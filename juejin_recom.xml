<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Pandas 入门指南]]></title>    <link>https://juejin.cn/post/7600989427906609206</link>    <guid>https://juejin.cn/post/7600989427906609206</guid>    <pubDate>2026-01-31T08:08:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600989427906609206" data-draft-id="7600999271770570752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pandas 入门指南"/> <meta itemprop="keywords" content="Python,pandas"/> <meta itemprop="datePublished" content="2026-01-31T08:08:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小张说故事"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pandas 入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小张说故事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T08:08:25.000Z" title="Sat Jan 31 2026 08:08:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 库的概览与核心价值</h2>
<p>想象一下，在数据分析工作中，如果你需要处理百万行 Excel 表格、清洗杂乱的数据、计算复杂的统计指标，就像用一把小勺子在挖土堆，不仅效率低下还容易出错。<code>Pandas</code> 正是为解决这个痛点而生的工具——它是 Python 数据分析领域的"瑞士军刀"。</p>
<p>Pandas 是基于 NumPy 构建的开源数据分析库，专门用于处理结构化数据。它填补了 NumPy 在处理非数值数据和混合类型数据方面的空白，让数据分析变得像操作 Excel 表格一样简单直观，同时具备处理大规模数据的高性能。</p>
<p>在 Python 数据科学生态中，Pandas 处于核心地位：上游连接数据源（CSV、Excel、SQL、JSON 等多种格式），下游衔接 NumPy（数值计算）、Matplotlib（可视化）和 Scikit-learn（机器学习）。掌握了 Pandas，你就拥有了从数据获取到建模准备的全流程能力。</p>
<h2 data-id="heading-1">2. 环境搭建与 "Hello, World"</h2>
<h3 data-id="heading-2">安装 Pandas</h3>
<p>Pandas 的安装非常简单，支持多种安装方式：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式1：使用 pip 安装（推荐）</span>
pip install pandas

<span class="hljs-comment"># 方式2：使用 conda 安装</span>
conda install pandas

<span class="hljs-comment"># 国内用户可使用镜像源加速</span>
pip install pandas -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
<p>安装完成后，在 Python 环境中导入并验证：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入 pandas（约定俗成使用 pd 作为别名）</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 打印版本号（确保安装成功）</span>
<span class="hljs-built_in">print</span>(pd.__version__)  <span class="hljs-comment"># 输出版本号，如 2.3.0</span>
</code></pre>
<h3 data-id="heading-3">Hello World 示例</h3>
<p>让我们通过一个简单的示例来体验 Pandas 的核心功能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

<span class="hljs-comment"># 创建一个简单的字典数据</span>
data = {
    <span class="hljs-string">'姓名'</span>: [<span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>],
    <span class="hljs-string">'年龄'</span>: [<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">28</span>],
    <span class="hljs-string">'城市'</span>: [<span class="hljs-string">'北京'</span>, <span class="hljs-string">'上海'</span>, <span class="hljs-string">'广州'</span>]
}

<span class="hljs-comment"># 将字典转换为 DataFrame（表格）</span>
df = pd.DataFrame(data)

<span class="hljs-comment"># 打印结果</span>
<span class="hljs-built_in">print</span>(df)
</code></pre>
<p><strong>逐行解释</strong>：</p>
<ul>
<li><code>import pandas as pd</code>：导入 Pandas 库，使用 <code>pd</code> 作为别名，这是 Python 社区的约定</li>
<li><code>data = {...}</code>：创建一个字典，包含姓名、年龄、城市三个字段的数据</li>
<li><code>df = pd.DataFrame(data)</code>：将字典转换为 <code>DataFrame</code> 对象，这是 Pandas 的核心数据结构，类似 Excel 表格</li>
<li><code>print(df)</code>：输出表格内容</li>
</ul>
<p><strong>运行结果</strong>：</p>
<pre><code class="hljs">   姓名  年龄   城市
0  张三  25  北京
1  李四  30  上海
2  王五  28  广州
</code></pre>
<p>看到这个结果，你可能已经发现了 Pandas 的优势：它自动为数据添加了行索引（0, 1, 2），并以整齐的表格形式展示数据，比 Python 原生的列表或字典直观得多。</p>
<h2 data-id="heading-4">3. 核心概念解析</h2>
<p>Pandas 的两大核心数据结构是 <code>Series</code>（一维序列）和 <code>DataFrame</code>（二维表格）。理解它们的区别和联系是掌握 Pandas 的关键。</p>
<h3 data-id="heading-5">Series：一维带标签数组</h3>
<p><code>Series</code> 是一个一维的带标签数组，可以理解为"带索引的列表"。每个元素都有一个对应的索引标签，默认是 0 开始的整数，也可以自定义。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建 Series</span>
s = pd.Series([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>], index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>], name=<span class="hljs-string">'数值'</span>)
<span class="hljs-built_in">print</span>(s)
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span>    <span class="hljs-number">10</span>
<span class="hljs-selector-tag">b</span>    <span class="hljs-number">20</span>
c    <span class="hljs-number">30</span>
Name: 数值, dtype: int64
</code></pre>
<p><strong>核心属性</strong>：</p>
<ul>
<li><code>values</code>：获取数据值（返回 NumPy 数组）</li>
<li><code>index</code>：获取索引标签</li>
<li><code>dtype</code>：数据类型（如 int64、float64、object 等）</li>
</ul>
<h3 data-id="heading-6">DataFrame：二维表格型数据</h3>
<p><code>DataFrame</code> 是二维的表格结构，可以理解为"多个 Series 按列组合而成"。它既有行索引也有列索引，类似 Excel 表格或数据库表。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 从字典创建 DataFrame</span>
data = {
    <span class="hljs-string">'姓名'</span>: [<span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>],
    <span class="hljs-string">'年龄'</span>: [<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">28</span>],
    <span class="hljs-string">'薪资'</span>: [<span class="hljs-number">15000</span>, <span class="hljs-number">20000</span>, <span class="hljs-number">18000</span>]
}
df = pd.DataFrame(data)
<span class="hljs-built_in">print</span>(df)
</code></pre>
<p>输出：</p>
<pre><code class="hljs">   姓名  年龄   薪资
0  张三  25  15000
1  李四  30  20000
2  王五  28  18000
</code></pre>
<p><strong>核心属性</strong>：</p>
<ul>
<li><code>shape</code>：数据维度（行数，列数）</li>
<li><code>columns</code>：列名（类似索引）</li>
<li><code>index</code>：行索引</li>
<li><code>values</code>：底层数据数组</li>
</ul>
<h3 data-id="heading-7">概念关系图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[NumPy数组] --&gt; B[Series 一维序列]
    B --&gt; C[DataFrame 二维表格]
    C --&gt; D[数据分析操作]
    C --&gt; E[数据可视化]
    C --&gt; F[机器学习]
    
    B -.-&gt;|组合成| C
    C -.-&gt;|提取为| B
    
    style B fill:#e1f5ff
    style C fill:#ffe1e1
</code></pre>
<p>这个图展示了 Pandas 的数据结构层级关系：</p>
<ul>
<li><code>Series</code> 基于 NumPy 数组构建，增加了标签索引功能</li>
<li><code>DataFrame</code> 由多个 <code>Series</code> 按列组合而成</li>
<li>从 <code>DataFrame</code> 中提取单列会返回 <code>Series</code></li>
<li><code>Series</code> 可以通过 <code>to_frame()</code> 方法转换为 <code>DataFrame</code></li>
</ul>
<p><strong>关键特性</strong>：</p>
<ul>
<li><strong>索引对齐</strong>：Pandas 运算时自动按索引对齐，即使顺序不同也能正确计算</li>
<li><strong>缺失值处理</strong>：自动识别和处理 <code>NaN</code>（Not a Number）缺失值</li>
<li><strong>灵活的数据类型</strong>：支持数值、字符串、日期等多种数据类型</li>
<li><strong>向量化操作</strong>：类似 NumPy，支持高效的向量化运算</li>
</ul>
<h2 data-id="heading-8">4. 实战演练：解决一个典型问题</h2>
<p>让我们通过一个完整的实战项目来体验 Pandas 的强大功能。假设我们有一份销售数据，需要进行分析和统计。</p>
<h3 data-id="heading-9">需求分析</h3>
<p>我们有某公司 2024 年上半年的销售数据，需要完成以下任务：</p>
<ol>
<li>查看数据概况</li>
<li>筛选高销售额订单</li>
<li>按月份统计销售总额</li>
<li>找出最佳销售员</li>
</ol>
<h3 data-id="heading-10">方案设计</h3>
<p>我们将使用 Pandas 的以下功能：</p>
<ul>
<li>数据读取：从 CSV 读取数据</li>
<li>数据查看：<code>head()</code>、<code>info()</code>、<code>describe()</code></li>
<li>数据筛选：布尔索引</li>
<li>数据分组：<code>groupby()</code> + 聚合函数</li>
<li>数据排序：<code>sort_values()</code></li>
</ul>
<h3 data-id="heading-11">代码实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 步骤1：创建模拟销售数据</span>
data = {
    <span class="hljs-string">'日期'</span>: pd.to_datetime([<span class="hljs-string">'2024-01-15'</span>, <span class="hljs-string">'2024-01-20'</span>, <span class="hljs-string">'2024-02-10'</span>, <span class="hljs-string">'2024-02-25'</span>, 
                           <span class="hljs-string">'2024-03-05'</span>, <span class="hljs-string">'2024-03-18'</span>, <span class="hljs-string">'2024-04-12'</span>, <span class="hljs-string">'2024-04-28'</span>,
                           <span class="hljs-string">'2024-05-08'</span>, <span class="hljs-string">'2024-05-22'</span>, <span class="hljs-string">'2024-06-05'</span>, <span class="hljs-string">'2024-06-18'</span>]),
    <span class="hljs-string">'销售员'</span>: [<span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>],
    <span class="hljs-string">'产品'</span>: [<span class="hljs-string">'产品A'</span>, <span class="hljs-string">'产品B'</span>, <span class="hljs-string">'产品A'</span>, <span class="hljs-string">'产品C'</span>, <span class="hljs-string">'产品B'</span>, <span class="hljs-string">'产品A'</span>, <span class="hljs-string">'产品C'</span>, <span class="hljs-string">'产品B'</span>, <span class="hljs-string">'产品A'</span>, <span class="hljs-string">'产品C'</span>, <span class="hljs-string">'产品B'</span>, <span class="hljs-string">'产品A'</span>],
    <span class="hljs-string">'销售额'</span>: [<span class="hljs-number">15000</span>, <span class="hljs-number">20000</span>, <span class="hljs-number">18000</span>, <span class="hljs-number">25000</span>, <span class="hljs-number">22000</span>, <span class="hljs-number">16000</span>, <span class="hljs-number">28000</span>, <span class="hljs-number">24000</span>, <span class="hljs-number">19000</span>, <span class="hljs-number">30000</span>, <span class="hljs-number">26000</span>, <span class="hljs-number">17000</span>]
}

<span class="hljs-comment"># 创建 DataFrame</span>
df = pd.DataFrame(data)

<span class="hljs-comment"># 步骤2：查看数据概况</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 数据概况 ==="</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"数据形状：<span class="hljs-subst">{df.shape}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n前5行数据：\n<span class="hljs-subst">{df.head()}</span>"</span>)

<span class="hljs-comment"># 步骤3：计算基本统计信息</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 销售额统计 ==="</span>)
<span class="hljs-built_in">print</span>(df[<span class="hljs-string">'销售额'</span>].describe())

<span class="hljs-comment"># 步骤4：筛选高销售额订单（&gt;20000）</span>
high_sales = df[df[<span class="hljs-string">'销售额'</span>] &gt; <span class="hljs-number">20000</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 高销售额订单（&gt;20000）==="</span>)
<span class="hljs-built_in">print</span>(high_sales[[<span class="hljs-string">'销售员'</span>, <span class="hljs-string">'产品'</span>, <span class="hljs-string">'销售额'</span>]])

<span class="hljs-comment"># 步骤5：按月份统计销售总额</span>
df[<span class="hljs-string">'月份'</span>] = df[<span class="hljs-string">'日期'</span>].dt.to_period(<span class="hljs-string">'M'</span>)
monthly_sales = df.groupby(<span class="hljs-string">'月份'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 月度销售总额 ==="</span>)
<span class="hljs-built_in">print</span>(monthly_sales)

<span class="hljs-comment"># 步骤6：统计各销售员的总销售额</span>
salesman_total = df.groupby(<span class="hljs-string">'销售员'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>().sort_values(ascending=<span class="hljs-literal">False</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 销售员业绩排名 ==="</span>)
<span class="hljs-built_in">print</span>(salesman_total)

<span class="hljs-comment"># 步骤7：找出最佳销售员</span>
best_salesman = salesman_total.index[<span class="hljs-number">0</span>]
best_total = salesman_total.iloc[<span class="hljs-number">0</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n最佳销售员是：<span class="hljs-subst">{best_salesman}</span>，总销售额：<span class="hljs-subst">{best_total:,}</span>"</span>)
</code></pre>
<h3 data-id="heading-12">运行说明</h3>
<p>将上述代码保存为 <code>.py</code> 文件并运行，你会看到如下输出：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">===</span> <span class="hljs-string">数据概况</span> <span class="hljs-string">===</span>
<span class="hljs-string">数据形状：(12,</span> <span class="hljs-number">4</span><span class="hljs-string">)</span>

<span class="hljs-string">前5行数据：</span>
        <span class="hljs-string">日期</span> <span class="hljs-string">销售员</span>   <span class="hljs-string">产品</span>   <span class="hljs-string">销售额</span>
<span class="hljs-number">0</span> <span class="hljs-number">2024-01-15</span>  <span class="hljs-string">张三</span>  <span class="hljs-string">产品A</span>  <span class="hljs-number">15000</span>
<span class="hljs-number">1</span> <span class="hljs-number">2024-01-20</span>  <span class="hljs-string">李四</span>  <span class="hljs-string">产品B</span>  <span class="hljs-number">20000</span>
<span class="hljs-number">2</span> <span class="hljs-number">2024-02-10</span>  <span class="hljs-string">王五</span>  <span class="hljs-string">产品A</span>  <span class="hljs-number">18000</span>
<span class="hljs-number">3</span> <span class="hljs-number">2024-02-25</span>  <span class="hljs-string">张三</span>  <span class="hljs-string">产品C</span>  <span class="hljs-number">25000</span>
<span class="hljs-number">4</span> <span class="hljs-number">2024-03-05</span>  <span class="hljs-string">李四</span>  <span class="hljs-string">产品B</span>  <span class="hljs-number">22000</span>

<span class="hljs-string">===</span> <span class="hljs-string">销售额统计</span> <span class="hljs-string">===</span>
<span class="hljs-string">count</span>       <span class="hljs-number">12.000000</span>
<span class="hljs-string">mean</span>     <span class="hljs-number">21833.333333</span>
<span class="hljs-string">std</span>       <span class="hljs-number">4783.921287</span>
<span class="hljs-string">min</span>      <span class="hljs-number">15000.000000</span>
<span class="hljs-number">25</span><span class="hljs-string">%</span>      <span class="hljs-number">18250.000000</span>
<span class="hljs-number">50</span><span class="hljs-string">%</span>      <span class="hljs-number">21500.000000</span>
<span class="hljs-number">75</span><span class="hljs-string">%</span>      <span class="hljs-number">25500.000000</span>
<span class="hljs-string">max</span>      <span class="hljs-number">30000.000000</span>
<span class="hljs-attr">Name:</span> <span class="hljs-string">销售额,</span> <span class="hljs-attr">dtype:</span> <span class="hljs-string">float64</span>

<span class="hljs-string">===</span> <span class="hljs-string">高销售额订单（&gt;20000）===</span>
   <span class="hljs-string">销售员</span>   <span class="hljs-string">产品</span>   <span class="hljs-string">销售额</span>
<span class="hljs-number">3</span>   <span class="hljs-string">张三</span>  <span class="hljs-string">产品C</span>  <span class="hljs-number">25000</span>
<span class="hljs-number">4</span>   <span class="hljs-string">李四</span>  <span class="hljs-string">产品B</span>  <span class="hljs-number">22000</span>
<span class="hljs-number">6</span>   <span class="hljs-string">张三</span>  <span class="hljs-string">产品C</span>  <span class="hljs-number">28000</span>
<span class="hljs-number">7</span>   <span class="hljs-string">李四</span>  <span class="hljs-string">产品B</span>  <span class="hljs-number">24000</span>
<span class="hljs-number">9</span>   <span class="hljs-string">张三</span>  <span class="hljs-string">产品C</span>  <span class="hljs-number">30000</span>
<span class="hljs-number">10</span>  <span class="hljs-string">李四</span>  <span class="hljs-string">产品B</span>  <span class="hljs-number">26000</span>

<span class="hljs-string">===</span> <span class="hljs-string">月度销售总额</span> <span class="hljs-string">===</span>
<span class="hljs-string">月份</span>
<span class="hljs-number">2024-01    </span><span class="hljs-number">35000</span>
<span class="hljs-number">2024-02    </span><span class="hljs-number">43000</span>
<span class="hljs-number">2024-03    </span><span class="hljs-number">38000</span>
<span class="hljs-number">2024-04    </span><span class="hljs-number">52000</span>
<span class="hljs-number">2024-05    </span><span class="hljs-number">49000</span>
<span class="hljs-number">2024-06    </span><span class="hljs-number">43000</span>
<span class="hljs-attr">Freq:</span> <span class="hljs-string">M,</span> <span class="hljs-attr">Name:</span> <span class="hljs-string">销售额,</span> <span class="hljs-attr">dtype:</span> <span class="hljs-string">int64</span>

<span class="hljs-string">===</span> <span class="hljs-string">销售员业绩排名</span> <span class="hljs-string">===</span>
<span class="hljs-string">销售员</span>
<span class="hljs-string">张三</span>    <span class="hljs-number">98000</span>
<span class="hljs-string">李四</span>    <span class="hljs-number">92000</span>
<span class="hljs-string">王五</span>    <span class="hljs-number">70000</span>
<span class="hljs-attr">Name:</span> <span class="hljs-string">销售额,</span> <span class="hljs-attr">dtype:</span> <span class="hljs-string">int64</span>

<span class="hljs-string">最佳销售员是：张三，总销售额：98,000</span>
</code></pre>
<h3 data-id="heading-13">结果分析</h3>
<p>通过这个实战案例，我们完成了：</p>
<ol>
<li><strong>数据创建与查看</strong>：使用字典创建 DataFrame，用 <code>head()</code> 快速预览</li>
<li><strong>统计分析</strong>：用 <code>describe()</code> 获得销售额的全面统计（均值、最值、标准差等）</li>
<li><strong>数据筛选</strong>：用布尔索引 <code>df['销售额'] &gt; 20000</code> 筛选高价值订单</li>
<li><strong>时间序列处理</strong>：用 <code>dt.to_period('M')</code> 提取月份</li>
<li><strong>分组聚合</strong>：用 <code>groupby()</code> + <code>sum()</code> 按月份和销售员统计</li>
<li><strong>数据排序</strong>：用 <code>sort_values()</code> 找出业绩最好的销售员</li>
</ol>
<p>这个项目涵盖了 Pandas 最核心的操作流程，展示了如何用简洁的代码完成复杂的数据分析任务。</p>
<h2 data-id="heading-14">5. 最佳实践与常见陷阱</h2>
<h3 data-id="heading-15">常见错误及规避方法</h3>
<p><strong>错误 1：链式赋值导致 SettingWithCopyWarning</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
df[df[<span class="hljs-string">'年龄'</span>] &gt; <span class="hljs-number">30</span>][<span class="hljs-string">'薪资'</span>] = <span class="hljs-number">0</span>  <span class="hljs-comment"># 可能报警告，且不会生效</span>

<span class="hljs-comment"># ✅ 正确做法</span>
df.loc[df[<span class="hljs-string">'年龄'</span>] &gt; <span class="hljs-number">30</span>, <span class="hljs-string">'薪资'</span>] = <span class="hljs-number">0</span>  <span class="hljs-comment"># 使用 loc 直接修改</span>
</code></pre>
<p><strong>错误 2：混淆 iloc 和 loc</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
df[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>, <span class="hljs-string">'姓名'</span>]  <span class="hljs-comment"># 语法错误，不能同时用位置和标签</span>

<span class="hljs-comment"># ✅ 正确做法</span>
df.iloc[<span class="hljs-number">0</span>:<span class="hljs-number">3</span>][<span class="hljs-string">'姓名'</span>]  <span class="hljs-comment"># 按位置选择</span>
df.loc[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>, <span class="hljs-string">'姓名'</span>]    <span class="hljs-comment"># 按标签选择</span>
</code></pre>
<p><strong>错误 3：忘记处理缺失值</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
df[<span class="hljs-string">'年龄'</span>].mean()  <span class="hljs-comment"># 如果有 NaN，结果也是 NaN</span>

<span class="hljs-comment"># ✅ 正确做法</span>
df[<span class="hljs-string">'年龄'</span>].fillna(<span class="hljs-number">0</span>).mean()  <span class="hljs-comment"># 先填充再计算</span>
<span class="hljs-comment"># 或</span>
df[<span class="hljs-string">'年龄'</span>].mean(skipna=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># 跳过缺失值</span>
</code></pre>
<h3 data-id="heading-16">最佳实践建议</h3>
<ol>
<li><strong>使用高效数据类型</strong>：对于大型数据集，将整数列从 <code>int64</code> 降级为 <code>int32</code> 可节省 50% 内存</li>
<li><strong>优先使用向量化操作</strong>：避免用 <code>for</code> 循环处理数据，向量化操作快 10-100 倍</li>
<li><strong>分块读取大文件</strong>：处理千万级数据时，用 <code>read_csv(chunksize=100000)</code> 分块加载</li>
<li><strong>显式创建副本</strong>：修改筛选后的数据时，用 <code>copy()</code> 避免链式赋值警告</li>
<li><strong>统一时间格式</strong>：日期数据尽早转为 <code>datetime</code> 类型，便于后续时间序列分析</li>
</ol>
<h2 data-id="heading-17">6. 进阶指引</h2>
<p>Pandas 的功能远不止于此，掌握基础后你可以继续探索：</p>
<p><strong>高级功能</strong>：</p>
<ul>
<li>时间序列分析：强大的日期处理和时间窗口操作</li>
<li>数据透视表：<code>pivot_table()</code> 实现复杂的数据重组</li>
<li>多表合并：<code>merge()</code>、<code>join()</code>、<code>concat()</code> 实现类似 SQL 的连接操作</li>
<li>性能优化：使用 <code>eval()</code>、<code>query()</code> 加速复杂计算</li>
</ul>
<p><strong>生态扩展</strong>：</p>
<ul>
<li><strong>数据可视化</strong>：集成 Matplotlib、Seaborn 快速绘图</li>
<li><strong>大数据处理</strong>：Dask、Modin 扩展 Pandas 处理能力到 TB 级数据</li>
<li><strong>机器学习</strong>：与 Scikit-learn 无缝衔接，用于特征工程</li>
</ul>
<p><strong>学习路径</strong>：</p>
<ol>
<li>掌握 Series/DataFrame 基础操作（创建、选择、筛选）</li>
<li>熟练数据清洗（缺失值、重复值、类型转换）</li>
<li>深入数据聚合与分组分析</li>
<li>学习时间序列和多表合并</li>
<li>探索性能优化和高级特性</li>
</ol>
<p><strong>推荐资源</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpandas.pydata.org%2Fdocs%2F" target="_blank" title="https://pandas.pydata.org/docs/" ref="nofollow noopener noreferrer">Pandas 官方文档</a>（最权威的参考）</li>
<li>《Python for Data Analysis》by Wes McKinney（Pandas 创始人的经典著作）</li>
<li>Kaggle Learn 的 Pandas 课程（免费实战教程）</li>
<li>实战项目：从真实数据集（如泰坦尼克号、房价预测）开始练习</li>
</ul>
<p>掌握 Pandas 是数据分析师的必备技能，它能让你的数据分析工作从"手工操作"升级为"自动化处理"，效率提升何止十倍！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始打造你的第一个AI智能体（Agent）——小白入门实战指南]]></title>    <link>https://juejin.cn/post/7601020578490581001</link>    <guid>https://juejin.cn/post/7601020578490581001</guid>    <pubDate>2026-01-31T07:17:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578490581001" data-draft-id="7601077764423254066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始打造你的第一个AI智能体（Agent）——小白入门实战指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-31T07:17:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大黄评测"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始打造你的第一个AI智能体（Agent）——小白入门实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大黄评测
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:17:40.000Z" title="Sat Jan 31 2026 07:17:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在人工智能迅猛发展的今天，"Agent"（智能体）已成为AI开发中的热门概念。无论你是编程新手，还是刚接触AI领域的爱好者，亲手创建一个属于自己的AI智能体，不仅能加深对AI工作原理的理解，还能为后续深入学习打下坚实基础。本文将手把手带你完成你的第一个AI Agent示例，全程使用通俗易懂的语言，无需高深背景知识。</p>
<h3 data-id="heading-0">什么是AI Agent？</h3>
<p>简单来说，AI Agent 是一个能感知环境、做出决策并执行动作的程序。它可以是一个聊天机器人、一个自动订票助手，甚至是一个能玩棋类游戏的AI对手。核心要素包括：</p>
<ul>
<li><strong>感知（Perception）</strong> ：接收外部输入（如用户问题、传感器数据等）</li>
<li><strong>思考（Reasoning）</strong> ：基于规则或模型处理信息</li>
<li><strong>行动（Action）</strong> ：输出响应或执行操作</li>
</ul>
<h3 data-id="heading-1">开发环境准备</h3>
<p>我们使用 Python 作为开发语言，因为它拥有丰富的AI生态库，且语法简洁。你需要安装以下工具：</p>
<pre><code class="hljs">pip install langchain openai python-dotenv
</code></pre>
<blockquote>
<p>注：如果你没有 OpenAI API Key，也可以使用开源模型（如 Ollama + Llama3）替代，本文以 OpenAI 为例。</p>
</blockquote>
<p>同时，在项目根目录创建 <code>.env</code> 文件，填入你的 API 密钥：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">OPENAI_API_KEY</span>=your-api-key-here
</code></pre>
<h3 data-id="heading-2">第一步：定义工具（Tools）</h3>
<p>Agent 的能力往往依赖于“工具”。比如，它可以调用计算器、搜索网页或查询数据库。我们先创建一个简单的“回声”工具：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> Tool

<span class="hljs-keyword">def</span> <span class="hljs-title function_">echo_tool</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"你说了：<span class="hljs-subst">{query}</span>"</span>

tools = [
    Tool(
        name=<span class="hljs-string">"Echo"</span>,
        func=echo_tool,
        description=<span class="hljs-string">"重复用户输入的内容"</span>
    )
]
</code></pre>
<h3 data-id="heading-3">第二步：初始化大语言模型（LLM）</h3>
<p>我们使用 OpenAI 的 GPT 模型作为 Agent 的“大脑”：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> <span class="hljs-title class_">ChatOpenAI</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">import</span> os

<span class="hljs-title function_">load_dotenv</span>()
llm = <span class="hljs-title class_">ChatOpenAI</span>(model=<span class="hljs-string">"gpt-3.5-turbo"</span>, temperature=<span class="hljs-number">0</span>)
</code></pre>
<h3 data-id="heading-4">第三步：创建并运行 Agent</h3>
<p>使用 LangChain 提供的 <code>create_react_agent</code> 快速构建一个 ReAct（Reason + Act）风格的智能体：</p>
<pre><code class="hljs language-ini" lang="ini">from langchain import hub
from langchain.agents import create_react_agent, AgentExecutor

<span class="hljs-comment"># 获取预设的 prompt 模板</span>
<span class="hljs-attr">prompt</span> = hub.pull(<span class="hljs-string">"hwchase17/react"</span>)

<span class="hljs-comment"># 创建 Agent</span>
<span class="hljs-attr">agent</span> = create_react_agent(llm, tools, prompt)

<span class="hljs-comment"># 创建执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(agent=agent, tools=tools, verbose=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 运行！</span>
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"你好，请重复我说的话：今天天气真好！"</span>})
print(response<span class="hljs-section">["output"]</span>)
</code></pre>
<p>运行后，你会看到类似这样的输出：</p>
<pre><code class="hljs">你说了：今天天气真好！
</code></pre>
<p>恭喜！你刚刚创建了一个具备基本感知-思考-行动能力的AI Agent！</p>
<h3 data-id="heading-5">扩展思路</h3>
<p>这个示例虽然简单，但已具备Agent的核心结构。你可以在此基础上：</p>
<ul>
<li>添加更多工具（如天气查询、数学计算）</li>
<li>接入本地知识库实现问答</li>
<li>部署为 Web 应用（使用 Flask 或 FastAPI）</li>
<li>使用记忆模块让 Agent 记住对话历史</li>
</ul>
<h3 data-id="heading-6">结语</h3>
<p>AI Agent 并非遥不可及的黑科技，而是一套清晰可构建的系统。通过这个“Hello World”级别的示例，希望你能迈出AI开发的第一步。记住：每一个复杂的智能系统，都始于一行简单的代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SQLcl：不只是 SQL*Plus 的升级版，更是 AI 时代数据库开发的智能连接器]]></title>    <link>https://juejin.cn/post/7600982613654913074</link>    <guid>https://juejin.cn/post/7600982613654913074</guid>    <pubDate>2026-01-31T07:23:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613654913074" data-draft-id="7601020578490695689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SQLcl：不只是 SQL*Plus 的升级版，更是 AI 时代数据库开发的智能连接器"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-31T07:23:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大黄评测"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SQLcl：不只是 SQL*Plus 的升级版，更是 AI 时代数据库开发的智能连接器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大黄评测
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:23:23.000Z" title="Sat Jan 31 2026 07:23:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Oracle 数据库工具演进史上，SQL<em>Plus 曾是无数 DBA 和开发者的“老战友”——简洁、稳定、无依赖。但随着 AI 与云原生时代的到来，命令行工具也需要进化。Oracle 推出的 <strong>SQLcl</strong>（SQL Developer Command Line）不仅全面兼容 SQL</em>Plus 语法，更以现代化交互、脚本扩展能力和原生 AI 集成，重新定义了数据库命令行体验。</p>
<p>它不再只是一个查询终端，而是连接开发者、数据库与生成式 AI 的<strong>智能桥梁</strong>。</p>
<hr/>
<h3 data-id="heading-0">一、从 SQL*Plus 到 SQLcl：不止是“更好看”</h3>
<p>SQLcl 延续了 SQL*Plus 的轻量与跨平台特性（基于 Java，支持 Windows/Linux/macOS），但在用户体验上实现了质的飞跃：</p>
<ul>
<li>✅ <strong>语法高亮与自动补全</strong>：输入 <code>SELECT * FROM emp</code> 时，表名、列名自动提示</li>
<li>✅ <strong>多行编辑与历史回溯</strong>：像现代 Shell 一样流畅编辑复杂语句</li>
<li>✅ <strong>内置 REST、JSON、CSV 支持</strong>：直接导出为结构化格式，无需额外脚本</li>
<li>✅ <strong>脚本语言支持 JavaScript / TypeScript</strong>：用 JS 编写数据库自动化任务</li>
</ul>
<p>例如，用 JavaScript 脚本一键生成表结构文档：</p>
<pre><code class="hljs language-lua" lang="lua">// table_info.js
var tables = db.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"SELECT table_name FROM user_tables"</span>);
tables.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(row)</span></span> {
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"=== "</span> + row[<span class="hljs-number">0</span>] + <span class="hljs-string">" ==="</span>);
    db.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"DESC "</span> + row[<span class="hljs-number">0</span>]).<span class="hljs-built_in">print</span>();
});
</code></pre>
<p>运行：<code>sql /nolog @table_info.js</code></p>
<p>这种灵活性让 SQLcl 成为 DevOps 和数据工程流水线的理想组件。</p>
<hr/>
<h3 data-id="heading-1">二、AI 时代的全新角色：SQLcl × Oracle AI</h3>
<p>真正让 SQLcl 脱颖而出的，是它与 <strong>Oracle Cloud Infrastructure（OCI）Generative AI 服务</strong>的深度集成。从 v23.4 开始，SQLcl 内置了 <code>AI</code> 命令，让你在命令行中直接调用大模型！</p>
<h4 data-id="heading-2">场景1：自然语言生成 SQL</h4>
<p>不会写复杂查询？直接问 AI：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">SQL&gt; </span><span class="bash">AI <span class="hljs-string">"列出过去30天销售额最高的5个客户，包括客户名和总金额"</span></span>
</code></pre>
<p>SQLcl 会调用 OCI 上的 Llama 或 Cohere 模型，返回可执行的 SQL 语句，并询问是否立即运行。</p>
<h4 data-id="heading-3">场景2：解释执行计划</h4>
<p>看不懂 <code>EXPLAIN PLAN</code> 的输出？让 AI 帮你解读：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> EXPLAIN PLAN <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'SHIPPED'</span>;
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> AI EXPLAIN
</code></pre>
<p>AI 会用通俗语言说明：“该查询使用了索引 IDX_ORD_STATUS，预计返回约12万行……”</p>
<h4 data-id="heading-4">场景3：自动生成测试数据或修复建议</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">SQL&gt; </span><span class="bash">AI <span class="hljs-string">"为 employees 表生成10条符合 HR 规则的测试数据"</span></span>
<span class="hljs-meta prompt_">SQL&gt; </span><span class="bash">AI <span class="hljs-string">"为什么这个 INSERT 报 ORA-02291？请给出解决方案"</span></span>
</code></pre>
<p>所有 AI 交互均通过企业级 OCI 服务完成，<strong>数据不经过公有大模型</strong>，保障安全合规。</p>
<hr/>
<h3 data-id="heading-5">三、为什么 SQLcl 是 AI 时代的“连接器”？</h3>



































<table><thead><tr><th>能力</th><th>传统工具（如 SQL*Plus）</th><th>SQLcl</th></tr></thead><tbody><tr><td>交互体验</td><td>纯文本，无提示</td><td>智能补全、语法高亮</td></tr><tr><td>脚本能力</td><td>仅 PL/SQL 或 Shell</td><td>支持 JavaScript/TypeScript</td></tr><tr><td>数据格式</td><td>仅文本表格</td><td>原生支持 JSON/CSV/XML</td></tr><tr><td>AI 集成</td><td>无</td><td>内置 <code>AI</code> 命令，直连 OCI GenAI</td></tr><tr><td>安全性</td><td>本地运行</td><td>支持 Wallet、OCI Auth、Vault 集成</td></tr></tbody></table>
<p>更重要的是，SQLcl <strong>无缝融入现有工作流</strong>。你无需放弃熟悉的 <code>/</code> 执行、<code>@script.sql</code> 调用等习惯，就能获得 AI 增强能力。</p>
<hr/>
<h3 data-id="heading-6">四、快速上手：三步启用 AI 功能</h3>
<ol>
<li>
<p><strong>安装 SQLcl</strong>（需 23.4+）<br/>
从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oracle.com%2Fdatabase%2Ftechnologies%2Fappdev%2Fsqlcl.html" target="_blank" title="https://www.oracle.com/database/technologies/appdev/sqlcl.html" ref="nofollow noopener noreferrer">Oracle 官网</a> 下载</p>
</li>
<li>
<p><strong>配置 OCI 凭据</strong><br/>
设置环境变量或使用 <code>oci setup config</code> 生成配置文件</p>
</li>
<li>
<p><strong>在 SQLcl 中启用 AI</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SET</span> AI <span class="hljs-keyword">ON</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> AI "显示当前用户有哪些表"
</code></pre>
</li>
</ol>
<p>首次使用会引导你选择模型（如 <code>meta/llama-3-70b-instruct</code>）和区域。</p>
<hr/>
<h3 data-id="heading-7">结语：命令行从未如此智能</h3>
<p>SQLcl 的使命，不只是取代 SQL*Plus，而是成为 <strong>AI 原生数据库开发的新入口</strong>。它让 DBA 从“记忆语法”转向“描述意图”，让开发者用自然语言与数据库对话，同时坚守企业对安全、可控和效率的要求。</p>
<p>在这个 AI 重构一切的时代，最强大的工具往往不是最炫的 GUI，而是那个你每天都在用、却悄然进化了的命令行——<br/>
<strong>SQLcl，正站在这个转折点上</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂Python装饰器]]></title>    <link>https://juejin.cn/post/7601000638344953871</link>    <guid>https://juejin.cn/post/7601000638344953871</guid>    <pubDate>2026-01-31T07:40:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601000638344953871" data-draft-id="7601077290680877108" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂Python装饰器"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-31T07:40:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Kevin666"/> <meta itemprop="url" content="https://juejin.cn/user/1549628692501449"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂Python装饰器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549628692501449/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Kevin666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:40:03.000Z" title="Sat Jan 31 2026 07:40:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F12722799041" target="_blank" title="https://zhuanlan.zhihu.com/p/12722799041" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/127227990…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D251567592%26content_type%3DArticle%26match_order%3D1%26q%3DPython%25E8%25A3%2585%25E9%25A5%25B0%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=251567592&amp;content_type=Article&amp;match_order=1&amp;q=Python%E8%A3%85%E9%A5%B0%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Python装饰器</a>是一个相对难以理解的概念，Up在初次接触时也觉得晦涩。本文尽可能用通俗易懂的语言和例子，解释清楚Python装饰器。</p>
<h3 data-id="heading-0">提前划重点</h3>
<ul>
<li>装饰器为什么难理解</li>
<li>先搞懂闭包</li>
<li>装饰器就是一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D251567592%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25AF%25AD%25E6%25B3%2595%25E7%25B3%2596%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=251567592&amp;content_type=Article&amp;match_order=1&amp;q=%E8%AF%AD%E6%B3%95%E7%B3%96&amp;zhida_source=entity" ref="nofollow noopener noreferrer">语法糖</a></li>
<li>装饰器的应用场景</li>
</ul>
<h3 data-id="heading-1">装饰器的为什么难理解</h3>
<p>我们先来看一个简单的例子，这个例子里我们定义了一个装饰器，用于在greet()函数执行前后各打印一条消息。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义一个简单的装饰器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_decorator</span>(<span class="hljs-params">func</span>):     <span class="hljs-comment"># 传入一个函数作为参数</span>
    <span class="hljs-comment"># 包装原始函数的内部函数</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"即将执行函数..."</span>)
        func()                  <span class="hljs-comment"># 执行原始函数</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"函数执行完毕。"</span>)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 使用装饰器</span>
<span class="hljs-meta">@simple_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你好！"</span>)

<span class="hljs-comment"># 调用被装饰的函数</span>
greet()

-------------------------
<span class="hljs-comment">## 打印</span>
即将执行函数...
你好！
函数执行完毕。
</code></pre>
<p>如果你是第一次接触装饰器，你一定觉得这个这个语法很难理解</p>
<ul>
<li>定义装饰器的时候，为什么simple_decorator函数里面，居然还有一个wrapper内部函数，并且返回值还是这个wrapper函数？？？</li>
<li>greet函数上面使用@simple_decorator是个什么用法？从来没见过</li>
</ul>
<p>没关系，大家可以先建立一个印象，大概这个装饰器是怎么用的。下面我们来一一拆解，<strong>并没有那么复杂！</strong></p>
<h3 data-id="heading-2">先搞懂闭包</h3>
<p>理解Python装饰器的前提是，我们先要搞懂<strong>闭包</strong>这个概念。</p>
<p>通俗来说，闭包就是<strong>函数</strong>及其<strong>周边环境</strong>的组合。（在<strong>本文语境下</strong>，你可以暂时理解<strong>周边环境就是一些外部的变量</strong>）</p>
<p>闭包通常涉及到一个内部函数，内部函数可以访问（或者说‘记住’）<strong>外部函数的局部变量</strong>，<strong>即使外部函数已经执行完毕</strong>。</p>
<p>这么说可能还是有点抽象，我们回到开头那个例子，wrapper就是一个内部函数，当我们调用simple_decorator(greet)会返回wrapper。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_decorator</span>(<span class="hljs-params">func</span>): <span class="hljs-comment"># 传入一个函数作为参数</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"即将执行函数..."</span>)
        func()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"函数执行完毕。"</span>)
    <span class="hljs-keyword">return</span> wrapper <span class="hljs-comment"># 返回wrapper</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你好！"</span>)

closure = simple_decorator(greet) <span class="hljs-comment"># simple_decorator(greet)会返回wrapper，这就是一个闭包实例</span>
</code></pre>
<p>这个closure就是一个闭包实例！</p>
<p>我们来理解一下，通常我们觉得wrapper这种函数就是它定义的代码吗，很简单：</p>
<pre><code class="hljs language-scss" lang="scss">def <span class="hljs-built_in">wrapper</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"即将执行函数..."</span>)
    <span class="hljs-built_in">func</span>()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"函数执行完毕。"</span>)
</code></pre>
<p>但是当wrapper作为内部函数的时候，调用simple_decorator(greet)返回的wrapper是一个闭包，除了上面定义的代码，它还能<strong>记住外层函数的变量</strong>，没错就是func变量，具体到这次调用就是我们传入的greet函数。<strong>即使simple_decorator已经执行完了，依然可以记住greet。</strong> 这个记住外部变量是大家不太熟悉的或者难以理解的原因。</p>
<p>所以，当我们调用closure()时：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">closure</span>()

-------
# 本质是执行了以下代码
<span class="hljs-built_in">print</span>("即将执行函数...")
<span class="hljs-built_in">greet</span>() # greet会被记住
<span class="hljs-built_in">print</span>("函数执行完毕。")

-------
## 打印
即将执行函数...
你好！
函数执行完毕。
</code></pre>
<h3 data-id="heading-3">装饰器就是一个语法糖</h3>
<p>下面我们再说说，@simple_decorator</p>
<p>通过上面的分析相信大家已经看出来了，这两种写法貌似是等效的：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 写法一</span>
<span class="hljs-meta">@simple_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你好！"</span>)

greet() <span class="hljs-comment"># 调用greet</span>

<span class="hljs-comment"># 写法二</span>
closure = simple_decorator(greet)
closure() <span class="hljs-comment"># 调用closure</span>
</code></pre>
<p>我们再进一步，其实写法二没必要引入一个新的变量closure，我们完全可以复用greet。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">写法三</span>
greet = simple_decorator(greet)
greet() # greet
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># greet本身指向自己定义的代码</span></span>
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment"># simple_decorator(greet) 返回wrapper，这是一个闭包</span></span>
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment"># 直接让greet指向新的闭包</span></span>
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment"># 这样调用greet()的时候，相当于调用的是闭包</span></span>
</code></pre>
<p>我们抽象一点，@这个用法本质就是一个语法糖，让程序员写代码更方便的一种写法而已：</p>
<pre><code class="hljs language-lua" lang="lua">@decorator
def <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>:
    ...

<span class="hljs-comment">------------   </span>
本质上就是
<span class="hljs-function"><span class="hljs-keyword">function</span> = <span class="hljs-title">decorator</span><span class="hljs-params">(function)</span></span>
</code></pre>
<h3 data-id="heading-4">装饰器的应用场景</h3>
<p>通过上述分析，我们可以看到，装饰器似乎提供了<strong>一种动态修改或者说加强函数的能力</strong>，通过使用装饰器，你可以在原函数的基础上增加一些逻辑。</p>
<p>那装饰器主要可以用在哪些场景呢</p>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D251567592%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2597%25A5%25E5%25BF%2597%25E8%25AE%25B0%25E5%25BD%2595%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=251567592&amp;content_type=Article&amp;match_order=1&amp;q=%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95&amp;zhida_source=entity" ref="nofollow noopener noreferrer">日志记录</a></strong>：在函数执行前后自动添加日志记录，方便调试和监控程序行为。</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D251567592%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2580%25A7%25E8%2583%25BD%25E6%25B5%258B%25E8%25AF%2595%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=251567592&amp;content_type=Article&amp;match_order=1&amp;q=%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95&amp;zhida_source=entity" ref="nofollow noopener noreferrer">性能测试</a></strong>：装饰器可以用来测量函数的执行时间，帮助识别性能瓶颈。</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D251567592%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%259D%2583%25E9%2599%2590%25E9%25AA%258C%25E8%25AF%2581%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=251567592&amp;content_type=Article&amp;match_order=1&amp;q=%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81&amp;zhida_source=entity" ref="nofollow noopener noreferrer">权限验证</a></strong>：在Web开发中，装饰器可以用于检查用户是否有权访问某个资源或执行特定操作。</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D251567592%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BC%2593%25E5%25AD%2598%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=251567592&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BC%93%E5%AD%98&amp;zhida_source=entity" ref="nofollow noopener noreferrer">缓存</a>（Memoization）</strong> ：通过装饰器实现函数结果的缓存，避免重复计算相同的输入值，从而提高效率。</li>
</ol>
<p>等等等等..</p>
<p>当你使用装饰器实现了这些功能，只需要使用@在想要增强的函数前面声明一下，可以<strong>非常清晰的表示你在本身函数业务的基础上，增加了什么逻辑</strong>。如果没有装饰器，你必须写到函数本身的代码里，这会不利于理解和复用，让这种增强逻辑和本身业务逻辑耦合。所以装饰器，<strong>也可以理解成一种优雅的语法，帮助程序变得清晰解耦。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 HTML 中引入 JavaScript 有哪几种方式？它们各自的优缺点是什么？]]></title>    <link>https://juejin.cn/post/7601020578490679305</link>    <guid>https://juejin.cn/post/7601020578490679305</guid>    <pubDate>2026-01-31T07:22:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578490679305" data-draft-id="7601077764423335986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 HTML 中引入 JavaScript 有哪几种方式？它们各自的优缺点是什么？"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-31T07:22:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smilezyl"/> <meta itemprop="url" content="https://juejin.cn/user/3438928103504088"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 HTML 中引入 JavaScript 有哪几种方式？它们各自的优缺点是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928103504088/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smilezyl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:22:47.000Z" title="Sat Jan 31 2026 07:22:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">在 HTML 中引入 JavaScript 有哪几种方式？它们各自的优缺点是什么？</h2>
<h3 data-id="heading-1">核心答案</h3>
<p>在 HTML 中引入 JavaScript 有 <strong>3 种主要方式</strong>：</p>

























<table><thead><tr><th>方式</th><th>语法</th><th>主要场景</th></tr></thead><tbody><tr><td><strong>1. 行内式</strong></td><td><code>&lt;div onclick="alert('hi')"&gt;</code></td><td>极少使用，不推荐</td></tr><tr><td><strong>2. 内嵌式</strong></td><td><code>&lt;script&gt;alert('hi')&lt;/script&gt;</code></td><td>小型脚本、单页应用</td></tr><tr><td><strong>3. 外链式</strong></td><td><code>&lt;script src="app.js"&gt;&lt;/script&gt;</code></td><td><strong>生产环境首选</strong></td></tr></tbody></table>
<p><strong>核心原则</strong>：生产环境优先使用外链式，配合 <code>defer</code> 或 <code>async</code> 优化加载性能。</p>
<hr/>
<h3 data-id="heading-2">深入解析</h3>
<h4 data-id="heading-3">1. 三种方式详解</h4>
<h5 data-id="heading-4">方式一：行内式（Inline）</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 直接在 HTML 属性中写 JS --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"alert('点击了！')"</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:void(0)"</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">"console.log('悬停')"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li>快速测试、简单直观</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>❌ HTML 和 JS 强耦合，难以维护</li>
<li>❌ 无法复用逻辑</li>
<li>❌ 代码混乱，可读性差</li>
<li>❌ 存在 XSS 安全风险</li>
<li>❌ 无法利用浏览器缓存</li>
</ul>
<hr/>
<h5 data-id="heading-5">方式二：内嵌式（Internal / Embedded）</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml">
        // JS 代码写在 <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"> 标签内
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'页面初始化'</span>);
        }
    </span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>内嵌式示例<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li>✓ 适合单页应用或小型项目</li>
<li>✓ HTML 和 JS 在同一文件，便于调试</li>
<li>✓ 可以访问页面中的所有元素</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>❌ HTML 文件体积变大</li>
<li>❌ 无法被浏览器缓存（每次加载 HTML 都要重新加载 JS）</li>
<li>❌ 多个页面无法共享同一份 JS 代码</li>
<li>❌ 不符合关注点分离原则</li>
</ul>
<hr/>
<h5 data-id="heading-6">方式三：外链式（External）⭐ <strong>推荐</strong></h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 基础用法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 推荐用法：配合 defer --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/app.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 或者 async（取决于场景） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/analytics.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li>✅ <strong>HTML 与 JS 分离</strong>，结构清晰</li>
<li>✅ <strong>可复用</strong>：多个页面共享同一个 JS 文件</li>
<li>✅ <strong>可缓存</strong>：浏览器缓存 JS 文件，提升加载速度</li>
<li>✅ <strong>便于维护</strong>：代码独立管理</li>
<li>✅ <strong>支持模块化</strong>：方便团队协作</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>⚠️ 需要额外的 HTTP 请求（但可通过缓存和打包优化）</li>
</ul>
<hr/>
<h4 data-id="heading-7">2. <code>&lt;script&gt;</code> 标签的关键属性</h4>
<h5 data-id="heading-8"><code>defer</code> 和 <code>async</code> 的区别</h5>
<pre><code class="hljs language-less" lang="less">页面解析流程对比：

无属性（默认）:
<span class="hljs-selector-tag">HTML</span>解析 → 遇到<span class="hljs-selector-tag">script</span> → 停止解析 → 下载<span class="hljs-selector-tag">JS</span> → 执行<span class="hljs-selector-tag">JS</span> → 继续解析<span class="hljs-selector-tag">HTML</span>
                ↑ 阻塞页面渲染 ↑

<span class="hljs-selector-tag">defer</span>:
<span class="hljs-selector-tag">HTML</span>解析 → 并行下载<span class="hljs-selector-tag">JS</span> → <span class="hljs-selector-tag">HTML</span>解析完成 → 按顺序执行<span class="hljs-selector-tag">JS</span> → <span class="hljs-selector-tag">DOMContentLoaded</span>
            ↓ 不阻塞解析 ↓

<span class="hljs-selector-tag">async</span>:
<span class="hljs-selector-tag">HTML</span>解析 → 并行下载<span class="hljs-selector-tag">JS</span> → 下载完立即执行 → 继续解析<span class="hljs-selector-tag">HTML</span>
            ↓ 执行时机不确定 ↓
</code></pre>





























<table><thead><tr><th>属性</th><th>执行时机</th><th>顺序保证</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>无属性</strong></td><td>立即执行，阻塞解析</td><td>✅ 按顺序</td><td>无</td></tr><tr><td><strong>defer</strong></td><td>HTML 解析完成后，<code>DOMContentLoaded</code> 前</td><td>✅ 按顺序</td><td><strong>DOM 操作脚本</strong></td></tr><tr><td><strong>async</strong></td><td>下载完成后立即执行</td><td>❌ 无顺序保证</td><td><strong>独立脚本</strong>（如统计、广告）</td></tr></tbody></table>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- defer 推荐用法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"main.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"utils.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 保证：utils.js 一定在 main.js 之前执行 --&gt;</span>

<span class="hljs-comment">&lt;!-- async 用法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"ads.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 不保证执行顺序，谁先下载完谁先执行 --&gt;</span>
</code></pre>
<h5 data-id="heading-9">其他重要属性</h5>






























<table><thead><tr><th>属性</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td><code>type</code></td><td>指定脚本类型</td><td><code>type="module"</code>（ES 模块）</td></tr><tr><td><code>crossorigin</code></td><td>CORS 配置</td><td><code>crossorigin="anonymous"</code></td></tr><tr><td><code>integrity</code></td><td>SRI（子资源完整性校验）</td><td><code>integrity="sha384-..."</code></td></tr><tr><td><code>nomodule</code></td><td>不支持模块的浏览器才执行</td><td><code>&lt;script nomodule src="legacy.js"&gt;&lt;/script&gt;</code></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-10">3. 底层机制：浏览器如何加载和执行脚本</h4>
<pre><code class="hljs language-xml" lang="xml">┌─────────────────────────────────────────────────────────┐
│                    浏览器渲染流程                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. HTML Parser ──→ 构建 DOM 树                          │
│         ↓                                                 │
│  2. CSS Parser ──→ 构建 CSSOM 树                         │
│         ↓                                                 │
│  3. 合并 ──→ 渲染树（Render Tree）                        │
│         ↓                                                 │
│  4. Layout（布局）                                        │
│         ↓                                                 │
│  5. Paint（绘制）                                         │
│                                                          │
└─────────────────────────────────────────────────────────┘

遇到 <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"> 时：

默认行为：
┌─────────┐
│ 停止解析 │ ← 阻塞 <span class="hljs-variable constant_">DOM</span> 构建
└────┬────┘
     ↓
┌─────────┐
│ 下载 <span class="hljs-variable constant_">JS</span> │ ← 如果是外链脚本
└────┬────┘
     ↓
┌─────────┐
│ 执行 <span class="hljs-variable constant_">JS</span> │ ← 阻塞渲染
└────┬────┘
     ↓
┌─────────┐
│ 继续解析 │
└─────────┘

使用 defer/<span class="hljs-keyword">async</span>：
┌─────────┐      ┌─────────┐
 │继续解析 │ ←→   │并行下载 │  ← 不阻塞
└─────────┘      └─────────┘
</span></code></pre>
<hr/>
<h4 data-id="heading-11">4. 最佳实践</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>最佳实践示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- CSS 放在 head 中 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"styles.css"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 预加载关键脚本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 页面内容 --&gt;</span>

    <span class="hljs-comment">&lt;!-- 方案1：现代浏览器推荐 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"main.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方案2：需要立即执行的脚本（如 polyfill） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 同步执行的小型脚本</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方案3：独立第三方脚本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方案4：ES 模块 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"module.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方案5：模块降级方案 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"modern.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"legacy.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-12">5. 常见误区</h4>
<blockquote>
<p>❌ <strong>误区1</strong>：<code>defer</code> 和 <code>async</code> 功能一样</p>
<p>✅ <strong>纠正</strong>：<code>defer</code> 保证顺序且在 DOMContentLoaded 前执行，<code>async</code> 不保证顺序</p>
</blockquote>
<blockquote>
<p>❌ <strong>误区2</strong>：把所有 <code>&lt;script&gt;</code> 都放在 <code>&lt;head&gt;</code> 里</p>
<p>✅ <strong>纠正</strong>：传统放 <code>&lt;/body&gt;</code> 前，现代用 <code>defer</code> 可放 <code>head</code></p>
</blockquote>
<blockquote>
<p>❌ <strong>误区3</strong>：<code>defer</code> 的脚本一定在 <code>DOMContentLoaded</code> 前执行</p>
<p>✅ <strong>纠正</strong>：大部分情况是的，但如果脚本很大或网络慢，可能在之后</p>
</blockquote>
<blockquote>
<p>❌ <strong>误区4</strong>：多个 <code>async</code> 脚本按书写顺序执行</p>
<p>✅ <strong>纠正</strong>：<code>async</code> 脚本按下载完成顺序执行，顺序不可控</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">代码示例</h3>
<h4 data-id="heading-14">示例1：三种引入方式对比</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>JS 引入方式对比<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方式1：行内式（不推荐） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"handleClick()"</span>&gt;</span>行内式按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方式2：内嵌式 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'内嵌式函数被调用'</span>);
        }

        <span class="hljs-comment">// 内嵌式可以直接操作页面</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'DOM 加载完成'</span>);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 方式3：外链式（推荐） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/utils.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>三种引入方式<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 行内式的完整示例 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onmouseover</span>=<span class="hljs-string">"this.style.background='yellow'"</span>
         <span class="hljs-attr">onmouseout</span>=<span class="hljs-string">"this.style.background='white'"</span>&gt;</span>
        鼠标悬停变色
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-15">示例2：defer vs async 实际效果</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>defer vs async<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>页面标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 同步脚本：阻塞后续渲染</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 同步脚本开始'</span>);
        <span class="hljs-comment">// 模拟耗时操作</span>
        <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
        <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">2000</span>) {}
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 同步脚本结束（阻塞了2秒）'</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这行内容被延迟显示了<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- defer 脚本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"defer1.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"defer2.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 保证：defer1.js 在 defer2.js 之前执行 --&gt;</span>

    <span class="hljs-comment">&lt;!-- async 脚本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"async1.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"async2.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 不保证：谁先下载完谁先执行 --&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. DOMContentLoaded 触发'</span>);
        });

        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 页面完全加载完成'</span>);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">示例3：现代项目的标准引入方式</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>现代项目<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 预连接到 CDN --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preconnect"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.example.com"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 预加载关键资源 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.css"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"style"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 关键 CSS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.css"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Polyfill：需要立即执行且不依赖 DOM --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 检测和添加必要的 polyfill</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">Promise</span>) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;script src="polyfills/promise.js"&gt;&lt;\/script&gt;'</span>);
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主要应用脚本：使用 defer --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"vendors.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"main.js"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 第三方统计：使用 async --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span> <span class="hljs-attr">async</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- ES 模块 + 降级方案 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"modern-app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"legacy-app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-17">示例4：动态加载脚本</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 动态创建 script 标签</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">url, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
        script.<span class="hljs-property">src</span> = url;

        <span class="hljs-comment">// 设置属性</span>
        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">async</span>) script.<span class="hljs-property">async</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">defer</span>) script.<span class="hljs-property">defer</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">type</span>) script.<span class="hljs-property">type</span> = options.<span class="hljs-property">type</span>;

        <span class="hljs-comment">// 事件监听</span>
        script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(script);
        script.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Failed to load <span class="hljs-subst">${url}</span>`</span>));

        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);
    });
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initApp</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">'/utils.js'</span>, { <span class="hljs-attr">defer</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">'/main.js'</span>, { <span class="hljs-attr">defer</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有脚本加载完成'</span>);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'脚本加载失败:'</span>, error);
    }
}

<span class="hljs-comment">// 条件加载</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">'IntersectionObserver'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
    <span class="hljs-comment">// 支持，加载现代版本</span>
    <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">'/modern-image-lazy-load.js'</span>);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 不支持，加载 polyfill</span>
    <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">'/polyfills/intersection-observer.js'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">'/legacy-image-lazy-load.js'</span>));
}
</code></pre>
<hr/>
<h3 data-id="heading-18">面试技巧</h3>
<h4 data-id="heading-19">面试官可能的追问</h4>
<ol>
<li>
<p><strong>"为什么传统建议把 <code>&lt;script&gt;</code> 放在 <code>&lt;/body&gt;</code> 之前？"</strong></p>
<ul>
<li>避免阻塞页面渲染，让用户先看到内容</li>
</ul>
</li>
<li>
<p><strong>"现在有了 <code>defer</code>，还需要放 <code>&lt;/body&gt;</code> 前吗？"</strong></p>
<ul>
<li>不需要，<code>defer</code> 可放 <code>head</code>，效果相同且更早开始下载</li>
</ul>
</li>
<li>
<p><strong>"什么情况下用 <code>async</code>？"</strong></p>
<ul>
<li>独立脚本：统计代码、广告脚本、不依赖其他代码的库</li>
</ul>
</li>
<li>
<p><strong>"多个 <code>defer</code> 脚本的执行顺序？"</strong></p>
<ul>
<li>按在 HTML 中的出现顺序执行</li>
</ul>
</li>
<li>
<p><strong>"<code>defer</code> 和 <code>DOMContentLoaded</code> 的关系？"</strong></p>
<ul>
<li><code>defer</code> 脚本在 DOMContentLoaded 之前执行</li>
</ul>
</li>
<li>
<p><strong>"什么是脚本阻塞（render blocking）？"</strong></p>
<ul>
<li>解释浏览器解析 HTML 时遇到 <code>&lt;script&gt;</code> 停止渲染的机制</li>
</ul>
</li>
</ol>
<h4 data-id="heading-20">如何展示深度理解</h4>
<ol>
<li>
<p><strong>谈性能优化</strong>：</p>
<ul>
<li>关键渲染路径优化</li>
<li>资源预加载（preload/prefetch）</li>
<li>代码分割（code splitting）</li>
</ul>
</li>
<li>
<p><strong>谈实际项目经验</strong>：</p>
<ul>
<li>如何处理第三方脚本（如 Google Analytics）</li>
<li>如何优化首屏加载时间</li>
<li>使用过哪些构建工具的优化</li>
</ul>
</li>
<li>
<p><strong>谈浏览器兼容性</strong>：</p>
<ul>
<li><code>defer</code>/<code>async</code> 的浏览器支持情况</li>
<li>如何为老浏览器做降级处理</li>
</ul>
</li>
<li>
<p><strong>谈安全</strong>：</p>
<ul>
<li>SRI（Subresource Integrity）</li>
<li>nonce/CSP（Content Security Policy）</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-21">一句话总结</h3>
<blockquote>
<p><strong>外链式 + <code>defer</code> 是现代网页引入 JavaScript 的最佳实践，它实现了代码分离、可缓存、不阻塞渲染的完美平衡。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[什么是"阻塞渲染"？如何避免 JavaScript 代码阻塞页面渲染？]]></title>    <link>https://juejin.cn/post/7600982613654929458</link>    <guid>https://juejin.cn/post/7600982613654929458</guid>    <pubDate>2026-01-31T07:24:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613654929458" data-draft-id="7601077764423401522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="什么是&quot;阻塞渲染&quot;？如何避免 JavaScript 代码阻塞页面渲染？"/> <meta itemprop="keywords" content="面试,JavaScript"/> <meta itemprop="datePublished" content="2026-01-31T07:24:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smilezyl"/> <meta itemprop="url" content="https://juejin.cn/user/3438928103504088"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            什么是"阻塞渲染"？如何避免 JavaScript 代码阻塞页面渲染？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928103504088/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smilezyl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:24:32.000Z" title="Sat Jan 31 2026 07:24:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是"阻塞渲染"？如何避免 JavaScript 代码阻塞页面渲染？</h2>
<h3 data-id="heading-1">核心答案</h3>
<p><strong>阻塞渲染</strong>是指浏览器在解析 HTML 构建 DOM 树的过程中，遇到 <code>&lt;script&gt;</code> 标签时会暂停 DOM 解析，等待脚本下载并执行完毕后才继续解析。这是因为 JavaScript 可能会修改 DOM 结构（如 <code>document.write</code>），浏览器必须确保 DOM 的正确性。</p>
<p><strong>避免阻塞的核心方法：</strong></p>
<ol>
<li>使用 <code>async</code> 属性：脚本异步下载，下载完立即执行</li>
<li>使用 <code>defer</code> 属性：脚本异步下载，DOM 解析完成后按顺序执行</li>
<li>将脚本放在 <code>&lt;/body&gt;</code> 前</li>
<li>动态创建 script 标签</li>
</ol>
<h3 data-id="heading-2">深入解析</h3>
<h4 data-id="heading-3">浏览器渲染流程</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">HTML</span> → DOM Tree
                  → Render Tree → Layout → Paint
CSS  → CSSOM
</code></pre>
<h4 data-id="heading-4">阻塞机制详解</h4>
<p><strong>1. JavaScript 阻塞 DOM 解析</strong></p>
<pre><code class="hljs language-xml" lang="xml">HTML解析 → 遇到<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> → 暂停解析 → 下载JS → 执行JS → 继续解析
</code></pre>
<p><strong>2. CSS 也会间接阻塞</strong></p>
<ul>
<li>CSS 本身不阻塞 DOM 解析，但阻塞渲染</li>
<li>如果 JS 在 CSS 之后，JS 会等待 CSSOM 构建完成（因为 JS 可能访问样式）</li>
</ul>
<h4 data-id="heading-5">async vs defer 的区别</h4>






























<table><thead><tr><th>特性</th><th>async</th><th>defer</th></tr></thead><tbody><tr><td>下载</td><td>异步，不阻塞解析</td><td>异步，不阻塞解析</td></tr><tr><td>执行时机</td><td>下载完立即执行</td><td>DOM 解析完成后执行</td></tr><tr><td>执行顺序</td><td>不保证顺序</td><td>保证顺序</td></tr><tr><td>适用场景</td><td>独立脚本（统计、广告）</td><td>有依赖关系的脚本</td></tr></tbody></table>
<h4 data-id="heading-6">常见误区</h4>
<ol>
<li>
<p><strong>误区：async 和 defer 可以同时使用</strong></p>
<ul>
<li>实际：同时存在时，现代浏览器优先使用 async</li>
</ul>
</li>
<li>
<p><strong>误区：内联脚本可以使用 async/defer</strong></p>
<ul>
<li>实际：async/defer 只对外部脚本有效</li>
</ul>
</li>
<li>
<p><strong>误区：放在 body 底部就不会阻塞</strong></p>
<ul>
<li>实际：仍会阻塞，只是此时 DOM 已基本解析完成，影响较小</li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">代码示例</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 1. 阻塞渲染（默认行为） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 2. async：异步下载，下载完立即执行 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 3. defer：异步下载，DOM 解析后按顺序执行 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"vendor.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 保证在 vendor.js 之后执行 --&gt;</span>

<span class="hljs-comment">&lt;!-- 4. 动态加载脚本 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
  script.<span class="hljs-property">src</span> = <span class="hljs-string">'lazy-module.js'</span>;
  script.<span class="hljs-property">async</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 保证顺序执行</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 5. 模块脚本（默认 defer 行为） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.mjs"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 6. 预加载关键资源 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">现代优化方案</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 Intersection Observer 懒加载脚本</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
  entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
      <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
      script.<span class="hljs-property">src</span> = entry.<span class="hljs-property">target</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);
      observer.<span class="hljs-title function_">unobserve</span>(entry.<span class="hljs-property">target</span>);
    }
  });
});

<span class="hljs-comment">// 使用 requestIdleCallback 在空闲时加载</span>
<span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
  script.<span class="hljs-property">src</span> = <span class="hljs-string">'non-critical.js'</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);
});
</code></pre>
<h3 data-id="heading-9">面试技巧</h3>
<h4 data-id="heading-10">可能的追问方向</h4>
<ol>
<li>
<p><strong>"async 和 defer 的执行时机具体是什么？"</strong></p>
<ul>
<li>async：下载完成后立即执行，可能在 DOMContentLoaded 之前或之后</li>
<li>defer：在 DOMContentLoaded 事件之前执行</li>
</ul>
</li>
<li>
<p><strong>"CSS 会阻塞 JS 执行吗？"</strong></p>
<ul>
<li>会。如果 <code>&lt;script&gt;</code> 在 <code>&lt;link&gt;</code> 之后，JS 会等待 CSSOM 构建完成</li>
</ul>
</li>
<li>
<p><strong>"如何检测和量化阻塞时间？"</strong></p>
<ul>
<li>Performance API、Lighthouse、Chrome DevTools Performance 面板</li>
</ul>
</li>
<li>
<p><strong>"type="module" 的脚本有什么特点？"</strong></p>
<ul>
<li>默认 defer 行为、严格模式、独立作用域、支持 import/export</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">展示深度的回答技巧</h4>
<ul>
<li>提及浏览器的预解析器（Preload Scanner）会提前扫描并下载资源</li>
<li>讨论 Critical Rendering Path 优化策略</li>
<li>结合实际项目经验，如 Webpack 的代码分割、动态 import</li>
</ul>
<h3 data-id="heading-12">一句话总结</h3>
<blockquote>
<p><strong>JS 阻塞 DOM 解析是因为可能修改 DOM；用 defer 保顺序、async 求速度、动态加载最灵活。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue视频播放器：基于vue-video-player的自定义视频播放器实现]]></title>    <link>https://juejin.cn/post/7601053058856157190</link>    <guid>https://juejin.cn/post/7601053058856157190</guid>    <pubDate>2026-01-31T07:32:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601053058856157190" data-draft-id="7601053058856042502" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue视频播放器：基于vue-video-player的自定义视频播放器实现"/> <meta itemprop="keywords" content="前端框架"/> <meta itemprop="datePublished" content="2026-01-31T07:32:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户943339501512"/> <meta itemprop="url" content="https://juejin.cn/user/1496911244173812"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue视频播放器：基于vue-video-player的自定义视频播放器实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1496911244173812/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户943339501512
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:32:36.000Z" title="Sat Jan 31 2026 07:32:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<h3 data-id="heading-1">目标</h3>
<p>实现类似el-image组件的视频查看器，支持预览和切换。但 element -ui 中没有封装对于视频的查看组件，在多方调研后，引入<code>vue-video-player</code>实现这一功能。</p>
<h3 data-id="heading-2">功能介绍</h3>
<p><code>vue-video-player</code> 是一个基于 <strong>Video.js</strong> 封装的 Vue 组件库，旨在为 Vue 开发者提供一套简洁、可复用的视频播放器集成方案。其本质是将 Video.js 的强大功能（如 HLS 支持、字幕加载、全屏控制等）通过 Vue 的组件化机制进行封装，从而实现声明式调用和响应式更新。</p>
<h2 data-id="heading-3">官方文档</h2>
<ol>
<li>vue-video-player：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsurmon-china%2Fvideojs-player" target="_blank" title="https://github.com/surmon-china/videojs-player" ref="nofollow noopener noreferrer">github.com/surmon-chin…</a></li>
<li>video.js：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.videojs.com%2Fdocs%2Fapi%2Fplayer.html" target="_blank" title="https://docs.videojs.com/docs/api/player.html" ref="nofollow noopener noreferrer">docs.videojs.com/docs/api/pl…</a></li>
</ol>
<h2 data-id="heading-4">安装</h2>
<h3 data-id="heading-5">版本兼容性</h3>
<p>随着 Vue3 的发布及其 Composition API 的普及，vue-video-player 的维护团队逐步将开发重心转向 Vue3 生态。对于新版本有如下改变：</p>
<ul>
<li>6.x 及以上版本开始依赖 Vue3 的 runtime-core 和新的组件模型；</li>
<li>不再支持<code>Vue.use()</code>这种全局注册方式；</li>
<li>使用了 Vue3 特有的响应式系统（Proxy 代替 defineProperty）；</li>
<li>构建工具链升级至 Vite，导致与 Vue2 项目的 webpack 配置存在冲突风险。</li>
</ul>
<h3 data-id="heading-6">版本选择策略</h3>























<table><thead><tr><th>需求场景</th><th>建议版本</th><th>安装命令</th><th>引入方式</th></tr></thead><tbody><tr><td>Vue2 项目</td><td>^5.0.2</td><td><code>npm install vue-video-player@^5.0.2</code></td><td><code>Vue.use(VueVideoPlayer)</code></td></tr><tr><td>Vue3 项目</td><td>^6.0.0</td><td><code>npm install vue-video-player@latest</code></td><td><code>app.use(VueVideoPlayer)</code></td></tr></tbody></table>
<h3 data-id="heading-7">错误使用案例</h3>
<ol>
<li>在安装依赖时未注意<code>版本约束</code>，导致运行时报错：</li>
</ol>

<pre><code class="hljs language-markdown" lang="markdown">[<span class="hljs-symbol">Vue warn</span>]: <span class="hljs-link">Unknown custom element: &lt;video-player&gt;</span>
Did you register the component correctly?
</code></pre>
<p>2.  Vue2 版本最佳实践建议：</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// package.json 中显式锁定版本</span>
<span class="hljs-string">"dependencies"</span>: {
  <span class="hljs-string">"vue-video-player"</span>: <span class="hljs-string">"^5.0.2"</span>,
  <span class="hljs-string">"video.js"</span>: <span class="hljs-string">"^7.10.2"</span>
}

<span class="hljs-comment">// main.js 中正确引入</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueVideoPlayer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-video-player'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'vue-video-player/node_modules/video.js/dist/video-js.css'</span>

<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueVideoPlayer</span>)
</code></pre>
<h2 data-id="heading-8">使用</h2>
<h3 data-id="heading-9">基本用法</h3>
<ol>
<li>属性配置</li>
</ol>
<p>我们可以通过playerOptions配置自定义属性，关键属性包括<code>src</code>（视频地址）、<code>:controls</code>（是否显示控制栏）、<code>:autoplay</code>（自动播放）、<code>:loop</code>（循环播放）以及<code>:volume</code>（音量设置）等。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"visible"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-mask-wrapper"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"viewer-wrapper"</span> @<span class="hljs-attr">click.self</span>=<span class="hljs-string">"handleClose"</span>&gt;</span>
         ……
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-player-wrapper"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"videoBoxStyle"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">video-player</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"`${index}-${viewerData.subLink}`"</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">"videoPlayer"</span>
          <span class="hljs-attr">class</span>=<span class="hljs-string">"video-player"</span>
          <span class="hljs-attr">:options</span>=<span class="hljs-string">"playerOptions"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: {
    ……
  },
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-title function_">playerOptions</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 自动播放</span>
        <span class="hljs-attr">controls</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 显示播放控制条</span>
        <span class="hljs-attr">preload</span>: <span class="hljs-string">'metadata'</span>,
        <span class="hljs-attr">fluid</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 自适应容器，设为false，使用自定义css样式控制</span>
        <span class="hljs-attr">sources</span>: [{ <span class="hljs-attr">src</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewerData</span>.<span class="hljs-property">subLink</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'video/mp4'</span> }],
        <span class="hljs-attr">controlBar</span>: {
          <span class="hljs-attr">volumePanel</span>: { <span class="hljs-attr">inline</span>: <span class="hljs-literal">false</span> }, <span class="hljs-comment">// 音量面板，inline置为false时：点击音量图标时弹出独立的垂直滑块</span>
          <span class="hljs-attr">playToggle</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 控制条的播放暂停按钮</span>
        },
        <span class="hljs-attr">bigPlayButton</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 隐藏大播放按钮</span>
      };
    },
  },
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.video-mask-wrapper</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2000</span>;
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-selector-class">.viewer-wrapper</span> {
    <span class="hljs-attribute">position</span>: absolute;
    inset: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2002</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-selector-class">.video-player-wrapper</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1000px</span>;
      <span class="hljs-attribute">max-height</span>: <span class="hljs-number">850px</span>;
      <span class="hljs-selector-class">.video-player</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      }
    }
  }
}
::v-deep .video-js {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
}
::v-deep .video-js .vjs-tech {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">object-fit</span>: contain;
  <span class="hljs-attribute">background-color</span>: transparent;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>2.  方法</p>

<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">player</span> = this.<span class="hljs-variable">$refs</span>.videoPlayer &amp;&amp; this.<span class="hljs-variable">$refs</span>.videoPlayer.player<span class="hljs-comment">;</span>

player.pause()<span class="hljs-comment">;</span>
player.load()<span class="hljs-comment">;</span>
player.src(<span class="hljs-section">[{ src: newSrc, type: 'video/mp4' }]</span>)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><code>addTextTrack()</code>：向音频/视频添加新的文本轨道。</li>
<li><code>canPlayType()</code>：检测浏览器是否能播放指定的音频/视频类型。</li>
<li><code>load()</code>：重新加载音频/视频元素。</li>
<li><code>play()</code>：开始播放音频/视频。</li>
<li><code>pause()</code>：暂停当前播放的音频/视频。</li>
<li>……</li>
</ul>
<ol start="3">
<li>事件</li>
</ol>
<ul>
<li><code>waiting</code>：当视频由于需要缓冲下一帧而停止时触发。</li>
<li><code>canplay</code>：当浏览器可以开始播放音频/视频时触发。</li>
<li><code>error</code>：当在音频/视频加载期间发生错误时触发。</li>
<li><code>loadedmetadata</code>：当浏览器已加载音频/视频的元数据时触发。</li>
<li>……</li>
</ul>
<ol start="4">
<li>支持的视频格式</li>
</ol>
<ul>
<li>可参考文档【测试说明】部分，<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F1186216" target="_blank" title="https://cloud.tencent.com/developer/article/1186216" ref="nofollow noopener noreferrer">cloud.tencent.com/developer/a…</a></li>
<li>若要播放m3u8视频流：1、需要引入<code>video.js</code>并绑定到window上；2、安装依赖<code>videojs-contrib-hls</code>并引入；3、sources 要指定<code>type: application/x-mpegURL</code></li>
</ul>
<h3 data-id="heading-10">二次封装</h3>
<p>基于用户操作习惯，我们需要对播放器进行二次封装，主要包括：</p>
<h4 data-id="heading-11">播放器动态宽高</h4>
<ol>
<li>解决什么问题
<ul>
<li>播放器配置项中自带的<code>fluid</code> 属性,可以调整视频比例来自适应容器大小，但这会导致与原始比例严重失调，比如在网页上通常是宽〉高，但如果视频是竖屏的，这时就会压缩视频高度适应容器，视觉效果大打折扣。</li>
<li>视频不足以撑满整个容器时，会存在黑边</li>
</ul>
</li>
<li>解决方案：如下流程图所示，基于当前传入的视频原始尺寸、视窗宽高、设定的最大宽高，动态计算当前视频下播放器的宽高，实现在设定的最大宽高范围内：
<ul>
<li>视频宽或者高大于设定最大宽高，基于比例缩放视频宽高</li>
<li>视频宽和高都不超过设定的最大宽高，使用原始视频宽高</li>
</ul>
</li>
<li>实现效果
<ul>
<li>视频宽高和播放器宽高完全一致，避免存在黑边的现象</li>
<li>缩放后依然保持视频原始比例，保证视觉效果</li>
<li>通过CSS 样式调整，可以将播放器背景设置为transparent，当视频加载时，就不会一直呈现黑色背景</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00f5c22ab42a4f0a842f34f36341d1fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTQzMzM5NTAxNTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449555&amp;x-signature=2995oLrjOolCGlR78maaSUZ7tGU%3D" alt="动态计算播放器尺寸.jpg" loading="lazy"/>
4.  部分代码</p>
<pre><code class="hljs language-ini" lang="ini"> computed: {
    // 将动态计算的视频宽高绑定到播放容器
    getVideoBoxStyle() {
      const <span class="hljs-attr">w</span> = this.boxWidth || <span class="hljs-number">0</span><span class="hljs-comment">;</span>
      const <span class="hljs-attr">h</span> = this.boxHeight || <span class="hljs-number">0</span><span class="hljs-comment">;</span>
      const <span class="hljs-attr">style</span> = {}<span class="hljs-comment">;</span>

      if (w &gt; 0 &amp;&amp; h &gt; 0) {
        <span class="hljs-attr">style.width</span> = w + <span class="hljs-string">'px'</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">style.height</span> = h + <span class="hljs-string">'px'</span><span class="hljs-comment">;</span>
      }

      return style<span class="hljs-comment">;</span>
    },
  },    
methods:{
    // 基于原始尺寸和当前可用空间，计算播放器尺寸    
    handleBoxSizeResize() {
      const { w, h } = this.naturalVideo || {}<span class="hljs-comment">;</span>
      const { LIMIT_W, LIMIT_H } = this<span class="hljs-comment">;</span>

      // 取视窗宽高与设置的最大宽高的最小值，作为播放器的最大宽高
      const <span class="hljs-attr">maxW</span> = Math.min(window.innerWidth, LIMIT_W)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">maxH</span> = Math.min(window.innerHeight, LIMIT_H)<span class="hljs-comment">;</span>

      // 取宽度、高度缩放比例的最小值，保证视频完整显示
      const <span class="hljs-attr">scale</span> = Math.min(<span class="hljs-number">1</span>, Math.min(maxW / w, maxH / h))<span class="hljs-comment">;</span>

      <span class="hljs-attr">this.boxWidth</span> = Math.max(<span class="hljs-number">0</span>, Math.round(w * (isFinite(scale) ? scale : <span class="hljs-number">1</span>)))<span class="hljs-comment">;</span>
      <span class="hljs-attr">this.boxHeight</span> = Math.max(<span class="hljs-number">0</span>, Math.round(h * (isFinite(scale) ? scale : <span class="hljs-number">1</span>)))<span class="hljs-comment">;</span>
    },

    // 基于最大宽高，动态计算视频宽高
    getVideoContainerSize() {
      const <span class="hljs-attr">player</span> = this.<span class="hljs-variable">$refs</span>.videoPlayer.player<span class="hljs-comment">;</span>
      const <span class="hljs-attr">node</span> = player.el().querySelector(<span class="hljs-string">'video'</span>)<span class="hljs-comment">;</span>

      const <span class="hljs-attr">compute</span> = () =&gt; {
        const <span class="hljs-attr">originVideoWidth</span> = node.videoWidth<span class="hljs-comment">;</span>
        const <span class="hljs-attr">originVideoHeight</span> = node.videoHeight<span class="hljs-comment">;</span>
        <span class="hljs-attr">this.naturalVideo</span> = { w: originVideoWidth, h: originVideoHeight }<span class="hljs-comment">;</span>
        this.handleBoxSizeResize()<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      // 若已加载元数据，直接计算；否则监听到加载后，执行compute
      if (node &amp;&amp; node.readyState &gt;= 1) {
        compute()<span class="hljs-comment">;</span>
      } else if (node) {
        node.addEventListener('loadedmetadata', compute, { once: true })<span class="hljs-comment">;</span>
      }
    },
}
</code></pre>
<h4 data-id="heading-12">多视频切换播放</h4>
<ol>
<li>解决什么问题：当前业务背景下，多个视频在弹窗内按顺序排列，如果要查看其他视频，需要退出当前视频后，再点击另一个视频查看，操作麻烦</li>
<li>解决方案：
<ul>
<li>在视频预览页面增加左、右箭头icon，绑定click事件，基于当前视频索引，当切换上一条视频时，父组件将index-1索引的视频信息传入播放器组件，播放器重新渲染；切换下一条视频时，同理。</li>
<li>监听<code>keyDown</code>事件，按下键盘左箭头、右箭头时，同上面逻辑。</li>
<li>增加<code>watch</code>监听，当监听到视频数据 viewerData 更新时，<code>重置视频预览数据</code>，同时进行<code>视频切源</code></li>
</ul>
</li>
<li>实现效果
<ul>
<li>点击左右箭头，支持上一条/下一条切换视频</li>
<li>监听键盘事件，支持键盘左右箭头事件来切换视频</li>
</ul>
</li>
<li>部分代码</li>
</ol>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 重置视频状态</span>
    handleVideoStateReset() {
      <span class="hljs-keyword">this</span>.boxWidth = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">this</span>.boxHeight = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">this</span>.naturalVideo = { w: <span class="hljs-number">0</span>, h: <span class="hljs-number">0</span> };
      <span class="hljs-keyword">this</span>.isLoading = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">this</span>.loadError = <span class="hljs-literal">false</span>;
    },
    <span class="hljs-comment">// 视频切源</span>
    handleVideoCutResource() {
      <span class="hljs-keyword">const</span> player = <span class="hljs-keyword">this</span>.$refs.videoPlayer &amp;&amp; <span class="hljs-keyword">this</span>.$refs.videoPlayer.player;
      <span class="hljs-keyword">const</span> newSrc = <span class="hljs-keyword">this</span>.viewerData &amp;&amp; <span class="hljs-keyword">this</span>.viewerData.subLink;

      <span class="hljs-keyword">if</span> (player &amp;&amp; newSrc) {
        player.pause();
        player.src([{ src: newSrc, type: <span class="hljs-string">'video/mp4'</span> }]);
        player.load();

        <span class="hljs-comment">// 监听视频事件</span>
        <span class="hljs-keyword">this</span>.bindVideoEvents(player);

        player.one(<span class="hljs-string">'loadedmetadata'</span>, () =&gt; {
          <span class="hljs-keyword">this</span>.getVideoContainerSize();
        });
      }
    },    
    <span class="hljs-comment">// 上一个视频</span>
    handlePreVideoChange(index) {
      <span class="hljs-keyword">this</span>.handleVideoSwitch(index, -<span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.dialogData.carveUrlList.length);
    },
    <span class="hljs-comment">// 下一个视频</span>
    handleNextVideoChange(index) {
      <span class="hljs-keyword">this</span>.handleVideoSwitch(index, <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.dialogData.carveUrlList.length);
    },
    <span class="hljs-comment">// 键盘左右箭头切换视频</span>
    handleVideoKeyDown(event) {
      <span class="hljs-keyword">const</span> length = <span class="hljs-keyword">this</span>.dialogData.carveUrlList.length;
      <span class="hljs-keyword">const</span> index = Number(<span class="hljs-keyword">this</span>.videoSafeAreaViewer.index) || <span class="hljs-number">0</span>;

    <span class="hljs-comment">// 视频查看器未渲染、视频列表为空、只有一个视频时，不执行切换事件</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.videoSafeAreaViewer.visible || !length || length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (event.key === <span class="hljs-string">'ArrowRight'</span>) {
        <span class="hljs-keyword">this</span>.handleVideoSwitch(index, <span class="hljs-number">1</span>, length);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.key === <span class="hljs-string">'ArrowLeft'</span>) {
        <span class="hljs-keyword">this</span>.handleVideoSwitch(index, -<span class="hljs-number">1</span>, length);
      }
    },
    <span class="hljs-comment">// 切换视频</span>
    handleVideoSwitch(index, step, len) {
      <span class="hljs-keyword">const</span> videoList = <span class="hljs-keyword">this</span>.dialogData.carveUrlList || [];
      <span class="hljs-keyword">const</span> idx = (index + step + len) % len;

      <span class="hljs-keyword">this</span>.handleVideoPreview(videoList[idx], idx, <span class="hljs-keyword">this</span>.dialogData.carveUrlList);
    },
</code></pre>
<h4 data-id="heading-13">视频加载提示</h4>
<ol>
<li>解决什么问题
<ul>
<li>视频加载时，页面没有内容显示，用户对视频加载无感知</li>
</ul>
</li>
<li>解决方案：在视频播放器容器中，增加提示块
<ul>
<li>视频加载中，设置 isLoading: true，渲染提示块，提示内容：视频正在加载中，请稍后……</li>
<li>视频加载失败，设置 loadingError: true，渲染提示块，提示内容：视频加载失败；增加<code>el-icon-refresh-left</code>图标，绑定click事件支持重新加载</li>
<li>重新加载事件包括：1、重置预览数据，2、视频切源</li>
<li>视频加载完成，提示块不可见，播放视频</li>
</ul>
</li>
<li>实现效果
<ul>
<li>视频加载中、加载失败提示，用户可感知视频加载进度</li>
<li>加载失败时支持重新加载，避免因偶发网络原因导致的失败，用户无需刷新/退出就能再次尝试加载视频</li>
</ul>
</li>
<li>部分代码</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-player-wrapper"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"getVideoBoxStyle"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 视频加载提示 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">"isLoading || loadingError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-status-tip"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"status-content"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 加载中 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isLoading &amp;&amp; !loadingError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-state"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-loading status-icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"status-text"</span>&gt;</span>视频正在加载中，请稍后...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 加载失败 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"loadingError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-state"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"status-text"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: #f56c6c"</span>
                &gt;</span>视频加载失败<span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-refresh-left"</span> @<span class="hljs-attr">click.stop</span>=<span class="hljs-string">"handleVideoReload"</span>&gt;</span>&lt;/i
              &gt;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 视频播放器 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">video-player</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"`${index}-${viewerData.subLink}`"</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">"videoPlayer"</span>
          <span class="hljs-attr">class</span>=<span class="hljs-string">"video-player"</span>
          <span class="hljs-attr">:options</span>=<span class="hljs-string">"playerOptions"</span>
          @<span class="hljs-attr">dblclick.native</span>=<span class="hljs-string">"toggleFullscreen"</span>
          @<span class="hljs-attr">waiting</span>=<span class="hljs-string">"handleVideoWaiting"</span>
          @<span class="hljs-attr">canplay</span>=<span class="hljs-string">"handleVideoCanPlay"</span>
          @<span class="hljs-attr">loadeddata</span>=<span class="hljs-string">"handleVideoLoadedData"</span>
          @<span class="hljs-attr">error</span>=<span class="hljs-string">"handleVideoError"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">双击进入/退出全屏</h4>
<ol>
<li>解决什么问题：video-player组件未显示配置双击进入/退出全屏事件，需要手动绑定dbclick事件</li>
<li>解决方案：为视频播放器绑定dbclick事件</li>
<li>实现效果：非全屏状态下双击全屏播放，反之退出全屏状态</li>
<li>部分代码</li>
</ol>

<pre><code class="hljs language-ini" lang="ini">  // 双击切换全屏
    toggleFullscreen() {
      const <span class="hljs-attr">videoPlayer</span> = this.<span class="hljs-variable">$refs</span>.videoPlayer<span class="hljs-comment">;</span>
      const <span class="hljs-attr">player</span> = videoPlayer &amp;&amp; videoPlayer.player<span class="hljs-comment">;</span>

      if (!player) {
        console.warn('<span class="hljs-section">[MKVideoSafeAreaViewer]</span> toggleFullscreen: player not ready')<span class="hljs-comment">;</span>
        return<span class="hljs-comment">;</span>
      }

      if (player.isFullscreen()) {
        player.exitFullscreen()<span class="hljs-comment">;</span>
      } else {
        player.requestFullscreen()<span class="hljs-comment">;</span>
      }
    },
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-appD4（uni-forms学习与回顾）]]></title>    <link>https://juejin.cn/post/7601044684773883942</link>    <guid>https://juejin.cn/post/7601044684773883942</guid>    <pubDate>2026-01-31T07:33:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601044684773883942" data-draft-id="7599634796583960582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-appD4（uni-forms学习与回顾）"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T07:33:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱泡脚的鸡腿"/> <meta itemprop="url" content="https://juejin.cn/user/4466663535419179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-appD4（uni-forms学习与回顾）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466663535419179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱泡脚的鸡腿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:33:45.000Z" title="Sat Jan 31 2026 07:33:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.补充小程序路由跳转方式</h2>
<p><strong>·wx.navigateTo：</strong> 按照顺序向页面栈中放入打开过的页面</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43cafe65021b42249ecc99940ac716d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=5R0oOb%2F7cV8sWmJkzJ%2FVKPpDcAg%3D" alt="image.png" loading="lazy"/> <strong>·wx.redierctTo：</strong> 先把上一个页面删掉，再把自己页面放入栈内</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a24954e26404475af5c49f34f3a29f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=W75oxZoWq46clwuEO21nKP4feDI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>·wx.reLaunch：</strong> 清空页面栈</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46b7b99c955747b4aaf3faa50f4a8d1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=nLhkjbqfKYCNjqmLc%2F2jMFmPf%2FQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2. uni-file-picker：实现文件上传功能</h2>
<h3 data-id="heading-2">2.1 开通uniCloud Web云存储空间</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.dcloud.net.cn%2F" target="_blank" title="https://dev.dcloud.net.cn/" ref="nofollow noopener noreferrer">dev.dcloud.net.cn/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91ccabdb148e4ea58c65e1828c5369b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=Mn1DAul8DG%2BKxzPY0jg5ny7BWh8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 在项目中与云空间关联</h3>
<p>先创建云开发环境
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e83cff49fb4d07bbc2ea7a8a062599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=s9kC6aXT2fnUI6aLo7jnrS8x1uY%3D" alt="image.png" loading="lazy"/>
再点击关联</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4b0a252df69459993bf71a45aa929cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=8weVuhl7OD32II8H3ZA0Q1kup%2BU%3D" alt="image.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/730194352ffa4408986f656db1ba4eef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=vMWoGaHeiLb0vShb%2FpdEZr0g2FE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">2.3 使用uni-file-picker</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Fcomponent%2Funiui%2Funi-file-picker.html" target="_blank" title="https://uniapp.dcloud.net.cn/component/uniui/uni-file-picker.html" ref="nofollow noopener noreferrer">uni-app官网</a>
上传结果可以使用v-model获取</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aa3625cc1e84d23a402ba4c074287ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=QlLeodt6Dfse81dGxQxasuz%2Fo%2BM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">2.3.1 验证</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c3871ba486b4ed48a36f949427c8627~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=XTEpWN9PVQ4Xv0uP8Ghn0wY0tew%3D" alt="image.png" loading="lazy"/><br/>
<strong>上面的数组和下方的数组必须至少都要有一个单元，否则‘提交’按钮不高亮</strong></p>
<h5 data-id="heading-6">2.3.1.1 定义上凭证与下凭证数组</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c937fe481414434a93ef540c0957175c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=ChPdiP1k5CX8i7Dsr5T2NxCuis8%3D" alt="image.png" loading="lazy"/>
<strong>做判断，当两个数组都有数据时才不禁用button</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce2badfd1e9e4ce29379764d83f2f8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=2aD04h8te2vo3fETMgRw4pt63sw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">2.4 接口只需要url，所以要处理掉其他的字段</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54a3c9d3d3784bb88e7330d07946f54e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=c2CoJF90KlR2bWWr%2Fh7viYFg%2BbU%3D" alt="image.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f889657491d147dd9298dfc3fb482551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=6R6huxVJTr5mq1DUlbbE8XoIWpE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/764ebf173f954fc7a122fa3b641f5535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=zrOhv%2FWlqmlLz4kKDGh13%2F0mjWs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4023b67ff0c542e99db974d25b35b62c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=1Ucjlv36PTzrqDkfEl3Qt930Yzs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">2.5 当用户点击提交的时候，调用接口，提交数组的url</h3>
<h4 data-id="heading-9">2.5.1 封装接口</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/886403218b664269bdb0c59ad14291f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=r7nz4K3kvf5ovQqq85Z9aBikjX4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">2.5.2 监听按钮</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95c614b61d6641e9b6b5ad81ace1e73d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=3VzlTwArXxQv8vtXXMcGFWk4BWQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c2d89725607488eb1ee22a77b334892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=S8qp5IggS1JVKi%2BKk%2BJJ4QAFnsc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">3 在途</h2>
<p>注意：是一对一运送，所以在途最多只能有一条任务</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be0aa6ffb125412d85c45897bdadd102~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=cTQ5tCxHncxOgmGk4Gh%2BQswrxLk%3D" alt="image.png" loading="lazy"/>
实现组件一加载就执行逻辑
<strong>获取接口数据</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9bd2b5ee10a41f2826e91f7cb8aa32e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=NMLyBSovM1ag4wL6z77IagxWid8%3D" alt="image.png" loading="lazy"/>
<strong>渲染数据</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04d0fce3cf08464f849fafdfcfe5944e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=4%2B%2FJWRZmwDmCNxV8kqa1UGlSYsI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48549e4772744da98ae0e1781e1e537f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=%2BRUSn65i6sNYRDj6hPO6WJHdlXw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">4 异常上报</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad8f1b3487a84c5b9bf995c6e0ff5a41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=UscvTdvzQEavNgjqWdOQNjXRuyk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">4.1 异常时间</h3>
<p>使用到uni-datetime-picker和uni-list组件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3834044bc66940f690e625cd8d10d3d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=xmrdDOlYi2uXZ5SJ0kRefp1Iqw4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0283692e9a67492b96f8ece6b6ab9e5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=qwmpiaFPMnLvVjx%2F3Dcv42L4cJ8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/062e9898e75746d8b678ec43f976309c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=W9wH52xCD3udA05WllskoM96pnY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">4.2 上报位置</h3>
<p>需要调用wx.chooseLocation和wx.chooseLocation</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6efd3ca87c00466fba56da5c647c8b0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=vEoNcr42NlYCNxY1bx1QHowrwrg%3D" alt="image.png" loading="lazy"/>
去腾讯申请key</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d987c9069314400bb908331ce7f463a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=NToQ7MUAvSVgLml4NbvY1bn9hv4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/652b68bb52af4fb0a9b65452325697cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=spMIMMdfSUO%2FW0F%2FNSC2AfLQ8Vw%3D" alt="image.png" loading="lazy"/>
拿到用户选择的地址，渲染到页面上
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b9dab8f44614e5781927b4e2fc393cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=ZgzD0isYR4HgIhA5dPy9r7BQyrQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">4.3 异常类型</h3>
<p>使用change事件监听用户有没有选择或者有没有取消</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bd12f666cb7424380585e92e77450b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=f8F0Ej35HhxaIcUkIp4SPCgZhzQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fad193d5c4a45cfba6ff1af433692a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=clIIJ%2FRK3ZtuQWO2qrmslfnFd8E%3D" alt="image.png" loading="lazy"/>
监听事件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e8688b2bea41b89fff2f16ac6e646e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=MktKcq2P%2FQZ4oOiEFZCkaRIvhbc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e305494cfdf04e6a965b0eab662197ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=xyQ9tD5SYnuWCndJKxKdPLvmuNE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5746e2562cfc4c749aa45649a162fb77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=LymK6LA6J8%2FPESvhtoMIZCBFlos%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/778c5fe29a084aa8b89aaa21258b9fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=b3dzsKIVs%2FxUW90FqjtkXWfBJ%2FU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-16">4.4 异常描述</h3>
<p>使用v-model获取即可</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5801d1ed7acd47f1ab82f019d9356be1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=sKM8CLJo%2FwNNkA9qIRAYD4khmAY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3c74b439a4b469dab44cd327d1200ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=vYEdjgKolkpnMQMPpHBEuUfmxkU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">4.5 异常图片</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c0f4561bf8a42e4b45706b52b609ba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=%2FnCmpuMES9gB%2FpgErOFXg%2BA0j5Y%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6656266056834da5b84d60131d503c1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=EAyb54U1liSnjc4uBQwt5ZAqybg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-18">4.6 调用接口用于提交数据</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80785df083b943e7af7a44cd9eedcc46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=ighVrhHBg3ifuj7p3f7x47vclNI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c77e47ac1d451e92be7f26c97a8fb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=6L%2F4dT%2BeMtRZXNi4jPYD2QCmtFg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-19">4.7 用户选择异常类型，并且回显到页面</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9b107c2623443cfba3d655b8af23a1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=rdCTzjfSAWaXQww0vIZUR4nkHvs%3D" alt="image.png" loading="lazy"/>
<strong>渲染回显</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/004d8ed45d2d468f9dfc433276fd69cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=270tFMszEnOaO1PnWVp1SRAfq4E%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f34c61f2ce34c9daa143dda0a6d51ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=8XO2NcIPtcY9hbu5fcZOKHtwZ1Q%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfb63665e5f42a6ba26d422a7df2f4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=C8zgBHsd1rZVkhYpBl23WVIVAk0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-20">4.8 调用接口</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8236d40f03be4ed68dbee8087cec5606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=9AAIm%2F9o1jVaMaGgdp%2FRJH3vqH8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/934cbc30c2a74b1f9aff04befc02b736~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=X%2Blmik5iNW3vFX26j18%2FApL7EAg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ed825c0068f4b50a19d1e2caf7e4edf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=IPjuCdJcr%2BFqgCD%2FKziqHCmHoB8%3D" alt="image.png" loading="lazy"/>
其中传过去的id要从url中获取，所以又要使用onLoad，来获取id（这里的id对应的参数名为transportTaskId）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afc8df7be1e24b3388f101ccb2809df3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=bOLkESwWpq9mB1yCiNzpxgpS3TU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19141a7f8d2447fca7f3705e13eab317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=Xj1aFI1%2FXBktAXRJTpvDcOPAwmQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f99b5b332f04986a96974df1a798537~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=kjbS1DQj9FxpaYP6n%2BJEtkSPOrY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-21">5 异常信息存在就显示，没有则隐藏</h2>
<p><strong>渲染数据</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9b3465f645f450987b2b88c9699f91b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770449630&amp;x-signature=W63pothzIH6JQXykhmAdjIKtsmg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS伪元素：给HTML穿上"隐形斗篷"的魔法]]></title>    <link>https://juejin.cn/post/7601053058856206342</link>    <guid>https://juejin.cn/post/7601053058856206342</guid>    <pubDate>2026-01-31T07:46:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601053058856206342" data-draft-id="7600994087588495379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" CSS伪元素：给HTML穿上&quot;隐形斗篷&quot;的魔法"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-31T07:46:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lee川"/> <meta itemprop="url" content="https://juejin.cn/user/2402874087453658"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             CSS伪元素：给HTML穿上"隐形斗篷"的魔法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2402874087453658/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lee川
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:46:01.000Z" title="Sat Jan 31 2026 07:46:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS伪元素：给HTML穿上"隐形斗篷"的魔法</h2>
<h3 data-id="heading-1">引言：一场看不见的化妆舞会</h3>
<p>想象一下，你在参加一场化妆舞会，但规则很特别：你<strong>不能</strong>给自己戴上面具或穿上戏服，只能请一位"魔法化妆师"（CSS）在你身上直接绘制妆容。这位化妆师手法高超，他能凭空在你耳边画上耳环，在额头点上装饰——而这一切都不需要你真正佩戴任何实物。</p>
<p>这就是<strong>CSS伪元素</strong>的魔法！它们就像HTML元素的"隐形斗篷"，让我们在不修改HTML结构的情况下，为页面添加各种装饰效果。</p>
<h3 data-id="heading-2">第一章：认识"双胞胎幽灵"——::before和::after</h3>
<p>伪元素中最常用的就是这对"双胞胎兄弟"：<code>::before</code>和 <code>::after</code>。它们不是HTML中真实存在的元素，而是CSS创造的"幽灵元素"。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 魔法咒语的基本格式 */</span>
.元素<span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>; <span class="hljs-comment">/* 魔法的核心：必须念出咒语 */</span>
    <span class="hljs-comment">/* 其他样式属性 */</span>
}

.元素<span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>; <span class="hljs-comment">/* 同样需要咒语 */</span>
    <span class="hljs-comment">/* 其他样式属性 */</span>
}
</code></pre>
<h4 data-id="heading-3">魔法规则第一条：content咒语</h4>
<p><code>content</code>属性是开启伪元素魔法的<strong>钥匙</strong>。即使你想创建空的内容，也必须写上 <code>content: ""</code>，就像念咒语一样，不念就没魔法！</p>
<h3 data-id="heading-4">第二章：伪元素的实战魔法——创建笑脸表情</h3>
<p>让我们回到文章开头的代码，看看这个"笑脸魔法"是如何实现的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础的脸部 */</span>
<span class="hljs-selector-class">.face</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffdd59</span>; <span class="hljs-comment">/* 阳光黄色 */</span>
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* 变成圆形 */</span>
    <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* 重要：为伪元素设置舞台 */</span>
}

<span class="hljs-comment">/* 召唤两只"幽灵眼睛" */</span>
<span class="hljs-selector-class">.face</span><span class="hljs-selector-pseudo">::after</span>, <span class="hljs-selector-class">.face</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>; <span class="hljs-comment">/* 念咒语：创造存在 */</span>
    <span class="hljs-attribute">position</span>: absolute; <span class="hljs-comment">/* 让它们漂浮在脸部上 */</span>
    <span class="hljs-attribute">width</span>: <span class="hljs-number">18px</span>;  <span class="hljs-comment">/* 眼睛宽度 */</span>
    <span class="hljs-attribute">height</span>: <span class="hljs-number">8px</span>;  <span class="hljs-comment">/* 眼睛高度 */</span>
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#badc58</span>; <span class="hljs-comment">/* 清新的黄绿色 */</span>
    <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>; <span class="hljs-comment">/* 从头顶往下20像素 */</span>
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* 椭圆形的眼睛 */</span>
}

<span class="hljs-comment">/* 右眼：调皮地往右看 */</span>
<span class="hljs-selector-class">.face</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">right</span>: -<span class="hljs-number">8px</span>; <span class="hljs-comment">/* 从右边往左偏移8px，稍微突出 */</span>
}

<span class="hljs-comment">/* 左眼：俏皮地往左看 */</span>
<span class="hljs-selector-class">.face</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">left</span>: -<span class="hljs-number">5px</span>; <span class="hljs-comment">/* 从左边往右偏移5px，稍微突出 */</span>
}
</code></pre>
<h4 data-id="heading-5">魔法效果可视化：</h4>
<pre><code class="hljs language-scss" lang="scss">👁️          😊         👁️
      (::before)   (.face)    (::after)
       右眼幽灵      笑脸主体    左眼幽灵
       向右突出                向左突出
</code></pre>
<p>这个笑脸最妙的地方在于：HTML只需要一个简单的 <code>&lt;div class="face"&gt;&lt;/div&gt;</code>，所有的眼睛装饰都由CSS凭空创造！</p>
<h3 data-id="heading-6">第三章：为什么不用真实元素？——魔法的智慧</h3>
<p>你可能会问："为什么不用真实的 <code>&lt;span&gt;</code>元素来当眼睛呢？"</p>
<p>让我们对比一下两种方式：</p>
<h4 data-id="heading-7">方式A：使用真实元素（麻瓜方法）</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face"</span>&gt;
    &lt;span <span class="hljs-attr">class</span>=<span class="hljs-string">"eye left"</span>&gt;&lt;/span&gt;
    &lt;span <span class="hljs-attr">class</span>=<span class="hljs-string">"eye right"</span>&gt;&lt;/span&gt;
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-8">方式B：使用伪元素（巫师方法）</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face"</span>&gt;&lt;/div&gt;
</code></pre>
<p><strong>巫师的三大理由：</strong></p>
<ol>
<li><strong>HTML保持纯净</strong>：HTML应该只关心<strong>内容结构</strong>，而不是<strong>表现装饰</strong>。眼睛是装饰，不是内容。</li>
<li><strong>维护更容易</strong>：想改变眼睛样式？只需修改CSS，完全不用碰HTML。</li>
<li><strong>性能更优</strong>：伪元素不会增加真实的DOM节点，浏览器渲染起来更轻快。</li>
</ol>
<h3 data-id="heading-9">第四章：伪元素的更多魔法应用</h3>
<p>伪元素的魔法远不止画眼睛！它们在Web设计中无处不在：</p>
<h4 data-id="heading-10">魔法1：优雅的引用标记</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">blockquote</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">"“"</span>; <span class="hljs-comment">/* 左引号 */</span>
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3em</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ccc</span>;
}

<span class="hljs-selector-tag">blockquote</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">"”"</span>; <span class="hljs-comment">/* 右引号 */</span>
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3em</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ccc</span>;
}
</code></pre>
<h4 data-id="heading-11">魔法2：自定义列表图标</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">"✨"</span>; <span class="hljs-comment">/* 星星图标 */</span>
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
}
</code></pre>
<h4 data-id="heading-12">魔法3：工具提示的小箭头</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.tooltip</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-comment">/* 绘制三角形箭头 */</span>
    <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid transparent;
    <span class="hljs-attribute">border-top-color</span>: <span class="hljs-number">#333</span>;
}
</code></pre>
<h3 data-id="heading-13">第五章：伪元素的工作原理——魔法的科学</h3>
<p>虽然叫"伪元素"，但它们在浏览器中表现得像真实元素一样：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 浏览器眼中的伪元素 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"face"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 这是::before --&gt;</span>
    😉
    <span class="hljs-comment">&lt;!-- 这是元素的实际内容（如果有的话） --&gt;</span>
    😊
    <span class="hljs-comment">&lt;!-- 这是::after --&gt;</span>
    😉
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">位置关系三兄弟：</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 源代码顺序 */</span>
.元素<span class="hljs-selector-pseudo">::before</span> { <span class="hljs-comment">/* 大哥：在最前面 */</span> }
.元素 { <span class="hljs-comment">/* 二弟：实际内容 */</span> }
.元素<span class="hljs-selector-pseudo">::after</span> { <span class="hljs-comment">/* 三弟：在最后面 */</span> }
</code></pre>
<h3 data-id="heading-15">第六章：伪元素 vs 伪类——不要搞混的魔法</h3>
<p>新手常把伪元素和伪类搞混，记住这个简单区别：</p>
<ul>
<li>
<p><strong>伪元素</strong>：<code>::before</code>、<code>::after</code>、<code>::first-line</code></p>
<ul>
<li><strong>创造</strong>新的虚拟元素</li>
<li>双冒号 <code>::</code>（CSS3规范，兼容单冒号<code>:</code>）</li>
</ul>
</li>
<li>
<p><strong>伪类</strong>：<code>:hover</code>、<code>:focus</code>、<code>:nth-child()</code></p>
<ul>
<li><strong>选择</strong>元素的特定状态</li>
<li>单冒号 <code>:</code></li>
</ul>
</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 伪类：鼠标悬停时变色 */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: blue;
}

<span class="hljs-comment">/* 伪元素：添加装饰性内容 */</span>
<span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">"👉 "</span>;
}
</code></pre>
<h3 data-id="heading-16">第七章：魔法的局限与禁忌</h3>
<p>虽然伪元素很强大，但也不是万能的：</p>
<h4 data-id="heading-17">可以用伪元素（装饰性内容）：</h4>
<p>✅ 装饰性图标、角标</p>
<p>✅ 工具提示的箭头</p>
<p>✅ 引用符号</p>
<p>✅ 清除浮动的空元素</p>
<p>✅ <strong>我们的笑脸眼睛</strong></p>
<h4 data-id="heading-18">不要用伪元素（重要内容）：</h4>
<p>❌ 重要的导航链接</p>
<p>❌ 需要被搜索引擎收录的文字</p>
<p>❌ 需要JavaScript交互的元素</p>
<p>❌ 对可访问性重要的内容</p>
<h3 data-id="heading-19">第八章：现代魔法进阶</h3>
<h4 data-id="heading-20">组合魔法：多重伪元素</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/* 创建更复杂的装饰 */</span>
.icon::before {
    <span class="hljs-comment">/* 背景层 */</span>
}
.icon::after {
    <span class="hljs-comment">/* 前景层 */</span>
}
</code></pre>
<h4 data-id="heading-21">动态魔法：结合CSS变量</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.face</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--eye-size, <span class="hljs-number">18px</span>);
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--eye-size, <span class="hljs-number">18px</span>) * <span class="hljs-number">0.444</span>);
}
</code></pre>
<h3 data-id="heading-22">结语：成为CSS魔法师</h3>
<p>CSS伪元素就像Web开发中的"隐形画笔"，让我们能够：</p>
<ol>
<li><strong>保持HTML的语义纯净</strong>——内容就是内容，装饰交给CSS</li>
<li><strong>实现优雅的视觉效果</strong>——无需污染DOM结构</li>
<li><strong>提高代码维护性</strong>——所有样式集中管理</li>
<li><strong>优化页面性能</strong>——减少不必要的DOM节点</li>
</ol>
<p>记住这个魔法口诀：</p>
<blockquote>
<p><strong>"content不可少，定位要记牢，装饰用伪元，内容用标签"</strong></p>
</blockquote>
<p>下次当你想要添加一些装饰性元素时，先问问自己："这可以用伪元素实现吗？" 很多时候，答案都是肯定的！</p>
<p>现在，拿起你的CSS魔杖（键盘），开始用伪元素创造更多神奇的Web魔法吧！🎩✨</p>
<hr/>
<p><strong>魔法小测验</strong>：你能只用CSS伪元素创建一个完整的太阳系动画吗？提示：一个div代表太阳，伪元素代表行星... 无限创意等着你！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从入门到落地：MindSpore实战指南与经验总结]]></title>    <link>https://juejin.cn/post/7600999271770537984</link>    <guid>https://juejin.cn/post/7600999271770537984</guid>    <pubDate>2026-01-31T07:50:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600999271770537984" data-draft-id="7601049142865625088" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从入门到落地：MindSpore实战指南与经验总结"/> <meta itemprop="keywords" content="人工智能,机器学习"/> <meta itemprop="datePublished" content="2026-01-31T07:50:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="skytier"/> <meta itemprop="url" content="https://juejin.cn/user/2067496505970135"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从入门到落地：MindSpore实战指南与经验总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2067496505970135/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    skytier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:50:21.000Z" title="Sat Jan 31 2026 07:50:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MindSpore是华为自研全场景AI框架，覆盖开发、训练、部署全链路，适配多领域需求，助力新手入门与资深开发者落地项目。</p>
<p>本文精简提炼入门准备、核心实操、模型部署、性能优化、问题排查五大模块的实战要点，帮助开发者快速上手、少走弯路。</p>
<h2 data-id="heading-0">一、入门准备：找准方向，快速搭建可用环境</h2>
<p>新手入门核心原则：先明确框架定位，再按需搭建环境，避免无效投入。</p>
<h3 data-id="heading-1">1. 先搞懂：MindSpore的核心优势与适用场景</h3>
<p>MindSpore核心优势与适用场景：</p>






























<table><thead><tr><th>核心特性</th><th>核心价值</th><th>适用场景</th></tr></thead><tbody><tr><td>动静态图统一</td><td>调试便捷、执行高效，一键切换</td><td>研发调试、量产部署</td></tr><tr><td>全场景部署</td><td>端边云无缝迁移，一次开发多端部署</td><td>边缘推理、云端训练</td></tr><tr><td>自动并行</td><td>无需手动编写并行逻辑</td><td>大规模训练任务</td></tr><tr><td>自动微分</td><td>省去手动反向传播代码</td><td>各类深度学习模型开发</td></tr></tbody></table>
<p>新手建议：优先掌握动态图模式与基础流程，再学静态图优化。</p>
<h3 data-id="heading-2">2. 环境搭建：3步搞定，避开版本兼容坑</h3>
<p>新手优先选CPU版本快速验证，环境搭建关键步骤：</p>
<h4 data-id="heading-3">（1）版本选型与安装</h4>
<p>核心注意：Python需3.7~3.9，推荐清华源安装：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 核心安装命令（三选一）﻿</span>
pip install <span class="hljs-attr">mindspore-cpu</span>==<span class="hljs-number">2.2</span>.<span class="hljs-number">10</span> -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install <span class="hljs-attr">mindspore-gpu</span>==<span class="hljs-number">2.2</span>.<span class="hljs-number">10</span> -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install <span class="hljs-attr">mindspore-ascend</span>==<span class="hljs-number">2.2</span>.<span class="hljs-number">10</span> -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
<h4 data-id="heading-4">（2）环境验证</h4>
<p>环境验证（输出(32, 1)即正常）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mindspore <span class="hljs-keyword">as</span> ms
<span class="hljs-keyword">import</span> mindspore.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

ms.set_context(mode=ms.PYNATIVE_MODE, device_target=<span class="hljs-string">"CPU"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleNet</span>(nn.Cell):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.linear = nn.Dense(<span class="hljs-number">10</span>, <span class="hljs-number">1</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-keyword">return</span> self.linear(x)

<span class="hljs-built_in">print</span>(SimpleNet()(ms.Tensor(np.random.randn(<span class="hljs-number">32</span>, <span class="hljs-number">10</span>), ms.float32)).shape)
</code></pre>
<h4 data-id="heading-5">（3）避坑要点</h4>
<ul>
<li>安装失败先查Python版本，冲突用虚拟环境；</li>
<li>昇腾版本需匹配驱动与CANN工具包。</li>
</ul>
<h3 data-id="heading-6">3. 工具选型：3个核心工具提升开发效率</h3>
<p>核心开发工具（3个）：</p>

























<table><thead><tr><th>工具名称</th><th>核心功能</th><th>入门用法</th></tr></thead><tbody><tr><td>MindStudio</td><td>集成开发、调试、部署</td><td>选MindSpore模板，断点调试</td></tr><tr><td>MindSpore Hub</td><td>提供预训练模型</td><td>直接加载微调</td></tr><tr><td>MindSpore Profiler</td><td>性能分析</td><td>定位训练/推理瓶颈</td></tr></tbody></table>
<h2 data-id="heading-7">二、核心功能实操：从数据到模型的全流程拆解</h2>
<p>核心开发流程：数据处理→模型构建→训练推理，以下为精简实操要点。</p>
<h3 data-id="heading-8">1. 数据处理：用Dataset模块高效搞定数据加载</h3>
<p>数据处理核心：Dataset模块，重点掌握两种场景。</p>
<h4 data-id="heading-9">（1）基础数据集加载（以CIFAR-10为例）</h4>
<p>基础数据集加载（CIFAR-10）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mindspore.dataset <span class="hljs-keyword">as</span> ds
<span class="hljs-keyword">import</span> mindspore.dataset.vision <span class="hljs-keyword">as</span> vision

<span class="hljs-comment"># 加载并预处理</span>
train_dataset = ds.Cifar10Dataset(<span class="hljs-string">"./cifar10"</span>, usage=<span class="hljs-string">"train"</span>, shuffle=<span class="hljs-literal">True</span>)
train_dataset = train_dataset.<span class="hljs-built_in">map</span>([vision.Resize((<span class="hljs-number">224</span>,<span class="hljs-number">224</span>)), 
                                   vision.Normalize([<span class="hljs-number">0.485</span>,<span class="hljs-number">0.456</span>,<span class="hljs-number">0.406</span>],[<span class="hljs-number">0.229</span>,<span class="hljs-number">0.224</span>,<span class="hljs-number">0.225</span>]),
                                   vision.HWC2CHW()], <span class="hljs-string">"image"</span>).batch(<span class="hljs-number">32</span>)
</code></pre>
<h4 data-id="heading-10">（2）自定义数据集（加载本地图片文件夹）</h4>
<p>自定义数据集核心代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> mindspore.dataset <span class="hljs-keyword">as</span> ds
<span class="hljs-keyword">import</span> mindspore <span class="hljs-keyword">as</span> ms

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomDataset</span>(ds.Dataset):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, image_paths, labels</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.image_paths, self.labels = image_paths, labels
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, i</span>):
        img = cv2.imread(self.image_paths[i])
        img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
        img = cv2.resize(img, (<span class="hljs-number">224</span>,<span class="hljs-number">224</span>))/<span class="hljs-number">255.0</span>
        <span class="hljs-keyword">return</span> ms.Tensor(img.astype(np.float32)), ms.Tensor(self.labels[i], ms.int32)
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.image_paths)
</code></pre>
<h4 data-id="heading-11">避坑要点</h4>
<ul>
<li>保证数据格式与模型要求一致（默认CHW）；</li>
<li>大规模数据用shard+多进程提升效率。</li>
</ul>
<h3 data-id="heading-12">2. 模型构建：继承Cell类快速搭建网络</h3>
<p>模型构建核心：继承nn.Cell，在construct定义前向传播。</p>
<h4 data-id="heading-13">（1）基础网络构建（简化版ResNet18）</h4>
<p>基础网络构建（简化ResNet）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mindspore.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">from</span> mindspore.common.initializer <span class="hljs-keyword">import</span> HeNormal

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicBlock</span>(nn.Cell):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, in_c, out_c, stride=<span class="hljs-number">1</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.conv1 = nn.Conv2d(in_c, out_c, <span class="hljs-number">3</span>, stride, <span class="hljs-number">1</span>, weight_init=HeNormal())
        self.bn1 = nn.BatchNorm2d(out_c)
        self.conv2 = nn.Conv2d(out_c, out_c, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, weight_init=HeNormal())
        self.bn2 = nn.BatchNorm2d(out_c)
        self.shortcut = nn.SequentialCell([nn.Conv2d(in_c, out_c, <span class="hljs-number">1</span>, stride), nn.BatchNorm2d(out_c)]) <span class="hljs-keyword">if</span> stride!=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> in_c!=out_c <span class="hljs-keyword">else</span> nn.Identity()
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, x</span>):
        out = self.relu(self.bn1(self.conv1(x)))
        <span class="hljs-keyword">return</span> self.relu(self.bn2(self.conv2(out)) + self.shortcut(x))

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleResNet</span>(nn.Cell):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_classes=<span class="hljs-number">10</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">64</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
        self.layer1 = self._make_layer(<span class="hljs-number">64</span>, <span class="hljs-number">2</span>)
        self.layer2 = self._make_layer(<span class="hljs-number">128</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)
        self.avgpool = nn.AdaptiveAvgPool2d((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))
        self.fc = nn.Dense(<span class="hljs-number">128</span>, num_classes)
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_layer</span>(<span class="hljs-params">self, out_c, blocks, stride=<span class="hljs-number">1</span></span>):
        layers = [BasicBlock(self.in_c, out_c, stride)]
        self.in_c = out_c
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, blocks):
            layers.append(BasicBlock(self.in_c, out_c))
        <span class="hljs-keyword">return</span> nn.SequentialCell(layers)
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, x</span>):
        x = self.relu(self.bn1(self.conv1(x)))
        x = self.maxpool(x)
        x = self.layer1(x); x = self.layer2(x)
        <span class="hljs-keyword">return</span> self.fc(self.avgpool(x).view(x.shape[<span class="hljs-number">0</span>],-<span class="hljs-number">1</span>))
</code></pre>
<h4 data-id="heading-14">（2）复用预训练模型（迁移学习）</h4>
<p>预训练模型复用（迁移学习）：</p>
<pre><code class="hljs language-ini" lang="ini">import mindspore_hub as mshub

<span class="hljs-comment"># 加载并冻结主干</span>
<span class="hljs-attr">net</span> = mshub.load(<span class="hljs-string">"resnet50_ascend_v130_imagenet2012"</span>, num_classes=<span class="hljs-number">10</span>)
for param in net.get_parameters():
    if "fc" not in param.name:
        <span class="hljs-attr">param.requires_grad</span> = <span class="hljs-literal">False</span>
</code></pre>
<h4 data-id="heading-15">避坑要点</h4>
<ul>
<li>construct仅用MindSpore算子，避免Python原生循环；</li>
<li>合理初始化参数，避免训练不收敛。</li>
</ul>
<h3 data-id="heading-16">3. 训练与推理：用Model类简化流程</h3>
<p>用Model类简化训练推理流程。</p>
<h4 data-id="heading-17">（1）基础训练流程</h4>
<pre><code class="hljs language-ini" lang="ini">import mindspore as ms
from mindspore import Model, nn

ms.set_context(<span class="hljs-attr">mode</span>=ms.PYNATIVE_MODE, device_target=<span class="hljs-string">"CPU"</span>)

<span class="hljs-comment"># 初始化组件并训练</span>
<span class="hljs-attr">net</span> = SimpleResNet(<span class="hljs-number">10</span>)
<span class="hljs-attr">model</span> = Model(net, nn.SoftmaxCrossEntropyWithLogits(<span class="hljs-literal">True</span>, <span class="hljs-string">"mean"</span>), 
              nn.Adam(net.trainable_params(), 0.001), {"accuracy"})
model.train(10, train_dataset, <span class="hljs-attr">dataset_sink_mode</span>=<span class="hljs-literal">False</span>)
</code></pre>
<p>评估与推理核心代码：</p>
<pre><code class="hljs language-scss" lang="scss">import mindspore<span class="hljs-selector-class">.ops</span> as ops

# 评估
test_dataset = ds<span class="hljs-selector-class">.Cifar10Dataset</span>("./cifar10", "test")<span class="hljs-selector-class">.map</span>(transform, "image")<span class="hljs-selector-class">.batch</span>(<span class="hljs-number">32</span>)
<span class="hljs-built_in">print</span>("准确率:", model.eval(test_dataset)<span class="hljs-selector-attr">[<span class="hljs-string">"accuracy"</span>]</span>)

# 单图推理
def <span class="hljs-built_in">predict</span>(img_path):
    img = cv2.<span class="hljs-built_in">imread</span>(img_path)
    img = ms.<span class="hljs-built_in">Tensor</span>(cv2.<span class="hljs-built_in">resize</span>(cv2.<span class="hljs-built_in">cvtColor</span>(img, cv2.COLOR_BGR2RGB), (<span class="hljs-number">224</span>,<span class="hljs-number">224</span>))/<span class="hljs-number">255.0</span>).<span class="hljs-built_in">unsqueeze</span>(<span class="hljs-number">0</span>)
    return ops.<span class="hljs-built_in">Argmax</span>(<span class="hljs-number">1</span>)(model.<span class="hljs-built_in">predict</span>(ops.<span class="hljs-built_in">transpose</span>(img, (<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)))).<span class="hljs-built_in">asnumpy</span>()[<span class="hljs-number">0</span>]

<span class="hljs-built_in">print</span>(<span class="hljs-string">"预测类别:"</span>, <span class="hljs-built_in">predict</span>(<span class="hljs-string">"./test.jpg"</span>))
</code></pre>
<h4 data-id="heading-18">避坑要点</h4>
<ul>
<li>调试设dataset_sink_mode=False，量产设True；</li>
<li>推理预处理与训练一致。</li>
</ul>
<h2 data-id="heading-19">三、模型部署：全场景落地的关键步骤</h2>
<p>部署核心流程：模型导出→格式转换→部署执行，聚焦两大场景。</p>
<h3 data-id="heading-20">1. 第一步：模型导出（导出为ONNX/MINDIR格式）</h3>
<p>模型导出（ONNX/MINDIR）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mindspore <span class="hljs-keyword">as</span> ms
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

input_tensor = ms.Tensor(np.random.randn(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">224</span>,<span class="hljs-number">224</span>), ms.float32)
ms.export(net, input_tensor, <span class="hljs-string">"simple_resnet.onnx"</span>, <span class="hljs-string">"ONNX"</span>)  <span class="hljs-comment"># 多框架适配</span>
ms.export(net, input_tensor, <span class="hljs-string">"simple_resnet.mindir"</span>, <span class="hljs-string">"MINDIR"</span>)  <span class="hljs-comment"># 昇腾适配</span>
</code></pre>
<p>避坑：导出输入形状与训练一致。</p>
<h3 data-id="heading-21">2. 昇腾硬件部署（边缘/云端）</h3>
<p>昇腾部署：MINDIR转OM后部署。</p>
<h4 data-id="heading-22">（1）模型转换（MINDIR→OM）</h4>
<p>使用昇腾ATC工具转换，命令如下：</p>
<pre><code class="hljs language-css" lang="css"># 昇腾ATC转换命令
atc <span class="hljs-attr">--model</span>=simple_resnet<span class="hljs-selector-class">.mindir</span> <span class="hljs-attr">--framework</span>=<span class="hljs-number">5</span> <span class="hljs-attr">--output</span>=simple_resnet_om <span class="hljs-attr">--input_format</span>=NCHW <span class="hljs-attr">--input_shape</span>="<span class="hljs-selector-tag">input</span>:<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">224</span>,<span class="hljs-number">224</span><span class="hljs-string">" --device_target=Ascend
</span></code></pre>
<h4 data-id="heading-23">（2）推理部署</h4>
<p>通过Ascend CL API加载OM模型执行推理，核心流程与CANN部署一致，可复用官方提供的推理模板代码。</p>
<h3 data-id="heading-24">3. 端侧部署（手机/嵌入式设备）</h3>
<p>端侧部署：先量化轻量化，再导出部署。</p>
<h4 data-id="heading-25">（1）模型轻量化（INT8量化）</h4>
<p>使用MindSpore的model_compression模块实现量化，减少模型体积与计算量，代码如下：</p>
<pre><code class="hljs language-makefile" lang="makefile">from mindspore import model_compression

<span class="hljs-comment"># INT8量化并导出</span>
quant_net = model_compression.quantize(net, model_compression.QuantConfig(), train_dataset)
ms.<span class="hljs-keyword">export</span>(quant_net, input_tensor, <span class="hljs-string">"simple_resnet_quant.mindir"</span>, <span class="hljs-string">"MINDIR"</span>)
</code></pre>
<h4 data-id="heading-26">（2）端侧推理</h4>
<p>使用MindSpore Lite将MINDIR模型转换为端侧专用格式，再通过端侧推理引擎（如Android/iOS SDK）执行推理。</p>
<h2 data-id="heading-27">四、性能优化：4个维度提升训练/推理效率</h2>
<p>性能优化核心：4个维度提升效率。</p>
<h3 data-id="heading-28">1. 数据加载优化：提升吞吐量</h3>
<ul>
<li>数据加载：开启数据下沉、多进程、预取；</li>
<li>模型结构：切换静态图、开启算子融合、用轻量化网络；</li>
<li>训练策略：优化Batch Size、选对优化器、开启自动并行。</li>
</ul>
<h2 data-id="heading-29">五、常见问题排查：高频坑与解决方案</h2>
<p>高频问题排查精简：</p>





























<table><thead><tr><th>常见问题</th><th>解决方案</th></tr></thead><tbody><tr><td>训练不收敛</td><td>合理初始化参数、调整学习率、检查数据预处理</td></tr><tr><td>算子不支持</td><td>用MindSpore内置算子、升级框架版本</td></tr><tr><td>导出形状不匹配</td><td>保证导出与训练输入形状一致</td></tr><tr><td>训练速度慢</td><td>开启数据下沉、多进程、切换静态图</td></tr><tr><td>昇腾OM转换失败</td><td>重新导出MINDIR、匹配版本</td></tr></tbody></table>
<p>排查技巧：优先查看MindSpore日志定位问题。</p>
<h2 data-id="heading-30">六、总结：MindSpore学习的核心心法</h2>
<p>学习心法：循序渐进，实战为王。按“环境搭建→核心流程→项目落地→优化”推进。</p>
<p>MindSpore核心价值：简化开发、全场景适配。希望本文助力开发者快速掌握、落地项目。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[腾讯云部署openclaw（QQ机器人）]]></title>    <link>https://juejin.cn/post/7601046076943220751</link>    <guid>https://juejin.cn/post/7601046076943220751</guid>    <pubDate>2026-01-31T07:53:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601046076943220751" data-draft-id="7601018079620677647" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="腾讯云部署openclaw（QQ机器人）"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-31T07:53:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Annie619"/> <meta itemprop="url" content="https://juejin.cn/user/4024631837330760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            腾讯云部署openclaw（QQ机器人）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4024631837330760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Annie619
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:53:39.000Z" title="Sat Jan 31 2026 07:53:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.选择镜像OpenClaw</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bee8277fba9247eb9a5c206406dd1fd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5uaWU2MTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770450819&amp;x-signature=HyuHkqBYTazQ1s2Pv%2F44Nr0JiwY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2.## 配置OpenClaw的Channel QQ</h2>
<p>先去qq开放平台注册qq机器人<a href="https://link.juejin.cn?target=https%3A%2F%2Fq.qq.com%2F%23%2F" target="_blank" title="https://q.qq.com/#/" ref="nofollow noopener noreferrer">q.qq.com/#/</a>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a16a8cb3e0c4a17afff12bd7499157d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5uaWU2MTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770450819&amp;x-signature=pOUQzfWLqMVRajR%2FTYQuwzUAGGM%3D" alt="image.png" loading="lazy"/></p>
<p>登录服务武器，使用命令行进行操作，如图
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c3f05e1080a4f188d031841869699b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5uaWU2MTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770450819&amp;x-signature=Bhi79p%2FuKW2tsfN5pHhE%2BrU%2F2AQ%3D" alt="image.png" loading="lazy"/>
配置中使用上下箭头进行选择，多选选中使用空格进行选中、取消。
可以先选择模型以及QQ这两个，其他的可以先跳过(<strong>我当前选择的是智谱的套餐，每天几十亿的token根本用不完</strong>)
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding%3Fic%3D3MXTC3M7RE" target="_blank" title="https://www.bigmodel.cn/glm-coding?ic=3MXTC3M7RE" ref="nofollow noopener noreferrer">www.bigmodel.cn/glm-coding?…</a></p>
<h2 data-id="heading-2">3.让OpenClaw在后台保持运行</h2>
<pre><code class="hljs language-bash" lang="bash">loginctl enable-linger $(<span class="hljs-built_in">whoami</span>) &amp;&amp; <span class="hljs-built_in">export</span> XDG_RUNTIME_DIR=/run/user/$(<span class="hljs-built_in">id</span> -u)
</code></pre>
<p>运行完之后没有输出
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4e1900f9c9f40ab86316b0c06bb6cc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5uaWU2MTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770450819&amp;x-signature=94OFPZiDPv6IKdyhrUTUq9L4lh0%3D" alt="image.png" loading="lazy"/>
先安装</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot daemon install
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9edceffcfbf45eaa95197526006dcda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5uaWU2MTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770450819&amp;x-signature=%2FgfjqyRs6pqxMh2hzD%2F2lV8GPJ8%3D" alt="image.png" loading="lazy"/></p>
<p>继续在终端进行输入</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot daemon start
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a461f5d36d640b7a62d6e2d55439ea5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5uaWU2MTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770450819&amp;x-signature=e6WWaXWlMikoef4f6nzj3Fo%2BLfs%3D" alt="image.png" loading="lazy"/>
验证是否正常</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot daemon status
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot (Moltbot) 保姆级安装教程]]></title>    <link>https://juejin.cn/post/7601077290680909876</link>    <guid>https://juejin.cn/post/7601077290680909876</guid>    <pubDate>2026-01-31T08:00:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601077290680909876" data-draft-id="7601046076943237135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot (Moltbot) 保姆级安装教程"/> <meta itemprop="keywords" content="Claude,AIGC"/> <meta itemprop="datePublished" content="2026-01-31T08:00:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="深藏blue47"/> <meta itemprop="url" content="https://juejin.cn/user/4339135019760265"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot (Moltbot) 保姆级安装教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4339135019760265/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    深藏blue47
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T08:00:10.000Z" title="Sat Jan 31 2026 08:00:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近，<strong>Clawdbot</strong> 在技术圈彻底火了！这种热度让人联想到去年 <strong>Manus</strong> 发布时的盛况，几乎在一夜之间引爆了互联网。</p>
<p>值得注意的是，Clawdbot 现已正式更名为 <strong>Moltbot</strong>，Logo 也从一只完整的小龙虾变成了一只“脱壳”的小龙虾。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cecbe428b1dc4188901bf82733aaa1fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=Gj9oSUBEcbri22Xscz7LZfcrrJY%3D" alt="Moltbot" loading="lazy"/></p>
<blockquote>
<p><strong>💡 关于命名：</strong>
Moltbot 意为“蜕皮”，取自龙虾的脱壳行为。这不仅保留了原有的龙虾元素，还巧妙地规避了与 Claude 的商标冲突问题。</p>
</blockquote>
<h2 data-id="heading-0">什么是 Clawdbot (Moltbot)？它能做什么？</h2>
<p><strong>Clawdbot</strong>（现称 Moltbot）不仅仅是一个聊天机器人，它是一个可以部署在本地电脑或服务器上的 <strong>AI Agent（智能体）</strong>。</p>
<p>通俗来说，你可以把它理解为一个<strong>拥有系统超级权限（Root 权限）的超级助理</strong>。如果你熟悉 Claude Code，那么 Clawdbot 就是一个拥有丰富 Skills（技能）且能够调用各种 MCP 服务来闭环完成复杂任务的进阶版。</p>
<p><strong>它的核心功能包括但不限于：</strong></p>
<ul>
<li>自动整理邮件与日程管理</li>
<li>股票市场分析与操作</li>
<li>自动化撰写推文与社交媒体运营</li>
<li>读取并总结 PPT/PDF 文档</li>
<li><strong>24小时后台运行</strong>，随时待命</li>
</ul>
<blockquote>
<p><strong>⚠️ 高危预警（必读）：</strong>
由于 Clawdbot 拥有极高的系统权限（Shell 访问权），<strong>请务必谨慎操作！</strong> 一旦指令错误，可能会误删系统关键文件。
此外，Clawdbot 的网关默认暴露在公网且缺乏严格的身份验证，安全性存在挑战。<strong>强烈建议在虚拟机（VM）或闲置的 Mac 电脑上进行部署</strong>，防止黑客入侵。</p>
</blockquote>
<h2 data-id="heading-1">第一步：环境准备与安装要求</h2>
<p>在开始安装 Clawdbot 之前，请确保您的电脑满足以下环境要求：</p>
<ul>
<li><strong>Node.js 版本：</strong> &gt;= 22.0</li>
<li><strong>Git：</strong> 必须安装</li>
</ul>
<p><strong>系统建议：</strong></p>
<ul>
<li><strong>Windows 用户：</strong> 强烈建议使用 <strong>WSL2</strong>（推荐 Ubuntu 系统），体验更佳。</li>
<li><strong>Mac 用户：</strong> 直接使用终端即可，开箱即用。</li>
</ul>
<h2 data-id="heading-2">第二步：Clawdbot (Moltbot) 安装教程</h2>
<p>安装过程非常简单，根据您的操作系统复制以下 Shell 命令即可一键安装。</p>
<h3 data-id="heading-3">1. macOS / Linux / Ubuntu / Debian 安装命令（推荐）</h3>
<p>打开终端（Terminal），输入：</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://molt.bot/install.sh | bash

</code></pre>
<h3 data-id="heading-4">2. Windows (PowerShell) 安装命令（推荐）</h3>
<p>打开 PowerShell，输入：</p>
<pre><code class="hljs language-powershell" lang="powershell">iwr -useb https://molt.bot/install.ps1 | iex

</code></pre>
<h3 data-id="heading-5">3. 安装 Beta 测试版（尝鲜用户）</h3>
<p>如果您想体验最新的功能，可以使用以下指令：</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://molt.bot/install.sh | bash -s -- --beta

</code></pre>
<h3 data-id="heading-6">4. 使用 Npm 包管理器安装（备选）</h3>
<p><em>注意：npm 版本为官方刚发布，可能存在不稳定性，建议优先使用上述 curl/iwr 脚本安装。</em></p>
<pre><code class="hljs language-bash" lang="bash">npm i -g moltbot@latest

</code></pre>
<p><em>提示：如果 npm 安装后找不到 <code>moltbot</code> 指令，请尝试使用 <code>clawdbot</code> 指令。</em></p>
<hr/>
<h2 data-id="heading-7">第三步：实战部署演示（以 Mac 系统为例）</h2>
<p>以下演示基于 <strong>Node.js 22.15</strong> 版本。</p>
<p>执行安装命令后，系统会自动克隆 Github 仓库。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beff76dac6ec4f0c8fd87bafe0c293e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=mZnVhpPaC5mMd2qStmqzf8EjjOA%3D" alt="2.png" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://molt.bot/install.sh | bash

</code></pre>
<h3 data-id="heading-8">1. 风险确认与初始化</h3>
<p>安装完成后，系统会提示 Clawdbot 的高风险性。</p>
<ul>
<li>输入 <code>yes</code> 继续。</li>
<li>选择 <strong>QuickStart</strong> 模式，加载默认配置。</li>
</ul>
<p>Clawdbot 默认分配端口为 <code>18789</code>。</p>
<h3 data-id="heading-9">2. 配置 AI 模型授权 (OAuth)</h3>
<p><strong>Clawdbot 的一大亮点是支持 ChatGPT 和 Claude 的 OAuth 授权登录。</strong> 这意味着你无需购买昂贵的 API Key，直接使用网页版会员权限（如 Plus、Team、Pro）即可驱动 AI。</p>
<blockquote>
<p><strong>🛑 避坑指南：</strong>
尽量避免使用 Claude 授权登录，因为 Claude 官方风控较严，可能会限制非 Claude Code 的调用。如果你必须用 Claude 但没有账号，可以参考这里：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffe.dtyuedan.cn%2Fshop%2Fjackma" target="_blank" title="https://fe.dtyuedan.cn/shop/jackma" ref="nofollow noopener noreferrer">Claude 账号获取渠道</a></p>
</blockquote>
<p><strong>推荐方案：使用 OpenAI (Codex) 授权</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0f0d254472f498e8044a4c89ce03424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=Pbk62Ju97OuYEq4hFwlij0T%2FyJQ%3D" alt="3.png" loading="lazy"/></p>
<p>只要你是 ChatGPT Plus、Business 或 Pro 会员，都可以直接使用。</p>
<p>为了演示方便，我们在配置界面选择 <strong>第 2 种</strong> 授权方式（浏览器授权）。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6ef31842263490d839e17f90ea76e50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=NxMX6cqido3IYWoeThKWjprNabY%3D" alt="4.png" loading="lazy"/></p>
<p>终端会生成一条 ChatGPT 授权链接，浏览器会自动弹出，选择你的会员账号登录即可。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f5e978e09f48ad8c8f207f7d70cc71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=8dR8NKS1e25fTZoMrBuJA7BVlOM%3D" alt="5.png" loading="lazy"/></p>
<p>这里我使用的是 <strong>ChatGPT Business 会员</strong>。</p>
<ul>
<li><strong>原因：</strong> Business 会员目前性价比极高，几十块钱就能享受跟 Plus 会员一样的 Codex 额度，非常适合跑这种耗 Token 的 Agent。</li>
</ul>
<blockquote>
<p><strong>💰 省钱技巧：</strong>
高性价比体验 Clawdbot，推荐使用 ChatGPT Business 账号。
<strong>优惠开通地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgptplus.org.cn" target="_blank" title="https://gptplus.org.cn" ref="nofollow noopener noreferrer">gptplus.org.cn</a>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf9bbf3914db4664b1f61bad1551fa6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=O10%2FLKQY%2FlUJw4as0FXQ7qJgguA%3D" alt="6.png" loading="lazy"/></p>
</blockquote>
<p>点击“继续”，授权成功后回到终端查看状态。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af3cd0c82459409088f687a7a1a57eea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=J%2BTbMiwxnXRavZZfeUanlxfxETU%3D" alt="7.png" loading="lazy"/></p>
<p><strong>PS：</strong> 如果终端没有自动抓取到 Token，请手动复制浏览器地址栏中 <code>localhost</code> 开头的完整回调地址，粘贴到终端即可。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7bba517ee5644cca94cbcb6987ca63f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=jF9FeOqHrs%2BEcjcI5JcT7abG6vY%3D" alt="8.png" loading="lazy"/></p>
<h3 data-id="heading-10">3. 选择模型与频道</h3>
<p>默认选择 <code>GPT-5.2-Codex</code> 模型。你可以选择跳过，或配置其他频道。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/332fb74da4ef42ea9e0a217f08e4ab18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=bHRAWil3dOR8bqtNagQbxGSaaS0%3D" alt="9.png" loading="lazy"/></p>
<h3 data-id="heading-11">4. 配置 Skills (技能)</h3>
<p>这就是 AI Agent 的灵魂所在。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/054dc1bf5248408991f8006e98207dc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=sW1XZRbhaJaM7BhdHjcHrLXy1Sg%3D" alt="10.png" loading="lazy"/></p>
<p>选择包管理工具（默认 npm 即可）。系统会推荐一些基础 Skills，你可以按需选择，也可以全部跳过。
<strong>最酷的是：</strong> 后续你需要什么功能，直接在对话框跟 Clawdbot 说“帮我安装某某 skill”，它就会自动安装，无需手动操作！
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f9e1d1a1fb84f1d99a5ee4a2b177f60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=K7XG7052onk%2FImSjxpKui64WOCk%3D" alt="11.png" loading="lazy"/></p>
<p>如果遇到 API Key 设置（如生图服务），没有的话直接回车 <code>No</code> 跳过。</p>
<h3 data-id="heading-12">5. 开启 Hooks (自动化钩子)</h3>
<p>最后，系统会询问是否开启内置钩子脚本（Hooks），建议<strong>全部开启</strong>以获得完整体验：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3913df2f1f534f30a3fc3af3a32536a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex6JePYmx1ZTQ3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770451213&amp;x-signature=iAdgWsq6UsW6UN5CTQ0xOBNySNc%3D" alt="12.png" loading="lazy"/></p>
<ul>
<li><strong>boot-md：</strong> 网关启动后自动执行 <code>BOOT.md</code> 中的引导指令。</li>
<li><strong>command-logger：</strong> 审计日志，记录所有执行过的命令（安全审计必备）。</li>
<li><strong>session-memory：</strong> 会话记忆功能，输入 <code>/new</code> 时自动保存当前上下文快照。</li>
</ul>
<h2 data-id="heading-13">第四步：启动 Web UI 控制台</h2>
<p>对于新手用户，强烈建议选择 <strong>Web UI</strong> 模式，可视化的网页操作界面比纯命令行更友好。</p>
<p>配置完成后，执行以下指令启动控制台：</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot dashboard

</code></pre>
<ul>
<li><strong>本地访问地址：</strong> <code>http://127.0.0.1:18789</code></li>
</ul>
<blockquote>
<p><strong>📝 重要提示：</strong>
虽然工具已更名为 Moltbot，但部分旧版指令尚未完全更新。如果 <code>moltbot</code> 指令无效，请尝试替换为 <code>clawdbot</code> 运行，通常能解决问题。</p>
</blockquote>
<p>现在，你的专属 AI 超级员工已经就位！如果你没有 OpenAI 或 Claude 账号，也可以在配置中绑定第三方 API Key，使用国内大模型来驱动 Clawdbot。</p>
<p>快去探索 Clawdbot (Moltbot) 的强大能力吧！</p>
<hr/>
<p>文章来源:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgptplus.org.cn%2Fhandbook%2Fclawdbot.html" target="_blank" title="https://gptplus.org.cn/handbook/clawdbot.html" ref="nofollow noopener noreferrer">Clawdbot (Moltbot) 保姆级安装教程</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Markdown 写稿，Word 交稿？用 Pandoc + 脚本一键转换，告别格式焦虑]]></title>    <link>https://juejin.cn/post/7601020578490761225</link>    <guid>https://juejin.cn/post/7601020578490761225</guid>    <pubDate>2026-01-31T07:39:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578490761225" data-draft-id="7601169987396288563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Markdown 写稿，Word 交稿？用 Pandoc + 脚本一键转换，告别格式焦虑"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-31T07:39:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大尚来也"/> <meta itemprop="url" content="https://juejin.cn/user/1681597639955488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Markdown 写稿，Word 交稿？用 Pandoc + 脚本一键转换，告别格式焦虑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1681597639955488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大尚来也
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:39:20.000Z" title="Sat Jan 31 2026 07:39:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否也经历过这样的场景？</p>
<ul>
<li>用 Markdown 写技术文档、论文或周报，思路流畅、版本清晰；</li>
<li>上级/客户/期刊却明确要求提交 <code>.docx</code> 格式；</li>
<li>手动复制粘贴到 Word 后，格式错乱、标题层级丢失、代码块变乱码……</li>
</ul>
<p>别再忍受这种“生产力倒退”！其实，只需一个开源工具 <strong>Pandoc</strong> 加几行脚本，就能实现 <strong>Markdown → 高质量 Word 文档</strong> 的自动化转换——全程免费、跨平台、可定制，真正实现“写得爽，交得稳”。</p>
<p>本文将手把手教你搭建一套零成本、高效率的 Markdown 到 Word 自动化工作流。</p>
<hr/>
<h3 data-id="heading-0">一、为什么 Pandoc 是最佳选择？</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpandoc.org%2F" target="_blank" title="https://pandoc.org/" ref="nofollow noopener noreferrer">Pandoc</a> 被誉为“文档格式的瑞士军刀”，由 Haskell 编写，支持 <strong>40+ 种格式互转</strong>，包括：</p>
<ul>
<li>Markdown ↔ Word (.docx)</li>
<li>Markdown ↔ PDF (via LaTeX)</li>
<li>Markdown ↔ HTML / EPUB / PowerPoint 等</li>
</ul>
<p>它的核心优势在于：</p>
<ul>
<li><strong>开源免费</strong>，无任何商业限制</li>
<li><strong>保留语义结构</strong>：标题、列表、表格、代码块等自动映射为 Word 样式</li>
<li><strong>高度可定制</strong>：通过模板、CSS 或元数据控制输出样式</li>
<li><strong>命令行驱动</strong>：天然适合脚本化和自动化</li>
</ul>
<blockquote>
<p>💡 小知识：许多知名项目（如 GitBook、Obsidian 导出插件）底层都依赖 Pandoc。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">二、三步搭建你的自动转换脚本</h3>
<h4 data-id="heading-2">第一步：安装 Pandoc</h4>
<ul>
<li>
<p><strong>macOS</strong>（推荐用 Homebrew）：</p>
<pre><code class="hljs">brew install pandoc
</code></pre>
</li>
<li>
<p><strong>Windows</strong>：从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpandoc.org%2Finstalling.html" target="_blank" title="https://pandoc.org/installing.html" ref="nofollow noopener noreferrer">pandoc.org/installing.…</a> 下载安装包</p>
</li>
<li>
<p><strong>Linux</strong>（Ubuntu/Debian）：</p>
<pre><code class="hljs">sudo apt install pandoc
</code></pre>
</li>
</ul>
<blockquote>
<p>✅ 验证安装：终端输入 <code>pandoc --version</code>，看到版本号即成功。</p>
</blockquote>
<h4 data-id="heading-3">第二步：准备你的 Markdown 文件</h4>
<p>建议在文件开头加入 <strong>YAML 元数据块</strong>，用于控制文档属性：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">"2026年Q1技术规划"</span>
<span class="hljs-attr">author:</span> <span class="hljs-string">张三</span>
<span class="hljs-attr">date:</span> <span class="hljs-number">2026-01-31</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># 引言</span>

<span class="hljs-string">本文档旨在...</span>
</code></pre>
<h4 data-id="heading-4">第三步：编写一键转换脚本</h4>
<h5 data-id="heading-5">▶ macOS / Linux（<code>md2docx.sh</code>）：</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
INPUT=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
OUTPUT=<span class="hljs-string">"<span class="hljs-variable">${INPUT%.md}</span>.docx"</span>

pandoc <span class="hljs-string">"<span class="hljs-variable">$INPUT</span>"</span> \
  -o <span class="hljs-string">"<span class="hljs-variable">$OUTPUT</span>"</span> \
  --reference-doc=default.docx \
  --highlight-style=pygments

<span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 已生成：<span class="hljs-variable">$OUTPUT</span>"</span>
</code></pre>
<h5 data-id="heading-6">▶ Windows（<code>md2docx.bat</code>）：</h5>
<pre><code class="hljs language-arduino" lang="arduino">@echo off
set <span class="hljs-literal">INPUT</span>=%<span class="hljs-number">1</span>
set <span class="hljs-literal">OUTPUT</span>=%<span class="hljs-literal">INPUT</span>:.md=.docx%

pandoc <span class="hljs-string">"%INPUT%"</span> -o <span class="hljs-string">"%OUTPUT%"</span> --reference-doc=<span class="hljs-keyword">default</span>.docx --highlight-style=pygments
echo ✅ 已生成：%<span class="hljs-literal">OUTPUT</span>%
</code></pre>
<blockquote>
<p>📌 权限设置（macOS/Linux）：<br/>
<code>chmod +x md2docx.sh</code><br/>
使用方式：<code>./md2docx.sh report.md</code></p>
</blockquote>
<hr/>
<h3 data-id="heading-7">三、进阶技巧：让 Word 输出更专业</h3>
<h4 data-id="heading-8">1. 自定义样式：使用 <code>--reference-doc</code></h4>
<p>Pandoc 默认的 Word 样式较朴素。你可以：</p>
<ol>
<li>
<p>在 Word 中新建一个 <code>.docx</code> 文件，设置好标题、正文、代码块等样式；</p>
</li>
<li>
<p>保存为 <code>my-style.docx</code>；</p>
</li>
<li>
<p>转换时指定：</p>
<pre><code class="hljs language-lua" lang="lua">pandoc <span class="hljs-built_in">input</span>.md -o <span class="hljs-built_in">output</span>.docx <span class="hljs-comment">--reference-doc=my-style.docx</span>
</code></pre>
</li>
</ol>
<p>这样，所有 Markdown 元素都会套用你预设的 Word 样式，完美匹配公司模板！</p>
<h4 data-id="heading-9">2. 代码高亮：启用语法着色</h4>
<p>添加 <code>--highlight-style=tango</code> 或 <code>pygments</code>，让代码块在 Word 中带颜色（需 Word 支持）。</p>
<h4 data-id="heading-10">3. 插入目录、页眉页脚</h4>
<p>通过 <code>--toc</code> 生成目录；更复杂的排版可结合 LaTeX 中间格式，但对大多数办公场景，<code>reference-doc</code> 已足够。</p>
<hr/>
<h3 data-id="heading-11">四、集成到你的写作环境</h3>
<ul>
<li><strong>VS Code 用户</strong>：安装 “Markdown Preview Enhanced” 插件，支持一键导出 DOCX。</li>
<li><strong>Obsidian 用户</strong>：使用社区插件 “Pandoc Plugin” 直接调用本地 Pandoc。</li>
<li><strong>终端党</strong>：将脚本加入 PATH，全局可用。</li>
</ul>
<p>甚至可以配合 <strong>GitHub Actions</strong> 实现“推送 Markdown 自动发布 Word 版本”！</p>
<hr/>
<h3 data-id="heading-12">结语：掌控格式，而非被格式掌控</h3>
<p>在内容创作日益去中心化的今天，<strong>用最舒服的方式写作，用最合规的方式交付</strong>，不该是奢望。借助 Pandoc 这样成熟、稳定、免费的工具，我们完全可以在保持 Markdown 高效写作体验的同时，无缝满足传统办公格式的要求。</p>
<blockquote>
<p><strong>真正的效率，不是妥协于工具，而是让工具为你服务。</strong></p>
</blockquote>
<p>现在就花 10 分钟配置这套脚本——从此，Markdown 是你的笔，Word 只是你的信封。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Terraform 实践课 -优课IT分享]]></title>    <link>https://juejin.cn/post/7600999271770701824</link>    <guid>https://juejin.cn/post/7600999271770701824</guid>    <pubDate>2026-01-31T08:17:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600999271770701824" data-draft-id="7601049142865739776" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Terraform 实践课 -优课IT分享"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-31T08:17:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户71791708027"/> <meta itemprop="url" content="https://juejin.cn/user/801974450660393"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Terraform 实践课 -优课IT分享
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/801974450660393/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户71791708027
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T08:17:38.000Z" title="Sat Jan 31 2026 08:17:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Terraform 实践课---获课：youkeit.xyz/15400/</strong></p>
<h2 data-id="heading-0">安全左移下的 Terraform：未来 IaC 安全合规与漏洞前置检测的实践发展方向</h2>
<p>在云原生时代，基础设施即代码（IaC）已成为企业自动化管理的核心工具，而 Terraform 作为行业标杆，其安全性直接影响云基础设施的可靠性。随着安全左移理念的普及，如何在 IaC 开发阶段前置检测安全漏洞与合规风险，成为提升云安全效率的关键。本文结合 Terraform 的最新实践，探讨安全左移下的技术演进方向，并提供可落地的代码示例。</p>
<h3 data-id="heading-1">一、安全左移的核心价值：从“事后修复”到“事前预防”</h3>
<p>传统 IaC 安全模式依赖部署后的扫描工具（如 OPA、Checkov），存在两大痛点：</p>
<ol>
<li><strong>滞后性</strong>：漏洞发现时可能已造成资源创建或数据泄露；</li>
<li><strong>成本高</strong>：修复已部署资源的成本远高于开发阶段调整代码。</li>
</ol>
<p>安全左移通过将安全检测嵌入 IaC 开发流程，实现以下目标：</p>
<ul>
<li><strong>代码级检测</strong>：在提交前识别敏感信息泄露、权限过配等风险；</li>
<li><strong>自动化合规</strong>：强制执行企业安全策略（如禁止公网暴露数据库）；</li>
<li><strong>成本优化</strong>：避免因安全问题导致的资源重建或数据迁移。</li>
</ul>
<h3 data-id="heading-2">二、Terraform 安全左移的三大技术方向</h3>
<h4 data-id="heading-3">1. 静态代码分析：前置拦截基础漏洞</h4>
<p>通过集成静态分析工具（如 tfsec、KICS），在代码编写阶段检测以下问题：</p>
<ul>
<li><strong>敏感信息硬编码</strong>：如直接在 <code>.tf</code> 文件中写入 AWS Access Key；</li>
<li><strong>资源权限过配</strong>：如 S3 桶未启用加密或允许公开访问；</li>
<li><strong>依赖项漏洞</strong>：使用含已知漏洞的 Provider 版本。</li>
</ul>
<p><strong>代码示例：使用 tfsec 检测 S3 桶配置</strong></p>
<pre><code class="hljs language-ini" lang="ini">hcl
1<span class="hljs-comment"># main.tf</span>
2resource "aws_s3_bucket" "example" {
3  <span class="hljs-attr">bucket</span> = <span class="hljs-string">"my-bucket"</span>
4  <span class="hljs-attr">acl</span>    = <span class="hljs-string">"public-read"</span>  <span class="hljs-comment"># tfsec:ignore:AWS002 触发警告：禁止公网访问</span>
5}
6
7resource "aws_s3_bucket_server_side_encryption_configuration" "example" {
8  <span class="hljs-attr">bucket</span> = aws_s3_bucket.example.bucket
9  rule {
10    apply_server_side_encryption_by_default {
11      <span class="hljs-attr">sse_algorithm</span> = <span class="hljs-string">"AES256"</span>
12    }
13  }
14}
15
</code></pre>
<p><strong>执行检测</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">bash
1tfsec . --soft-fail  <span class="hljs-comment"># 输出警告但不中断流程</span>
2
</code></pre>
<p><strong>输出结果</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">1</span>[AWS002][ERROR] S3 bucket <span class="hljs-string">'my-bucket'</span> has ACL set to <span class="hljs-string">'public-read'</span>
<span class="hljs-number">2</span>
</code></pre>
<h4 data-id="heading-4">2. 策略即代码（Policy as Code）：强制合规约束</h4>
<p>通过 Open Policy Agent（OPA）或 Sentinel 定义安全策略，在 <code>terraform plan</code> 阶段拦截违规操作。例如，禁止创建未加密的 EBS 卷：</p>
<p><strong>代码示例：OPA 策略规则</strong></p>
<pre><code class="hljs language-lua" lang="lua">rego
<span class="hljs-number">1</span># policy.rego
<span class="hljs-number">2</span><span class="hljs-built_in">package</span> terraform.aws.ebs
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>deny[msg] {
<span class="hljs-number">5</span>  <span class="hljs-built_in">input</span>.<span class="hljs-built_in">type</span> == <span class="hljs-string">"aws_ebs_volume"</span>
<span class="hljs-number">6</span>  <span class="hljs-keyword">not</span> <span class="hljs-built_in">input</span>.encrypted
<span class="hljs-number">7</span>  msg := <span class="hljs-string">"EBS volumes must be encrypted"</span>
<span class="hljs-number">8</span>}
<span class="hljs-number">9</span>
</code></pre>
<p><strong>集成到 Terraform 工作流</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">bash
1<span class="hljs-comment"># 安装 OPA</span>
2curl -L -o opa https://openpolicyagent.org/downloads/latest/opa_linux_amd64
3chmod +x opa
4
5<span class="hljs-comment"># 执行策略检查</span>
6opa <span class="hljs-built_in">eval</span> --input ./plan.json --data policy.rego <span class="hljs-string">"data.terraform.aws.ebs.deny"</span>
7
</code></pre>
<h4 data-id="heading-5">3. 动态漏洞扫描：模拟攻击验证安全性</h4>
<p>结合漏洞扫描工具（如 Trivy、Snyk），在 CI/CD 流水线中模拟攻击者行为，检测以下风险：</p>
<ul>
<li><strong>依赖项漏洞</strong>：Provider 或模块含已知 CVE；</li>
<li><strong>配置错误</strong>：如 Kubernetes Pod 未启用网络策略；</li>
<li><strong>运行时风险</strong>：如容器镜像含恶意软件。</li>
</ul>
<p><strong>代码示例：GitHub Actions 集成 Trivy 扫描</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">yaml</span>
<span class="hljs-number">1</span><span class="hljs-comment"># .github/workflows/terraform-security.yml</span>
<span class="hljs-attr">2name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Security</span> <span class="hljs-string">Scan</span>
<span class="hljs-attr">3on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-number">4</span>
<span class="hljs-attr">5jobs:</span>
<span class="hljs-attr">6  scan:</span>
<span class="hljs-attr">7    runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
<span class="hljs-attr">8    steps:</span>
<span class="hljs-attr">9      - uses:</span> <span class="hljs-string">actions/checkout@v4</span>
<span class="hljs-attr">10      - name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Terraform</span>
<span class="hljs-attr">11        uses:</span> <span class="hljs-string">hashicorp/setup-terraform@v2</span>
<span class="hljs-attr">12      - name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Init</span>
<span class="hljs-attr">13        run:</span> <span class="hljs-string">terraform</span> <span class="hljs-string">init</span>
<span class="hljs-attr">14      - name:</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Plan</span>
<span class="hljs-attr">15        run:</span> <span class="hljs-string">terraform</span> <span class="hljs-string">plan</span> <span class="hljs-string">-out=plan.tfplan</span>
<span class="hljs-attr">16      - name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Trivy</span>
<span class="hljs-attr">17        run:</span> <span class="hljs-string">|</span>
<span class="hljs-number">18</span>          <span class="hljs-string">curl</span> <span class="hljs-string">-sfL</span> <span class="hljs-string">https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh</span> <span class="hljs-string">|</span> <span class="hljs-string">sh</span> <span class="hljs-string">-s</span> <span class="hljs-string">--</span> <span class="hljs-string">-b</span> <span class="hljs-string">/usr/local/bin</span>
<span class="hljs-attr">19      - name:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Terraform</span> <span class="hljs-string">Plan</span>
<span class="hljs-attr">20        run:</span> <span class="hljs-string">|</span>
<span class="hljs-number">21</span>          <span class="hljs-string">trivy</span> <span class="hljs-string">fs</span> <span class="hljs-string">--severity</span> <span class="hljs-string">CRITICAL,HIGH</span> <span class="hljs-string">.</span> <span class="hljs-string">--skip-dirs=".terraform"</span>
<span class="hljs-number">22</span>
</code></pre>
<h3 data-id="heading-6">三、未来趋势：AI 驱动的智能安全左移</h3>
<p>随着 AI 技术的成熟，Terraform 安全左移将向智能化演进：</p>
<ol>
<li><strong>自动修复建议</strong>：AI 分析漏洞上下文，生成修复代码（如自动替换硬编码密钥为 Vault 引用）；</li>
<li><strong>预测性安全</strong>：基于历史数据预测潜在风险（如识别频繁变更的资源可能存在配置错误）；</li>
<li><strong>跨云合规</strong>：通过动态标准库（如 IACheck）自动适配不同云厂商的合规要求。</li>
</ol>
<p><strong>代码示例：AI 辅助修复硬编码密钥（伪代码）</strong></p>
<pre><code class="hljs language-python" lang="python">python
<span class="hljs-number">1</span><span class="hljs-comment"># AI 修复逻辑示例</span>
<span class="hljs-number">2</span><span class="hljs-keyword">def</span> fix_hardcoded_secrets(tf_content):
<span class="hljs-number">3</span>    <span class="hljs-keyword">import</span> re
<span class="hljs-number">4</span>    patterns = [
<span class="hljs-number">5</span>        <span class="hljs-string">r'access_key\s*=\s*"([^"]+)"'</span>,  <span class="hljs-comment"># AWS Access Key</span>
<span class="hljs-number">6</span>        <span class="hljs-string">r'password\s*=\s*"([^"]+)"'</span>     <span class="hljs-comment"># 数据库密码</span>
<span class="hljs-number">7</span>    ]
<span class="hljs-number">8</span>    <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> patterns:
<span class="hljs-number">9</span>        matches = re.findall(pattern, tf_content)
<span class="hljs-number">10</span>        <span class="hljs-keyword">for</span> secret <span class="hljs-keyword">in</span> matches:
<span class="hljs-number">11</span>            <span class="hljs-comment"># 调用 Vault API 存储密钥并生成引用</span>
<span class="hljs-number">12</span>            vault_path = store_in_vault(secret)
<span class="hljs-number">13</span>            tf_content = tf_content.replace(<span class="hljs-string">f'"<span class="hljs-subst">{secret}</span>"'</span>, <span class="hljs-string">f'$<span class="hljs-subst">{vault(<span class="hljs-string">"{vault_path}"</span>)}</span>'</span>)
<span class="hljs-number">14</span>    <span class="hljs-keyword">return</span> tf_content
<span class="hljs-number">15</span>
</code></pre>
<h3 data-id="heading-7">四、实践建议：构建安全左移的 Terraform 工作流</h3>
<ol>
<li>
<p><strong>分层检测</strong>：</p>
<ul>
<li><strong>开发阶段</strong>：使用 tfsec + Pre-commit 钩子拦截基础错误；</li>
<li><strong>CI 阶段</strong>：通过 OPA 策略检查强制合规；</li>
<li><strong>CD 阶段</strong>：结合 Trivy 扫描运行时风险。</li>
</ul>
</li>
<li>
<p><strong>工具链整合</strong>：</p>
<pre><code class="hljs language-css" lang="css">mermaid
<span class="hljs-number">1</span>graph <span class="hljs-selector-tag">TD</span>
<span class="hljs-number">2</span>  <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[Code Commit]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[tfsec]</span>
<span class="hljs-number">3</span>  <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[OPA Policy Check]</span>
<span class="hljs-number">4</span>  C --&gt; D<span class="hljs-selector-attr">[Trivy Scan]</span>
<span class="hljs-number">5</span>  D --&gt; E<span class="hljs-selector-attr">[Deploy to Cloud]</span>
<span class="hljs-number">6</span>
</code></pre>
</li>
<li>
<p><strong>团队培训</strong>：</p>
<ul>
<li>将安全左移纳入开发者日常流程（如 Git 提交前自动检测）；</li>
<li>定期更新安全策略以适配新漏洞（如 Log4j2 事件后的依赖检查）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">结语</h3>
<p>安全左移下的 Terraform 实践，本质是将安全从“事后处理”转变为“内生能力”。通过静态分析、策略约束和动态扫描的三层防护，结合 AI 技术的智能化演进，企业可显著降低云基础设施的安全风险，同时提升开发效率。未来，随着 IaC 生态的完善，安全左移将成为云原生安全的标配能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建无障碍组件之Breadcrumb Pattern]]></title>    <link>https://juejin.cn/post/7601169987396436019</link>    <guid>https://juejin.cn/post/7601169987396436019</guid>    <pubDate>2026-01-31T08:32:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601169987396436019" data-draft-id="7600982613655126066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建无障碍组件之Breadcrumb Pattern"/> <meta itemprop="keywords" content="前端,设计,HTML"/> <meta itemprop="datePublished" content="2026-01-31T08:32:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="anOnion"/> <meta itemprop="url" content="https://juejin.cn/user/553809592722589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建无障碍组件之Breadcrumb Pattern
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592722589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    anOnion
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T08:32:47.000Z" title="Sat Jan 31 2026 08:32:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Breadcrumb Pattern 详解：构建无障碍面包屑导航</h2>
<p>面包屑导航是 Web 页面中不可或缺的导航组件，它以层级链接的形式展示当前页面在网站结构中的位置，帮助用户快速了解自己所处的位置并轻松返回上级页面。根据 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Fbreadcrumb%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/breadcrumb/" ref="nofollow noopener noreferrer">W3C WAI-ARIA Breadcrumb Pattern</a> 规范，正确实现的面包屑导航不仅要提供清晰的层级导航路径，更要确保所有用户都能顺利使用，包括依赖屏幕阅读器等辅助技术的用户。本文将深入探讨 Breadcrumb Pattern 的核心概念、实现要点以及最佳实践。</p>
<h3 data-id="heading-1">一、面包屑导航的定义与核心功能</h3>
<p>面包屑导航（Breadcrumb Trail）是由一系列指向父级页面的链接组成的导航路径，按照层级顺序展示当前页面在网站架构中的位置。它的主要功能是帮助用户了解自己在网站中的位置，并在需要时快速返回上级页面。面包屑导航通常水平放置在页面主体内容之前，为用户提供清晰的导航参考。</p>
<p>在实际应用中，面包屑导航广泛应用于内容层级较深的网站，例如电商平台的产品分类页、博客文章的分类归档页、企业官网的产品介绍页等。一个设计良好的面包屑导航能够显著提升用户体验，降低用户的迷失感，同时也有利于搜索引擎更好地理解网站的结构层次。</p>
<h3 data-id="heading-2">二、键盘交互规范</h3>
<p>面包屑导航的键盘交互具有特殊性。由于面包屑导航仅由静态链接组成，用户不需要进行任何特殊的键盘操作来与之交互。链接本身已经支持标准的键盘导航行为，用户可以通过 Tab 键在各个链接之间切换，通过 Enter 键激活链接进行页面跳转。这种标准的行为已经满足了键盘可访问性的要求，无需额外的键盘事件处理。</p>
<p>因此，Breadcrumb Pattern 规范明确指出，面包屑导航不需要特殊的键盘交互支持。开发者只需要确保链接元素是标准的 HTML 元素，即可获得完整的键盘可访问性支持。这一特点使得面包屑导航的实现相对简单，重点应放在正确的语义标记和 ARIA 属性使用上。</p>
<h3 data-id="heading-3">三、WAI-ARIA 角色、状态和属性</h3>
<p>正确使用 WAI-ARIA 属性是构建无障碍面包屑导航的技术基础。虽然面包屑导航不涉及复杂的交互逻辑，但正确的语义标记对于屏幕阅读器用户理解导航结构至关重要。</p>
<h4 data-id="heading-4">3.1 导航容器标记</h4>
<p>面包屑导航必须放置在导航地标区域（Navigation Landmark）内。这可以通过使用 nav 元素或为其他元素添加 role="navigation" 来实现。导航地标区域需要通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-labelledby" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-labelledby" ref="nofollow noopener noreferrer">aria-labelledby</a> 进行标记，以便屏幕阅读器向用户描述这个导航区域的用途。</p>
<p>示例：使用 nav 元素包裹面包屑导航：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/"</span>&gt;</span>产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/electronics/"</span>&gt;</span>电子产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>笔记本电脑<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<p>示例：使用 role 属性定义导航地标：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"navigation"</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/blog/"</span>&gt;</span>博客<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>2025 年技术趋势<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">3.2 当前页面状态标记</h4>
<p>面包屑导航中的当前页面链接需要使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a> 属性来标识。aria-current="page" 明确告诉辅助技术当前元素代表的是用户正在浏览的页面。这一属性对于屏幕阅读器用户理解面包屑导航的结构非常重要，使他们能够区分可导航的父级页面和当前所在页面。</p>
<p>值得注意的是，如果代表当前页面的元素不是链接（例如使用 span 或其他元素呈现），那么 aria-current 属性是可选的。但为了保持一致性，建议始终为当前页面元素添加 aria-current="page"。</p>
<p>示例：当前页面为链接时的标记：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/"</span>&gt;</span>文档<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/guides/"</span>&gt;</span>指南<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/guides/getting-started/"</span>
        <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>
        &gt;</span>快速入门&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<p>示例：当前页面为非链接元素时的标记：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/shop/"</span>&gt;</span>商店<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/shop/clothing/"</span>&gt;</span>服装<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>春季新品<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">四、完整示例</h3>
<p>以下是使用不同方式实现面包屑导航的完整示例，展示了标准的 HTML 结构、ARIA 属性应用以及样式设计：</p>
<h4 data-id="heading-7">4.1 基础面包屑导航实现</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/"</span>&gt;</span>所有产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/electronics/"</span>&gt;</span>电子产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>智能手表<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">4.2 带分隔符的面包屑导航</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-nav"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-link"</span>
        &gt;</span>首页&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-separator"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
      /
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/categories/"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-link"</span>
        &gt;</span>分类&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-separator"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
      /
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/categories/books/"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-link"</span>
        &gt;</span>图书&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-separator"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
      /
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>
      <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-current"</span>&gt;</span>编程指南<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">4.3 电商网站产品页面包屑导航</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"商品位置"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"product-breadcrumb"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/electronics/"</span>&gt;</span>家用电器<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/electronics/kitchen/"</span>&gt;</span>厨房电器<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/electronics/kitchen/coffee/"</span>&gt;</span>咖啡机<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>全自动咖啡机 X2000<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">五、最佳实践</h3>
<h4 data-id="heading-11">5.1 语义化 HTML 结构</h4>
<p>面包屑导航应使用语义化的 HTML 元素构建。使用 nav 元素定义导航区域，使用 ol 或 ul 元素创建有序或无序列表，使用 li 元素包含各个导航项。这种结构不仅对搜索引擎友好，也便于屏幕阅读器向用户传达导航的层级关系。</p>
<p>在列表的选择上，ol 元素更适合面包屑导航，因为它能够传达各个项之间的顺序关系。但如果网站没有强制的层级顺序要求，ul 元素同样可以接受。无论选择哪种列表元素，都要确保列表项之间的逻辑顺序与面包屑导航的层级结构保持一致。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 推荐做法：使用语义化元素 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/"</span>&gt;</span>文档<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>当前页面<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">5.2 正确使用 ARIA 属性</h4>
<p>面包屑导航的 ARIA 属性使用相对简单，但有几个关键点需要注意。首先，导航容器必须使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-labelledby" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-labelledby" ref="nofollow noopener noreferrer">aria-labelledby</a> 进行标记，以便用户了解这个导航区域的用途。其次，当前页面项必须使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a>="page" 进行标记。最后，确保分隔符元素使用 aria-hidden="true"，以避免辅助技术用户听到不必要的标点符号朗读。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ARIA 属性使用规范 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/blog/"</span>&gt;</span>博客<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>文章标题<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">5.3 响应式设计考虑</h4>
<p>面包屑导航在移动设备上可能面临空间受限的挑战。对于层级较深的导航，可以考虑以下策略：一是使用省略号隐藏中间层级，只保留首页和最后几级；二是允许用户展开查看完整路径；三是将面包屑导航改为垂直布局。无论采用哪种策略，都要确保用户能够访问完整的导航信息。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 响应式面包屑导航 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.breadcrumb-list</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
  }

  <span class="hljs-selector-class">.breadcrumb-separator</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">90deg</span>);
  }
}
</code></pre>
<h3 data-id="heading-14">六、面包屑导航与主导航的区别</h3>
<p>面包屑导航和主导航栏虽然都是网站导航的重要组成部分，但它们服务于不同的目的，理解这种区别对于正确使用这两种导航组件至关重要。</p>
<p>面包屑导航的主要作用是展示用户在网站层级结构中的当前位置，它反映的是网站的逻辑结构，而非用户的浏览历史。面包屑导航通常只出现在层级较深的页面中，帮助用户理解当前位置与网站整体结构的关系。相比之下，主导航栏提供的是网站的整体架构概览，允许用户直接跳转到任何主要版块，而不考虑当前的层级位置。</p>
<p>从实现角度来看，面包屑导航强调的是层级关系，因此通常使用有序列表（ol）来体现这种顺序性。而主导航栏更强调功能分区的划分，可能使用无序列表（ul）或更复杂的布局结构。两者在 ARIA 属性使用上也不同：面包屑导航需要明确标记当前页面（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a>="page"），而主导航栏通常不需要这种标记。</p>
<h3 data-id="heading-15">七、总结</h3>
<p>构建无障碍的面包屑导航需要关注语义化结构、ARIA 属性应用和视觉样式三个层面的细节。从语义化角度，应使用 nav 元素定义导航区域，使用 ol 或 ul 元素创建列表结构。从 ARIA 属性角度，需要使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 为导航区域提供标签，使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a>="page" 标记当前页面。从视觉样式角度，应确保链接易于识别，分隔符清晰，当前页面状态明确。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Fbreadcrumb%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/breadcrumb/" ref="nofollow noopener noreferrer">WAI-ARIA Breadcrumb Pattern</a> 为我们提供了清晰的指导方针，遵循这些规范能够帮助我们创建更加包容和易用的 Web 应用。每一个正确实现的面包屑导航组件，都是提升用户体验和网站可访问性的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CMakeLists.txt命令全面解析]]></title>    <link>https://juejin.cn/post/7600986495927877673</link>    <guid>https://juejin.cn/post/7600986495927877673</guid>    <pubDate>2026-01-31T08:58:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986495927877673" data-draft-id="7600986495927844905" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CMakeLists.txt命令全面解析"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-01-31T08:58:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黑夜给了我黑色的眼睛"/> <meta itemprop="url" content="https://juejin.cn/user/3690408471177224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CMakeLists.txt命令全面解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3690408471177224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黑夜给了我黑色的眼睛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T08:58:55.000Z" title="Sat Jan 31 2026 08:58:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、CMake 核心基础（必学，占80%使用场景）</h2>
<h3 data-id="heading-1">1. 版本声明（脚本第一行必写）</h3>
<h4 data-id="heading-2">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION &lt;版本号&gt;)
</code></pre>
<h4 data-id="heading-3">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION 3.10)    # Abseil项目最低版本
cmake_minimum_required(VERSION 3.22.1) # nativesdk项目最低版本
cmake_minimum_required(VERSION 3.5)     # utf8_range项目最低版本
</code></pre>
<h4 data-id="heading-4">作用</h4>
<p>指定运行当前CMake脚本所需的最低CMake版本，低于该版本会直接报错，确保脚本兼容性。</p>
<h3 data-id="heading-5">2. 项目声明</h3>
<h4 data-id="heading-6">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">project(&lt;项目名&gt; [LANGUAGES &lt;语言列表&gt;] [VERSION &lt;版本号&gt;])
</code></pre>
<h4 data-id="heading-7">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">project(absl LANGUAGES CXX VERSION 20230802)  # 仅C++，指定版本
project(nativesdk)                             # 默认语言（C/C++），无版本
project(utf8_range C CXX)                     # 同时支持C和C++
</code></pre>
<h4 data-id="heading-8">作用</h4>
<ul>
<li>定义项目名称，是CMake脚本的核心标识；</li>
<li><code>LANGUAGES</code>：指定项目支持的编译语言（CXX=C++，C=C，不写则默认C/C++）；</li>
<li><code>VERSION</code>：给项目标注版本号（仅发布库时有用）；</li>
</ul>
<h4 data-id="heading-9">自动生成变量（常用）</h4>
<ul>
<li><code>${PROJECT_NAME}</code>：当前项目名（如absl、nativesdk）；</li>
<li><code>${PROJECT_SOURCE_DIR}</code>：项目源码根目录。</li>
</ul>
<h3 data-id="heading-10">3. 变量设置（存储路径/开关/参数）</h3>
<h4 data-id="heading-11">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake"># 基础赋值
set(&lt;变量名&gt; &lt;变量值&gt;)
# 缓存变量（强制覆盖默认值）
set(&lt;变量名&gt; &lt;值&gt; CACHE &lt;类型&gt; "&lt;描述&gt;" FORCE)
</code></pre>
<h4 data-id="heading-12">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake"># 基础变量：编译标准、平台配置
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_ANDROID_STL_TYPE c++_static)

# 缓存变量：关闭第三方库测试/示例
set(ABSL_BUILD_TESTING OFF CACHE BOOL "" FORCE)
set(protobuf_USE_LITE_RUNTIME ON CACHE BOOL "" FORCE)

# 路径变量：拼接路径
set(UTF8_RANGE_SRC_DIR "${protobuf_SOURCE_DIR}/third_party/utf8_range")
</code></pre>
<h4 data-id="heading-13">核心说明</h4>
<ul>
<li>变量引用方式：<code>${变量名}</code>（如<code>${CMAKE_CXX_STANDARD}</code>）；</li>
<li>常用类型：<code>BOOL</code>（布尔值，值为ON/OFF，非true/false）；</li>
<li><code>FORCE</code>：强制覆盖CMake默认的变量值（比如关闭Abseil的测试编译）；</li>
<li>路径拼接：用双引号包裹（<code>"${A}/${B}"</code>），避免路径含空格时出错。</li>
</ul>
<h3 data-id="heading-14">4. 编译库/可执行文件（核心编译命令）</h3>
<h4 data-id="heading-15">（1）编译库：<code>add_library</code></h4>
<h5 data-id="heading-16">命令格式</h5>
<pre><code class="hljs language-cmake" lang="cmake">add_library(&lt;库名&gt; &lt;库类型&gt; &lt;源码文件列表&gt;)
</code></pre>
<h5 data-id="heading-17">示例（你的代码）</h5>
<pre><code class="hljs language-cmake" lang="cmake"># 静态库（STATIC）：生成.a/.lib文件
add_library(utf8_range STATIC naive.c range2-neon.c)

# 动态库（SHARED）：生成.so/.dll文件
add_library(nativesdk SHARED ${ALL_SRC})
</code></pre>
<h5 data-id="heading-18">核心说明</h5>
<ul>
<li>库类型：
<ul>
<li><code>STATIC</code>：静态库，编译时打包进可执行文件，不依赖外部库；</li>
<li><code>SHARED</code>：动态库，运行时加载，需配套发布.so/.dll；</li>
<li><code>INTERFACE</code>：仅头文件库（无源码，仅提供头文件）；</li>
</ul>
</li>
<li>源码列表：可直接写文件名（如<code>naive.c</code>），也可引用变量（如<code>${ALL_SRC}</code>）。</li>
</ul>
<h4 data-id="heading-19">（2）编译可执行文件：<code>add_executable</code></h4>
<h5 data-id="heading-20">命令格式</h5>
<pre><code class="hljs language-cmake" lang="cmake">add_executable(&lt;程序名&gt; &lt;源码文件列表&gt;)
</code></pre>
<h5 data-id="heading-21">示例（你的代码）</h5>
<pre><code class="hljs language-cmake" lang="cmake">add_executable(tests utf8_validity_test.cc)  # 编译测试程序
</code></pre>
<h5 data-id="heading-22">作用</h5>
<p>生成可运行的程序（如测试程序、工具程序），仅在需要可执行文件时使用。</p>
<h3 data-id="heading-23">5. 头文件目录配置</h3>
<h4 data-id="heading-24">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake"># 全局头文件（所有目标生效）
include_directories(&lt;目录列表&gt;)
# 目标专属头文件（推荐，精准）
target_include_directories(&lt;目标名&gt; &lt;作用域&gt; &lt;目录列表&gt;)
</code></pre>
<h4 data-id="heading-25">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake"># 全局头文件
include_directories(${UTF8_RANGE_SRC_DIR})

# 目标专属头文件（PRIVATE仅当前目标可用）
target_include_directories(nativesdk PRIVATE
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${abseil-cpp_SOURCE_DIR}
)
</code></pre>
<h4 data-id="heading-26">核心说明</h4>
<ul>
<li>作用域：
<ul>
<li><code>PRIVATE</code>：仅当前目标可用（如nativesdk自己的头文件）；</li>
<li><code>PUBLIC</code>：当前目标 + 依赖该目标的其他目标可用；</li>
<li><code>INTERFACE</code>：仅依赖该目标的其他目标可用；</li>
</ul>
</li>
<li>核心作用：告诉编译器「去哪里找#include的头文件」，避免「头文件找不到」错误。</li>
</ul>
<h3 data-id="heading-27">6. 库链接（关联依赖库）</h3>
<h4 data-id="heading-28">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">target_link_libraries(&lt;目标名&gt; &lt;作用域&gt; &lt;库名列表&gt;)
</code></pre>
<h4 data-id="heading-29">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">target_link_libraries(nativesdk PRIVATE
  absl::base absl::strings
  protobuf::libprotobuf-lite
  utf8_range
  log z atomic m
)

target_link_libraries(utf8_validity PUBLIC absl::strings)
</code></pre>
<h4 data-id="heading-30">核心说明</h4>
<ul>
<li>作用：告诉编译器「当前目标需要链接哪些库」，解决编译时的「未定义符号」错误；</li>
<li>库名类型：
<ul>
<li>自定义库（如<code>utf8_range</code>）；</li>
<li>第三方库别名（如<code>absl::base</code>、<code>protobuf::libprotobuf-lite</code>）；</li>
<li>系统库（如Android的<code>log</code>、<code>z</code>、<code>atomic</code>）；</li>
</ul>
</li>
<li>作用域：同<code>target_include_directories</code>（PRIVATE/PUBLIC/INTERFACE）。</li>
</ul>
<h3 data-id="heading-31">7. 条件判断（控制编译逻辑）</h3>
<h4 data-id="heading-32">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">if(&lt;条件&gt;)
  # 满足条件执行的命令
elseif(&lt;其他条件&gt;)
  # 其他条件执行的命令
else()
  # 都不满足执行的命令
endif()
</code></pre>
<h4 data-id="heading-33">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake"># 检查是否存在目标
if (NOT TARGET absl::strings)
  if (NOT ABSL_ROOT_DIR)
    find_package(absl REQUIRED CONFIG)
  else ()
    add_subdirectory(${ABSL_ROOT_DIR} third_party/abseil-cpp)
  endif ()
endif ()

# 检查编译开关
if (${ABSL_BUILD_DLL})
  absl_make_dll()
endif ()
</code></pre>
<h4 data-id="heading-34">常用条件</h4>
<ul>
<li><code>NOT</code>：取反（如<code>NOT TARGET absl::strings</code> = 不存在absl::strings目标）；</li>
<li><code>MATCHES</code>：字符串匹配（如<code>"${CMAKE_CXX_COMPILER_ID}" MATCHES "Clang"</code>）；</li>
<li>变量判断（如<code>${ABSL_BUILD_DLL}</code> = ON时执行）；</li>
</ul>
<h4 data-id="heading-35">作用</h4>
<p>实现「跨平台编译」「按需编译」（比如Android和Linux编译逻辑不同、是否编译测试代码）。</p>
<h2 data-id="heading-36">二、CMake 进阶命令（你的代码高频使用）</h2>
<h3 data-id="heading-37">1. 第三方库拉取：<code>FetchContent</code>（自动下载/编译）</h3>
<h4 data-id="heading-38">命令组合</h4>
<pre><code class="hljs language-cmake" lang="cmake"># 声明要拉取的库
FetchContent_Declare(
  &lt;库名&gt;
  GIT_REPOSITORY &lt;Git仓库地址&gt;
  GIT_TAG &lt;版本标签/分支&gt;
  GIT_SHALLOW &lt;ON/OFF&gt;
)
# 初始化并编译库
FetchContent_MakeAvailable(&lt;库名1&gt; &lt;库名2&gt;)
</code></pre>
<h4 data-id="heading-39">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">FetchContent_Declare(
  abseil-cpp
  GIT_REPOSITORY https://github.com/abseil/abseil-cpp.git
  GIT_TAG 20240116.0
  GIT_SHALLOW OFF
)
FetchContent_MakeAvailable(abseil-cpp protobuf)
</code></pre>
<h4 data-id="heading-40">核心说明</h4>
<ul>
<li>作用：无需手动下载第三方库源码，CMake自动从Git拉取、编译，简化依赖管理；</li>
<li><code>GIT_TAG</code>：必须指定（如版本号、标签），避免拉取最新代码导致兼容问题；</li>
<li>拉取的库会存到构建目录的<code>_deps</code>子目录下。</li>
</ul>
<h3 data-id="heading-41">2. 查找系统库：<code>find_package</code>（找已安装的库）</h3>
<h4 data-id="heading-42">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">find_package(&lt;库名&gt; [REQUIRED] [CONFIG])
</code></pre>
<h4 data-id="heading-43">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">find_package(Threads REQUIRED)    # 查找线程库，找不到则报错
find_package(GTest REQUIRED)      # 查找GoogleTest库
find_package(absl REQUIRED CONFIG) # 按配置文件查找Abseil
</code></pre>
<h4 data-id="heading-44">核心说明</h4>
<ul>
<li><code>REQUIRED</code>：标记为必选依赖，找不到库则直接报错；</li>
<li><code>CONFIG</code>：按库的CMake配置文件查找（而非系统默认路径）；</li>
<li>区别：<code>FetchContent</code>是「下载并编译」，<code>find_package</code>是「找已安装的库」。</li>
</ul>
<h3 data-id="heading-45">3. 子目录编译：<code>add_subdirectory</code></h3>
<h4 data-id="heading-46">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">add_subdirectory(&lt;子目录路径&gt; [编译输出目录])
</code></pre>
<h4 data-id="heading-47">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">add_subdirectory(absl)                  # 编译Abseil主目录
add_subdirectory(base)                  # 编译Abseil的base子模块
add_subdirectory(${ABSL_ROOT_DIR} third_party/abseil-cpp) # 指定输出目录
</code></pre>
<h4 data-id="heading-48">作用</h4>
<p>进入子目录，执行该目录下的<code>CMakeLists.txt</code>，适合拆分大型项目（如Abseil按模块拆分编译）。</p>
<h3 data-id="heading-49">4. 编译宏定义：<code>target_compile_definitions</code></h3>
<h4 data-id="heading-50">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">target_compile_definitions(&lt;目标名&gt; &lt;作用域&gt; &lt;宏名1&gt; &lt;宏名2=值&gt;)
</code></pre>
<h4 data-id="heading-51">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">target_compile_definitions(nativesdk PRIVATE
  PROTOBUF_USE_LITE_RUNTIME
  GOOGLE_PROTOBUF_NO_RTTI
  PROTOBUF_DISABLE_JSON=1
)
</code></pre>
<h4 data-id="heading-52">作用</h4>
<p>给编译器传递宏定义，代码中可通过<code>#ifdef</code>判断（如<code>PROTOBUF_USE_LITE_RUNTIME</code>启用Protobuf Lite版本）。</p>
<h3 data-id="heading-53">5. 文件批量查找：<code>file(GLOB)</code></h3>
<h4 data-id="heading-54">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">file(GLOB &lt;变量名&gt; &lt;文件匹配规则&gt;)
</code></pre>
<h4 data-id="heading-55">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">file(GLOB ALL_SRC
  ${CMAKE_CURRENT_SOURCE_DIR}/core/*.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/proto/*.pb.cc
)
</code></pre>
<h4 data-id="heading-56">核心说明</h4>
<ul>
<li>作用：批量匹配文件（如所有<code>.cpp</code>、<code>.pb.cc</code>），避免手动罗列所有源码；</li>
<li>匹配规则：<code>*.cpp</code>（所有cpp文件）、<code>core/*.cpp</code>（core目录下的cpp文件）；</li>
<li>注意：新增文件后需重新执行<code>cmake ..</code>才能识别。</li>
</ul>
<h3 data-id="heading-57">6. CMake策略配置：<code>cmake_policy</code></h3>
<h4 data-id="heading-58">命令格式</h4>
<pre><code class="hljs language-cmake" lang="cmake">cmake_policy(SET &lt;策略ID&gt; &lt;NEW/OLD&gt;)
</code></pre>
<h4 data-id="heading-59">示例（你的代码）</h4>
<pre><code class="hljs language-cmake" lang="cmake">cmake_policy(SET CMP0025 NEW)  # Apple Clang编译器标识修正
cmake_policy(SET CMP0077 NEW)  # option命令尊重变量值
</code></pre>
<h4 data-id="heading-60">作用</h4>
<p>兼容不同CMake版本的行为差异（如旧版本CMake的某些命令逻辑和新版本不同，通过策略统一）。</p>
<h2 data-id="heading-61">三、CMake 实战场景（结合你的代码）</h2>
<h3 data-id="heading-62">场景1：编译Android动态库（nativesdk）</h3>
<p>核心命令流程：</p>
<pre><code class="hljs language-cmake" lang="cmake"># 1. 基础配置
cmake_minimum_required(VERSION 3.22.1)
project(nativesdk)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_ANDROID_STL_TYPE c++_static)

# 2. 拉取第三方依赖
FetchContent_Declare(abseil-cpp ...)
FetchContent_Declare(protobuf ...)
FetchContent_MakeAvailable(abseil-cpp protobuf)

# 3. 收集源码
file(GLOB ALL_SRC core/*.cpp jni/*.cpp proto/*.pb.cc)

# 4. 编译动态库
add_library(nativesdk SHARED ${ALL_SRC})

# 5. 配置头文件
target_include_directories(nativesdk PRIVATE ${CMAKE_CURRENT_SOURCE_DIR} ${abseil-cpp_SOURCE_DIR})

# 6. 定义编译宏
target_compile_definitions(nativesdk PRIVATE PROTOBUF_USE_LITE_RUNTIME)

# 7. 链接依赖库
target_link_libraries(nativesdk PRIVATE absl::base protobuf::libprotobuf-lite)
</code></pre>
<h3 data-id="heading-63">场景2：编译静态库（utf8_range）</h3>
<p>核心命令流程：</p>
<pre><code class="hljs language-cmake" lang="cmake"># 1. 基础配置
cmake_minimum_required(VERSION 3.5)
project(utf8_range C CXX)

# 2. 编译静态库
add_library(utf8_range STATIC naive.c range2-neon.c)

# 3. 查找/编译Abseil依赖
if (NOT TARGET absl::strings)
  find_package(absl REQUIRED CONFIG)
endif()

# 4. 链接Abseil
target_link_libraries(utf8_validity PUBLIC absl::strings)
</code></pre>
<h2 data-id="heading-64">四、避坑指南</h2>
<ol>
<li>路径引用：所有路径用<code>${}</code>包裹，拼接时加双引号（如<code>"${A}/${B}"</code>）；</li>
<li>布尔值：CMake中用<code>ON/OFF</code>，而非<code>true/false</code>；</li>
<li>作用域：优先用<code>PRIVATE</code>（仅当前目标生效），避免<code>PUBLIC</code>导致的全局污染；</li>
<li>第三方库：<code>FetchContent</code>指定<code>GIT_TAG</code>，避免拉取最新代码引发兼容问题；</li>
<li>错误排查：
<ul>
<li>头文件找不到：检查<code>target_include_directories</code>；</li>
<li>链接错误：检查<code>target_link_libraries</code>（库名是否正确、顺序是否合理）。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面试官：多节点争抢资源， Redis 分布式锁是怎么实现的？]]></title>    <link>https://juejin.cn/post/7600999271770341376</link>    <guid>https://juejin.cn/post/7600999271770341376</guid>    <pubDate>2026-01-31T07:07:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600999271770341376" data-draft-id="7601018079620612111" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面试官：多节点争抢资源， Redis 分布式锁是怎么实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-31T07:07:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小林coding"/> <meta itemprop="url" content="https://juejin.cn/user/1750078243734029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面试官：多节点争抢资源， Redis 分布式锁是怎么实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078243734029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小林coding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:07:58.000Z" title="Sat Jan 31 2026 07:07:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">多节点争抢资源， Redis 分布式锁是怎么实现的？</h2>
<p>大家好，今天给大家分享 Redis 里的一个知识点 — Redis 分布式锁。</p>
<p><strong>在分布式系统的世界里，Redis 就像一座高效运转的共享仓库</strong> — 多个节点通过共享数据协同发力，左手接过业务系统的海量读写请求，右手以毫秒级速度完成数据交付。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b8e5942e4b7439dbdf3a911a642b973~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=cLjG0a%2BPRLw%2FXLxtzn%2FlKj18tEk%3D" alt="图片" loading="lazy"/></p>
<p>可再默契的团队，如果没有统一的行动准则，也难免遇到“抢活干”的问题。而 Redis 分布式锁，就像是分布式世界里的 “秩序守护者”。它会清晰地告诉每个节点：</p>
<p><strong>什么时候能操作数据、能不能同时操作，把数据操作的边界和顺序划分得明明白白，从根源上杜绝争抢。</strong></p>
<p>接下来，我们就来看看 — Redis 分布式锁是怎么给多节点系统 “立规矩” 的。</p>
<h3 data-id="heading-1">谁在给 Redis 锁制造冲突？</h3>
<p>Redis 锁的核心目标，是在分布式环境中建立"共享资源访问规则"，让锁机制井然有序运行。但在实际落地时，总有些问题在制造冲突：</p>
<h4 data-id="heading-2"><strong>问题一：锁争抢 — 多人抢同一把锁，导致数据错乱</strong></h4>
<p>节点想要拿到锁，得经历两步操作：</p>
<p><strong>先判断这把锁当前有没有被人占用，确认空闲后再动手抢占锁。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e1c99f39e86408f8ccba4b03fa78801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=PP87Yp%2FstrXKiEUno7iUXjcoz9g%3D" alt="图片" loading="lazy"/></p>
<p>但问题恰恰出在这两步是分开做的 — 哪怕中间只隔了一瞬间的空隙，也足以埋下隐患。</p>
<p>想象一下这样的场景：有好几个节点同时要抢同一把锁。节点 A 先查询了锁的状态，发现 “没人占用”，正准备动手抢占时，节点 B 几乎在同一时间也查了锁的状态，得到了同样的结果。</p>
<p><strong>接下来，两个节点都顺利完成了抢占操作，以至于每个节点都觉得自己抢到了唯一的锁。</strong> 进而同时去操作同一个共享资源，最终引发数据错乱、操作冲突。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f66119c9f8f48979c684ff6f670f7d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=FMX0vlpTrA3UD%2B%2BTE4YGYnWOMy4%3D" alt="图片" loading="lazy"/></p>
<p>锁争抢就是典型的“多人抢锁”乱象，而当锁被某一节点占用后，又可能面临「锁不释放」的情况，这便是“僵尸锁”带来的挑战。</p>
<h4 data-id="heading-3"><strong>问题二：僵尸锁 — 锁不释放，导致业务流程阻塞</strong></h4>
<p>某个节点拿到锁后，粗心地忘了给锁设定过期时间，紧接着又因为节点宕机或程序报错，没法主动释放这把锁。</p>
<p><strong>于是这条锁记录就彻底赖在 Redis 里不走了，变成没人管的 “僵尸锁”</strong> — 牢牢霸占着对应的共享资源，后面不管哪个节点想操作这个资源，全被它拦在门外，直接影响整个系统正常干活。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9a7ca5685914e74ba2edc4f311ed93d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=nY3ShMQeOSldclx3%2BM7pSKW2DzY%3D" alt="图片" loading="lazy"/></p>
<p>为了解决“僵尸”锁问题，给锁设置过期时间成为必然选择，但这一解决方案又会催生新的矛盾，即锁过期的问题。</p>
<h4 data-id="heading-4"><strong>问题三：锁过期 — 过期时间与任务时长不匹配</strong></h4>
<p>某个节点拿到锁并且设置完过期时间后，马上投入业务处理，可偏偏业务还没做完，锁的过期时间就到了。</p>
<p>Redis 见状直接自动释放了锁，而原来拿锁的节点对此毫无察觉，还在闷头干活。这时，其他节点一看锁没了，立刻一拥而上把锁抢到手，然后操作同一个资源 — <strong>结果就是两个节点同时改一个数据，直接造成并发冲突。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ffd17aae7841b2b4dde3173051c346~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=LrCcH3yQvrKIhE%2BNfr7%2BgrpZtdQ%3D" alt="图片" loading="lazy"/></p>
<p>但无论是锁争抢、僵尸锁，还是锁过期导致的冲突，都有一个前提：<strong>锁的存储节点足够稳定。</strong> 而当 Redis 架构本身出现隐患时，上述所有问题都可能升级为影响整个系统的故障。</p>
<h4 data-id="heading-5"><strong>问题四：锁存储不可靠 — 单节点部署的隐患</strong></h4>
<p>当存储分布式锁的 Redis 只用单节点部署时，无异于把所有 “锁管理大权” 交给了唯一的管理员。一旦这个管理员突然 “罢工”（比如宕机），那么所有加锁、解锁、查锁状态的操作都会彻底卡壳，直接导致整个分布式锁机制瘫痪。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082d1d1ef93e43f9b74a02607da4ba98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=HyqxKo5idEewq5JTel10zxMH0NM%3D" alt="图片" loading="lazy"/></p>
<p>到头来，共享资源要么没人敢碰，要么大家一窝蜂乱抢，场面完全失控。</p>
<p>这些问题就像横亘在我们面前的四座大山，要构建可靠的分布式锁，就必须逐一攻克。接下来，我们就来看业务层面如何借助 Redis 的核心特性来实现分布式锁的。</p>
<h3 data-id="heading-6">Redis 锁的“秩序构建术”</h3>
<p>面对分布式环境的复杂挑战，Redis 锁通过分层设计构建了一套完整的"秩序体系"。从加锁到释放锁，每个环节都蕴含着精妙的设计思想。</p>
<h4 data-id="heading-7">1、加锁机制：从单节点到高可用</h4>
<p>加锁的核心目标是保证同一时间只有一个业务能操作共享资源，Redis 锁通过两层设计来实现这个目标：</p>
<h5 data-id="heading-8"><strong>第一层：单节点锁 — 破解“锁争抢”和“僵尸锁”</strong></h5>
<p>Redis 单节点锁的核心命令看似简单：<strong>SET lock_key unique_value NX EX 30。</strong> 但这条命令里藏着解决两大基础难题的巧思。我们逐一拆开来看：</p>
<p>先看 unique_value，它是给每个节点生成的唯一标识，就像给每个节点发了一张专属入场券。释放锁的时候，节点必须出示这张入场券，只有校验通过，才能删除自己持有的锁，绝不会误删别人的锁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b0018c43c024f3595f7ec732de17771~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=O%2Bcaajp%2F13TRZMBnZEtsjvXsoEw%3D" alt="图片" loading="lazy"/></p>
<p>再看 NX（Not eXists），它的意思是仅当锁对应的 lock_key 不存在时，才执行加锁操作。这就像只有空座位才能入座，直接保证了锁的互斥性 — 同一时间，只有一个节点能成功获取锁，从根源上解决了大家抢着用资源的锁争抢问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54d07138cc8046a598c898f5beeca4e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=6oxfNv979x7RYsdSnLP6FUI9RKU%3D" alt="图片" loading="lazy"/></p>
<p>然后是 EX 30，它的作用是给锁设置 30 秒的过期时间。好比座位有最长占用时限，超时后自动 “让座”，不会一直占着资源不释放，从根本上避免了节点宕机等异常情况导致的“僵尸锁”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a81e6d6157144c0ad94699dd91848c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=0hy2mcGzgZQclmTQO2VDukvo55Q%3D" alt="图片" loading="lazy"/></p>
<p>而这条 SET 命令的关键，就是把抢锁（NX）和设过期时间（EX），变成了一步完成的原子操作，中间没有任何可中断的间隙：</p>
<p><strong>要么</strong> ***** *指令未执行，<strong><strong>锁没抢到；要么</strong></strong>指令完整执行，**<strong>抢到的锁已经自带过期时间。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/880940ce307d40649577b26c3bfb5814~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=o6NToasotnpO3wd8%2FALtdWoXzt8%3D" alt="图片" loading="lazy"/></p>
<p>这就从机制上杜绝了因分步执行而引发的各类异常。</p>
<p>不过单节点 Redis 锁虽然简单高效，但存在一个致命弱点：<strong>如果 Redis 节点宕机，整个锁机制就会失效。</strong> 因此，为了提升锁机制的高可用性，需要一种能突破单节点依赖的解决方案 — 高可用锁。</p>
<h5 data-id="heading-9"><strong>第二层：高可用锁 —</strong> <strong>解决单点依赖</strong></h5>
<p>为了破解单节点锁的可用性瓶颈，Redis 的作者 Antirez 提出了 Redlock 算法。其核心思想是：</p>
<p><strong>给 Redis 锁部署至少 3 个独立的节点（实际常用 5 个），只有超过半数节点都成功给资源加锁时，资源才算真的拿到了有效锁。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a67b3c92f6c84806871d5cdbf1fcf634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=etw89iF1%2Fa6fPsHTJijAolA9mxI%3D" alt="图片" loading="lazy"/></p>
<p>Redlock 算法的执行步骤如下：</p>
<ol>
<li>向 N 个独立的 Redis 锁节点依次发送 <code>SET NX EX</code> 加锁请求，实际应用中通常会部署 5 个；</li>
<li>统计成功给资源加锁的节点数量，若成功数量超过 N/2，比如部署 5 个节点时至少有 3 个成功，就判定加锁成功；</li>
<li>如果成功数量少于半数，则说明加锁失败，立即向所有锁节点释放锁，避免产生"僵尸锁"。</li>
</ol>
<p>这种设计的精妙之处在于，即便部分锁节点宕机（不超过半数），剩余的多数锁节点仍能正常提供锁服务，从根本上规避了单点故障风险。这就像开会投票，只要超过半数人同意，决议就能生效，少数人的缺席不会影响整体决策。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca4d0368df6c4b3ebfbd445374503ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=19gaFmSh5MFPzQpEeL74PaR8dIo%3D" alt="图片" loading="lazy"/></p>
<p>通过 Redlock 算法的加锁机制，我们确保了分布式环境下资源的互斥访问，但锁的释放环节同样需要谨慎处理，毕竟一旦释放逻辑出现疏漏，就可能引发新的并发混乱。</p>
<h4 data-id="heading-10">2、释放锁机制：先 “验身份” 再删锁</h4>
<p>先前加锁时，我们会针对要保护的共享资源，在锁节点存入一把 “带身份标识的锁” — unique_value，就像给这把锁刻上了自己的 “专属名字”。等业务要释放共享资源时，不能直接删锁，得先去锁节点验证：</p>
<p><strong>“这把锁是不是我的？”</strong></p>
<p>确认无误后，才能删除锁，也就是真正释放锁。</p>
<p>但这里有个关键问题：如果 “先查身份、再删锁” 分成两步做，中间就会有个 “时间差漏洞”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/031f1a150fd4452e9ea0d143b150cbf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=IugstHWOFWzGyv%2Frou1SWvACTI8%3D" alt="图片" loading="lazy"/></p>
<p>比如你刚查完，确认这把锁是自己的，可还没来得及删，这把锁的过期时间就到了，系统自动把它释放了；而就在这一瞬间，其他业务刚好抢到了这把锁。等你反应过来执行删除操作时，删的已经不是自己的锁，而是别人刚抢到的新锁了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6970c2962a64fcd89d2e2c873f029ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=eIbcaMcCNl4XSoluMePOZ%2FvLCJM%3D" alt="图片" loading="lazy"/></p>
<p>这一下就出大问题了：<strong>不仅误删了别人的锁，还让共享资源失去了保护</strong> — 没有锁的约束，其他业务可能会一窝蜂地操作这个资源，最后很可能导致数据错乱。</p>
<p>为了规避这种风险，Redis 提供了 Lua 脚本支持，能将判断和删除这两个操作封装成一个原子操作。对应的脚本如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d9f12d8ae7941e898cea83c42d60cbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=Vxw78sUJ8Z9GCFrKXRXTz9FveZU%3D" alt="图片" loading="lazy"/></p>
<p>这段脚本相当于让 「验锁 + 删锁」 一步到位，安全可靠！</p>
<p>最终，从单节点锁到 Redlock 算法，从加锁到释放锁，Redis 为我们构建了完整的分布式锁理论基础。接下来，我们将这些理论转化为实践，看看如何在项目中正确落地。</p>
<h3 data-id="heading-11">Redis 锁的落地指南</h3>
<p>分布式锁的落地从来不是一刀切的，而是要"因地制宜" — 简单场景用单节点锁高效落地，核心业务靠高可用锁保驾护航。下面我们结合不同的业务场景，拆解对应的 Redis 锁实践方案：</p>
<h4 data-id="heading-12">1、简单场景：单节点锁轻量高效</h4>
<p>如果你的业务不是支付、下单这种核心场景，那单节点 Redis 锁就完全够用了，简单还不占资源。例如我们要给 1001 号商品的库存加锁，核心命令如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89e2e6eefce44698b78b3d5c2cb3fd13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=2Zh6oFqoYGkPDhe7yGM%2FCObG4ZY%3D" alt="图片" loading="lazy"/></p>
<p>使用时需要注意三个关键细节，不然容易出问题：</p>
<p><strong>第一个细节是 unique_value 必须独一无二。</strong></p>
<p>命令里的 "node1_uuid_12345" 可不是随便填的字符串，它是每个加锁请求的专属 “身份证”，得保证全网唯一。核心目的就是让后续解锁时，能准确识别出 “这把锁是我加的”，避免误解锁别人的锁。</p>
<p><strong>第二个是过期时间 <code>EX 30 </code>的设置，得合理预留缓冲。</strong></p>
<p>比如你预估一个任务平均 10 秒能完成，那过期时间就别设 10 秒，建议设 30 秒。多出来的 20 秒是缓冲，万一某个任务因为网络延迟、数据量稍大慢了点，也不会出现 “任务还没做完，锁就过期了” 的情况。</p>
<p><strong>第三个是加锁失败后别做无效等待。</strong></p>
<p>如果执行上面的 SET 命令后，返回的是<code>nil，说明锁已经被别人占用了。这时候别一直死等，要么设置最多重试 3 次（每次间隔几百毫秒），要么直接返回 “操作失败，请稍后再试”，避免浪费服务器资源。</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef37c653312442a5863383fed6bb6a9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=LlyX4r7vOrthp16RsQPZN0LGn7E%3D" alt="图片" loading="lazy"/></p>
<p>基础版的单节点锁用起来简单又高效，但如果任务执行时间不确定，很可能出现“任务还没做完，锁就过期了”的情况。这时，“看门狗（Watch Dog）” 机制就能派上用场。</p>
<h4 data-id="heading-13">2、长任务场景：用“看门狗”给锁自动续期</h4>
<p>看门狗机制的工作原理其实很简单：</p>
<p>当业务节点成功抢到锁之后，系统会在这个节点上启动一个后台线程，就像给业务栓了一只尽职尽责的看门狗。这只 “看门狗” 会按固定时间（比如每隔 10 秒）主动检查：</p>
<p><strong>“主人，你还在使用这把锁吗？”</strong></p>
<p>如果发现业务还在正常执行，它就会立刻给锁 “续期”，比如把锁的过期时间再延长 30 秒，不让锁提前过期被别人抢走。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82d3a0ff5bde4e5aab508c2c01c284a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=NgAw0N9aZ9aNW3gtfBAnpgSVufw%3D" alt="图片" loading="lazy"/></p>
<p>目前主流的开源框架 Redisson 已经内置了这个看门狗机制，使用起来十分便捷。</p>
<p>不过要注意，不管是基础版单节点锁，还是带看门狗的锁，都只是解决了单节点场景的锁问题。如果是支付、下单这类核心业务，我们需要更高的可用性保障，这时候基于<strong>Redlock 算法</strong>的高可用部署方案就成了首选。</p>
<h4 data-id="heading-14">3、核心场景：高可用锁守住业务“生命线”</h4>
<p>针对支付、下单等核心业务场景，建议直接采用 Redlock 算法，并部署至少 3 个独立的 Redis 锁节点。具体部署建议如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dc877311f6d44baa97ba3b522ef2746~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=75GfxDjuodiDdz%2FtUrVMt00B9x0%3D" alt="图片" loading="lazy"/></p>
<ul>
<li><strong>节点数量选择奇数</strong>：优先选择 3、5、7 个节点，便于快速计算 “超过半数” 的成功条件，确保锁机制的有效性；</li>
<li><strong>保证节点独立性</strong>：节点之间不能有主从复制关系，最好分布在不同物理机或机房，避免因机房断电、网络故障等问题导致多个节点同时失效；</li>
<li><strong>合理设置请求超时</strong>：向每个节点发送加锁请求时，建议设置 50-100ms 的超时时间，避免单个节点响应缓慢拖垮整个加锁流程。</li>
</ul>
<p>总之，从基础单节点锁到高可用部署，Redis 提供了灵活多样的锁解决方案。但要真正用好这些方案，避免实际应用中出现隐患，还需要注意一些关键细节。</p>
<h3 data-id="heading-15">Redis 锁的隐形“陷阱”</h3>
<p>分布式锁看着简单好上手，但实际落地时，稍有疏忽整个锁机制就可能 “罢工”。今天就来聊聊几个必须盯紧的关键细节，帮你避开常见陷阱：</p>
<h4 data-id="heading-16">陷阱一：看门狗不是万能的</h4>
<p>先说说大家常依赖的看门狗机制 — 它确实能自动给锁续期，但并非绝对可靠。如果持有锁的服务器突然宕机，看门狗线程会随之终止，无法继续给锁续期，锁最终还是会因过期而释放。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6eaee9ce56ac42aa9bba9f5267a3ba50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=VKvT6nN5kzSXQjSPHhSFK5Ik0S0%3D" alt="图片" loading="lazy"/></p>
<p>所以我们设计业务逻辑时，尽量要 “短平快”，能尽快释放锁就别长时间占用；同时做好异常兜底方案，避免锁过期后不同线程同时操作数据，导致数据不一致的问题。</p>
<h4 data-id="heading-17">陷阱二：Redlock 切勿滥用</h4>
<p>Redlock 算法的可靠性确实更高，但相比单节点锁，它需要访问多个节点来确认锁的状态，性能开销更大。对于非核心业务场景，「单节点锁 + 看门狗」的组合已经能满足需求，不必过度追求高可用而采用 Redlock，否则会造成性能浪费。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0281046ab830442c98263b5e33f2c912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=AAMeh5RwF0nzjWaZFAD95TApwZ0%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-18">陷阱三：锁的粒度要把握适中</h4>
<p>最后是锁的粒度设计，这直接关系到系统的运行效率。</p>
<ul>
<li><strong>粒度太粗</strong>，比如整个系统共用一把锁，会导致所有请求排队等待，引发严重的性能瓶颈；</li>
<li><strong>粒度太细</strong>，比如为每个数据项都单独设锁，则会增加系统复杂性和运维开销，还可能出现 "锁爆炸" 问题。建议根据实际业务场景合理设计锁粒度，在并发安全和系统性能之间找到平衡点。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91f75b59743a44cd90398544f56ea366~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6XY29kaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770448078&amp;x-signature=7AW5FoM%2BD4eOMbJpPV7XQl8fDyw%3D" alt="图片" loading="lazy"/></p>
<p>掌握这些最佳实践后，我们才能真正构建出既可靠又高效的分布式锁系统。</p>
<h3 data-id="heading-19">Redis 锁 — 分布式世界的“秩序守护者”</h3>
<p>从单节点锁的「先到先得」逻辑，到 Redlock 算法的「少数服从多数」原则；从 <code>NX EX</code> 原子命令的精妙设计，到 Lua 脚本保障的安全释放，Redis 分布式锁用简洁而优雅的实现，精准解决了分布式系统的三大核心难题 — <strong>互斥性、防死锁、高可用</strong>。</p>
<p>下一次当你遇到分布式定时任务重复执行、核心数据同步错乱等并发问题时，不妨先问问自己：</p>
<p>我的系统中，分布式锁真的用对了吗？核心资源真的被有效 “锁住” 了吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux 进程、网络相关命令大全]]></title>    <link>https://juejin.cn/post/7601046076943171599</link>    <guid>https://juejin.cn/post/7601046076943171599</guid>    <pubDate>2026-01-31T07:28:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601046076943171599" data-draft-id="7601000638344871951" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux 进程、网络相关命令大全"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-31T07:28:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux 进程、网络相关命令大全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:28:16.000Z" title="Sat Jan 31 2026 07:28:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1 进程管理核心命令</h2>
<p>进程是计算机中正在运行的程序的实例。每个进程都有自己的内存空间、寄存器和文件描述符等资源。在 Linux 中，进程可以处于运行（Running）、睡眠（Sleeping）、停止（Stopped）或僵尸（Zombie）等状态。</p>
<h3 data-id="heading-1">1.1 进程查看命令</h3>
<p><strong>ps（进程状态）</strong></p>
<p>ps 是最基础的进程查看命令，用于显示当前时刻的进程状态快照。</p>
<pre><code class="hljs language-ini" lang="ini">ps aux        <span class="hljs-comment"># 显示所有用户的所有进程（BSD风格）</span>
ps -ef        <span class="hljs-comment"># 全格式显示所有进程（System V风格）</span>
ps -ejH       <span class="hljs-comment"># 显示进程树结构</span>
ps aux <span class="hljs-attr">--sort</span>=-%mem  <span class="hljs-comment"># 按内存使用率降序排列</span>
</code></pre>
<p>常用字段说明：</p>
<ul>
<li>USER：进程所有者</li>
<li>PID：进程ID</li>
<li>%CPU：CPU使用率</li>
<li>%MEM：内存使用率</li>
<li>VSZ：虚拟内存大小</li>
<li>RSS：物理内存大小</li>
<li>STAT：进程状态（R=运行, S=睡眠, Z=僵尸）</li>
<li>COMMAND：启动命令</li>
</ul>
<p><strong>top（实时进程监控）</strong></p>
<p>top 提供动态实时视图，显示系统资源使用情况和进程列表。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">top</span>                    # 默认启动，按CPU排序
<span class="hljs-attribute">top</span> -u username        # 仅显示指定用户的进程
<span class="hljs-attribute">top</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-number">1234</span>,<span class="hljs-number">5678</span>       # 监控指定PID的进程
</code></pre>
<p>交互操作（运行中按键）：</p>
<ul>
<li>P：按CPU使用率排序</li>
<li>M：按内存使用率排序</li>
<li>T：按运行时间排序</li>
<li>k：终止指定进程</li>
<li>u：按用户过滤</li>
<li>q：退出</li>
</ul>
<p><strong>htop（增强版top）</strong></p>
<p>htop 是 top 的增强版，提供更直观的界面和更多功能。</p>
<pre><code class="hljs language-bash" lang="bash">sudo apt install htop    <span class="hljs-comment"># Debian/Ubuntu安装</span>
htop -t                 <span class="hljs-comment"># 树状显示进程</span>
htop -s cpu            <span class="hljs-comment"># 按CPU使用率排序</span>
</code></pre>
<p>优势特性：</p>
<ul>
<li>彩色显示，支持鼠标操作</li>
<li>直接F9发送信号，F5进程树视图</li>
<li>显示CPU核心分布和内存条形图</li>
</ul>
<p><strong>pgrep 和 pidof（进程查找）</strong></p>
<pre><code class="hljs language-bash" lang="bash">pgrep firefox                 <span class="hljs-comment"># 查找firefox进程PID</span>
pgrep -u root -f <span class="hljs-string">"nginx"</span>     <span class="hljs-comment"># 查找root用户的nginx进程</span>
pidof bash                   <span class="hljs-comment"># 查找bash进程PID</span>
</code></pre>
<h3 data-id="heading-2">1.2 进程控制命令</h3>
<p><strong>kill 和 killall（进程终止）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> 1234              <span class="hljs-comment"># 默认发送SIGTERM(15)，正常终止</span>
<span class="hljs-built_in">kill</span> -9 1234           <span class="hljs-comment"># 发送SIGKILL(9)，强制终止</span>
<span class="hljs-built_in">kill</span> -TERM $(pgrep nginx)  <span class="hljs-comment"># 优雅终止所有nginx进程</span>
killall firefox        <span class="hljs-comment"># 终止所有firefox进程</span>
pkill -f <span class="hljs-string">"python script.py"</span>  <span class="hljs-comment"># 终止匹配模式的进程</span>
</code></pre>
<p>常用信号说明：</p>
<ul>
<li>SIGTERM(15)：请求正常终止（默认）</li>
<li>SIGKILL(9)：强制立即终止，无法阻塞</li>
<li>SIGINT(2)：中断进程（相当于Ctrl+C）</li>
<li>SIGSTOP(19)：暂停进程</li>
<li>SIGCONT(18)：恢复暂停的进程</li>
</ul>
<p><strong>nice 和 renice（优先级调整）</strong></p>
<p>Linux进程优先级范围-20（最高）到19（最低）。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">nice</span> -n 10 <span class="hljs-built_in">command</span>     <span class="hljs-comment"># 以优先级10启动进程</span>
renice 15 -p 1234      <span class="hljs-comment"># 修改已运行进程的优先级</span>
renice -u username -5  <span class="hljs-comment"># 修改用户所有进程的优先级</span>
</code></pre>
<h3 data-id="heading-3">1.3 前后台作业管理</h3>
<p><strong>jobs、fg、bg（作业控制）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">sleep</span> 100 &amp;            <span class="hljs-comment"># 后台运行</span>
<span class="hljs-built_in">jobs</span> -l               <span class="hljs-comment"># 查看后台任务列表及PID</span>
<span class="hljs-built_in">fg</span> %1                 <span class="hljs-comment"># 将作业1调至前台</span>
<span class="hljs-built_in">bg</span> %2                 <span class="hljs-comment"># 让暂停的作业2在后台继续</span>
</code></pre>
<p><strong>nohup 和 disown（终端退出保活）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">nohup</span> python script.py &gt; output.log 2&gt;&amp;1 &amp;  <span class="hljs-comment"># 终端退出后继续运行</span>
python script.py &amp;      <span class="hljs-comment"># 先后台启动</span>
<span class="hljs-built_in">disown</span> %1              <span class="hljs-comment"># 从作业列表移除，终端关闭不影响</span>
</code></pre>
<h2 data-id="heading-4">2 网络管理核心命令</h2>
<h3 data-id="heading-5">2.1 网络配置命令</h3>
<p><strong>ip（现代网络配置）</strong></p>
<p>ip 命令已逐渐取代 ifconfig，是更强大的网络配置工具。</p>
<pre><code class="hljs language-bash" lang="bash">ip addr show           <span class="hljs-comment"># 显示所有网络接口信息</span>
ip -4 addr             <span class="hljs-comment"># 仅显示IPv4信息</span>
ip route show         <span class="hljs-comment"># 显示路由表</span>
ip neighbor show      <span class="hljs-comment"># 显示ARP表（邻接表）</span>
</code></pre>
<p><strong>nmcli（NetworkManager控制）</strong></p>
<pre><code class="hljs language-bash" lang="bash">nmcli connection show           <span class="hljs-comment"># 显示网络连接</span>
nmcli device status            <span class="hljs-comment"># 显示设备状态</span>
nmcli connection add <span class="hljs-built_in">type</span> wifi ifname wlan0 ssid <span class="hljs-string">"MyWifi"</span> password <span class="hljs-string">"password"</span>  <span class="hljs-comment"># 添加WiFi连接</span>
</code></pre>
<h3 data-id="heading-6">2.2 网络诊断命令</h3>
<p><strong>ping 和 traceroute（连通性测试）</strong></p>
<pre><code class="hljs language-r" lang="r">ping <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">4</span> baidu.com           <span class="hljs-comment"># 发送4个测试包</span>
ping6 target.ipv6.com         <span class="hljs-comment"># IPv6测试</span>
traceroute <span class="hljs-operator">-</span>n baidu.com       <span class="hljs-comment"># 追踪路径，以IP显示节点</span>
mtr baidu.com                <span class="hljs-comment"># 更强大的路径追踪工具</span>
</code></pre>
<p><strong>ss 和 netstat（连接统计）</strong></p>
<p>ss 是 netstat 的现代替代品，速度更快。</p>
<pre><code class="hljs language-perl" lang="perl">ss -tuln                      <span class="hljs-comment"># 查看所有监听端口</span>
ss -t -a                      <span class="hljs-comment"># 所有TCP连接</span>
netstat -anp | <span class="hljs-keyword">grep</span> :<span class="hljs-number">80</span>       <span class="hljs-comment"># 传统方式查看80端口进程</span>
netstat -s                    <span class="hljs-comment"># 显示协议统计信息</span>
</code></pre>
<p>输出字段说明：</p>
<ul>
<li>State：连接状态（ESTABLISHED, LISTEN等）</li>
<li>Recv-Q/Send-Q：接收/发送队列大小</li>
<li>Local Address:Port：本地地址端口</li>
<li>Peer Address:Port：对端地址端口</li>
<li>PID/Program name：进程信息</li>
</ul>
<h3 data-id="heading-7">2.3 网络服务与安全</h3>
<p><strong>iptables（防火墙规则）</strong></p>
<pre><code class="hljs language-css" lang="css">iptables -L                    # 列出当前规则
iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">p</span> tcp <span class="hljs-attr">--dport</span> <span class="hljs-number">22</span> -j ACCEPT  # 允许SSH连接
iptables -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -<span class="hljs-selector-tag">i</span> lo -j ACCEPT              # 允许环回接口
</code></pre>
<p><strong>tcpdump 和 wireshark（流量分析）</strong></p>
<pre><code class="hljs language-bash" lang="bash">tcpdump -i eth0 port 80        <span class="hljs-comment"># 捕获80端口流量</span>
tcpdump -w capture.pcap -i eth0 <span class="hljs-comment"># 保存到文件</span>
tshark -i eth0 -f <span class="hljs-string">"port 53"</span>    <span class="hljs-comment"># wireshark命令行版，捕获DNS查询</span>
</code></pre>
<p><strong>curl 和 wget（网络请求）</strong></p>
<pre><code class="hljs language-bash" lang="bash">curl -I http://example.com     <span class="hljs-comment"># 仅获取HTTP头</span>
curl -O http://example.com/file.zip  <span class="hljs-comment"># 下载文件</span>
wget -c http://example.com/largefile.iso  <span class="hljs-comment"># 断点续传</span>
wget -r -l1 http://example.com  <span class="hljs-comment"># 递归下载一级目录</span>
</code></pre>
<h2 data-id="heading-8">3 实用场景与技巧</h2>
<h3 data-id="heading-9">3.1 服务故障排查流程</h3>
<ol>
<li>
<p><strong>检查服务进程状态</strong></p>
<pre><code class="hljs language-perl" lang="perl">ps aux | <span class="hljs-keyword">grep</span> nginx         <span class="hljs-comment"># 查找nginx进程</span>
systemctl status nginx      <span class="hljs-comment"># 检查服务状态</span>
</code></pre>
</li>
<li>
<p><strong>验证端口监听</strong></p>
<pre><code class="hljs language-perl" lang="perl">ss -tuln | <span class="hljs-keyword">grep</span> :<span class="hljs-number">80</span>         <span class="hljs-comment"># 检查80端口监听</span>
netstat -anp | <span class="hljs-keyword">grep</span> :<span class="hljs-number">80</span>     <span class="hljs-comment"># 传统方式检查</span>
</code></pre>
</li>
<li>
<p><strong>测试网络连通性</strong></p>
<pre><code class="hljs language-r" lang="r">ping <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">3</span> target_server     <span class="hljs-comment"># 基础连通性</span>
traceroute target_server    <span class="hljs-comment"># 路径分析</span>
telnet target_server <span class="hljs-number">80</span>     <span class="hljs-comment"># 端口连通性</span>
</code></pre>
</li>
<li>
<p><strong>检查DNS解析</strong></p>
<pre><code class="hljs language-bash" lang="bash">nslookup example.com        <span class="hljs-comment"># DNS解析检查</span>
dig A example.com          <span class="hljs-comment"># 更详细的DNS信息</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-10">3.2 资源监控与优化</h3>
<p><strong>找出资源占用最高的进程</strong></p>
<pre><code class="hljs language-perl" lang="perl">top -o %CPU                    <span class="hljs-comment"># 按CPU使用率排序</span>
ps aux --<span class="hljs-keyword">sort</span>=-%mem | head -<span class="hljs-number">10</span> <span class="hljs-comment"># 内存使用前10的进程</span>
iotop                         <span class="hljs-comment"># 磁盘I/O监控（需安装）</span>
</code></pre>
<p><strong>自动化监控脚本</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 进程监控脚本</span>
PROCESS_NAME=<span class="hljs-string">"nginx"</span>
INTERVAL=60

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> ! pgrep -x <span class="hljs-string">"<span class="hljs-variable">$PROCESS_NAME</span>"</span> &gt; /dev/null; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: 进程 <span class="hljs-variable">$PROCESS_NAME</span> 已停止，尝试重启"</span>
        systemctl restart <span class="hljs-variable">$PROCESS_NAME</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$INTERVAL</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-11">3.3 安全最佳实践</h3>
<ol>
<li>
<p><strong>定期检查异常连接</strong></p>
<pre><code class="hljs language-perl" lang="perl">ss -tuln | <span class="hljs-keyword">grep</span> LISTEN      <span class="hljs-comment"># 检查监听端口</span>
lsof -i -P | <span class="hljs-keyword">grep</span> ESTABLISHED <span class="hljs-comment"># 查看所有活跃连接</span>
</code></pre>
</li>
<li>
<p><strong>监控系统负载</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uptime</span>                      <span class="hljs-comment"># 查看负载平均值</span>
<span class="hljs-built_in">cat</span> /proc/loadavg           <span class="hljs-comment"># 系统负载详情</span>
</code></pre>
</li>
<li>
<p><strong>限制进程资源</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ulimit</span> -a                   <span class="hljs-comment"># 显示当前限制</span>
<span class="hljs-built_in">ulimit</span> -n 2048             <span class="hljs-comment"># 设置最大文件描述符数</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-12">4 总结</h2>
<p>Linux 进程和网络管理命令是系统管理员和开发人员必须掌握的核心技能。本文介绍的命令覆盖了日常管理和故障排查的绝大多数场景。实际使用中，建议结合具体需求灵活组合这些命令，并养成查看手册（man command）的习惯以获得更深入的理解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[man command详解与应用实战]]></title>    <link>https://juejin.cn/post/7601000638344937487</link>    <guid>https://juejin.cn/post/7601000638344937487</guid>    <pubDate>2026-01-31T07:39:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601000638344937487" data-draft-id="7601000638344921103" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="man command详解与应用实战"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-31T07:39:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            man command详解与应用实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T07:39:41.000Z" title="Sat Jan 31 2026 07:39:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>man</code>命令是 Linux 系统中不可或缺的<strong>官方手册查看工具</strong>，它能提供关于命令、系统调用、库函数、配置文件等的详尽说明。下面这张表总结了其核心用法，方便你快速查阅。</p>
<h3 data-id="heading-0">🔍 核心语法与选项</h3>








































<table><thead><tr><th>用途</th><th>命令示例</th><th>说明</th></tr></thead><tbody><tr><td><strong>查看命令手册</strong></td><td><code>man ls</code></td><td>查看 <code>ls</code>命令的详细手册。</td></tr><tr><td><strong>指定章节</strong></td><td><code>man 2 open</code></td><td>查看第2章节（系统调用）关于 <code>open</code>的说明。</td></tr><tr><td><strong>关键字搜索</strong></td><td><code>man -k network</code></td><td>在所有手册页中搜索包含 "network" 的条目。</td></tr><tr><td><strong>显示简要描述</strong></td><td><code>man -f passwd</code></td><td>显示名为 <code>passwd</code>的所有手册条目的简短描述。</td></tr><tr><td><strong>显示所有匹配</strong></td><td><code>man -a passwd</code></td><td>依次显示所有章节中名为 <code>passwd</code>的手册页。</td></tr><tr><td><strong>显示手册路径</strong></td><td><code>man -w ls</code></td><td>显示 <code>ls</code>命令手册页的磁盘存储路径。</td></tr></tbody></table>
<h3 data-id="heading-1">📚 理解手册章节</h3>
<p>Linux 的手册页（man pages）按照主题分为多个章节，这是高效使用 <code>man</code>命令的关键。当你使用 <code>man passwd</code>时，默认会显示排在首位的章节（通常是第1章）的内容。但如果想查看 <code>/etc/passwd</code>文件格式的说明，就需要指定第5章节：<code>man 5 passwd</code>。</p>
<p>以下是常见的章节划分：</p>








































<table><thead><tr><th>章节编号</th><th>内容类型</th><th>示例</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>用户命令（普通用户可执行的命令）</td><td><code>ls</code>, <code>cp</code>, <code>mkdir</code></td></tr><tr><td><strong>2</strong></td><td>系统调用（由内核提供的函数）</td><td><code>open</code>, <code>fork</code>, <code>read</code></td></tr><tr><td><strong>3</strong></td><td>库函数（标准库中的函数）</td><td><code>printf</code>, <code>malloc</code>, <code>fopen</code></td></tr><tr><td><strong>4</strong></td><td>特殊文件（通常指 <code>/dev</code>下的设备文件）</td><td><code>null</code>, <code>zero</code>, <code>tty</code></td></tr><tr><td><strong>5</strong></td><td>文件格式和约定（配置文件格式）</td><td><code>passwd</code>, <code>fstab</code>, <code>hosts</code></td></tr><tr><td><strong>8</strong></td><td>系统管理命令（通常需要 root 权限）</td><td><code>systemctl</code>, <code>fdisk</code>, <code>iptables</code></td></tr></tbody></table>
<h3 data-id="heading-2">🔧 实用操作技巧</h3>
<p>进入手册页后，你可以使用以下快捷键进行导航和搜索，这能极大提升查阅效率：</p>













































<table><thead><tr><th>操作</th><th>快捷键</th><th>说明</th></tr></thead><tbody><tr><td><strong>向下翻页</strong></td><td><code>空格键</code>或 <code>Page Down</code></td><td>查看下一屏内容。</td></tr><tr><td><strong>向上翻页</strong></td><td><code>b</code>或 <code>Page Up</code></td><td>查看上一屏内容。</td></tr><tr><td><strong>退出</strong></td><td><code>q</code></td><td>退出手册页，回到命令行。</td></tr><tr><td><strong>向下搜索</strong></td><td><code>/关键词</code></td><td>从当前位置向下搜索特定关键词，如 <code>/option</code>。</td></tr><tr><td><strong>向上搜索</strong></td><td><code>?关键词</code></td><td>从当前位置向上搜索。</td></tr><tr><td><strong>下一个匹配</strong></td><td><code>n</code></td><td>跳转到下一个搜索结果。</td></tr><tr><td><strong>上一个匹配</strong></td><td><code>N</code></td><td>跳转到上一个搜索结果。</td></tr></tbody></table>
<h3 data-id="heading-3">🚀 高级应用与实战</h3>
<h4 data-id="heading-4">1. 获取中文手册</h4>
<p>如果你的系统环境是中文，或者希望阅读中文手册，可以安装中文手册包。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 在 Debian/Ubuntu 系统上安装中文手册页</span>
sudo apt-<span class="hljs-keyword">get</span> install manpages-zh
</code></pre>
<p>安装后，你可以通过设置语言环境来查看中文手册，例如 <code>LANG=zh_CN.UTF-8 man ls</code>。需要注意的是，中文翻译可能滞后于英文原版。</p>
<h4 data-id="heading-5">2. 更新手册数据库</h4>
<p>当系统安装新软件后，其手册页信息需要更新到 <code>man</code>的数据库中，<code>-k</code>和 <code>-f</code>选项才能正常识别。可以使用以下命令更新：</p>
<pre><code class="hljs">sudo mandb
</code></pre>
<h4 data-id="heading-6">3. 导出手册内容</h4>
<p>有时你可能希望将手册页的内容保存到文件中以便离线阅读或打印。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 将 ls 命令的手册页导出为纯文本文件</span>
man <span class="hljs-built_in">ls</span> &gt; ls_manual.txt

<span class="hljs-comment"># 如果需要格式更好的版本，可以先转换为 PostScript 再转为 PDF</span>
man -t <span class="hljs-built_in">ls</span> &gt; ls.ps
ps2pdf ls.ps ls.pdf
</code></pre>
<h3 data-id="heading-7">💡 实战场景举例</h3>
<ul>
<li>
<p><strong>场景1：快速了解未知命令</strong></p>
<p>当你第一次遇到 <code>chmod</code>命令时，直接输入 <code>man chmod</code>。重点阅读 <strong>SYNOPSIS</strong>（语法）和 <strong>DESCRIPTION</strong>（描述）部分，了解其基本用法和参数含义。</p>
</li>
<li>
<p><strong>场景2：查询函数用法</strong></p>
<p>在编写C程序时，需要了解 <code>printf</code>函数的详细用法和头文件，应使用 <code>man 3 printf</code>查看库函数章节的说明。</p>
</li>
<li>
<p><strong>场景3：排查网络问题</strong></p>
<p>如果想查看服务器上哪些端口正在监听，可以使用 <code>man netstat</code>查询 <code>-tuln</code>选项的具体含义，确保命令使用正确。</p>
</li>
<li>
<p><strong>场景4：理解配置文件</strong></p>
<p>当需要修改 <code>/etc/ssh/sshd_config</code>文件时，使用 <code>man 5 sshd_config</code>可以查看该配置文件中每个选项的详细解释。</p>
</li>
</ul>
<h3 data-id="heading-8">⚠️ 注意事项</h3>
<ul>
<li><strong>手册页可能缺失</strong>：某些精简版系统或第三方软件可能没有安装完整的手册页。如果 <code>man</code>命令提示找不到条目，可以尝试使用软件包管理器安装 <code>man-pages</code>或类似软件包。</li>
<li><strong>信息可能过时</strong>：手册页是随软件包一起发布的，有时可能无法完全跟上某个命令最新版本的所有变化。此时，结合命令的 <code>--help</code>选项或查阅官方在线文档是很好的补充。</li>
<li><strong>善用 SEE ALSO</strong>：手册页末尾的 <strong>SEE ALSO</strong>（参见）部分非常有用，它会指引你查看相关的命令或文件，帮助你构建更完整的知识网络。</li>
</ul>
<p><code>man</code>命令是探索和理解 Linux 世界的可靠地图。熟练掌握它，你将能更自信、独立地解决遇到的各种问题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据“显微镜”：蜂群图让每个数据点都发声]]></title>    <link>https://juejin.cn/post/7601018079620530191</link>    <guid>https://juejin.cn/post/7601018079620530191</guid>    <pubDate>2026-01-31T06:21:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601018079620530191" data-draft-id="7601049142865477632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据“显微镜”：蜂群图让每个数据点都发声"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-31T06:21:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据“显微镜”：蜂群图让每个数据点都发声
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T06:21:08.000Z" title="Sat Jan 31 2026 06:21:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下夏日的花丛中，成群的蜜蜂围绕着花朵忙碌地飞舞。每只蜜蜂都是一个独立的数据点，它们既保持群体聚集的形态，又不会完全重叠在一起。</p>
<p>这就是<strong>蜂群图</strong>（<code>Swarm Plot</code>）的<strong>核心理念</strong>——在有限的空间内展示所有数据点，让每个点都能被清晰看见。</p>
<p><strong>蜂群图</strong>是一种特殊的数据可视化图表，它将分类数据与数值数据结合起来，展示数据的分布情况。</p>
<p>与传统的条形图或箱线图不同，蜂群图不进行任何数据聚合，而是展示每一个原始数据点，避免了信息丢失。</p>
<h2 data-id="heading-0">1. 蜂群图核心特点</h2>
<p><strong>蜂群图</strong>最巧妙的地方在于它的布局算法。</p>
<p>当多个数据点具有相似数值时，它们不会简单地重叠在一起，而是像有“排斥力”一样，在垂直方向（或水平方向）上轻微偏移，形成一个类似蜂群的分布。</p>
<p>比如，下面是<strong>同一组数据</strong>在<strong>散点图</strong>和<strong>蜂群图</strong>中展示的效果。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4caf03d4b0d24f74842c22c27c2a702e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770445271&amp;x-signature=0MjPiDO20sLmLVRzrLMrrIF6Wwk%3D" alt="" loading="lazy"/></p>
<p>从中可以看出蜂群图的核心特点有：</p>
<ol>
<li><strong>绝不重叠</strong>： 它通过算法检测数据点的重叠情况，一旦发现两个点数值相近，就会自动把它们向水平方向推开。</li>
<li><strong>保留分布形态</strong>： 散开后的形状，天然形成了一种类似“小提琴”或“山峰”的轮廓，直观地展示了数据的密度。</li>
<li><strong>参数调整</strong>： 我们可以调整点的大小（marker size）和排列的紧密程度。点越大，视觉冲击力越强，但需要的水平空间也越多。</li>
</ol>
<h2 data-id="heading-1">2. 蜂群图 vs. 条形图：从摘要到细节</h2>
<p><strong>条形图</strong>就像是一份数据摘要报告，它告诉我们每个类别的平均值或总计值，但隐藏了数据内部的分布细节。</p>
<p>而<strong>蜂群图</strong>则像是一次数据点的全员大会，每个数据点都有发言的机会。</p>
<p>下面针对同一组数据，我们分别绘制了<strong>条形图</strong>、<strong>箱线图</strong>和<strong>蜂群图</strong>，一起来感受一下它们之间不同的展示效果。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 生成示例数据</span>
np.random.seed(<span class="hljs-number">123</span>)
categories = [<span class="hljs-string">"产品A"</span>, <span class="hljs-string">"产品B"</span>, <span class="hljs-string">"产品C"</span>, <span class="hljs-string">"产品D"</span>]
data_comparison = []
<span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:
    n_points = <span class="hljs-number">40</span>
    <span class="hljs-keyword">if</span> category == <span class="hljs-string">"产品A"</span>:
        values = np.random.normal(<span class="hljs-number">75</span>, <span class="hljs-number">8</span>, n_points)
    <span class="hljs-keyword">elif</span> category == <span class="hljs-string">"产品B"</span>:
        values = np.random.normal(<span class="hljs-number">82</span>, <span class="hljs-number">12</span>, n_points)
    <span class="hljs-keyword">elif</span> category == <span class="hljs-string">"产品C"</span>:
        values = np.random.normal(<span class="hljs-number">65</span>, <span class="hljs-number">5</span>, n_points)
    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 产品D</span>
        <span class="hljs-comment"># 创建一个双峰分布</span>
        values1 = np.random.normal(<span class="hljs-number">55</span>, <span class="hljs-number">6</span>, n_points // <span class="hljs-number">2</span>)
        values2 = np.random.normal(<span class="hljs-number">85</span>, <span class="hljs-number">7</span>, n_points // <span class="hljs-number">2</span>)
        values = np.concatenate([values1, values2])

    <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> values:
        data_comparison.append({<span class="hljs-string">"产品"</span>: category, <span class="hljs-string">"用户评分"</span>: value})

<span class="hljs-comment"># 1. 条形图（平均值）</span>
means = []
<span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:
    cat_data = [d[<span class="hljs-string">"用户评分"</span>] <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data_comparison <span class="hljs-keyword">if</span> d[<span class="hljs-string">"产品"</span>] == category]
    means.append(np.mean(cat_data))

bars = axes[<span class="hljs-number">0</span>].bar(
    categories, means, color=[<span class="hljs-string">"#1f77b4"</span>, <span class="hljs-string">"#ff7f0e"</span>, <span class="hljs-string">"#2ca02c"</span>, <span class="hljs-string">"#d62728"</span>]
)


<span class="hljs-comment"># 在条形上标注平均值</span>
<span class="hljs-comment"># 省略...</span>

<span class="hljs-comment"># 2. 箱线图</span>
box_data = []
<span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:
    cat_data = [d[<span class="hljs-string">"用户评分"</span>] <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data_comparison <span class="hljs-keyword">if</span> d[<span class="hljs-string">"产品"</span>] == category]
    box_data.append(cat_data)

boxplot = axes[<span class="hljs-number">1</span>].boxplot(
    box_data, tick_labels=categories, patch_artist=<span class="hljs-literal">True</span>, boxprops=<span class="hljs-built_in">dict</span>(facecolor=<span class="hljs-string">"lightblue"</span>)
)
<span class="hljs-comment"># 省略...</span>

<span class="hljs-comment"># 3. 蜂群图</span>
data_df = pd.DataFrame(data_comparison)
sns.swarmplot(
    x=<span class="hljs-string">"产品"</span>,
    y=<span class="hljs-string">"用户评分"</span>,
    hue=<span class="hljs-string">"产品"</span>,
    data=data_df,
    ax=axes[<span class="hljs-number">2</span>],
    size=<span class="hljs-number">5</span>,
    palette=<span class="hljs-string">"Set2"</span>,
    edgecolor=<span class="hljs-string">"black"</span>,
    linewidth=<span class="hljs-number">0.5</span>,
)
<span class="hljs-comment"># 省略...</span>

plt.tight_layout()
plt.show()

</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f95d09191b174b04afe13368017263c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770445271&amp;x-signature=SWcMKvD0V3DjIb2CgnNpxYsZJRc%3D" alt="" loading="lazy"/></p>
<p>绘制蜂群图可以用<code>seaborn</code>这个库中的<code>swarmplot</code>函数。</p>
<p>从上面的对比可以看出：</p>
<ul>
<li><strong>条形图</strong>告诉我们产品D的平均分约为70分</li>
<li><strong>箱线图</strong>提示产品D的数据分布范围很广</li>
<li>但只有<strong>蜂群图</strong>清晰地揭示了产品D实际上有两个明显的用户群体：一个低评分群体和一个高评分群体</li>
</ul>
<h2 data-id="heading-2">3. 蜂群图 vs. 散点图：从混乱到有序</h2>
<p>传统<strong>散点图</strong>在处理分类数据时，常常导致数据点大量重叠，形成"黑团"，我们无法看清数据点的真实分布。</p>
<p><strong>蜂群图</strong>通过智能布局算法解决了这个问题。</p>
<p>下面构造一个不同密度的数据，看看蜂群图和散点图的展示效果。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 比较散点图与蜂群图的视觉效果</span>
fig, axes = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 生成具有不同密度的数据</span>
np.random.seed(<span class="hljs-number">42</span>)
density_data = []
categories = [<span class="hljs-string">"低密度"</span>, <span class="hljs-string">"中等密度"</span>, <span class="hljs-string">"高密度"</span>]
<span class="hljs-keyword">for</span> i, category <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(categories):
    n_points = <span class="hljs-number">20</span> + i * <span class="hljs-number">30</span>  <span class="hljs-comment"># 不同密度</span>
    <span class="hljs-keyword">if</span> category == <span class="hljs-string">"低密度"</span>:
        values = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">15</span>, n_points)
    <span class="hljs-keyword">elif</span> category == <span class="hljs-string">"中等密度"</span>:
        values = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">8</span>, n_points)
    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 高密度</span>
        values = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">4</span>, n_points)

    <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> values:
        density_data.append({<span class="hljs-string">"类别"</span>: category, <span class="hljs-string">"数值"</span>: value})

<span class="hljs-comment"># 左侧：传统散点图</span>
<span class="hljs-keyword">for</span> i, category <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(categories):
    cat_data = [d[<span class="hljs-string">"数值"</span>] <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> density_data <span class="hljs-keyword">if</span> d[<span class="hljs-string">"类别"</span>] == category]
    x_positions = np.full(<span class="hljs-built_in">len</span>(cat_data), i)
    axes[<span class="hljs-number">0</span>].scatter(x_positions, cat_data, alpha=<span class="hljs-number">0.6</span>, s=<span class="hljs-number">60</span>, label=category)

<span class="hljs-comment">#省略...</span>

<span class="hljs-comment"># 右侧：蜂群图</span>
density_data_df = pd.DataFrame(density_data)
sns.swarmplot(
    x=<span class="hljs-string">"类别"</span>,
    y=<span class="hljs-string">"数值"</span>,
    hue=<span class="hljs-string">"类别"</span>,
    data=density_data_df,
    ax=axes[<span class="hljs-number">1</span>],
    size=<span class="hljs-number">6</span>,
    palette=<span class="hljs-string">"coolwarm"</span>,
    edgecolor=<span class="hljs-string">"black"</span>,
    linewidth=<span class="hljs-number">0.5</span>,
)
<span class="hljs-comment">#省略...</span>

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e57e532d22f4ad4a068c2c244080e88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770445271&amp;x-signature=5%2BeEHyWRB4VpR%2BOvr3UTi4Y%2BqGw%3D" alt="" loading="lazy"/></p>
<p><strong>蜂群图</strong>解决了 <strong>“重叠（Overplotting）”</strong> 的问题。在数据量适中（几百到几千个点）时，它是展示分布密度的最佳选择。</p>
<h2 data-id="heading-3">4. 蜂群图的适用场景</h2>
<p><strong>蜂群图</strong>并不是为了取代<strong>条形图</strong>或<strong>散点图</strong>，它有自己的适用场景和局限性。</p>
<p>适合使用<strong>蜂群图</strong>的场景：</p>
<ul>
<li>样本量适中（通常少于几百个点）时，展示完整数据分布</li>
<li>需要同时看到整体趋势和个体数据点</li>
<li>数据有多个分类变量，需要比较不同类别分布</li>
<li>希望发现异常值或特殊模式（如双峰分布）</li>
</ul>
<p/>
<p><strong>蜂群图</strong>的<strong>局限性</strong>主要有：</p>
<ol>
<li>大数据集可能导致图表过于拥挤</li>
<li>对于非常大规模数据，箱线图或小提琴图可能更合适</li>
<li>精确的数值比较不如条形图直观</li>
</ol>
<h2 data-id="heading-4">5. 总结</h2>
<p><strong>蜂群图</strong>就像数据可视化领域的"显微镜"，它让我们既能观察到数据的整体分布形态，又能看到每一个数据点的具体位置。</p>
<p>与只能显示摘要信息的<strong>条形图</strong>和容易产生重叠的<strong>散点图</strong>相比，<strong>蜂群图</strong>在显示中小型数据集的完整分布信息方面具有独特优势。</p>
<p>在数据可视化实践中，选择正确的图表类型就像选择正确的工具一样重要。</p>
<p>当下一次你需要展示分类数据的分布时，不妨尝试一下蜂群图，它可能会揭示出你从未注意到的数据秘密。</p>
<p>文中的完整代码共享在：<a href="https://link.juejin.cn?target=https%3A%2F%2Furl11.ctfile.com%2Ff%2F45455611-8639900394-9a109f%3Fp%3D6872" target="_blank" title="https://url11.ctfile.com/f/45455611-8639900394-9a109f?p=6872" ref="nofollow noopener noreferrer">蜂群图.ipynb</a> (访问密码: 6872)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[服务器系统安全配置指南(持续更新)]]></title>    <link>https://juejin.cn/post/7600982613654454322</link>    <guid>https://juejin.cn/post/7600982613654454322</guid>    <pubDate>2026-01-31T03:35:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613654454322" data-draft-id="7600953879501717555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="服务器系统安全配置指南(持续更新)"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2026-01-31T03:35:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="猿先生133"/> <meta itemprop="url" content="https://juejin.cn/user/3923509324823005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            服务器系统安全配置指南(持续更新)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3923509324823005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    猿先生133
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T03:35:03.000Z" title="Sat Jan 31 2026 03:35:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">系统安全配置指南</h2>
<h3 data-id="heading-1">1. 将普通用户添加到 sudo 组</h3>
<h4 data-id="heading-2">目标</h4>
<p>将普通用户（如 lingdong）添加到 sudo 组，使其能够执行管理员权限操作。</p>
<h4 data-id="heading-3">步骤</h4>
<p>1：创建新用户</p>
<p>执行以下命令来创建新用户并设置密码：</p>
<pre><code class="hljs language-bash" lang="bash">sudo adduser lingdong
</code></pre>
<p>这条命令将创建一个名为 <code>lingdong</code> 的新用户，并提示您设置密码和其他信息。请根据提示完成操作。</p>
<ol start="2">
<li>如果您有 <code>root</code> 用户的访问权限，请切换到 <code>root</code> 用户：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">su - root
</code></pre>
<ol start="3">
<li>将用户添加到 sudo 组：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">usermod -aG sudo lingdong
</code></pre>
<p>这条命令的作用：将用户 <code>lingdong</code> 添加到 <code>sudo</code> 组，使其获得管理员权限。</p>
<ol start="4">
<li>重新登录系统以使组权限生效。
在重新登录后，请尝试运行以下命令以验证 <code>lingdong</code> 用户是否能够正常使用 <code>sudo</code>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">whoami</span>
</code></pre>
<p>如果输出为 <code>root</code>，则表示配置成功。</p>
<h3 data-id="heading-4">2. 禁用 root 用户的直接登录</h3>
<h4 data-id="heading-5">目标</h4>
<p>通过修改 SSH 配置文件禁用 root 用户的直接登录，提高系统安全性。</p>
<h4 data-id="heading-6">步骤</h4>
<ol>
<li>备份并编辑 SSH 配置文件：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> /etc/ssh/sshd_config /etc/ssh/sshd_config.bak &amp;&amp; sed -i <span class="hljs-string">'s/^#*PermitRootLogin.*/PermitRootLogin no/'</span> /etc/ssh/sshd_config
</code></pre>
<ol start="2">
<li>重启 SSH 服务以应用更改：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">systemctl restart ssh
</code></pre>
<h3 data-id="heading-7">3. 下一步建议</h3>
<ul>
<li>配置 SSH 密钥认证以进一步提高安全性。</li>
<li>禁用密码登录（可选）。</li>
</ul>
<h3 data-id="heading-8">4. Docker管理</h3>
<h4 data-id="heading-9">步骤 2：将用户添加到 <code>docker</code> 组</h4>
<p>为了让 <code>lingdong</code> 用户无需使用 <code>sudo</code> 即可管理 Docker，我们需要将其添加到 <code>docker</code> 组中。</p>
<p>执行以下命令将 <code>lingdong</code> 添加到 <code>docker</code> 组：</p>
<pre><code class="hljs language-bash" lang="bash">sudo usermod -aG docker lingdong
</code></pre>
<p>这条命令会将用户 <code>lingdong</code> 添加到 <code>docker</code> 组。完成后，您需要重新登录或重启系统以使更改生效。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring与MyBatis整合原理及事务管理]]></title>    <link>https://juejin.cn/post/7601020578490499081</link>    <guid>https://juejin.cn/post/7601020578490499081</guid>    <pubDate>2026-01-31T06:12:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578490499081" data-draft-id="7600982613654683698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring与MyBatis整合原理及事务管理"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-31T06:12:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring与MyBatis整合原理及事务管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T06:12:08.000Z" title="Sat Jan 31 2026 06:12:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 整合的三种方式：你用的是哪一种？</h3>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.1 传统XML配置：最经典也最复杂</h4>
<p>先看看最传统的整合方式，现在还有很多老项目在用：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- applicationContext.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span>
       <span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">"http://www.springframework.org/schema/tx"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 1. 数据源 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.url}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.username}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.password}"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 2. SqlSessionFactory --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sqlSessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mapperLocations"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:mapper/*.xml"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"configLocation"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:mybatis-config.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 3. 事务管理器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"transactionManager"</span> 
          <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 4. 开启注解事务 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">"transactionManager"</span>/&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 5. Mapper扫描 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basePackage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"com.example.mapper"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sqlSessionFactoryBeanName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"sqlSessionFactory"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
AI写代码XML
</code></pre>
<p><em>代码清单1：传统Spring+MyBatis XML配置</em></p>
<p><strong>问题</strong>：配置繁琐，容易出错，依赖顺序很重要。</p>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2 注解配置：Spring JavaConfig</h4>
<p>Spring 3.0之后，推荐用JavaConfig：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Configuration</span>
<span class="hljs-variable">@ComponentScan</span>(<span class="hljs-string">"com.example"</span>)
<span class="hljs-variable">@EnableTransactionManagement</span>
<span class="hljs-variable">@MapperScan</span>(<span class="hljs-string">"com.example.mapper"</span>)
public class AppConfig {
    
    <span class="hljs-variable">@Bean</span>
    public DataSource <span class="hljs-built_in">dataSource</span>() {
        <span class="hljs-selector-tag">DruidDataSource</span> <span class="hljs-selector-tag">ds</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DruidDataSource</span>();
        <span class="hljs-selector-tag">ds</span><span class="hljs-selector-class">.setUrl</span>(env.<span class="hljs-built_in">getProperty</span>(<span class="hljs-string">"jdbc.url"</span>));
        <span class="hljs-selector-tag">ds</span><span class="hljs-selector-class">.setUsername</span>(env.<span class="hljs-built_in">getProperty</span>(<span class="hljs-string">"jdbc.username"</span>));
        <span class="hljs-selector-tag">ds</span><span class="hljs-selector-class">.setPassword</span>(env.<span class="hljs-built_in">getProperty</span>(<span class="hljs-string">"jdbc.password"</span>));
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ds</span>;
    }
    
    @<span class="hljs-selector-tag">Bean</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">SqlSessionFactory</span> <span class="hljs-selector-tag">sqlSessionFactory</span>(DataSource dataSource) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Exception</span> {
        <span class="hljs-selector-tag">SqlSessionFactoryBean</span> <span class="hljs-selector-tag">factoryBean</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SqlSessionFactoryBean</span>();
        <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.setDataSource</span>(dataSource);
        <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.setMapperLocations</span>(
            new <span class="hljs-built_in">PathMatchingResourcePatternResolver</span>()
                .<span class="hljs-built_in">getResources</span>(<span class="hljs-string">"classpath:mapper/*.xml"</span>)
        );
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.getObject</span>();
    }
    
    @<span class="hljs-selector-tag">Bean</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">PlatformTransactionManager</span> <span class="hljs-selector-tag">transactionManager</span>(DataSource dataSource) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DataSourceTransactionManager</span>(dataSource);
    }
}
<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
</code></pre>
<p><em>代码清单2：JavaConfig配置方式</em></p>
<p><strong>优点</strong>：类型安全，IDE友好，不容易配置错。</p>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.3 Spring Boot自动配置：最简单</h4>
<p>现在最流行的方式：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/test</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">20</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">5</span>
 
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.model</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
<span class="hljs-string">AI写代码</span>
</code></pre>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@SpringBootApplication</span>
<span class="hljs-variable">@MapperScan</span>(<span class="hljs-string">"com.example.mapper"</span>)
public class Application {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application.class, args);
    }
}
<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
</code></pre>
<p><em>代码清单3：Spring Boot自动配置</em></p>
<p><strong>但问题来了</strong>：这么简单的配置背后，Spring Boot到底干了什么？</p>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 整合的核心：SqlSession管理</h3>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.1 为什么需要SqlSessionTemplate？</h4>
<p>在纯MyBatis中，我们这样用：</p>
<pre><code class="hljs language-ini" lang="ini">// 传统MyBatis用法
try (SqlSession <span class="hljs-attr">session</span> = sqlSessionFactory.openSession()) {
    UserMapper <span class="hljs-attr">mapper</span> = session.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
    User <span class="hljs-attr">user</span> = mapper.findById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
    session.commit()<span class="hljs-comment">;</span>
}
AI写代码java
运行
</code></pre>
<p><strong>问题</strong>：</p>
<ol>
<li>需要手动管理SqlSession生命周期</li>
<li>事务管理复杂</li>
<li>线程不安全</li>
</ol>
<p>Spring的解决方案：<strong>SqlSessionTemplate</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoImpl</span> <span class="hljs-title">implements</span> <span class="hljs-title">UserDao</span> {
    
    <span class="hljs-comment">// 直接注入SqlSessionTemplate</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SqlSessionTemplate sqlSessionTemplate;
    
    <span class="hljs-keyword">public</span> User findById(<span class="hljs-built_in">Long</span> id) {
        <span class="hljs-comment">// 不用关心SqlSession的创建和关闭</span>
        <span class="hljs-keyword">return</span> sqlSessionTemplate.selectOne(
            <span class="hljs-string">"com.example.mapper.UserMapper.findById"</span>, id);
    }
}
AI写代码java
运行
</code></pre>
<p><em>代码清单4：使用SqlSessionTemplate</em></p>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2 SqlSessionTemplate的线程安全设计</h4>
<p>这是Spring整合MyBatis最精妙的设计。看源码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionTemplate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SqlSession</span>, DisposableBean {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlSessionFactory sqlSessionFactory;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ExecutorType executorType;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlSession sqlSessionProxy;  <span class="hljs-comment">// 关键：动态代理</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqlSessionTemplate</span><span class="hljs-params">(SqlSessionFactory sqlSessionFactory)</span> {
        <span class="hljs-built_in">this</span>(sqlSessionFactory, sqlSessionFactory.getConfiguration()
            .getDefaultExecutorType());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqlSessionTemplate</span><span class="hljs-params">(SqlSessionFactory sqlSessionFactory, ExecutorType executorType)</span> {
        <span class="hljs-built_in">this</span>.sqlSessionFactory = sqlSessionFactory;
        <span class="hljs-built_in">this</span>.executorType = executorType;
        
        <span class="hljs-comment">// 创建动态代理</span>
        <span class="hljs-built_in">this</span>.sqlSessionProxy = (SqlSession) Proxy.newProxyInstance(
            SqlSessionFactory.class.getClassLoader(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] { SqlSession.class },
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionInterceptor</span>()  <span class="hljs-comment">// 关键：拦截器</span>
        );
    }
    
    <span class="hljs-comment">// 所有SqlSession方法都委托给代理</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">selectOne</span><span class="hljs-params">(String statement)</span> {
        <span class="hljs-keyword">return</span> sqlSessionProxy.selectOne(statement);
    }
    
    <span class="hljs-comment">// 内部拦截器类</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlSessionInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
            <span class="hljs-comment">// 关键：每次调用都获取新的SqlSession</span>
            <span class="hljs-type">SqlSession</span> <span class="hljs-variable">sqlSession</span> <span class="hljs-operator">=</span> getSqlSession(
                sqlSessionFactory, executorType, EXCEPTION);
            
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(sqlSession, args);
                <span class="hljs-comment">// 不提交事务！由Spring事务管理器控制</span>
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">catch</span> (Throwable t) {
                <span class="hljs-comment">// 异常处理...</span>
                <span class="hljs-keyword">throw</span> ExceptionUtil.unwrapThrowable(t);
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-comment">// 关闭SqlSession</span>
                closeSqlSession(sqlSession, sqlSessionFactory);
            }
        }
    }
    
    <span class="hljs-comment">// 获取SqlSession：与当前事务关联</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSqlSession</span><span class="hljs-params">(SqlSessionFactory sessionFactory, 
                                          ExecutorType executorType, 
                                          PersistenceExceptionTranslator exceptionTranslator)</span> {
        
        <span class="hljs-comment">// 关键：检查当前线程是否已有SqlSession</span>
        <span class="hljs-type">SqlSessionHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> (SqlSessionHolder) TransactionSynchronizationManager
            .getResource(sessionFactory);
        
        <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span> &amp;&amp; holder.isSynchronizedWithTransaction()) {
            <span class="hljs-keyword">if</span> (holder.getExecutorType() != executorType) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransientDataAccessResourceException</span>(
                    <span class="hljs-string">"Cannot change ExecutorType when there is an existing transaction"</span>);
            }
            
            <span class="hljs-comment">// 增加引用计数</span>
            holder.requested();
            <span class="hljs-keyword">return</span> holder.getSqlSession();
        }
        
        <span class="hljs-comment">// 没有事务，创建新的SqlSession</span>
        <span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession(executorType);
        
        <span class="hljs-comment">// 注册到事务同步管理器</span>
        registerSessionHolder(sessionFactory, executorType, exceptionTranslator, session);
        
        <span class="hljs-keyword">return</span> session;
    }
}
AI写代码java
运行
</code></pre>
<p><em>代码清单5：SqlSessionTemplate核心源码</em></p>
<p>用图来表示更清楚：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/201c9b495ece4ad3a591188b70a10283~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770444728&amp;x-signature=WzlgGv5D7quzycxeTmsiYX7UVVo%3D" alt="" loading="lazy"/></p>
<p><em>图1：SqlSessionTemplate执行流程</em></p>
<p><strong>关键点</strong>：</p>
<ol>
<li>用动态代理拦截所有方法调用</li>
<li>每次方法调用都可能创建新SqlSession</li>
<li>事务期间复用同一个SqlSession</li>
<li>事务结束后自动关闭SqlSession</li>
</ol>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.3 性能影响测试</h4>
<p>这么复杂的机制，性能影响大吗？我做了测试：</p>
<p><strong>测试场景</strong>：单线程执行1000次查询</p>





























<table><thead><tr><th>使用方式</th><th>总耗时(ms)</th><th>平均耗时(ms)</th><th>SqlSession创建次数</th></tr></thead><tbody><tr><td>原生MyBatis</td><td>1250</td><td>1.25</td><td>1</td></tr><tr><td>SqlSessionTemplate(无事务)</td><td>1450</td><td>1.45</td><td>1000</td></tr><tr><td>SqlSessionTemplate(有事务)</td><td>1320</td><td>1.32</td><td>1</td></tr></tbody></table>
<p><strong>结论</strong>：</p>
<ol>
<li>无事务时，每次调用都创建SqlSession，性能损失约16%</li>
<li>有事务时，复用SqlSession，性能接近原生</li>
<li>生产环境大部分操作在事务中，性能影响可接受</li>
</ol>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. Mapper接口的自动注册</h3>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.1 @MapperScan是怎么工作的？</h4>
<p>很多人用<code>@MapperScan</code>，但不知道它干了什么。看源码：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Target</span>(ElementType.TYPE)
<span class="hljs-variable">@Import</span>(MapperScannerRegistrar.class)  <span class="hljs-comment">// 关键：导入配置类</span>
<span class="hljs-variable">@Repeatable</span>(MapperScans.class)
public <span class="hljs-variable">@interface</span> MapperScan {
    <span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">value</span>() <span class="hljs-selector-tag">default</span> {};
    <span class="hljs-selector-tag">String</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">basePackages</span>() <span class="hljs-selector-tag">default</span> {};
    <span class="hljs-selector-tag">Class</span>&lt;?&gt;<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">basePackageClasses</span>() <span class="hljs-selector-tag">default</span> {};
    <span class="hljs-comment">// ...</span>
}
 
<span class="hljs-comment">// 配置类</span>
<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MapperScannerRegistrar</span> <span class="hljs-selector-tag">implements</span> <span class="hljs-selector-tag">ImportBeanDefinitionRegistrar</span> {
    
    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">registerBeanDefinitions</span>(AnnotationMetadata importingClassMetadata, 
                                      BeanDefinitionRegistry registry) {
        
        <span class="hljs-comment">// 解析@MapperScan注解</span>
        <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">annotationAttributes</span> = <span class="hljs-selector-tag">importingClassMetadata</span>
            <span class="hljs-selector-class">.getAnnotationAttributes</span>(MapperScan.class.<span class="hljs-built_in">getName</span>());
        
        <span class="hljs-comment">// 创建扫描器配置</span>
        <span class="hljs-selector-tag">BeanDefinitionBuilder</span> <span class="hljs-selector-tag">builder</span> = <span class="hljs-selector-tag">BeanDefinitionBuilder</span>
            <span class="hljs-selector-class">.genericBeanDefinition</span>(MapperScannerConfigurer.class);
        
        <span class="hljs-comment">// 设置扫描包</span>
        <span class="hljs-selector-tag">builder</span><span class="hljs-selector-class">.addPropertyValue</span>(<span class="hljs-string">"basePackage"</span>, 
            StringUtils.<span class="hljs-built_in">arrayToCommaDelimitedString</span>((String[]) 
                annotationAttributes.<span class="hljs-built_in">get</span>(<span class="hljs-string">"basePackages"</span>)));
        
        <span class="hljs-comment">// 注册Bean</span>
        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.registerBeanDefinition</span>(
            MapperScannerConfigurer.class.<span class="hljs-built_in">getName</span>(), 
            builder.<span class="hljs-built_in">getBeanDefinition</span>());
    }
}
<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
</code></pre>
<p><em>代码清单6：@MapperScan工作原理</em></p>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2 MapperScannerConfigurer：扫描器的核心</h4>
<p>真正干活的是<code>MapperScannerConfigurer</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperScannerConfigurer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span>, <span class="hljs-title class_">InitializingBean</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> basePackage;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">SqlSessionFactory</span> sqlSessionFactory;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">SqlSessionTemplate</span> sqlSessionTemplate;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span>(<span class="hljs-params">BeanDefinitionRegistry registry</span>) {
        <span class="hljs-comment">// 创建ClassPath扫描器</span>
        <span class="hljs-title class_">ClassPathMapperScanner</span> scanner = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathMapperScanner</span>(registry);
        
        <span class="hljs-comment">// 设置过滤条件：只扫描接口</span>
        scanner.<span class="hljs-title function_">setAnnotationClass</span>(<span class="hljs-title class_">Mapper</span>.<span class="hljs-property">class</span>);
        scanner.<span class="hljs-title function_">registerFilters</span>();
        
        <span class="hljs-comment">// 设置SqlSessionFactory</span>
        <span class="hljs-keyword">if</span> (sqlSessionFactory != <span class="hljs-literal">null</span>) {
            scanner.<span class="hljs-title function_">setSqlSessionFactory</span>(sqlSessionFactory);
        }
        <span class="hljs-keyword">if</span> (sqlSessionTemplate != <span class="hljs-literal">null</span>) {
            scanner.<span class="hljs-title function_">setSqlSessionTemplate</span>(sqlSessionTemplate);
        }
        
        <span class="hljs-comment">// 扫描并注册</span>
        scanner.<span class="hljs-title function_">scan</span>(<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">tokenizeToStringArray</span>(
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">basePackage</span>, <span class="hljs-title class_">ConfigurableApplicationContext</span>.<span class="hljs-property">CONFIG_LOCATION_DELIMITERS</span>));
    }
}
 
<span class="hljs-comment">// 自定义扫描器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassPathMapperScanner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ClassPathBeanDefinitionScanner</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">BeanDefinitionHolder</span>&gt; <span class="hljs-title function_">doScan</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>... basePackages</span>) {
        <span class="hljs-comment">// 1. 扫描包，获取Bean定义</span>
        <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">BeanDefinitionHolder</span>&gt; beanDefinitions = <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">doScan</span>(basePackages);
        
        <span class="hljs-keyword">if</span> (beanDefinitions.<span class="hljs-title function_">isEmpty</span>()) {
            logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"No MyBatis mapper was found..."</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 2. 处理每个Bean定义</span>
            <span class="hljs-title function_">processBeanDefinitions</span>(beanDefinitions);
        }
        
        <span class="hljs-keyword">return</span> beanDefinitions;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processBeanDefinitions</span>(<span class="hljs-params"><span class="hljs-built_in">Set</span>&lt;BeanDefinitionHolder&gt; beanDefinitions</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">BeanDefinitionHolder</span> holder : beanDefinitions) {
            <span class="hljs-title class_">GenericBeanDefinition</span> definition = (<span class="hljs-title class_">GenericBeanDefinition</span>) holder.<span class="hljs-title function_">getBeanDefinition</span>();
            
            <span class="hljs-comment">// 3. 设置Bean类为MapperFactoryBean</span>
            definition.<span class="hljs-title function_">setBeanClass</span>(<span class="hljs-title class_">MapperFactoryBean</span>.<span class="hljs-property">class</span>);
            
            <span class="hljs-comment">// 4. 设置构造函数参数：Mapper接口</span>
            definition.<span class="hljs-title function_">getConstructorArgumentValues</span>()
                .<span class="hljs-title function_">addGenericArgumentValue</span>(definition.<span class="hljs-title function_">getBeanClassName</span>());
            
            <span class="hljs-comment">// 5. 设置属性：SqlSessionFactory/SqlSessionTemplate</span>
            <span class="hljs-keyword">if</span> (sqlSessionFactory != <span class="hljs-literal">null</span>) {
                definition.<span class="hljs-title function_">getPropertyValues</span>()
                    .<span class="hljs-title function_">add</span>(<span class="hljs-string">"sqlSessionFactory"</span>, sqlSessionFactory);
            }
            <span class="hljs-keyword">if</span> (sqlSessionTemplate != <span class="hljs-literal">null</span>) {
                definition.<span class="hljs-title function_">getPropertyValues</span>()
                    .<span class="hljs-title function_">add</span>(<span class="hljs-string">"sqlSessionTemplate"</span>, sqlSessionTemplate);
            }
        }
    }
}
<span class="hljs-variable constant_">AI</span>写代码java
运行
</code></pre>
<p><em>代码清单7：MapperScannerConfigurer核心逻辑</em></p>
<p>用图表示扫描过程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/711ca95fd53a4055afaa3a85653070d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770444728&amp;x-signature=iuCbRfpNxDFsMzZOHKdKiu9TsDM%3D" alt="" loading="lazy"/></p>
<p><em>图2：Mapper接口扫描注册流程</em></p>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3 MapperFactoryBean：Mapper的工厂</h4>
<p>这是Spring创建Mapper代理的关键：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperFactoryBean</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SqlSessionDaoSupport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;T&gt; {
    
    <span class="hljs-keyword">private</span> Class&lt;T&gt; mapperInterface;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">addToConfig</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MapperFactoryBean</span><span class="hljs-params">(Class&lt;T&gt; mapperInterface)</span> {
        <span class="hljs-built_in">this</span>.mapperInterface = mapperInterface;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 从SqlSessionTemplate获取Mapper</span>
        <span class="hljs-keyword">return</span> getSqlSession().getMapper(<span class="hljs-built_in">this</span>.mapperInterface);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Class&lt;T&gt; <span class="hljs-title function_">getObjectType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mapperInterface;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkDaoConfig</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.checkDaoConfig();
        
        <span class="hljs-comment">// 验证配置</span>
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> getSqlSession().getConfiguration();
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.addToConfig &amp;&amp; !configuration.hasMapper(<span class="hljs-built_in">this</span>.mapperInterface)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 将Mapper添加到MyBatis配置</span>
                configuration.addMapper(<span class="hljs-built_in">this</span>.mapperInterface);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                logger.error(<span class="hljs-string">"Error while adding the mapper..."</span>, e);
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(e);
            }
        }
    }
}
AI写代码java
运行
</code></pre>
<p><em>代码清单8：MapperFactoryBean核心代码</em></p>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. Spring事务管理在MyBatis中的实现</h3>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 事务管理器配置</h4>
<p>这是整合中最容易出错的部分：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Configuration</span>
<span class="hljs-variable">@EnableTransactionManagement</span>
public class TransactionConfig {
    
    <span class="hljs-variable">@Bean</span>
    public PlatformTransactionManager <span class="hljs-built_in">transactionManager</span>(DataSource dataSource) {
        <span class="hljs-comment">// 关键：必须用DataSourceTransactionManager</span>
        <span class="hljs-selector-tag">DataSourceTransactionManager</span> <span class="hljs-selector-tag">tm</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DataSourceTransactionManager</span>();
        <span class="hljs-selector-tag">tm</span><span class="hljs-selector-class">.setDataSource</span>(dataSource);
        
        <span class="hljs-comment">// 可选配置</span>
        <span class="hljs-selector-tag">tm</span><span class="hljs-selector-class">.setDefaultTimeout</span>(<span class="hljs-number">30</span>);  <span class="hljs-comment">// 默认30秒超时</span>
        <span class="hljs-selector-tag">tm</span><span class="hljs-selector-class">.setNestedTransactionAllowed</span>(true);  <span class="hljs-comment">// 允许嵌套事务</span>
        <span class="hljs-selector-tag">tm</span><span class="hljs-selector-class">.setRollbackOnCommitFailure</span>(true);  <span class="hljs-comment">// 提交失败时回滚</span>
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">tm</span>;
    }
}
<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
</code></pre>
<p><strong>为什么必须是DataSourceTransactionManager？</strong></p>
<p>因为MyBatis底层用的是JDBC，而<code>DataSourceTransactionManager</code>是Spring为JDBC事务提供的实现。</p>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 事务的传播行为测试</h4>
<p>Spring的7种传播行为在MyBatis中表现如何？我做了测试：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMapper userMapper;
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
        userMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"user1"</span>));
        
        <span class="hljs-keyword">try</span> {
            innerMethod();  <span class="hljs-comment">// 调用内部方法</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 处理异常</span>
        }
    }
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        userMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"user2"</span>));
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"测试异常"</span>);
    }
}
AI写代码java
运行
</code></pre>
<p><em>代码清单9：事务传播行为测试</em></p>
<p><strong>测试结果</strong>：</p>













































<table><thead><tr><th>传播行为</th><th>结果</th><th>说明</th></tr></thead><tbody><tr><td>REQUIRED</td><td>user1插入成功，user2回滚</td><td>同一个事务，一起回滚</td></tr><tr><td>REQUIRES_NEW</td><td>user1插入成功，user2回滚</td><td>新事务，独立回滚</td></tr><tr><td>NESTED</td><td>user1插入成功，user2回滚</td><td>嵌套事务，可部分回滚</td></tr><tr><td>SUPPORTS</td><td>无事务运行</td><td>沿用当前事务状态</td></tr><tr><td>NOT_SUPPORTED</td><td>挂起当前事务</td><td>无事务运行</td></tr><tr><td>NEVER</td><td>抛出异常</td><td>不能在事务中运行</td></tr><tr><td>MANDATORY</td><td>必须在事务中</td><td>否则抛异常</td></tr></tbody></table>
<p><strong>注意</strong>：MySQL的InnoDB不支持真正的嵌套事务，<code>NESTED</code>会被降级为<code>REQUIRED</code>。</p>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.3 事务与SqlSession的绑定</h4>
<p>这是理解事务整合的关键。看源码：</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceTransactionManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractPlatformTransactionManager</span> </span>{
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">Object</span> doGetTransaction() {
        <span class="hljs-type">DataSourceTransactionObject</span> txObject = <span class="hljs-keyword">new</span> <span class="hljs-type">DataSourceTransactionObject</span>();
        
        <span class="hljs-comment">// 获取当前连接</span>
        <span class="hljs-type">ConnectionHolder</span> conHolder = (<span class="hljs-type">ConnectionHolder</span>) 
            <span class="hljs-type">TransactionSynchronizationManager</span>.getResource(<span class="hljs-keyword">this</span>.dataSource);
        
        txObject.setConnectionHolder(conHolder, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> txObject;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void doBegin(<span class="hljs-type">Object</span> transaction, <span class="hljs-type">TransactionDefinition</span> definition) {
        <span class="hljs-type">DataSourceTransactionObject</span> txObject = (<span class="hljs-type">DataSourceTransactionObject</span>) transaction;
        
        <span class="hljs-type">Connection</span> con = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取数据库连接</span>
            con = <span class="hljs-keyword">this</span>.dataSource.getConnection();
            
            <span class="hljs-comment">// 设置事务属性</span>
            con.setAutoCommit(<span class="hljs-literal">false</span>);
            con.setTransactionIsolation(definition.getIsolationLevel());
            
            <span class="hljs-comment">// 绑定到当前线程</span>
            <span class="hljs-type">ConnectionHolder</span> holder = <span class="hljs-keyword">new</span> <span class="hljs-type">ConnectionHolder</span>(con);
            holder.setSynchronizedWithTransaction(<span class="hljs-literal">true</span>);
            
            <span class="hljs-type">TransactionSynchronizationManager</span>.bindResource(
                <span class="hljs-keyword">this</span>.dataSource, holder);
            
            txObject.setConnectionHolder(holder);
            
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">Throwable</span> ex) {
            <span class="hljs-comment">// 清理资源</span>
            <span class="hljs-type">DataSourceUtils</span>.releaseConnection(con, <span class="hljs-keyword">this</span>.dataSource);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">CannotCreateTransactionException</span>(<span class="hljs-string">"Could not open JDBC Connection"</span>, ex);
        }
    }
}
<span class="hljs-type">AI</span>写代码java
运行
</code></pre>
<p><em>代码清单10：DataSourceTransactionManager事务绑定</em></p>
<p>在MyBatis中，SqlSession会使用这个绑定的连接：</p>
<pre><code class="hljs language-ini" lang="ini">public static SqlSession getSqlSession(SqlSessionFactory sessionFactory, 
                                      ExecutorType executorType, 
                                      PersistenceExceptionTranslator exceptionTranslator) {
    
    // 检查当前线程是否已绑定连接
    ConnectionHolder <span class="hljs-attr">holder</span> = (ConnectionHolder) 
        TransactionSynchronizationManager.getResource(sessionFactory)<span class="hljs-comment">;</span>
    
    if (holder != null) {
        // 有事务，使用事务中的连接创建SqlSession
        SqlSession <span class="hljs-attr">session</span> = holder.getSqlSession()<span class="hljs-comment">;</span>
        if (<span class="hljs-attr">session</span> == null) {
            <span class="hljs-attr">session</span> = sessionFactory.openSession(executorType)<span class="hljs-comment">;</span>
            holder.setSqlSession(session)<span class="hljs-comment">;</span>
        }
        return session<span class="hljs-comment">;</span>
    }
    
    // 无事务，创建新的SqlSession
    return sessionFactory.openSession(executorType)<span class="hljs-comment">;</span>
}
AI写代码java
运行
</code></pre>
<p>用图表示事务、连接、SqlSession的关系：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21bd4821ca0949eb858aae087a89685c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770444728&amp;x-signature=nM7YPnt78d3pAFgL4Iy7NtZ%2BAQU%3D" alt="" loading="lazy"/></p>
<p><em>图3：事务与连接绑定关系</em></p>
<h3 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5. 整合中的性能陷阱与优化</h3>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 连接池配置不当</h4>
<p>我见过最多的性能问题就是连接池配置不对：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 错误配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">100</span>  <span class="hljs-comment"># 太大，浪费资源</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">50</span>        <span class="hljs-comment"># 太大，启动慢</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>  <span class="hljs-comment"># 太长</span>
 
<span class="hljs-comment"># 正确配置（根据实际负载调整）</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">20</span>   <span class="hljs-comment"># 根据CPU核心数*2-4</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">5</span>         <span class="hljs-comment"># 小一点，按需创建</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">5000</span>  <span class="hljs-comment"># 5秒超时</span>
      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">600000</span>    <span class="hljs-comment"># 10分钟空闲超时</span>
      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span>   <span class="hljs-comment"># 30分钟最大生命周期</span>
      <span class="hljs-attr">leak-detection-threshold:</span> <span class="hljs-number">30000</span>  <span class="hljs-comment"># 30秒泄露检测</span>
<span class="hljs-string">AI写代码</span>
</code></pre>
<p><strong>性能测试数据</strong>（100并发查询）：</p>



































<table><thead><tr><th>连接池大小</th><th>QPS</th><th>平均响应时间(ms)</th><th>连接使用率</th></tr></thead><tbody><tr><td>10</td><td>850</td><td>45</td><td>100%</td></tr><tr><td>20</td><td>1550</td><td>32</td><td>75%</td></tr><tr><td>50</td><td>1600</td><td>31</td><td>40%</td></tr><tr><td>100</td><td>1620</td><td>30</td><td>20%</td></tr></tbody></table>
<p><strong>结论</strong>：连接池不是越大越好，20-50是比较合理的范围。</p>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2 一级缓存失效问题</h4>
<p>在Spring整合MyBatis中，一级缓存很容易失效：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 第一次查询</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> userMapper.findById(id);  <span class="hljs-comment">// 查数据库</span>
        
        <span class="hljs-comment">// 中间有其他操作</span>
        doSomething();
        
        <span class="hljs-comment">// 第二次查询</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> userMapper.findById(id);  <span class="hljs-comment">// 期望从缓存获取</span>
        
        <span class="hljs-keyword">return</span> user2;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 如果这里执行了insert/update/delete</span>
        userMapper.updateSomething();  <span class="hljs-comment">// 会导致一级缓存清空！</span>
    }
}
AI写代码java
运行
</code></pre>
<p><strong>解决方案</strong>：</p>
<ol>
<li>合理安排方法顺序</li>
<li>使用二级缓存</li>
<li>在Service层做缓存</li>
</ol>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.3 批量操作性能优化</h4>
<p>批量操作是性能优化的重点：</p>
<pre><code class="hljs language-csharp" lang="csharp">@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BatchService</span> {
    
    <span class="hljs-comment">// 错误：每次insert都提交</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">batchInsertWrong</span>(<span class="hljs-params">List&lt;User&gt; users</span>)</span> {
        <span class="hljs-keyword">for</span> (User user : users) {
            userMapper.insert(user);  <span class="hljs-comment">// 每次都有事务开销</span>
        }
    }
    
    <span class="hljs-comment">// 正确：使用批量模式</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">batchInsertRight</span>(<span class="hljs-params">List&lt;User&gt; users</span>)</span> {
        <span class="hljs-comment">// 使用Batch执行器</span>
        SqlSessionTemplate template = <span class="hljs-keyword">new</span> SqlSessionTemplate(
            sqlSessionFactory, ExecutorType.BATCH);
        
        UserMapper mapper = template.getMapper(UserMapper.<span class="hljs-keyword">class</span>);
        
        <span class="hljs-keyword">for</span> (User user : users) {
            mapper.insert(user);
        }
        
        <span class="hljs-comment">// 手动提交</span>
        template.commit();
    }
    
    <span class="hljs-comment">// 更优：使用MyBatis的foreach</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">batchInsertBest</span>(<span class="hljs-params">List&lt;User&gt; users</span>)</span> {
        userMapper.batchInsert(users);  <span class="hljs-comment">// 一次插入多条</span>
    }
}
 
<span class="hljs-comment">// Mapper中的批量插入</span>
&lt;insert id=<span class="hljs-string">"batchInsert"</span> parameterType=<span class="hljs-string">"list"</span>&gt;
    <span class="hljs-function">INSERT INTO <span class="hljs-title">users</span> (<span class="hljs-params">name, email</span>) VALUES
    &lt;<span class="hljs-keyword">foreach</span> collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"user"</span> separator=<span class="hljs-string">","</span>&gt;
        (<span class="hljs-meta">#{user.name}, #{user.email})</span>
    &lt;/<span class="hljs-keyword">foreach</span>&gt;
&lt;/insert&gt;
AI写代码java
运行
</code></pre>
<p><em>代码清单11：批量操作优化</em></p>
<p><strong>性能对比</strong>（插入1000条记录）：</p>





























<table><thead><tr><th>方式</th><th>耗时(ms)</th><th>内存占用</th><th>推荐指数</th></tr></thead><tbody><tr><td>循环单条插入</td><td>1250</td><td>低</td><td>⭐</td></tr><tr><td>Batch执行器</td><td>350</td><td>中</td><td>⭐⭐⭐</td></tr><tr><td>foreach批量插入</td><td>120</td><td>高</td><td>⭐⭐⭐⭐⭐</td></tr></tbody></table>
<h3 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6. 多数据源整合</h3>
<h4 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.1 多数据源配置</h4>
<p>企业级应用经常需要多数据源：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Configuration</span>
public class DataSourceConfig {
    
    <span class="hljs-variable">@Bean</span>(name = <span class="hljs-string">"primaryDataSource"</span>)
    <span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource.primary"</span>)
    public DataSource <span class="hljs-built_in">primaryDataSource</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">DataSourceBuilder</span><span class="hljs-selector-class">.create</span>()<span class="hljs-selector-class">.build</span>();
    }
    
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"secondaryDataSource"</span>)
    @<span class="hljs-selector-tag">ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource.secondary"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">DataSource</span> <span class="hljs-selector-tag">secondaryDataSource</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">DataSourceBuilder</span><span class="hljs-selector-class">.create</span>()<span class="hljs-selector-class">.build</span>();
    }
    
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"primarySqlSessionFactory"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">SqlSessionFactory</span> <span class="hljs-selector-tag">primarySqlSessionFactory</span>(
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"primaryDataSource"</span>) DataSource dataSource) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Exception</span> {
        <span class="hljs-selector-tag">SqlSessionFactoryBean</span> <span class="hljs-selector-tag">factoryBean</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SqlSessionFactoryBean</span>();
        <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.setDataSource</span>(dataSource);
        <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.setMapperLocations</span>(
            new <span class="hljs-built_in">PathMatchingResourcePatternResolver</span>()
                .<span class="hljs-built_in">getResources</span>(<span class="hljs-string">"classpath:mapper/primary/*.xml"</span>));
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.getObject</span>();
    }
    
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"secondarySqlSessionFactory"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">SqlSessionFactory</span> <span class="hljs-selector-tag">secondarySqlSessionFactory</span>(
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"secondaryDataSource"</span>) DataSource dataSource) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Exception</span> {
        <span class="hljs-selector-tag">SqlSessionFactoryBean</span> <span class="hljs-selector-tag">factoryBean</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SqlSessionFactoryBean</span>();
        <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.setDataSource</span>(dataSource);
        <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.setMapperLocations</span>(
            new <span class="hljs-built_in">PathMatchingResourcePatternResolver</span>()
                .<span class="hljs-built_in">getResources</span>(<span class="hljs-string">"classpath:mapper/secondary/*.xml"</span>));
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">factoryBean</span><span class="hljs-selector-class">.getObject</span>();
    }
    
    <span class="hljs-comment">// 事务管理器也要配多个</span>
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"primaryTransactionManager"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">PlatformTransactionManager</span> <span class="hljs-selector-tag">primaryTransactionManager</span>(
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"primaryDataSource"</span>) DataSource dataSource) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DataSourceTransactionManager</span>(dataSource);
    }
    
    @<span class="hljs-selector-tag">Bean</span>(name = <span class="hljs-string">"secondaryTransactionManager"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">PlatformTransactionManager</span> <span class="hljs-selector-tag">secondaryTransactionManager</span>(
            <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">"secondaryDataSource"</span>) DataSource dataSource) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">DataSourceTransactionManager</span>(dataSource);
    }
}
<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
</code></pre>
<p><em>代码清单12：多数据源配置</em></p>
<h4 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.2 动态数据源切换</h4>
<p>更复杂的场景需要动态切换数据源：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 定义动态数据源</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbstractRoutingDataSource</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">determineCurrentLookupKey</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">getDataSource</span>();
    }
}
 
<span class="hljs-comment">// 2. 数据源上下文</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceContextHolder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">ThreadLocal</span>&lt;<span class="hljs-title class_">String</span>&gt; contextHolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setDataSource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> dataSource</span>) {
        contextHolder.<span class="hljs-title function_">set</span>(dataSource);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDataSource</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> contextHolder.<span class="hljs-title function_">get</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">clearDataSource</span>(<span class="hljs-params"/>) {
        contextHolder.<span class="hljs-title function_">remove</span>();
    }
}
 
<span class="hljs-comment">// 3. 自定义注解</span>
<span class="hljs-meta">@Target</span>({<span class="hljs-title class_">ElementType</span>.<span class="hljs-property">METHOD</span>, <span class="hljs-title class_">ElementType</span>.<span class="hljs-property">TYPE</span>})
<span class="hljs-meta">@Retention</span>(<span class="hljs-title class_">RetentionPolicy</span>.<span class="hljs-property">RUNTIME</span>)
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> <span class="hljs-title class_">DataSource</span> {
    <span class="hljs-title class_">String</span> <span class="hljs-title function_">value</span>() <span class="hljs-keyword">default</span> <span class="hljs-string">"primary"</span>;
}
 
<span class="hljs-comment">// 4. 切面实现切换</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceAspect</span> {
    
    <span class="hljs-meta">@Around</span>(<span class="hljs-string">"@annotation(dataSource)"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">around</span>(<span class="hljs-title class_">ProceedingJoinPoint</span> joinPoint, <span class="hljs-title class_">DataSource</span> dataSource) throws <span class="hljs-title class_">Throwable</span> {
        <span class="hljs-title class_">String</span> oldDataSource = <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">getDataSource</span>();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">setDataSource</span>(dataSource.<span class="hljs-title function_">value</span>());
            <span class="hljs-keyword">return</span> joinPoint.<span class="hljs-title function_">proceed</span>();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (oldDataSource != <span class="hljs-literal">null</span>) {
                <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">setDataSource</span>(oldDataSource);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title class_">DataSourceContextHolder</span>.<span class="hljs-title function_">clearDataSource</span>();
            }
        }
    }
}
<span class="hljs-variable constant_">AI</span>写代码java
运行
</code></pre>
<p><em>代码清单13：动态数据源切换</em></p>
<h3 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7. 事务失效的常见场景</h3>
<h4 data-id="heading-24"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7.1 自调用问题</h4>
<p>这是最常见的问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// 自调用，事务失效！</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateAndSave</span>(user);
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateAndSave</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// 事务不会生效</span>
        validator.<span class="hljs-title function_">validate</span>(user);
        userMapper.<span class="hljs-title function_">insert</span>(user);
    }
}
<span class="hljs-variable constant_">AI</span>写代码java
运行
</code></pre>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 方案1：注入自己</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserService</span> self;  <span class="hljs-comment">// 注入代理对象</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        self.<span class="hljs-title function_">validateAndSave</span>(user);  <span class="hljs-comment">// 通过代理调用</span>
    }
}
 
<span class="hljs-comment">// 方案2：拆分Service</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserTransactionService</span> transactionService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        transactionService.<span class="hljs-title function_">validateAndSave</span>(user);
    }
}
 
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTransactionService</span> {
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateAndSave</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// 事务生效</span>
    }
}
<span class="hljs-variable constant_">AI</span>写代码java
运行
</code></pre>
<h4 data-id="heading-25"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7.2 异常类型不匹配</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">// 默认只回滚RuntimeException</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"业务异常"</span>);  <span class="hljs-comment">// 不会回滚！</span>
    }
}
AI写代码java
运行
</code></pre>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 现在任何异常都会回滚</span>
}
AI写代码java
运行
</code></pre>
<h4 data-id="heading-26"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7.3 方法修饰符问题</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">internalSave</span>(<span class="hljs-params">User user</span>) {  <span class="hljs-comment">// 私有方法，事务失效！</span>
        userMapper.<span class="hljs-title function_">insert</span>(user);
    }
}
<span class="hljs-variable constant_">AI</span>写代码java
运行
</code></pre>
<p><strong>原因</strong>：Spring AOP基于代理，只能代理public方法。</p>
<h3 data-id="heading-27"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8. 性能监控与调优</h3>
<h4 data-id="heading-28"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8.1 监控指标配置</h4>
<p>生产环境必须监控：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,metrics,prometheus</span>
  <span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">export:</span>
      <span class="hljs-attr">prometheus:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-attr">application:</span> <span class="hljs-string">${spring.application.name}</span>
      
<span class="hljs-comment"># 自定义监控</span>
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">log-slow-sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">slow-sql-threshold:</span> <span class="hljs-number">1000</span>
<span class="hljs-string">AI写代码</span>
</code></pre>
<h4 data-id="heading-29"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8.2 关键监控指标</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisMetrics</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MeterRegistry meterRegistry;
    
    <span class="hljs-comment">// SQL执行统计</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Timer sqlTimer;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Counter sqlErrorCounter;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyBatisMetrics</span><span class="hljs-params">(MeterRegistry meterRegistry)</span> {
        <span class="hljs-built_in">this</span>.meterRegistry = meterRegistry;
        
        sqlTimer = Timer.builder(<span class="hljs-string">"mybatis.sql.duration"</span>)
            .description(<span class="hljs-string">"SQL执行耗时"</span>)
            .publishPercentiles(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">0.99</span>)  <span class="hljs-comment">// 50%, 95%, 99%分位</span>
            .register(meterRegistry);
        
        sqlErrorCounter = Counter.builder(<span class="hljs-string">"mybatis.sql.errors"</span>)
            .description(<span class="hljs-string">"SQL执行错误次数"</span>)
            .register(meterRegistry);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordSqlExecution</span><span class="hljs-params">(<span class="hljs-type">long</span> duration, <span class="hljs-type">boolean</span> success)</span> {
        sqlTimer.record(duration, TimeUnit.MILLISECONDS);
        
        <span class="hljs-keyword">if</span> (!success) {
            sqlErrorCounter.increment();
        }
    }
}
AI写代码java
运行
</code></pre>
<h4 data-id="heading-30"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8.3 <a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%25E6%2585%25A2SQL%26spm%3D1001.2101.3001.7020" target="_blank" title="https://so.csdn.net/so/search?q=%E6%85%A2SQL&amp;spm=1001.2101.3001.7020" ref="nofollow noopener noreferrer">慢SQL</a>监控</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Intercepts</span>({
    <span class="hljs-variable">@Signature</span>(type = StatementHandler.class, 
               method = <span class="hljs-string">"query"</span>, 
               args = {Statement.class, ResultHandler.class})
})
<span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Slf4j</span>
public class SlowSqlInterceptor implements Interceptor {
    
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">SLOW_SQL_THRESHOLD</span> = <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 1秒</span>
    
    @<span class="hljs-selector-tag">Override</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">intercept</span>(Invocation invocation) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Throwable</span> {
        <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">startTime</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>();
        
        <span class="hljs-selector-tag">try</span> {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">invocation</span><span class="hljs-selector-class">.proceed</span>();
        } <span class="hljs-selector-tag">finally</span> {
            <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">costTime</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>() <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">startTime</span>;
            
            <span class="hljs-selector-tag">if</span> (costTime &gt; SLOW_SQL_THRESHOLD) {
                <span class="hljs-selector-tag">StatementHandler</span> <span class="hljs-selector-tag">handler</span> = (StatementHandler) <span class="hljs-selector-tag">invocation</span><span class="hljs-selector-class">.getTarget</span>();
                <span class="hljs-selector-tag">BoundSql</span> <span class="hljs-selector-tag">boundSql</span> = <span class="hljs-selector-tag">handler</span><span class="hljs-selector-class">.getBoundSql</span>();
                
                <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.warn</span>(<span class="hljs-string">"慢SQL检测 - 耗时: {}ms, SQL: {}, 参数: {}"</span>, 
                    costTime, boundSql.<span class="hljs-built_in">getSql</span>(), boundSql.<span class="hljs-built_in">getParameterObject</span>());
                
                <span class="hljs-comment">// 发送告警</span>
                <span class="hljs-selector-tag">alertSlowSql</span>(boundSql.<span class="hljs-built_in">getSql</span>(), costTime);
            }
        }
    }
}
<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
</code></pre>
<h3 data-id="heading-31"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9. 企业级最佳实践</h3>
<h4 data-id="heading-32"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9.1 我的"整合配置军规"</h4>
<p>经过多年实践，我总结了一套最佳实践：</p>
<h5 data-id="heading-33">📜 第一条：明确数据源配置</h5>
<ul>
<li>生产环境必须用连接池（HikariCP）</li>
<li>根据实际负载调整连接数</li>
<li>开启监控和泄露检测</li>
</ul>
<h5 data-id="heading-34">📜 第二条：合理使用事务</h5>
<ul>
<li>事务要短小，不要在事务中做RPC调用</li>
<li>明确指定回滚异常类型</li>
<li>合理设置事务超时时间</li>
</ul>
<h5 data-id="heading-35">📜 第三条：监控到位</h5>
<ul>
<li>监控SQL执行时间</li>
<li>监控连接池使用情况</li>
<li>设置慢SQL告警</li>
</ul>
<h5 data-id="heading-36">📜 第四条：代码规范</h5>
<ul>
<li>Mapper接口要有@Repository或@Mapper注解</li>
<li>SQL写在XML中，复杂的用动态SQL</li>
<li>使用resultMap明确映射关系</li>
</ul>
<h5 data-id="heading-37">📜 第五条：测试充分</h5>
<ul>
<li>单元测试要覆盖事务场景</li>
<li>集成测试要验证多数据源</li>
<li>性能测试要模拟生产负载</li>
</ul>
<h4 data-id="heading-38"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9.2 生产环境配置模板</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application-prod.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://${DB_HOST:localhost}:3306/${DB_NAME}?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">${DB_USER}</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">${DB_PASSWORD}</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">HikariPool</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">20</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">5000</span>
      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">600000</span>
      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span>
      <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">leak-detection-threshold:</span> <span class="hljs-number">30000</span>
      
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/**/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.model</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">cache-enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">lazy-loading-enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">aggressive-lazy-loading:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">default-statement-timeout:</span> <span class="hljs-number">30</span>
    
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,metrics,prometheus</span>
  <span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">export:</span>
      <span class="hljs-attr">prometheus:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-string">AI写代码</span>
</code></pre>
<h3 data-id="heading-39"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>10. 故障排查指南</h3>
<h4 data-id="heading-40"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>10.1 常见问题排查清单</h4>
<h5 data-id="heading-41">问题1：事务不生效</h5>
<ol>
<li>检查是否配置了<code>@EnableTransactionManagement</code></li>
<li>检查方法是否是public</li>
<li>检查是否自调用</li>
<li>检查异常类型是否匹配</li>
</ol>
<h5 data-id="heading-42">问题2：连接泄露</h5>
<ol>
<li>检查是否在事务外使用了SqlSession</li>
<li>检查连接池配置</li>
<li>使用Druid的监控界面查看</li>
<li>检查是否有未关闭的ResultSet/Statement</li>
</ol>
<h5 data-id="heading-43">问题3：性能下降</h5>
<ol>
<li>检查SQL是否有全表扫描</li>
<li>检查是否缺少索引</li>
<li>检查连接池是否过小</li>
<li>检查是否有N+1查询问题</li>
</ol>
<h4 data-id="heading-44"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>10.2 调试技巧</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 开启MyBatis日志</span>
logging:
  level:
    com.example.mapper: DEBUG
    org.mybatis: DEBUG
    org.springframework.jdbc: DEBUG
 
<span class="hljs-comment">// 查看事务状态</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TransactionDebug</span> {
    
    @Autowired
    <span class="hljs-keyword">private</span> PlatformTransactionManager transactionManager;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">debugTransaction</span>()</span> {
        TransactionStatus status = transactionManager.getTransaction(
            <span class="hljs-keyword">new</span> DefaultTransactionDefinition());
        
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"是否新事务: "</span> + status.isNewTransaction());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"是否有保存点: "</span> + status.hasSavepoint());
        
        transactionManager.commit(status);
    }
}
AI写代码
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 vite-plugin-vue-devtools 实现 IDE 一键打开选中组件]]></title>    <link>https://juejin.cn/post/7600982613654028338</link>    <guid>https://juejin.cn/post/7600982613654028338</guid>    <pubDate>2026-01-30T16:33:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613654028338" data-draft-id="7600955777316339750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 vite-plugin-vue-devtools 实现 IDE 一键打开选中组件"/> <meta itemprop="keywords" content="前端,Vite"/> <meta itemprop="datePublished" content="2026-01-30T16:33:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LaLu"/> <meta itemprop="url" content="https://juejin.cn/user/739350236891191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 vite-plugin-vue-devtools 实现 IDE 一键打开选中组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/739350236891191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LaLu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T16:33:32.000Z" title="Fri Jan 30 2026 16:33:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用 vite-plugin-vue-devtools 实现 IDE 一键打开选中组件</h2>
<blockquote>
<p>在 Vue 项目开发中，快速定位组件源码是提升开发效率的关键。本文将介绍如何使用 <code>vite-plugin-vue-devtools</code> 插件，实现在浏览器中选中组件后一键在 IDE 中打开对应源码文件。</p>
</blockquote>
<h3 data-id="heading-1">一、背景与痛点</h3>
<p>大型 Vue 项目，我们经常会遇到以下场景：</p>
<ul>
<li>页面上有一个组件需要修改，但不知道它对应的源文件在哪里</li>
<li>项目组件层级很深，手动查找费时费力</li>
<li>新接手项目，对代码结构不熟悉</li>
</ul>
<p><strong>vite-plugin-vue-devtools</strong> 正是解决这个问题的利器。</p>
<h3 data-id="heading-2">二、vite-plugin-vue-devtools作用</h3>
<p><code>vite-plugin-vue-devtools</code> 是一个为 Vue 3 + Vite 项目设计的开发工具插件，它提供了：</p>
<ul>
<li>📍 <strong>组件检查器</strong>：在页面上悬停/点击组件，查看组件信息</li>
<li>🔗 <strong>一键跳转</strong>：点击组件直接在 IDE 中打开源码文件</li>
<li>📊 <strong>组件树可视化</strong>：查看组件的层级关系</li>
<li>🔧 <strong>状态调试</strong>：实时查看和修改组件状态</li>
<li>⚡ <strong>性能分析</strong>：分析组件渲染性能</li>
</ul>
<p>这里只做IDE跳转文件的分享</p>
<h3 data-id="heading-3">三、安装和配置</h3>
<h4 data-id="heading-4">3.1 安装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># npm</span>
npm install vite-plugin-vue-devtools -D

<span class="hljs-comment"># yarn</span>
yarn add vite-plugin-vue-devtools -D

<span class="hljs-comment"># pnpm</span>
pnpm add vite-plugin-vue-devtools -D
</code></pre>
<h4 data-id="heading-5">3.2 配置 vite.config.js</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>

<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueDevTools</span>  <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-vue-devtools'</span>

<span class="hljs-comment">// https://vite.dev/config/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title class_">VueDevTools</span> ({
      <span class="hljs-attr">launchEditor</span>: <span class="hljs-string">'webstorm64'</span>, <span class="hljs-comment">//这里很关键，windows下看IDE安装目录的exe文件名</span>
    }),
  ],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./src'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))
    },
  },
})
</code></pre>
<h4 data-id="heading-6">3.3 launchEditor 支持的编辑器</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyyx990803%2Flaunch-editor%3Ftab%3Dreadme-ov-file%23supported-editors" target="_blank" title="https://github.com/yyx990803/launch-editor?tab=readme-ov-file#supported-editors" ref="nofollow noopener noreferrer">github.com/yyx990803/l…</a></p>
<h3 data-id="heading-7">四、使用方法</h3>
<h4 data-id="heading-8">4.1 启动开发服务器</h4>
<pre><code class="hljs language-bash" lang="bash">npm run dev
</code></pre>
<p>启动后，你会在页面底部看到一个 Vue DevTools 的悬浮按钮，点击定位图标，就可以直接选中页面上的元素跳转IDE对应的文件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7d3d1ae094a4893b4dddb8683b77751~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFMdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770395612&amp;x-signature=vq451iBiFliRHaJXFmTodrXKsOo%3D" alt="PixPin_2026-01-31_00-24-38.gif" loading="lazy"/></p>
<h3 data-id="heading-9">五、常见问题与解决方案</h3>
<h4 data-id="heading-10">5.1 点击组件后 IDE 没有反应</h4>
<p><strong>可能原因</strong>：</p>
<ol>
<li><code>launchEditor</code> 配置的编辑器名称不正确</li>
<li>编辑器没有加入系统环境变量</li>
</ol>
<p><strong>解决方案</strong>：</p>
<p>方案一：使用完整路径</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">VueDevTools</span>({
  <span class="hljs-attr">launchEditor</span>: <span class="hljs-string">'C:\\Program Files\\JetBrains\\WebStorm\\bin\\webstorm64.exe'</span>,
})
</code></pre>
<p>方案二：检查环境变量
确保在命令行中可以直接运行 webstorm64 或 code 命令，这个主要看IDE在bin目录下exe对应的文件名叫什么，例如我的文件名是webstorm64，配置里面就写的就是launchEditor: 'webstorm64'</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1252d6bd4454cf6a16fd656d8df711c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFMdQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770395612&amp;x-signature=s8FK%2FQ1NuAtl4%2B65soc3B2FJ0Do%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-11">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fdevtools-next" target="_blank" title="https://github.com/vuejs/devtools-next" ref="nofollow noopener noreferrer">vite-plugin-vue-devtools GitHub</a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浏览器缓存：从底层原理到最佳实践]]></title>    <link>https://juejin.cn/post/7601028900886265902</link>    <guid>https://juejin.cn/post/7601028900886265902</guid>    <pubDate>2026-01-30T23:29:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900886265902" data-draft-id="7601169987395321907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浏览器缓存：从底层原理到最佳实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T23:29:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浏览器缓存：从底层原理到最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T23:29:46.000Z" title="Fri Jan 30 2026 23:29:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>缓存是前端性能优化的核心，但我们真的理解各种缓存之间的关系吗？本篇文章将彻底解析浏览器缓存机制，帮我们建立完整的知识体系。</p>
</blockquote>
<h2 data-id="heading-0">缓存全景图：一张图看懂所有缓存关系</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/945540c1c7194db1ae267ecc305c764c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3VoZW5fbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770420589&amp;x-signature=aY%2Bq3L4eLvFbDdyiDHGySAUDNHQ%3D" alt="缓存全景图" loading="lazy"/></p>
<h2 data-id="heading-1">HTTP缓存：强缓存 vs 协商缓存</h2>
<p>HTTP缓存是浏览器缓存体系的核心，分为两大策略：<strong>强缓存</strong> 和 <strong>协商缓存</strong>。</p>
<h3 data-id="heading-2">强缓存：浏览器自主决策</h3>
<p>浏览器检查本地缓存是否在有效期内，若有效则直接使用，不发送任何网络请求。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 第一次请求：服务器设置缓存策略</span>
GET /static/logo.png
HTTP/1.1 200 OK
Cache-Control: max-age=31536000, public
Expires: Mon, 01 Jan 2024 00:00:00 GMT

<span class="hljs-comment"># 后续请求：浏览器自主决策（在有效期内）</span>
GET /static/logo.png
<span class="hljs-comment"># 浏览器检查：max-age=31536000 → 还有效！</span>
<span class="hljs-comment"># 直接从缓存返回，不发送网络请求</span>
</code></pre>
<h3 data-id="heading-3">协商缓存：服务端验证</h3>
<p>当请求资源时，浏览器携带缓存标识询问服务器资源是否变更，若没有变更，直接从缓存中读取资源。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 第一次请求：服务器返回资源标识</span>
GET /api/user/profile
HTTP/1.1 200 OK
ETag: <span class="hljs-string">"abc123xyz"</span>
Last-Modified: Wed, 21 Oct 2022 07:28:00 GMT
Cache-Control: no-cache

<span class="hljs-comment"># 第二次请求：带上标识询问服务器</span>
GET /api/user/profile
If-None-Match: <span class="hljs-string">"abc123xyz"</span>
If-Modified-Since: Wed, 21 Oct 2022 07:28:00 GMT

<span class="hljs-comment"># 服务器响应</span>
HTTP/1.1 304 Not Modified
<span class="hljs-comment"># 资源未变，使用本地缓存</span>
</code></pre>
<h3 data-id="heading-4">强缓存 vs 协商缓存对比：</h3>













































<table><thead><tr><th>特性</th><th>强缓存</th><th>协商缓存</th></tr></thead><tbody><tr><td>决策机制</td><td>浏览器自己决定</td><td>浏览器和服务器协商</td></tr><tr><td>检查时机</td><td>优先检查</td><td>强缓存失效后检查</td></tr><tr><td>网络请求</td><td>可能完全不发请求</td><td>一定发送请求（验证）</td></tr><tr><td>典型状态码</td><td>200 (from cache)</td><td>304 (Not Modified)</td></tr><tr><td>响应速度</td><td>极快（直接本地读取）</td><td>较慢（需要网络往返）</td></tr><tr><td>适用场景</td><td>版本固定的静态资源</td><td>频繁更新的动态资源</td></tr><tr><td>更新时机</td><td>缓存过期时更新</td><td>每次请求都验证</td></tr></tbody></table>
<h2 data-id="heading-5">浏览器缓存：Memory Cache vs Disk Cache</h2>
<h3 data-id="heading-6">Memory Cache：高速内存缓存</h3>
<ul>
<li>位置：浏览器进程内存空间</li>
<li>容量：有限，依赖设备内存</li>
<li>生命周期：会话级别，标签页关闭则释放</li>
<li>特点：读取速度极快（纳秒级）</li>
</ul>
<h4 data-id="heading-7">适用场景</h4>
<ul>
<li>当前页面已加载的资源</li>
<li>预加载的脚本和样式</li>
<li>小体积的Base64图片</li>
</ul>
<h3 data-id="heading-8">Disk Cache：持久化磁盘缓存</h3>
<ul>
<li>位置：用户磁盘的缓存目录</li>
<li>容量：较大（通常数百MB到数GB）</li>
<li>生命周期：长期持久化</li>
<li>特点：读取速度较慢（毫秒级），但容量大</li>
</ul>
<h4 data-id="heading-9">适用场景</h4>
<ul>
<li>大体积静态资源（图片、字体、视频）</li>
<li>跨会话共享的资源</li>
<li>低频访问但需要持久化的内容</li>
</ul>
<h2 data-id="heading-10">Service Worker：应用层缓存控制</h2>
<p><code>Service Worker</code> 运行在浏览器后台，作为<strong>代理服务器</strong>，赋予开发者完全控制缓存的能力。</p>
<h3 data-id="heading-11">Service Worker 缓存特点</h3>
<ol>
<li>独立线程运行，不阻塞主线程</li>
<li>完全控制网络请求，可自定义缓存策略</li>
<li>支持离线体验，是PWA的核心技术</li>
<li>生命周期独立，可长期缓存资源</li>
</ol>
<h3 data-id="heading-12">Service Worker 缓存策略</h3>
<p>Service Worker 使用的是典型的缓存优先策略：</p>
<pre><code class="hljs language-javascript" lang="javascript">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">cachedResponse</span> =&gt;</span> {
        <span class="hljs-comment">// 1. 缓存优先</span>
        <span class="hljs-keyword">if</span> (cachedResponse) {
          <span class="hljs-comment">// 后台更新缓存</span>
          event.<span class="hljs-title function_">waitUntil</span>(
            <span class="hljs-title function_">updateCache</span>(event.<span class="hljs-property">request</span>)
          );
          <span class="hljs-keyword">return</span> cachedResponse;
        }
        
        <span class="hljs-comment">// 2. 网络回退</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>)
          .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">networkResponse</span> =&gt;</span> {
            <span class="hljs-comment">// 缓存新资源</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">cacheResponse</span>(event.<span class="hljs-property">request</span>, networkResponse);
          })
          .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// 3. 回退到离线页面</span>
            <span class="hljs-keyword">return</span> caches.<span class="hljs-title function_">match</span>(<span class="hljs-string">'/offline.html'</span>);
          });
      })
  );
});
</code></pre>
<h3 data-id="heading-13">Service Worker 使用场景</h3>






























<table><thead><tr><th>场景</th><th>策略</th><th>优势</th></tr></thead><tbody><tr><td>离线应用</td><td>Cache-First + Network-Fallback</td><td>提供完整的离线体验</td></tr><tr><td>性能优化</td><td>Stale-While-Revalidate</td><td>快速响应+后台更新</td></tr><tr><td>资源预加载</td><td>Precache + Runtime Caching</td><td>减少关键资源加载时间</td></tr><tr><td>不可靠网络</td><td>Network-First + Cache-Fallback</td><td>提升弱网环境体验</td></tr></tbody></table>
<h2 data-id="heading-14">缓存查找顺序</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchWithCache</span>(<span class="hljs-params">request</span>) {
  <span class="hljs-comment">// 1. Service Worker 拦截（最高优先级）</span>
  <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">serviceWorker</span>?.<span class="hljs-property">controller</span>) {
    <span class="hljs-keyword">const</span> swResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkServiceWorkerCache</span>(request);
    <span class="hljs-keyword">if</span> (swResponse) <span class="hljs-keyword">return</span> swResponse;
  }
  
  <span class="hljs-comment">// 2. Memory Cache 检查（最快路径）</span>
  <span class="hljs-keyword">const</span> memoryCached = memoryCache.<span class="hljs-title function_">get</span>(request.<span class="hljs-property">url</span>);
  <span class="hljs-keyword">if</span> (memoryCached &amp;&amp; !<span class="hljs-title function_">isExpired</span>(memoryCached)) {
    <span class="hljs-title function_">reportCacheHit</span>(<span class="hljs-string">'memory'</span>);
    <span class="hljs-keyword">return</span> memoryCached;
  }
  
  <span class="hljs-comment">// 3. Disk Cache 检查（强缓存验证）</span>
  <span class="hljs-keyword">const</span> diskCached = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkDiskCache</span>(request);
  <span class="hljs-keyword">if</span> (diskCached) {
    <span class="hljs-keyword">if</span> (diskCached.<span class="hljs-property">cacheControl</span> === <span class="hljs-string">'immutable'</span> || 
        !<span class="hljs-title function_">isExpired</span>(diskCached)) {
      <span class="hljs-comment">// 更新 Memory Cache 提升后续访问速度</span>
      memoryCache.<span class="hljs-title function_">set</span>(request.<span class="hljs-property">url</span>, diskCached);
      <span class="hljs-title function_">reportCacheHit</span>(<span class="hljs-string">'disk'</span>);
      <span class="hljs-keyword">return</span> diskCached;
    }
  }
  
  <span class="hljs-comment">// 4. 准备网络请求（设置协商缓存头）</span>
  <span class="hljs-keyword">const</span> init = <span class="hljs-title function_">prepareRequest</span>(request);
  
  <span class="hljs-comment">// 5. 发起网络请求</span>
  <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(request, init);
  
  <span class="hljs-comment">// 6. 处理响应，决定是否缓存</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">shouldCache</span>(response)) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">cacheInLayers</span>(request, response.<span class="hljs-title function_">clone</span>());
  }
  
  <span class="hljs-keyword">return</span> response;
}

</code></pre>
<blockquote>
<ul>
<li>强缓存资源：可以同时存在于Memory和Disk Cache，浏览器根据大小和类型智能分配</li>
<li>协商缓存资源：主要在Disk Cache，Memory Cache可能不存储或短期存储</li>
<li>开发者控制策略：通过HTTP头控制缓存策略，浏览器自动选择存储位置</li>
<li>性能考量：小文件强缓存 → Memory Cache极速；大文件强缓存 → Disk Cache持久</li>
</ul>
</blockquote>
<h2 data-id="heading-15">本地存储体系</h2>















































<table><thead><tr><th>存储类型</th><th>容量</th><th>生命周期</th><th>同步性</th><th>使用场景</th></tr></thead><tbody><tr><td>Cookie</td><td>4KB</td><td>可设置过期时间</td><td>每次请求自动携带</td><td>用户认证、服务端状态</td></tr><tr><td>LocalStorage</td><td>5-10MB</td><td>永久（除非手动清除）</td><td>同步阻塞</td><td>用户偏好、应用配置</td></tr><tr><td>SessionStorage</td><td>5-10MB</td><td>标签页关闭时清除</td><td>同步阻塞</td><td>表单草稿、临时状态</td></tr><tr><td>IndexedDB</td><td>数百MB</td><td>永久</td><td>异步非阻塞</td><td>大量结构化数据</td></tr><tr><td>Cache API</td><td>依赖设备</td><td>Service Worker控制</td><td>异步</td><td>网络资源缓存、PWA</td></tr></tbody></table>
<h2 data-id="heading-16">Chrome DevTools中的缓存标识</h2>
<p>在Chrome开发者工具中，不同缓存来源有不同的标识：</p>









































<table><thead><tr><th>Size列显示</th><th>状态码</th><th>含义</th><th>缓存来源</th></tr></thead><tbody><tr><td>(memory cache)</td><td>200</td><td>内存缓存</td><td>Memory Cache</td></tr><tr><td>(disk cache)</td><td>200</td><td>磁盘缓存</td><td>Disk Cache</td></tr><tr><td>(ServiceWorker)</td><td>200</td><td>Service Worker缓存</td><td>Service Worker Cache</td></tr><tr><td>文件大小</td><td>304</td><td>协商缓存生效</td><td>服务器验证通过</td></tr><tr><td>文件大小</td><td>200</td><td>新请求</td><td>网络获取</td></tr></tbody></table>
<h2 data-id="heading-17">现代框架下的缓存最佳实践</h2>
<h3 data-id="heading-18">Vue 3 + Vite 缓存配置</h3>
<p><code>vite.config.js</code> 中配置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    <span class="hljs-comment">// 生成带hash的文件名，实现长期缓存</span>
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'assets/[name]-[hash].js'</span>,
        <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">'assets/[name]-[hash].js'</span>,
        <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">'assets/[name]-[hash].[ext]'</span>
      }
    }
  },
  
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-comment">// 开发环境：禁用缓存</span>
      <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-store'</span>
    }
  }
});
</code></pre>
<p>生产环境 <code>Nginx</code> 配置：</p>
<pre><code class="hljs language-bash" lang="bash">server {
    <span class="hljs-comment"># HTML文件：短缓存 + 协商缓存</span>
    location = /index.html {
        add_header Cache-Control <span class="hljs-string">"public, max-age=300, must-revalidate"</span>;
    }
    
    <span class="hljs-comment"># 带hash的静态资源：长期缓存 + 不可变</span>
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff2)$ {
        <span class="hljs-comment"># 匹配带hash的文件名</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_uri</span> ~* <span class="hljs-string">"\.([0-9a-f]{8,})\.(js|css|png|jpg|jpeg|gif|ico|svg|woff2)$"</span>) {
            add_header Cache-Control <span class="hljs-string">"public, max-age=31536000, immutable"</span>;
        }
        <span class="hljs-comment"># 无hash的资源使用协商缓存</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_uri</span> !~* <span class="hljs-string">"\.([0-9a-f]{8,})\.(js|css|png|jpg|jpeg|gif|ico|svg|woff2)$"</span>) {
            add_header Cache-Control <span class="hljs-string">"public, max-age=604800, must-revalidate"</span>;
        }
    }
    
    <span class="hljs-comment"># API请求：不缓存或短缓存</span>
    location /api/ {
        add_header Cache-Control <span class="hljs-string">"no-store, no-cache, must-revalidate"</span>;
        proxy_pass http://api-backend;
    }
}
</code></pre>
<h3 data-id="heading-19">React 缓存策略建议</h3>
<p>使用 <code>React Query</code> 进行数据缓存管理：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useQuery, <span class="hljs-title class_">QueryClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-query'</span>;

<span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>({
  <span class="hljs-attr">defaultOptions</span>: {
    <span class="hljs-attr">queries</span>: {
      <span class="hljs-attr">staleTime</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5分钟</span>
      <span class="hljs-attr">cacheTime</span>: <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 10分钟</span>
      <span class="hljs-attr">retry</span>: <span class="hljs-number">1</span>,
    },
  },
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> { data, isLoading } = <span class="hljs-title function_">useQuery</span>({
    <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'user'</span>, userId],
    <span class="hljs-attr">queryFn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchUser</span>(userId),
    <span class="hljs-comment">// 根据用户交互决定缓存策略</span>
    <span class="hljs-attr">cacheTime</span>: userId ? <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> : <span class="hljs-number">0</span>, <span class="hljs-comment">// 登录用户缓存15分钟</span>
  });
  
  <span class="hljs-comment">// 预加载相关数据</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">prefetchPosts</span> = (<span class="hljs-params"/>) =&gt; {
    queryClient.<span class="hljs-title function_">prefetchQuery</span>({
      <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'posts'</span>, userId],
      <span class="hljs-attr">queryFn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchUserPosts</span>(userId),
    });
  };
}
</code></pre>
<h2 data-id="heading-20">常见问题与解决方案</h2>
<h3 data-id="heading-21">用户反映看到的是旧版本页面</h3>
<p>原因：HTML文件被缓存，导致加载的是旧版本的静态资源引用。
解决方案：在nginx中配置合理的缓存策略：</p>
<pre><code class="hljs language-bash" lang="bash">location / {
    <span class="hljs-comment"># HTML文件：短时间缓存 + 协商缓存</span>
    add_header Cache-Control <span class="hljs-string">"public, max-age=300, must-revalidate"</span>;
}

location /assets/ {
    <span class="hljs-comment"># 静态资源：长时间缓存 + 文件hash</span>
    add_header Cache-Control <span class="hljs-string">"public, max-age=31536000, immutable"</span>;
}
</code></pre>
<h3 data-id="heading-22">如何优雅地清除缓存？</h3>
<p><code>vite/webpack</code> 会自动生成文件hash，以此进行清除。</p>
<h2 data-id="heading-23">缓存最佳实践总结</h2>















































<table><thead><tr><th>资源类型</th><th>推荐策略</th><th>缓存时间</th><th>更新机制</th></tr></thead><tbody><tr><td>HTML入口文件</td><td>协商缓存</td><td>短时间（5分钟）</td><td>内容hash或版本号</td></tr><tr><td>JS/CSS（带hash）</td><td>强缓存</td><td>长期（1年）</td><td>文件名hash变更</td></tr><tr><td>图片/字体</td><td>强缓存</td><td>中期（1个月）</td><td>URL变更或版本控制</td></tr><tr><td>API数据（列表）</td><td>内存缓存</td><td>短期（1-5分钟）</td><td>时间过期或主动失效</td></tr><tr><td>用户偏好配置</td><td>LocalStorage</td><td>永久</td><td>用户操作触发更新</td></tr><tr><td>离线资源</td><td>Service Worker</td><td>长期</td><td>版本化预缓存</td></tr></tbody></table>
<h2 data-id="heading-24">未来趋势</h2>
<ul>
<li>HTTP/3的缓存改进：更智能的缓存协商机制</li>
<li>AI驱动的缓存策略：根据用户行为预测缓存需求</li>
<li>边缘计算缓存：CDN与浏览器缓存的深度融合</li>
<li>隐私保护的缓存：沙盒化缓存防止指纹追踪</li>
</ul>
<h2 data-id="heading-25">结语</h2>
<p>浏览器缓存是一个多层次的复杂系统，理解各层缓存的工作原理、生命周期和适用场景是进行有效缓存管理的关键，对于文章中错误的地方或者有任何问题，欢迎在评论区留言讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript原型链 - 继承的基石与核心机制]]></title>    <link>https://juejin.cn/post/7601028900886298670</link>    <guid>https://juejin.cn/post/7601028900886298670</guid>    <pubDate>2026-01-30T23:55:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900886298670" data-draft-id="7601169987395338291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript原型链 - 继承的基石与核心机制"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T23:55:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript原型链 - 继承的基石与核心机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T23:55:52.000Z" title="Fri Jan 30 2026 23:55:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：从一道面试题说起</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// null</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Function</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span>); <span class="hljs-comment">// true (!)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Function</span>); <span class="hljs-comment">// true (!)</span>
</code></pre>
<p>如果你能完全理解上面的代码，那么你已经掌握了原型链的核心。如果不能，本篇文章将带我们一步步揭开原型链的神秘面纱。</p>
<h2 data-id="heading-1">构造函数、实例、原型的三者关系</h2>
<p>在JavaScript中，每个对象都有一个特殊的内部属性<code>[[Prototype]]</code>（可以通过<code>__proto__</code>访问），它指向该对象的原型对象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 原型对象：所有实例共享的方法和属性</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-comment">// 实例：通过new创建的对象</span>
<span class="hljs-keyword">const</span> zhangsan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'zhangsna'</span>);

<span class="hljs-comment">// 三者关系验证</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(zhangsan.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h2 data-id="heading-2">prototype和__proto__的区别与联系</h2>
<ul>
<li><code>prototype</code> 是函数特有的属性。</li>
<li><code>__proto__</code> 是每个对象都有的属性。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// "object"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> obj.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// "object"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> === obj.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 一定要注意：函数也是对象，所以函数也有__proto__</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
<ol>
<li>每个函数都有一个 <code>prototype</code> 属性，指向该函数的<strong>原型对象</strong>。</li>
<li>每个对象都有一个 <code>__proto__</code> 属性，指向创建该对象的构造函数的<strong>原型对象</strong>。</li>
<li>原型对象的 <code>constructor</code> 属性指向创建该实例对象的构造函数。</li>
<li><code>Function</code> 是一个特殊的函数，它的 <code>constructor</code> 指向它自己。</li>
</ol>
<h2 data-id="heading-3">完整的原型链结构</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is eating`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name); <span class="hljs-comment">// 调用父类构造函数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
}

<span class="hljs-comment">// 设置原型链</span>
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>; <span class="hljs-comment">// 修复constructor指向</span>

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">bark</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is barking`</span>);
};

<span class="hljs-keyword">const</span> myDog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>, <span class="hljs-string">'Golden Retriever'</span>);

<span class="hljs-comment">// 原型链查找路径：</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// null</span>
</code></pre>
<p>上述代码中，原型链的查找过程：</p>
<ol>
<li><code>myDog</code> 本身有 <code>name</code> 和 <code>breed</code> 属性</li>
<li><code>myDog.__proto__</code> (<code>Dog.prototype</code>) 有 <code>bark</code> 方法</li>
<li><code>Dog.prototype.__proto__</code> (<code>Animal.prototype</code>) 有 <code>eat</code> 方法</li>
<li><code>Animal.prototype.__proto__</code> (<code>Object.prototype</code>) 有 <code>toString</code> 等方法</li>
<li><code>Object.prototype.__proto__</code> 为<code>null</code>，查找结束</li>
</ol>
<blockquote>
<p>Object.prototype是所有原型链的终点。</p>
</blockquote>
<h2 data-id="heading-4">属性屏蔽规则</h2>
<h3 data-id="heading-5">hasOwnProperty vs in操作符</h3>
<ul>
<li><code>hasOwnProperty</code>: 检查属性是否在对象自身（不在原型链上）</li>
<li>in操作符: 检查属性是否在对象自身或原型链上</li>
</ul>
<h3 data-id="heading-6">属性屏蔽的三种情况</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'parent value'</span>;
}

<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">shared</span> = <span class="hljs-string">'parent shared'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'child value'</span>; 
}

<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">shared</span> = <span class="hljs-string">'child shared'</span>; 

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();
</code></pre>
<h4 data-id="heading-7">情况1：对象自身有该属性（完全屏蔽）</h4>
<p>以上述代码为例，<code>Child</code> 本身有自己的 <code>value</code> 属性，当调用 <code>value</code> 属性时，会完全屏蔽原型链上的同名 <code>value</code> 属性：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">value</span>); <span class="hljs-comment">// 'child value'（不是'parent value'）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'value'</span>)); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-8">情况2：对象自身本来没有，但添加对象自身属性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">shared</span>); <span class="hljs-comment">// 'child shared'（来自Child.prototype）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'shared'</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 添加对象自身属性</span>
child.<span class="hljs-property">shared</span> = <span class="hljs-string">'instance shared'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">shared</span>); <span class="hljs-comment">// 'instance shared'（现在自身有了）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'shared'</span>)); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-9">情况3：属性是只读的</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">readOnly</span> = <span class="hljs-string">'cannot change'</span>;

<span class="hljs-comment">// 试图修改只读属性</span>
child.<span class="hljs-property">readOnly</span> = <span class="hljs-string">'try to change'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">readOnly</span>); <span class="hljs-comment">// 'cannot change'（修改失败）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'readOnly'</span>)); <span class="hljs-comment">// false（没有添加成功）</span>
</code></pre>
<h2 data-id="heading-10">原型链的基础结构</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> zhangsan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'zhangsan'</span>);
</code></pre>
<p>其原型结构图如下：</p>
<pre><code class="hljs language-text" lang="text">zhangsan (实例)
  ├── __proto__: Person.prototype
  │      ├── constructor: Person
  │      ├── sayHello: function()
  │      └── __proto__: Object.prototype
  │             ├── constructor: Object
  │             ├── toString: function()
  │             ├── hasOwnProperty: function()
  │             └── __proto__: null
  ├── name: "zhangsan"
  └── (其他实例属性...)

Person (构造函数)
  ├── prototype: Person.prototype
  └── __proto__: Function.prototype
           ├── constructor: Function
           ├── apply: function()
           ├── call: function()
           └── __proto__: Object.prototype
</code></pre>
<h2 data-id="heading-11">原型链的实际应用</h2>
<h3 data-id="heading-12">实现继承的多种方式</h3>
<h4 data-id="heading-13">原型链继承（经典方式）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">age</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-comment">// 关键：让子类原型指向父类实例</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Parent</span>();

<span class="hljs-comment">// 修复constructor指向</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;
</code></pre>
<ul>
<li>问题：引用类型的属性会被所有实例共享</li>
</ul>
<h4 data-id="heading-14">组合继承（最常用）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name ;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-comment">// 继承属性</span>
    <span class="hljs-title class_">Parent</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);  <span class="hljs-comment">// 第二次调用Parent</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-comment">// 继承方法</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Parent</span>();  <span class="hljs-comment">// 第一次调用Parent</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;
</code></pre>
<ul>
<li>优点：结合了原型链和构造函数的优点</li>
<li>缺点：父类构造函数被调用了两次</li>
</ul>
<h4 data-id="heading-15">寄生组合式继承（最佳实践）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">inheritPrototype</span>(<span class="hljs-params">child, parent</span>) {
    <span class="hljs-comment">// 创建父类原型的副本</span>
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(parent.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
    <span class="hljs-comment">// 修复constructor指向</span>
    prototype.<span class="hljs-property">constructor</span> = child;
    <span class="hljs-comment">// 设置子类原型</span>
    child.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = prototype;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-title class_">Parent2</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-title function_">inheritPrototype</span>(<span class="hljs-title class_">Child</span>, <span class="hljs-title class_">Parent</span>);
</code></pre>
<ul>
<li>只调用一次父类构造函数</li>
<li>避免在子类原型上创建不必要的属性</li>
<li>原型链保持不变</li>
</ul>
<h4 data-id="heading-16">ES6 class继承</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent3</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent3</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
        <span class="hljs-variable language_">super</span>(name);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    }
    
    <span class="hljs-title function_">sayAge</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>);
    }
}
</code></pre>
<ul>
<li>语法简洁，现代解决方案，但需要ES6+支持</li>
</ul>
<h3 data-id="heading-17">实现混入（Mixin）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> canEat = {
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is eating <span class="hljs-subst">${food}</span>`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += <span class="hljs-number">10</span>;
    }
};

<span class="hljs-keyword">const</span> canSleep = {
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is sleeping for <span class="hljs-subst">${hours}</span> hours`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += hours * <span class="hljs-number">5</span>;
    }
};

<span class="hljs-keyword">const</span> canWalk = {
    <span class="hljs-attr">walk</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">distance</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is walking <span class="hljs-subst">${distance}</span> km`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= distance * <span class="hljs-number">2</span>;
    }
};

<span class="hljs-comment">// 混入函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mixin</span>(<span class="hljs-params">target, ...sources</span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(target.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, ...sources);
}

<span class="hljs-comment">// 创建动物类</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> = <span class="hljs-number">100</span>;
}

<span class="hljs-title function_">mixin</span>(<span class="hljs-title class_">Animal</span>, canEat, canSleep, canWalk);

<span class="hljs-comment">// 创建鸟类，额外添加飞行能力</span>
<span class="hljs-keyword">const</span> canFly = {
    <span class="hljs-attr">fly</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">distance</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying <span class="hljs-subst">${distance}</span> km`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= distance * <span class="hljs-number">5</span>;
    }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Bird</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">wings</span> = <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// 设置原型链</span>
<span class="hljs-title class_">Bird</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Bird</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Bird</span>;

<span class="hljs-comment">// 添加飞行能力</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Bird</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, canFly);
</code></pre>
<h2 data-id="heading-18">原型链常见陷阱</h2>
<h3 data-id="heading-19">陷阱1：修改原型会影响所有实例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> zhangsan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'zhangsan'</span>);
<span class="hljs-keyword">const</span> lisi = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'lisi'</span>);

<span class="hljs-comment">// 修改原型</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

zhangsan.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// Hello, zhangsan (正常)</span>
lisi.<span class="hljs-title function_">sayHello</span>();   <span class="hljs-comment">// Hello, lisi (正常)</span>
</code></pre>
<h3 data-id="heading-20">陷阱2：原型上的引用类型属性被所有实例共享</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Problem</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">values</span> = []; <span class="hljs-comment">// 正确：每个实例有自己的数组</span>
}

<span class="hljs-title class_">Problem</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sharedValues</span> = []; <span class="hljs-comment">// 错误：所有实例共享同一个数组</span>

<span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Problem</span>();
<span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Problem</span>();

p1.<span class="hljs-property">sharedValues</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'from p1'</span>);
p2.<span class="hljs-property">sharedValues</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'from p2'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p1.<span class="hljs-property">sharedValues</span>); <span class="hljs-comment">// ['from p1', 'from p2']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p2.<span class="hljs-property">sharedValues</span>); <span class="hljs-comment">// ['from p1', 'from p2']</span>
</code></pre>
<h3 data-id="heading-21">陷阱3：for...in会遍历原型链上的可枚举属性</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentProp</span> = <span class="hljs-string">'parent'</span>;
}

<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">inheritedProp</span> = <span class="hljs-string">'inherited'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childProp</span> = <span class="hljs-string">'child'</span>;
}

<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Parent</span>();

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> child) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// childProp, parentProp, inheritedProp</span>
}
</code></pre>
<p>解决方案：使用hasOwnProperty过滤：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> child) {
    <span class="hljs-keyword">if</span> (child.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// childProp, parentProp</span>
    }
}
</code></pre>
<h2 data-id="heading-22">原型链的最佳实践</h2>
<h3 data-id="heading-23">实践1：使用Object.create设置原型链</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayName</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-title class_">Parent</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-comment">// 最佳方式</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

<span class="hljs-comment">// 添加子类方法</span>
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayAge</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>);
};
</code></pre>
<h3 data-id="heading-24">实践2：使用class语法（ES6+）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodParent</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">sayName</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodChild</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">GoodParent</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
        <span class="hljs-variable language_">super</span>(name);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    }
    
    <span class="hljs-title function_">sayAge</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>);
    }
}
</code></pre>
<h3 data-id="heading-25">实践3：安全地检查属性</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">ownProp</span>: <span class="hljs-string">'value'</span> };

<span class="hljs-comment">// 不好的做法</span>
<span class="hljs-keyword">if</span> (obj.<span class="hljs-property">property</span>) {
    <span class="hljs-comment">// 如果property值为falsy（0, '', false, null, undefined），会被误判</span>
}

<span class="hljs-comment">// 好的做法</span>
<span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'property'</span>)) {
    <span class="hljs-comment">// 明确检查自身属性</span>
}

<span class="hljs-comment">// 更好的做法（防止hasOwnProperty被覆盖）</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hasOwnProperty</span>.<span class="hljs-title function_">call</span>(obj, <span class="hljs-string">'property'</span>)) {
    <span class="hljs-comment">// 最安全的方式</span>
}
</code></pre>
<h3 data-id="heading-26">实践4：避免修改内置对象的原型</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 非必要情况，不得进行以下操作</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">customMethod</span>) {
    <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">customMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 实现</span>
    };
}
</code></pre>
<h2 data-id="heading-27">思考题：以下代码的输出是什么？为什么？</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Bar</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Bar</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

<span class="hljs-keyword">const</span> bar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bar</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Bar</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Foo</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Bar</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">isPrototypeOf</span>(bar)); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">isPrototypeOf</span>(bar)); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">isPrototypeOf</span>(bar)); 
</code></pre>
<h2 data-id="heading-28">结语</h2>
<p>原型链是 JavaScript 面向对象编程的基石，在 JavaScript 中没有真正的类，只有对象和它们之间的链接（原型链），对于文章中错误的地方或者有任何问题，欢迎在评论区留言讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯原生html js实现幸运抽奖转盘功能-奖项不重复(javascript小案例)]]></title>    <link>https://juejin.cn/post/7600787795478560814</link>    <guid>https://juejin.cn/post/7600787795478560814</guid>    <pubDate>2026-01-31T01:21:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600787795478560814" data-draft-id="7601169987395452979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯原生html js实现幸运抽奖转盘功能-奖项不重复(javascript小案例)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-31T01:21:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崧峻"/> <meta itemprop="url" content="https://juejin.cn/user/4484237958320521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯原生html js实现幸运抽奖转盘功能-奖项不重复(javascript小案例)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4484237958320521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崧峻
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:21:28.000Z" title="Sat Jan 31 2026 01:21:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">创建项目</h2>
<p>如图所示创建一个基本html项目,创建好之后如图2所示
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ba83c15da3a4cb784e3eb6322545d6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSn5bO7:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427288&amp;x-signature=sMg6YF4CkBv3kC%2FzdOAPkVC6a0w%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">九宫格效果</h2>
<p>我们先来实现九宫格的效果吧，有两种一种是按照顺序的九宫格如图1所示，一种是一圈的效果如图2所示，我们本期以第一种九宫格为案例进行实现</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1572afd747e4298accc02bd20f9da08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSn5bO7:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427288&amp;x-signature=Z0DmeBVOwodvQBd57uwmQW6slXA%3D" alt="image.png" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0a2950e8f88400f9cfd63c101d776b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSn5bO7:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427288&amp;x-signature=wF6smvVSgTBDgEJ5bXrQfxqZ%2Bns%3D" alt="image.png" loading="lazy"/></p>
<p>html部分代码</p>
<pre><code class="hljs language-js" lang="js">&lt;body&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"turntable-box"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>一等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>二等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>三等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>四等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startBtn"</span>&gt;</span>参与游戏<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>赢得大奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>五等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>六等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>七等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>八等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/body&gt;
</code></pre>
<p>css部分代码样式</p>
<pre><code class="hljs language-css" lang="css">&lt;style type="text/css"&gt;

  


<span class="hljs-comment">/* 转盘的外层边框 */</span>

<span class="hljs-selector-id">#turntable-box</span> {

<span class="hljs-attribute">display</span>: flex;

<span class="hljs-attribute">align-items</span>: center;

<span class="hljs-attribute">justify-content</span>: center;

<span class="hljs-attribute">flex-wrap</span>: wrap;

<span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;

<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">15px</span>;

<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#922a21</span>;

<span class="hljs-attribute">position</span>: relative;

<span class="hljs-attribute">width</span>: <span class="hljs-number">510px</span>;

<span class="hljs-attribute">height</span>: <span class="hljs-number">420px</span>;

<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;

<span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;

}

  


<span class="hljs-comment">/* 转盘下面的每个模块样式 */</span>

<span class="hljs-selector-id">#turntable-box</span> &gt; <span class="hljs-selector-tag">div</span> {

<span class="hljs-attribute">display</span>: flex;

<span class="hljs-attribute">align-items</span>: center;

<span class="hljs-attribute">justify-content</span>: center;

<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">25px</span>;

<span class="hljs-attribute">width</span>: <span class="hljs-number">160px</span>;

<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8e7c1</span>;

<span class="hljs-attribute">height</span>: <span class="hljs-number">130px</span>;

<span class="hljs-attribute">text-align</span>: center;

<span class="hljs-attribute">font-size</span>: <span class="hljs-number">25px</span>;

}

&lt;/style&gt;
</code></pre>
<p>这个就是很简单的一个换行排序 flex布局</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
<span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;
<span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) {
<span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;
<span class="hljs-attribute">left</span>: <span class="hljs-number">175px</span>;
}
<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) {
<span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;
<span class="hljs-attribute">left</span>: <span class="hljs-number">340px</span>;
}
<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">4</span>) {
<span class="hljs-attribute">left</span>: <span class="hljs-number">340px</span>;
<span class="hljs-attribute">top</span>: <span class="hljs-number">145px</span>;
}
<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">5</span>) {
<span class="hljs-attribute">left</span>: <span class="hljs-number">340px</span>;
<span class="hljs-attribute">top</span>: <span class="hljs-number">280px</span>;
}
<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">6</span>) {
<span class="hljs-attribute">top</span>: <span class="hljs-number">280px</span>;
<span class="hljs-attribute">left</span>: <span class="hljs-number">175px</span>;
}
<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">7</span>) {
<span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>;
<span class="hljs-attribute">top</span>: <span class="hljs-number">280px</span>;
}
<span class="hljs-selector-id">#turntable-box</span> <span class="hljs-selector-class">.reward</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">8</span>) {
<span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>;
<span class="hljs-attribute">top</span>: <span class="hljs-number">145px</span>;
}
</code></pre>
<p><strong>如果大家想要一圈形式的布局代码参考如下 其实就是利用了定位让他形成了一圈</strong></p>
<h2 data-id="heading-2">美化样式</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>幸运转盘<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="css">
			<span class="hljs-selector-tag">body</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">flex-direction</span>: column;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">overflow</span>: hidden;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
				<span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'img/background.jpg'</span>);
				<span class="hljs-comment">/* 背景图片居中 */</span>
				<span class="hljs-attribute">background-position</span>: center;
				<span class="hljs-comment">/* 背景图片不重复 */</span>
				<span class="hljs-attribute">background-repeat</span>: no-repeat;
			}


			<span class="hljs-comment">/* 幸运抽奖的标题图片 */</span>
			<span class="hljs-selector-class">.draw-title</span> {
				<span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
				<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">10px</span>);
			}


			<span class="hljs-comment">/*  转盘的外层边框 */</span>
			<span class="hljs-selector-id">#turntable-content</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">flex-wrap</span>: wrap;
				<span class="hljs-attribute">gap</span>: <span class="hljs-number">5px</span>;
				<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">15px</span>;
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#922a21</span>;
				<span class="hljs-attribute">position</span>: relative;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">510px</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">410px</span>;
				<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
				<span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
			}


			<span class="hljs-comment">/*  转盘下面的每个模块样式 */</span>
			<span class="hljs-selector-id">#turntable-content</span>&gt;<span class="hljs-selector-tag">div</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">25px</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">160px</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">130px</span>;
				<span class="hljs-attribute">text-align</span>: center;
				<span class="hljs-attribute">font-size</span>: <span class="hljs-number">25px</span>;
			}






			<span class="hljs-comment">/* 幸运转盘最外层 */</span>
			<span class="hljs-selector-class">.draw-turntable-box</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5%</span>;
				<span class="hljs-attribute">background</span>: <span class="hljs-number">#de4b3f</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;
			}


			<span class="hljs-comment">/* 开始抽奖按钮 */</span>
			<span class="hljs-selector-id">#startBtn</span> {
				<span class="hljs-attribute">cursor</span>: pointer;
				<span class="hljs-attribute">text-align</span>: center;
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">font-size</span>: <span class="hljs-number">22px</span>;
				<span class="hljs-attribute">white-space</span>: normal;
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eb5e4a</span>;
				<span class="hljs-attribute">color</span>: white;
			}
			
			<span class="hljs-comment">/* 奖项 */</span>
			<span class="hljs-selector-class">.unselected</span> {
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8e7c1</span>;
			}
			
			<span class="hljs-selector-id">#selected</span> {
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ee7c45</span>;
			}
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./img/draw.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"抽奖标题"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"draw-title"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"draw-turntable-box"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"turntable-content"</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>一等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>二等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>三等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>四等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startBtn"</span>&gt;</span>参与游戏<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>赢得大奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>五等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>六等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>七等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>八等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-3">js代码实现-抽奖不重复</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a93ee5595bda42ef93aa42f28e8ab012~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSn5bO7:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427288&amp;x-signature=QOAxu77mfzIn42X%2FDuY5ZyZ%2Fduk%3D" alt="image.png" loading="lazy"/>
实现原理是给开始按钮绑定一个点击事件，然后进行依次变色，最后随机一个没有抽到过的数，然后抽奖成功后把这个数放到一个变量中存储进行去重，完整js代码如下 如图所示</p>
<pre><code class="hljs language-&lt;script" lang="&lt;script">		// 奖项元素列表
		var award = document.getElementsByClassName("award");
		// 已经拿到的奖励序号
		const lucks = [];
		// 是否正在抽奖
		let running = false;
		
		// 开始按钮元素
		var startBtn = document.getElementById("startBtn");
		
		startBtn.onclick = function() {
			// 判断是否正在抽奖
			if (running) return;
			// 设置为正在抽奖
			running = true;
				
			// 可抽取的奖项编号（1~8）排除已经抽取的
			const available = Array.from({ length: award.length }, (_, i) =&gt; i + 1)
				.filter(i =&gt; !lucks.includes(i));
				
			// 全部抽完
			if (available.length === 0) {
				startBtn.innerHTML = "所有奖项已抽完";
				running = false;
				return;
			}
				
			// 随机中奖编号（1~8中未抽的一个）
			const target = available[Math.floor(Math.random() * available.length)];
				
			// 随机圈数（2~4圈）
			const rounds = Math.floor(Math.random() * 2) + 2;
			const totalSteps = rounds * award.length + (target - 1);
				
			let current = 0;
			let speed = 60;
				
			function spin() {
				const index = current % award.length;
				
				// 重置未中奖项颜色
				for (let i = 0; i &lt; award.length; i++) {
					if (!lucks.includes(i + 1)) {
						award[i].className = "award unselected";
					}
				}
				
				// 高亮当前
				award[index].className = "selected award";
				
				current++;
				
				// 是否结束
				if (current &gt; totalSteps) {
					lucks.push(index + 1);
					startBtn.innerHTML = `恭喜您中了&lt;br&gt;${index + 1}等奖 🎊`;
					running = false;
					return;
				}
				
				// 越接近目标速度越慢
				if (totalSteps - current &lt; award.length) {
					speed += 40;
				}
				
				setTimeout(spin, speed);
			}
				
			spin();
		};
	&lt;/script&gt;
</code></pre>
<h2 data-id="heading-4">完整代码</h2>
<pre><code class="hljs language-js" lang="js">

&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>幸运转盘<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="css">
			<span class="hljs-selector-tag">body</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">flex-direction</span>: column;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">overflow</span>: hidden;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
				<span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'img/background.jpg'</span>);
				<span class="hljs-comment">/* 背景图片居中 */</span>
				<span class="hljs-attribute">background-position</span>: center;
				<span class="hljs-comment">/* 背景图片不重复 */</span>
				<span class="hljs-attribute">background-repeat</span>: no-repeat;
			}


			<span class="hljs-comment">/* 幸运抽奖的标题图片 */</span>
			<span class="hljs-selector-class">.draw-title</span> {
				<span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
				<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">10px</span>);
			}


			<span class="hljs-comment">/*  转盘的外层边框 */</span>
			<span class="hljs-selector-id">#turntable-content</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">flex-wrap</span>: wrap;
				<span class="hljs-attribute">gap</span>: <span class="hljs-number">5px</span>;
				<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">15px</span>;
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#922a21</span>;
				<span class="hljs-attribute">position</span>: relative;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">510px</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">410px</span>;
				<span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
				<span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
			}


			<span class="hljs-comment">/*  转盘下面的每个模块样式 */</span>
			<span class="hljs-selector-id">#turntable-content</span>&gt;<span class="hljs-selector-tag">div</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">25px</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">160px</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">130px</span>;
				<span class="hljs-attribute">text-align</span>: center;
				<span class="hljs-attribute">font-size</span>: <span class="hljs-number">25px</span>;
			}






			<span class="hljs-comment">/* 幸运转盘最外层 */</span>
			<span class="hljs-selector-class">.draw-turntable-box</span> {
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5%</span>;
				<span class="hljs-attribute">background</span>: <span class="hljs-number">#de4b3f</span>;
				<span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
				<span class="hljs-attribute">width</span>: <span class="hljs-number">600px</span>;
			}


			<span class="hljs-comment">/* 开始抽奖按钮 */</span>
			<span class="hljs-selector-id">#startBtn</span> {
				<span class="hljs-attribute">cursor</span>: pointer;
				<span class="hljs-attribute">text-align</span>: center;
				<span class="hljs-attribute">display</span>: flex;
				<span class="hljs-attribute">align-items</span>: center;
				<span class="hljs-attribute">justify-content</span>: center;
				<span class="hljs-attribute">font-size</span>: <span class="hljs-number">22px</span>;
				<span class="hljs-attribute">white-space</span>: normal;
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eb5e4a</span>;
				<span class="hljs-attribute">color</span>: white;
			}
			
			<span class="hljs-comment">/* 奖项 */</span>
			<span class="hljs-selector-class">.unselected</span> {
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8e7c1</span>;
			}
			
			<span class="hljs-selector-class">.selected</span> {
				<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ee7c45</span>;
			}
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./img/draw.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"抽奖标题"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"draw-title"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"draw-turntable-box"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"turntable-content"</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>一等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>二等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>三等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>四等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startBtn"</span>&gt;</span>参与游戏<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>赢得大奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>五等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>六等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>七等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"award unselected"</span>&gt;</span>八等奖<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>


	<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
		<span class="hljs-comment">// 奖项元素列表</span>
		<span class="hljs-keyword">var</span> award = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByClassName</span>(<span class="hljs-string">"award"</span>);
		<span class="hljs-comment">// 已经拿到的奖励序号</span>
		<span class="hljs-keyword">const</span> lucks = [];
		<span class="hljs-comment">// 是否正在抽奖</span>
		<span class="hljs-keyword">let</span> running = <span class="hljs-literal">false</span>;
		
		<span class="hljs-comment">// 开始按钮元素</span>
		<span class="hljs-keyword">var</span> startBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"startBtn"</span>);
		
		startBtn.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
			<span class="hljs-comment">// 判断是否正在抽奖</span>
			<span class="hljs-keyword">if</span> (running) <span class="hljs-keyword">return</span>;
			<span class="hljs-comment">// 设置为正在抽奖</span>
			running = <span class="hljs-literal">true</span>;
				
			<span class="hljs-comment">// 可抽取的奖项编号（1~8）排除已经抽取的</span>
			<span class="hljs-keyword">const</span> available = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: award.<span class="hljs-property">length</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">1</span>)
				.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> !lucks.<span class="hljs-title function_">includes</span>(i));
				
			<span class="hljs-comment">// 全部抽完</span>
			<span class="hljs-keyword">if</span> (available.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
				startBtn.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"所有奖项已抽完"</span>;
				running = <span class="hljs-literal">false</span>;
				<span class="hljs-keyword">return</span>;
			}
				
			<span class="hljs-comment">// 随机中奖编号（1~8中未抽的一个）</span>
			<span class="hljs-keyword">const</span> target = available[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * available.<span class="hljs-property">length</span>)];
				
			<span class="hljs-comment">// 随机圈数（2~4圈）</span>
			<span class="hljs-keyword">const</span> rounds = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span>) + <span class="hljs-number">2</span>;
			<span class="hljs-keyword">const</span> totalSteps = rounds * award.<span class="hljs-property">length</span> + (target - <span class="hljs-number">1</span>);
				
			<span class="hljs-keyword">let</span> current = <span class="hljs-number">0</span>;
			<span class="hljs-keyword">let</span> speed = <span class="hljs-number">60</span>;
				
			<span class="hljs-keyword">function</span> <span class="hljs-title function_">spin</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">const</span> index = current % award.<span class="hljs-property">length</span>;
				
				<span class="hljs-comment">// 重置未中奖项颜色</span>
				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; award.<span class="hljs-property">length</span>; i++) {
					<span class="hljs-keyword">if</span> (!lucks.<span class="hljs-title function_">includes</span>(i + <span class="hljs-number">1</span>)) {
						award[i].<span class="hljs-property">className</span> = <span class="hljs-string">"award unselected"</span>;
					}
				}
				
				<span class="hljs-comment">// 高亮当前</span>
				award[index].<span class="hljs-property">className</span> = <span class="hljs-string">"selected award"</span>;
				
				current++;
				
				<span class="hljs-comment">// 是否结束</span>
				<span class="hljs-keyword">if</span> (current &gt; totalSteps) {
					lucks.<span class="hljs-title function_">push</span>(index + <span class="hljs-number">1</span>);
					startBtn.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`恭喜您中了&lt;br&gt;<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>等奖 🎊`</span>;
					running = <span class="hljs-literal">false</span>;
					<span class="hljs-keyword">return</span>;
				}
				
				<span class="hljs-comment">// 越接近目标速度越慢</span>
				<span class="hljs-keyword">if</span> (totalSteps - current &lt; award.<span class="hljs-property">length</span>) {
					speed += <span class="hljs-number">40</span>;
				}
				
				<span class="hljs-built_in">setTimeout</span>(spin, speed);
			}
				
			<span class="hljs-title function_">spin</span>();
		};
	</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</span></code></pre>
<p>转载自DOIT社区<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.doitwiki.com%2Farticle%2Fdetails%2F180486793636864" target="_blank" title="https://www.doitwiki.com/article/details/180486793636864" ref="nofollow noopener noreferrer">纯原生html js实现幸运抽奖转盘功能-奖项不重复(javascript小案例)-DOIT社区</a> 如有需要大家可以去此地址拿取文件</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React、TypeScript、reduce 以及 Ant Design Pro Components（antProcomponent）搭建开发环境教程]]></title>    <link>https://juejin.cn/post/7600986495927140393</link>    <guid>https://juejin.cn/post/7600986495927140393</guid>    <pubDate>2026-01-31T01:29:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986495927140393" data-draft-id="7600986495927107625" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React、TypeScript、reduce 以及 Ant Design Pro Components（antProcomponent）搭建开发环境教程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-31T01:29:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户22176592792"/> <meta itemprop="url" content="https://juejin.cn/user/4461135061323432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React、TypeScript、reduce 以及 Ant Design Pro Components（antProcomponent）搭建开发环境教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4461135061323432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户22176592792
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:29:07.000Z" title="Sat Jan 31 2026 01:29:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你想要的是一套完整的教程，指导如何搭建一个结合了 React、TypeScript、reduce 以及 Ant Design Pro Components（antProcomponent）的开发环境，我会一步步带你完成这个过程。</p>
<h4 data-id="heading-0">一、环境准备（前置条件）</h4>
<p>在开始前，请确保你的电脑已安装以下工具：</p>
<ol>
<li>Node.js（推荐 16.x 或 18.x 版本，可通过 ​<code>​node -v​</code>​ 检查）</li>
<li>npm 或 yarn（npm 随 Node.js 自带，yarn 可通过 ​<code>​npm install -g yarn​</code>​ 安装）</li>
<li>代码编辑器（推荐 VS Code）</li>
</ol>
<h4 data-id="heading-1">二、搭建 React + TypeScript 基础项目</h4>
<p>Ant Design Pro 提供了开箱即用的脚手架，能快速集成 TypeScript 和 Pro Components，比手动配置更高效：</p>
<h5 data-id="heading-2">步骤 1：创建 Ant Design Pro 项目</h5>
<p>打开终端，执行以下命令（选择 TypeScript 模板）：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 使用官方脚手架创建项目</span>
npm create umi@latest <span class="hljs-keyword">my</span>-pro-app
<span class="hljs-comment"># 或用 yarn</span>
yarn create umi <span class="hljs-keyword">my</span>-pro-app
</code></pre>
<p>执行后会出现交互式选择，按以下选项配置：</p>
<ol>
<li>选择 ​<code>​ant-design-pro​</code>​（Pro 模板）</li>
<li>选择 ​<code>​TypeScript​</code>​（语言）</li>
<li>选择 ​<code>​simple​</code>​（简易模板，适合新手）</li>
<li>确认安装依赖（等待依赖下载完成）</li>
</ol>
<h5 data-id="heading-3">步骤 2：安装依赖并启动项目</h5>
<p>进入项目目录，安装依赖并启动：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> my-pro-app
<span class="hljs-comment"># 安装依赖</span>
npm install
<span class="hljs-comment"># 启动开发服务</span>
npm run start
</code></pre>
<p>启动成功后，浏览器会自动打开 ​<code>​http://localhost:8000​</code>​，能看到 Ant Design Pro 的基础页面，说明 React + TypeScript + Pro Components 环境已搭建完成。</p>
<h4 data-id="heading-4">三、集成 reduce（数组方法）的实战示例</h4>
<p>React 中常使用 ​<code>​reduce​</code>​ 处理数组数据（比如数据聚合、筛选、格式化），结合 TypeScript 能保证类型安全，以下是结合 Pro Components（如 ProTable）的实战示例：</p>
<h5 data-id="heading-5">示例：用 reduce 处理表格数据并渲染 ProTable</h5>
<ol>
<li>在 ​<code>​src/pages​</code>​ 下新建 ​<code>​ReduceDemo.tsx​</code>​ 文件，写入以下代码：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-components'</span>;

<span class="hljs-comment">// 定义数据类型（TypeScript 类型约束）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserData</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">department</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">salary</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ReduceDemo</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 原始模拟数据</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">rawData</span>: <span class="hljs-title class_">UserData</span>[] = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">department</span>: <span class="hljs-string">'前端'</span>, <span class="hljs-attr">salary</span>: <span class="hljs-number">15000</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">department</span>: <span class="hljs-string">'后端'</span>, <span class="hljs-attr">salary</span>: <span class="hljs-number">18000</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">department</span>: <span class="hljs-string">'前端'</span>, <span class="hljs-attr">salary</span>: <span class="hljs-number">16000</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'赵六'</span>, <span class="hljs-attr">department</span>: <span class="hljs-string">'后端'</span>, <span class="hljs-attr">salary</span>: <span class="hljs-number">20000</span> },
  ];

  <span class="hljs-comment">// 用 reduce 聚合：按部门分组，计算每个部门的平均工资</span>
  <span class="hljs-keyword">const</span> departmentSalary = rawData.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, item</span>) =&gt;</span> {
    <span class="hljs-comment">// 类型守卫，确保 acc 结构正确</span>
    <span class="hljs-keyword">if</span> (!acc[item.<span class="hljs-property">department</span>]) {
      acc[item.<span class="hljs-property">department</span>] = {
        <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">average</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">list</span>: [] <span class="hljs-keyword">as</span> <span class="hljs-title class_">UserData</span>[],
      };
    }
    <span class="hljs-comment">// 累加工资和人数</span>
    acc[item.<span class="hljs-property">department</span>].<span class="hljs-property">total</span> += item.<span class="hljs-property">salary</span>;
    acc[item.<span class="hljs-property">department</span>].<span class="hljs-property">count</span> += <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 存入当前用户</span>
    acc[item.<span class="hljs-property">department</span>].<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>(item);
    <span class="hljs-comment">// 计算平均工资（保留2位小数）</span>
    acc[item.<span class="hljs-property">department</span>].<span class="hljs-property">average</span> = <span class="hljs-title class_">Number</span>(
      (acc[item.<span class="hljs-property">department</span>].<span class="hljs-property">total</span> / acc[item.<span class="hljs-property">department</span>].<span class="hljs-property">count</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)
    );
    <span class="hljs-keyword">return</span> acc;
  }, {} <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, { <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">average</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">list</span>: <span class="hljs-title class_">UserData</span>[] }&gt;);

  <span class="hljs-comment">// 转换为 ProTable 可渲染的格式</span>
  <span class="hljs-keyword">const</span> tableData = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(departmentSalary).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[dept, data]</span>) =&gt;</span> ({
    <span class="hljs-attr">department</span>: dept,
    <span class="hljs-attr">totalSalary</span>: data.<span class="hljs-property">total</span>,
    <span class="hljs-attr">personCount</span>: data.<span class="hljs-property">count</span>,
    <span class="hljs-attr">averageSalary</span>: data.<span class="hljs-property">average</span>,
  }));

  <span class="hljs-comment">// ProTable 列配置</span>
  <span class="hljs-keyword">const</span> columns = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'部门'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'department'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'department'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'总工资'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'totalSalary'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'totalSalary'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'人数'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'personCount'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'personCount'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'平均工资'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'averageSalary'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'averageSalary'</span>,
    },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">20</span> }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Reduce + ProTable 实战示例<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
        <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{tableData}</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span>
        <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"department"</span>
        <span class="hljs-attr">pagination</span>=<span class="hljs-string">{false}</span>
        <span class="hljs-attr">title</span>=<span class="hljs-string">{()</span> =&gt;</span> '各部门工资统计（基于reduce聚合）'}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ReduceDemo</span>;
</code></pre>
<ol start="2">
<li>配置路由：修改 ​<code>​src/config/routes.ts​</code>​，添加新路由：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">IRouteProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@umijs/max'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">IRouteProps</span>[] = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/reduce-demo'</span>,
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/reduce-demo'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Reduce示例'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-string">'./ReduceDemo'</span>,
  },
];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> routes;
</code></pre>
<ol start="3">
<li>重启项目（​<code>​npm run start​</code>​），访问 ​<code>​http://localhost:8000/reduce-demo​</code>​，就能看到用 ​<code>​reduce​</code>​ 聚合后的数据通过 ProTable 渲染的表格。</li>
</ol>
<h4 data-id="heading-6">四、关键知识点解释</h4>
<ol>
<li><strong>TypeScript 类型约束</strong>：</li>
</ol>
<ul>
<li>定义 ​<code>​UserData​</code>​ 接口规范原始数据结构，避免类型错误；</li>
<li>​<code>​Record&lt;string, ...&gt;​</code>​ 约束 ​<code>​reduce​</code>​ 累加器的类型，确保 ​<code>​acc​</code>​ 的属性和值类型符合预期。</li>
</ul>
<ol start="2">
<li><strong>reduce 核心逻辑</strong>：</li>
</ol>
<ul>
<li>第一个参数：回调函数，接收 ​<code>​acc​</code>​（累加器）和 ​<code>​item​</code>​（当前项），返回更新后的累加器；</li>
<li>第二个参数：累加器初始值（这里是空对象，且用 TypeScript 定义了结构）；</li>
<li>作用：替代循环，高效完成“分组 + 计算”的聚合操作。</li>
</ul>
<ol start="3">
<li><strong>Ant Design Pro Components 优势</strong>：</li>
</ol>
<ul>
<li>​<code>​ProTable​</code>​ 内置了分页、筛选、排序等功能，比原生 Table 更易用；</li>
<li>支持 TypeScript 类型推导，列配置的 ​<code>​dataIndex​</code>​ 会自动校验是否匹配数据源。</li>
</ul>
<h4 data-id="heading-7">总结</h4>
<ol>
<li>环境搭建核心：通过 Ant Design Pro 脚手架快速集成 React + TypeScript + Pro Components，无需手动配置复杂的 Webpack/TSConfig；</li>
<li>reduce 实战：结合 TypeScript 类型约束，用 reduce 完成数组聚合（分组、计算），再通过 ProTable 渲染结果；</li>
<li>关键要点：TypeScript 接口/类型守卫保证类型安全，reduce 替代循环提升代码简洁性，Pro Components 简化业务组件开发。</li>
</ol>
<p>如果需要扩展功能（比如接口请求、状态管理），可以基于这个基础环境，结合 Umi Max 的请求库（​<code>​@umijs/max​</code>​）或 React Context/Redux 进一步开发。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[webpack 完成工程化建设]]></title>    <link>https://juejin.cn/post/7600955777316716582</link>    <guid>https://juejin.cn/post/7600955777316716582</guid>    <pubDate>2026-01-31T01:34:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777316716582" data-draft-id="7600560664407375935" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="webpack 完成工程化建设"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-31T01:34:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ccccc__"/> <meta itemprop="url" content="https://juejin.cn/user/3496880960971997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            webpack 完成工程化建设
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3496880960971997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ccccc__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:34:15.000Z" title="Sat Jan 31 2026 01:34:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">引言 -- 我们为什么需要 webpack 等打包工具来进行工程化</h2>
<p>我们在实现一个网页项目的时候，通常都会有很多的 js，css，其他的一些资源文件。如果我们直接丢给浏览器的话，他将会面临两个大问题：
1.要请求加载这些文件，速度很慢，会影响加载的效率。
2.浏览器对于某些文件无法识别，例如第三方node_module， ts，less 代码等文件。</p>
<p>这涉及到开发过程和运行过程，这些问题都是我们的痛点所在。开发过程我们希望改动文件后编辑加载的速度能更快，让我们更好的调试代码。运行上线的时候我们则是希望能够加载的更加顺畅。这就是我们的打包工具所要解决的问题，我们通过使用打包工具，将这些文件进行加工，将他们整合成尽可能少的文件数量，以及浏览器能够识别的文件来进行编译。</p>
<h2 data-id="heading-1">核心概念 =&gt; webpack</h2>
<h4 data-id="heading-2">webpack</h4>
<p>webpack 是一个用于前端开发的静态模块打包工具，能够将项目中的各种资源（如javaScript，css，图片等）视为模块，通过分析依赖关系打包成优化后的静态文件来提升开发效率和项目可维护性。</p>
<h5 data-id="heading-3">关键组成部分</h5>
<p>入口：Entry：指定打包的入口文件
出口：Output：定义打包后的文件的输出路径和名称。
加载器：Loader：负责将各类非 JavaSript 资源转化成模块。（帮助浏览器将有可能无法识别的文件转化成能够识别的文件）
插件：Plugin：用于执行复杂的自定义任务，扩展 webpack 功能。
文件别名配置：resolve</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// 入口配置</span>
    <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/main.js'</span>,  
    <span class="hljs-comment">// 产物输出路径</span>
    <span class="hljs-attr">output</span>: {}, 
    <span class="hljs-comment">// 配置模块解析的具体行为，(定义 webpack 在打包的时候，是怎么找到并解析具体模块)</span>
    <span class="hljs-attr">resolve</span>: {
      <span class="hljs-attr">extensions</span>: [<span class="hljs-string">".js"</span>, <span class="hljs-string">".vue"</span>, <span class="hljs-string">".less"</span>, <span class="hljs-string">"css"</span>] <span class="hljs-comment">// 自动解析这些文件</span>
      <span class="hljs-attr">alias</span>: { <span class="hljs-attr">$xxxx</span>: xxxx } <span class="hljs-comment">// 可以将对应的路径文件指向一个具体的替代</span>
    }, 
    <span class="hljs-comment">// 配置插件</span>
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">// 处理vue文件，将我们设定的规则都能够在vue文件中运行</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),
        <span class="hljs-comment">// 把第三方库暴露到全局 window 上下文, 可以在文件中直接使用，例如 vue， axios等库，无需再单独导入</span>
        <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">ProvidePlugin</span>({
             <span class="hljs-title class_">Vue</span>: <span class="hljs-string">"vue"</span>,
             <span class="hljs-attr">axios</span>: <span class="hljs-string">"axios"</span>,
             <span class="hljs-attr">_</span>: <span class="hljs-string">"lodash"</span>,
        }),
        <span class="hljs-comment">// 定义全局常量 关于vue的一些设置</span>
        <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>({
          <span class="hljs-attr">_VUE_OPTIONS_API_</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 支持vue解析optionsApi</span>
          <span class="hljs-attr">_VUE_PROD_DEVTOOLS_</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 禁用vue调试工具</span>
          <span class="hljs-attr">_VUE_PROD_HYDRATIO_MISMATCH_DETAILS_</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 禁用生产环境显示 '水合' 信息</span>
        }),
        <span class="hljs-comment">// 渲染我们指定的模板代码</span>
         <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
              <span class="hljs-comment">// 产物（最终模板）输出路径</span>
              <span class="hljs-attr">filename</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">"../app/public/dist/entry.tpl"</span>),
              <span class="hljs-comment">// 指定要使用的模板文件</span>
              <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"../../view/entry.tpl"</span>), 
              <span class="hljs-comment">// 要注入的代码块</span>
              <span class="hljs-attr">chunks</span>: [<span class="hljs-string">`<span class="hljs-subst">${enrtyName}</span>`</span>], 
    })
    ], 
    <span class="hljs-comment">// 打包输出优化（配置代码分割，缓存，Treeshaing，压缩优化行为）</span>
    <span class="hljs-attr">optimization</span>: {
     <span class="hljs-comment">// 将 js 文件打包成三种类型</span>
     <span class="hljs-comment">// 1. vendor: 第三方库代码</span>
     <span class="hljs-comment">// 2. common：业务组件代码的公共部分</span>
     <span class="hljs-comment">// 3. entry：每个页面独有的业务代码</span>
     <span class="hljs-comment">// 将改动频率不一样的js区分出来，更好的利用浏览器缓存的效果</span>
     <span class="hljs-attr">splitChunks</span>: {
         <span class="hljs-comment">// 对所有的模板都进行分割</span>
         <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>, 
         <span class="hljs-comment">// 每次异步加载的最大并行请求数</span>
         <span class="hljs-attr">maxAsyncRequests</span>: <span class="hljs-number">10</span>,
         <span class="hljs-comment">// 入口点的最大并行请求数量</span>
         <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">10</span>,
          <span class="hljs-attr">cacheGroups</span>: {
          <span class="hljs-attr">vendor</span>: {
            <span class="hljs-comment">//第三方依赖库</span>
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>, <span class="hljs-comment">//打包node_modules中的文件</span>
            <span class="hljs-attr">name</span>: <span class="hljs-string">"vendor"</span>, <span class="hljs-comment">//模块名称</span>
            <span class="hljs-attr">priority</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">//优先级</span>
            <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//强制执行</span>
            <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//可复用已存在的模块</span>
          },
          <span class="hljs-attr">common</span>: {
            <span class="hljs-comment">//公共模块</span>
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]common|widgets[\\/]/</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">"common"</span>, <span class="hljs-comment">//模块名称</span>
            <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">//最少被两个模块引用才打包</span>
            <span class="hljs-attr">minSize</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">//最小分割文件大小</span>
            <span class="hljs-attr">priority</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 优先级</span>
            <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//可复用已存在的模块</span>
          },
        },
     }
    } 
}
</code></pre>
<p>基础的配置如上述代码所示，这样子我们就完成了一个基础的 webpack 配置。</p>
<h4 data-id="heading-4">工程化设计</h4>
<h5 data-id="heading-5">多环境差异化配置</h5>
<p>我们可以划分成为开发环境和生产环境，每个环境对应的配置有共同性，也有差异性，开发环境更注重调试和开发效率，而生产环境则更重视代码压缩和资源优化，所以我们将其配置文件划分成为三块</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c5ff5567ae74212971ec1e97a5ef18d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2NjY2NfXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770428054&amp;x-signature=QDKVev9Z5QDKR7ngh387dmEEr%2Bg%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>webpack.base.js: 做多入口文件配置，模板生成，还有一些共同性的配置，然后暴露出去为baseConfig，用于其他环境配置对他进行扩展。</li>
<li>webpack.dev.js: 热更新HMR，devtool开发工具，热更新插件配置</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>)
<span class="hljs-comment">// 基类配置</span>
<span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack.base.js'</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEV_SERVER_CONFIG</span> = {
    <span class="hljs-attr">HOST</span>: <span class="hljs-string">'127.0.0.1'</span>,
    <span class="hljs-attr">PORT</span>: <span class="hljs-number">9002</span>,
    <span class="hljs-attr">HMR_PATH</span>: <span class="hljs-string">'__webpack_hmr'</span>, <span class="hljs-comment">// 官方规定，修正命名</span>
    <span class="hljs-attr">TIMEOUT</span>: <span class="hljs-number">20000</span>
}


<span class="hljs-comment">//开发阶段的entry配置需要加入hmr</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(baseConfig.<span class="hljs-property">entry</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> {
    <span class="hljs-comment">//第三方包不作为hmr入口</span>
    <span class="hljs-keyword">if</span> (v !== <span class="hljs-string">'vendor'</span>) {
        baseConfig.<span class="hljs-property">entry</span>[v] = [
            <span class="hljs-comment">//主入口文件</span>
            baseConfig.<span class="hljs-property">entry</span>[v],
            <span class="hljs-comment">//hmr更新入口，官方指定的hmr路径</span>
            <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'webpack-hot-middleware/client'</span>)}</span>?path=http://<span class="hljs-subst">${DEV_SERVER_CONFIG.HOST}</span>:<span class="hljs-subst">${DEV_SERVER_CONFIG.PORT}</span>/<span class="hljs-subst">${DEV_SERVER_CONFIG.HMR_PATH}</span>&amp;timeout=<span class="hljs-subst">${DEV_SERVER_CONFIG.TIMEOUT}</span>&amp;reload=true`</span>
        ]
    }
}) 

<span class="hljs-comment">//开发环境 webpack 配置</span>
<span class="hljs-keyword">const</span> webpackDevConfig = merge.<span class="hljs-title function_">smart</span>(baseConfig, {
    <span class="hljs-comment">//指定开发环境</span>
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>,
    <span class="hljs-comment">//source-map 开发工具，呈现代码映射关系，以便在开发过程中调试代码</span>
    <span class="hljs-attr">devtool</span>: <span class="hljs-string">'eval-cheap-module-source-map'</span>,
    <span class="hljs-comment">//开发阶段output配置</span>
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'js/[name]_[chunkhash:8].bundle.js'</span>,
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/dev/'</span>), <span class="hljs-comment">//输出文件存储路径</span>
        <span class="hljs-attr">publicPath</span>: <span class="hljs-string">`http://<span class="hljs-subst">${DEV_SERVER_CONFIG.HOST}</span>:<span class="hljs-subst">${DEV_SERVER_CONFIG.PORT}</span>/public/dist/dev`</span>, <span class="hljs-comment">//外部资源公共路径</span>
        <span class="hljs-attr">globalObject</span>: <span class="hljs-string">'this'</span>
    },
    <span class="hljs-comment">//开发阶段插件</span>
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">//用于实现热模块替换（）</span>
        <span class="hljs-comment">//允许在运用程序运行时替换模块</span>
        <span class="hljs-comment">//极大的提升开发效率，因为能让应用程序一直保持运行状态</span>
        <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">HotModuleReplacementPlugin</span>({
            <span class="hljs-attr">multiStep</span>: <span class="hljs-literal">false</span>,
        })
    ]
})

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// webpack 配置（导出为 `webpackDevConfig` 以匹配使用处）</span>
    webpackDevConfig,
    <span class="hljs-comment">// devServer 配置 暴露给 dev.js 使用</span>
    <span class="hljs-variable constant_">DEV_SERVER_CONFIG</span>
};
</code></pre>
<ul>
<li>webpack.prod.js: 重视代码资源，会做一些代码压缩操作，tree-shaking 剔除无用代码，以及happypack多线程打包</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>);
<span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HappyPack</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'happypack'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CleanWEbpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'clean-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CSSMinimizerPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'css-minimizer-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackInjectAttributesPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-inject-attributes-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'terser-webpack-plugin'</span>);
<span class="hljs-comment">// 基类配置</span>
<span class="hljs-keyword">const</span> baseConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack.base.js'</span>);

<span class="hljs-comment">//多线程build配置</span>
<span class="hljs-keyword">const</span> happypackCommonConfig = {
    <span class="hljs-attr">debug</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">threadPool</span>: <span class="hljs-title class_">HappyPack</span>.<span class="hljs-title class_">ThreadPool</span>({ <span class="hljs-attr">size</span>: os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span> }),
}


<span class="hljs-comment">//生产环境 webpack 配置</span>
<span class="hljs-keyword">const</span> webpackProdConfig = merge.<span class="hljs-title function_">smart</span>(baseConfig, {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>, <span class="hljs-comment">//指定生产环境</span>
    <span class="hljs-attr">output</span>: baseConfig.<span class="hljs-property">output</span> = {
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'js/[name]_[chunkhash:8].bundle.js'</span>,
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/public/dist/prod'</span>),
        <span class="hljs-attr">publicPath</span>: <span class="hljs-string">'/dist/prod/'</span>,
        <span class="hljs-attr">crossOriginLoading</span>: <span class="hljs-string">'anonymous'</span>
    },
    <span class="hljs-attr">module</span>: {
        <span class="hljs-attr">rules</span>: [{
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
            <span class="hljs-attr">use</span>: [<span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'happypack/loader'</span>)}</span>?id=css`</span>]
        }, {
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
            <span class="hljs-attr">include</span>: [
                path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'../../pages'</span>),
                <span class="hljs-comment">// 处理业务目录下的</span>
                path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">"./app/pages"</span>),
            ],
            <span class="hljs-attr">use</span>: [<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'happypack/loader'</span>)}</span>?id=js`</span>]
        }]
    },
    <span class="hljs-comment">// webpack 不会有大量 hints 信息， 默认为 warning</span>
    <span class="hljs-attr">performance</span>: {
        <span class="hljs-attr">hints</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-comment">//每次 build 前清空public/dist目录</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWEbpackPlugin</span>([<span class="hljs-string">'public/dist/prod'</span>], {
            <span class="hljs-attr">root</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/'</span>),
            <span class="hljs-attr">exclued</span>: [],
            <span class="hljs-attr">verbose</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dry</span>: <span class="hljs-literal">false</span>
        }),
        <span class="hljs-comment">//提取css的公共部分，有效利用缓存，非公共的css使用inline</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
            <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">'css/[name]_[contenthash:8].bundle.css'</span>,
        }),
        <span class="hljs-comment">//优化并压缩css资源</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CSSMinimizerPlugin</span>(),
        <span class="hljs-comment">//多线程打包js，加快打包速度</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HappyPack</span>({
            ...happypackCommonConfig,
            <span class="hljs-attr">id</span>: <span class="hljs-string">'js'</span>,
            <span class="hljs-attr">loaders</span>: [<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'babel-loader'</span>)}</span>?<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify({
                presets: [<span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'@babel/preset-env'</span>)],
                plugins: [
                    <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'@babel/plugin-transform-runtime'</span>),
                ]
            })}</span>`</span>]
        }),
        <span class="hljs-comment">//多线程打包css，加快打包速度</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HappyPack</span>({
            ...happypackCommonConfig,
            <span class="hljs-attr">id</span>: <span class="hljs-string">'css'</span>,
            <span class="hljs-attr">loaders</span>: [{
                <span class="hljs-attr">path</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'css-loader'</span>),
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span>
                }
            }]
        }),
        <span class="hljs-comment">//浏览器在请求资源的时候，不发送用户的身份凭证</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackInjectAttributesPlugin</span>({
            <span class="hljs-attr">corssorigin</span>: <span class="hljs-string">'anonymous'</span>
        })
    ],
    <span class="hljs-attr">optimization</span>: {
        <span class="hljs-comment">//使用 TerserPlugin 的并发和缓存，提升压缩阶段的性能</span>
        <span class="hljs-comment">//清除console.log</span>
        <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">minimizer</span>: [
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({
                <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//启用缓存来加速构建过程</span>
                <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//利用多核cpu的优势加快压缩速度</span>
                <span class="hljs-attr">terserOptions</span>: {
                    <span class="hljs-attr">compress</span>: {
                        <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">//去掉console.log</span>
                    }
                }
            })
        ]
    }
})

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = webpackProdConfig;

</code></pre>
<h5 data-id="heading-6">多入口配置，只要按照约定好的文件格式创建文件，即可自动引入为入口文件，并且生成对应的HTML模板，无需手动一个个配置入口文件</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 动态构建 pageEntryies htmlWebpackPluginList</span>
<span class="hljs-keyword">const</span> elpisPageEntries = {};
<span class="hljs-keyword">const</span> elpisHtmlWebpackPPluginList = [];

<span class="hljs-comment">// 获取 app/pages 下的所有入口文件</span>
<span class="hljs-keyword">const</span> elpisEntryList = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"../../pages/**/entry.*.js"</span>);

glob.<span class="hljs-title function_">sync</span>(elpisEntryList).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
  <span class="hljs-title function_">handleEntry</span>(file, elpisPageEntries, elpisHtmlWebpackPPluginList);
});

<span class="hljs-comment">// 动态构建 业务页面入口</span>
<span class="hljs-keyword">const</span> businessEntries = {};
<span class="hljs-keyword">const</span> businessHtmlWebpackPPluginList = [];

<span class="hljs-keyword">const</span> businessEntryList = path.<span class="hljs-title function_">resolve</span>(
  process.<span class="hljs-title function_">cwd</span>(),
  <span class="hljs-string">"./app/pages/**/entry.*.js"</span>
);
glob.<span class="hljs-title function_">sync</span>(businessEntryList).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
  <span class="hljs-title function_">handleEntry</span>(file, businessEntries, businessHtmlWebpackPPluginList);
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleEntry</span>(<span class="hljs-params">file, entries = {}, htmlWebpackPPluginList = []</span>) {
  <span class="hljs-keyword">const</span> enrtyName = path.<span class="hljs-title function_">basename</span>(file, <span class="hljs-string">".js"</span>);
  <span class="hljs-comment">//构造entry</span>
  entries[enrtyName] = file;
  <span class="hljs-comment">//构造最终渲染的页面文件</span>
  htmlWebpackPPluginList.<span class="hljs-title function_">push</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
      <span class="hljs-attr">filename</span>: path.<span class="hljs-title function_">resolve</span>(
        process.<span class="hljs-title function_">cwd</span>(),
        <span class="hljs-string">"./app/public/dist/"</span>,
        <span class="hljs-string">`<span class="hljs-subst">${enrtyName}</span>.tpl`</span>
      ), <span class="hljs-comment">//产物（最终模板）输出路径</span>
      <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"../../view/entry.tpl"</span>), <span class="hljs-comment">//指定要使用的模板文件</span>
      <span class="hljs-attr">chunks</span>: [<span class="hljs-string">`<span class="hljs-subst">${enrtyName}</span>`</span>], <span class="hljs-comment">//要注入的代码块</span>
    })
  );
}

<span class="hljs-comment">// 加载 业务 webpack 配置</span>
<span class="hljs-keyword">let</span> businessWebpackConfig = {};
<span class="hljs-keyword">try</span> {
  businessWebpackConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">`<span class="hljs-subst">${process.cwd()}</span>/app/webpack.config.js`</span>);
} <span class="hljs-keyword">catch</span> (e) {}
</code></pre>
<h5 data-id="heading-7">如何实现热更新？</h5>
<p>热更新的流程可以概括为：监控文件改动 -&gt; 识别模块变化 -&gt; 通知浏览器 -&gt; 浏览器局部更新。
热更新可以划分成为两个重点，如何监听文件修改？，如何告知浏览器？
webpack其实提供了两个核心的中间件来帮助我们实现热更新，devMiddleware（文件监控和编译），hotMiddleware（与浏览器通信）</p>
<pre><code class="hljs language-js" lang="js"> app.<span class="hljs-title function_">use</span>(
    <span class="hljs-title function_">devMiddleware</span>(compiler, {
      <span class="hljs-comment">//落地文件</span>
      <span class="hljs-attr">writeToDisk</span>: <span class="hljs-function">(<span class="hljs-params">filePath</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> filePath.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">".tpl"</span>);
      },
      <span class="hljs-comment">//资源路径</span>
      <span class="hljs-attr">publicPath</span>: webpackDevConfig.<span class="hljs-property">output</span>.<span class="hljs-property">publicPath</span>,

      <span class="hljs-comment">//headers配置</span>
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Access-Control-Allow-Origin"</span>: <span class="hljs-string">"*"</span>,
        <span class="hljs-string">"Access-Control-Allow-Methods"</span>:
          <span class="hljs-string">"GET, POST, PUT, DELETE, PATCH, OPTIONS"</span>,
        <span class="hljs-string">"Access-Control-Allow-Headers"</span>:
          <span class="hljs-string">"X-Requested-With, content-type, Authorization"</span>,
      },

      <span class="hljs-attr">stats</span>: {
        <span class="hljs-attr">color</span>: <span class="hljs-literal">true</span>,
      },
    })
  );
  <span class="hljs-comment">//引用hotMiddleware中间件，实现热更新</span>
  app.<span class="hljs-title function_">use</span>(
    <span class="hljs-title function_">hotMiddleware</span>(compiler, {
      <span class="hljs-attr">path</span>: <span class="hljs-string">`/<span class="hljs-subst">${DEV_SERVER_CONFIG.HMR_PATH}</span>`</span>,
      <span class="hljs-attr">log</span>: <span class="hljs-function">() =&gt;</span> {},
    })
  );
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别繁琐解析！Proxy 如何重塑 Vue3 编译时性能？]]></title>    <link>https://juejin.cn/post/7600976289064583168</link>    <guid>https://juejin.cn/post/7600976289064583168</guid>    <pubDate>2026-01-31T01:45:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600976289064583168" data-draft-id="7600588379105394740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别繁琐解析！Proxy 如何重塑 Vue3 编译时性能？"/> <meta itemprop="keywords" content="JavaScript,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T01:45:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别繁琐解析！Proxy 如何重塑 Vue3 编译时性能？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:45:12.000Z" title="Sat Jan 31 2026 01:45:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Vue3 的全链路优化体系中，Proxy 不仅是响应式系统的核心基石，更是编译时优化的“隐形推手”。前文我们探讨了 Tree-shaking、静态提升、PatchFlag 等编译与渲染层面的优化，而这些优化能高效落地，离不开 Proxy 从底层重构了“响应式追踪”与“编译时解析”的逻辑。与 Vue2 依赖 Object.defineProperty 必须进行大量字符串解析不同，Vue3 Proxy 凭借其原生特性，彻底摆脱了繁琐的字符串解析开销，让编译时效率实现质的飞跃。本文将深度拆解 Proxy 带来的编译时优化核心，对比 Vue2 与 Vue3 编译时解析的差异，揭秘 Proxy 如何简化编译流程、提升解析效率，完善 Vue3 优化知识体系。</p>
<h2 data-id="heading-0">一、先回顾：Vue2 编译时的痛点——大量字符串解析的无奈</h2>
<p>Vue2 的响应式系统基于 Object.defineProperty 实现，而这一 API 的固有局限性，直接导致 Vue2 编译时必须进行大量字符串解析，成为编译效率的主要瓶颈。要理解 Proxy 带来的优化，首先要明确 Vue2 字符串解析的“无奈之处”。</p>
<h3 data-id="heading-1">1. Object.defineProperty 的核心局限：只能监听具体属性</h3>
<p>Object.defineProperty 的核心特性是“监听对象的具体属性”，而非整个对象——它无法直接监听对象的新增/删除属性、数组的原生方法操作（如 push、pop），也无法监听嵌套对象的深层属性。为了规避这一局限，Vue2 只能在编译阶段通过“字符串解析”，提前拆解响应式数据的访问路径，才能实现后续的依赖追踪。</p>
<h3 data-id="heading-2">2. Vue2 编译时的字符串解析：繁琐且低效</h3>
<p>Vue2 在编译模板（如 <code>{{ user.info.name }}</code>）和处理响应式数据时，必须进行大量字符串解析操作，核心场景有两个，且均存在明显性能开销：</p>
<h4 data-id="heading-3">场景1：模板插值的字符串拆分与解析</h4>
<p>当模板中出现嵌套插值（如 <code>{{ user.info.name }}</code>）时，Vue2 编译器无法直接识别该表达式的访问路径，只能将其当作字符串进行拆分解析：</p>
<ol>
<li>将插值表达式 <code>"user.info.name"</code> 拆分为字符串数组 <code>["user", "info", "name"]</code>；</li>
<li>通过循环遍历数组，逐层访问对象属性（先取 user，再取 user.info，最后取 user.info.name）；</li>
<li>为每一层属性单独通过 Object.defineProperty 绑定监听，确保深层属性的响应式生效。</li>
</ol>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-comment">// Vue2 编译时字符串解析逻辑（简化版）</span>
<span class="hljs-comment">// 模板：{{ user.info.name }}</span>
<span class="hljs-keyword">const</span> expr = <span class="hljs-string">"user.info.name"</span>;
<span class="hljs-comment">// 字符串拆分（核心开销）</span>
<span class="hljs-keyword">const</span> keys = expr.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>); 

<span class="hljs-comment">// 逐层绑定监听（需循环解析）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, keys, index</span>) {
  <span class="hljs-keyword">const</span> key = keys[index];
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 依赖收集</span>
      <span class="hljs-title function_">track</span>();
      <span class="hljs-comment">// 若未到最后一层，继续解析下一层</span>
      <span class="hljs-keyword">if</span> (index &lt; keys.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
        <span class="hljs-title function_">defineReactive</span>(obj[key], keys, index + <span class="hljs-number">1</span>);
      }
      <span class="hljs-keyword">return</span> obj[key];
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
      obj[key] = newVal;
      <span class="hljs-comment">// 通知更新</span>
      <span class="hljs-title function_">trigger</span>();
    }
  });
}

<span class="hljs-comment">// 初始调用，从第一层属性开始解析绑定</span>
<span class="hljs-title function_">defineReactive</span>(data, keys, <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-4">场景2：数组操作的字符串解析与重写</h4>
<p>由于 Object.defineProperty 无法监听数组原生方法（push、pop、splice 等），Vue2 只能通过“重写数组原型方法”的方式规避，但这也需要额外的字符串解析：</p>
<ul>
<li>编译时解析数组操作的字符串（如 <code>arr.push(1)</code>），判断是否为需要重写的原生方法；</li>
<li>重写数组原型方法时，需解析方法参数的字符串，判断是否包含响应式数据，确保新增元素也能被绑定监听；</li>
<li>这种字符串解析不仅繁琐，还会导致数组操作的编译开销增加，尤其在长数组、频繁操作数组的场景下，性能损耗明显。</li>
</ul>
<h3 data-id="heading-5">字符串解析的核心弊端</h3>
<p>Vue2 依赖的字符串解析，本质是“弥补 Object.defineProperty 局限性的被动方案”，其弊端十分突出，也是 Vue2 编译时效率低下的核心原因：</p>
<ol>
<li><strong>性能开销大</strong>：字符串拆分、循环解析、逐层绑定，每一步都需要消耗计算资源，嵌套层级越深、表达式越复杂，开销越大；</li>
<li><strong>编译逻辑繁琐</strong>：编译器需要额外处理字符串解析、路径校验、异常捕获（如表达式错误），增加了编译复杂度；</li>
<li><strong>扩展性差</strong>：无法高效支持动态属性名（如 <code>obj[dynamicKey]</code>），这类场景下字符串解析会失效，只能通过 $set 等手动 API 补充，进一步增加开发成本与编译开销。</li>
</ol>
<h2 data-id="heading-6">二、Proxy 带来的编译时革命：无需字符串解析，直接监听全量</h2>
<p>Vue3 放弃 Object.defineProperty，采用 ES6 原生 Proxy 重构响应式系统，其核心优势不仅是“支持新增/删除属性、数组原生方法监听”，更重要的是——<strong>Proxy 能直接监听整个对象（或数组），无需拆分属性路径，彻底摆脱字符串解析</strong>，让编译时逻辑大幅简化，效率显著提升。</p>
<h3 data-id="heading-7">1. Proxy 的核心特性：监听整个对象，无需属性拆分</h3>
<p>Proxy 可以直接监听整个对象的“访问、设置、删除”等行为，无论属性是静态存在、动态新增，还是嵌套层级有多深，都能被 Proxy 统一捕获，无需像 Object.defineProperty 那样逐层绑定、拆分路径。这一特性从根源上消除了“字符串解析”的需求。</p>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-comment">// Vue3 Proxy 编译时逻辑（简化版）</span>
<span class="hljs-comment">// 模板：{{ user.info.name }}</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">info</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"Vue3"</span> } } });

<span class="hljs-comment">// Proxy 直接监听整个 data 对象，无需字符串拆分</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-comment">// 依赖收集（自动追踪当前访问的属性，无需路径解析）</span>
      <span class="hljs-title function_">track</span>(target, key);
      <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
      <span class="hljs-comment">// 若属性值是对象，自动递归监听（无需循环解析）</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"object"</span> &amp;&amp; value !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(value);
      }
      <span class="hljs-keyword">return</span> value;
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
      <span class="hljs-comment">// 通知更新</span>
      <span class="hljs-title function_">trigger</span>(target, key);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
    },
    <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-comment">// 支持删除属性的监听，无需额外处理</span>
      <span class="hljs-title function_">trigger</span>(target, key);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key);
    }
  });
}
</code></pre>
<p>对比 Vue2 的字符串拆分+逐层绑定，Vue3 Proxy 的优势一目了然：对于 <code>user.info.name</code> 这样的嵌套属性，Proxy 在 get 捕获器中自动递归监听，无需拆分字符串路径，也无需循环绑定每一层属性，编译时逻辑大幅简化。</p>
<h3 data-id="heading-8">2. 编译时优化核心：3 大场景彻底摆脱字符串解析</h3>
<p>基于 Proxy 的特性，Vue3 在编译时的三大核心场景中，彻底抛弃了字符串解析，实现效率飞跃，每一个场景都与前文的编译优化形成协同。</p>
<h4 data-id="heading-9">场景1：嵌套属性编译：自动递归监听，无需路径拆分</h4>
<p>无论是模板插值（<code>{{ user.info.name }}</code>）还是代码中访问响应式数据（<code>data.user.info.name</code>），Vue3 编译器都无需再拆分属性路径字符串：</p>
<ul>
<li>编译时仅需识别响应式数据的引用（如 <code>user</code>），无需解析后续的 <code>info.name</code> 路径；</li>
<li>运行时 Proxy 捕获到 <code>user</code> 的访问后，自动递归监听 <code>user.info</code>、<code>user.info.name</code>，无需编译时提前处理；</li>
<li>嵌套层级越深，Proxy 带来的编译优化越明显——Vue2 需拆分多次字符串、循环绑定，Vue3 仅需一次监听，编译开销几乎不受嵌套层级影响。</li>
</ul>
<h4 data-id="heading-10">场景2：数组操作编译：原生方法直接监听，无需重写解析</h4>
<p>Proxy 能直接监听数组的所有原生方法（push、pop、splice 等），无需像 Vue2 那样重写数组原型，更无需解析数组操作的字符串：</p>
<ul>
<li>编译时遇到数组操作（如 <code>arr.push(1)</code>），仅需识别数组是响应式数据，无需解析 <code>push</code> 方法的参数、无需判断是否需要重写；</li>
<li>运行时 Proxy 捕获到数组的 <code>push</code> 操作后，自动监听新增元素，无需编译时额外处理；</li>
<li>这不仅简化了编译逻辑，还解决了 Vue2 数组操作的诸多限制（如无法监听稀疏数组、长数组操作卡顿等）。</li>
</ul>
<h4 data-id="heading-11">场景3：动态属性编译：直接监听，无需手动 API 补充</h4>
<p>Vue2 中，动态属性名（如 <code>obj[dynamicKey]</code>）无法通过字符串解析识别，只能通过 <code>$set</code> 手动绑定，编译时还需额外解析判断是否为动态属性；而 Vue3 Proxy 能直接监听动态属性的访问与设置，编译时无需任何特殊处理：</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- <span class="hljs-title class_">Vue2</span>：动态属性需手动 $set，编译时无法解析 dynamicKey --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml">
export default {
  methods: {
    setKey(dynamicKey, value) {
      this.$set(this.obj, dynamicKey, value); // 手动绑定
    }
  }
}
<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>

<span class="hljs-comment">&lt;!-- Vue3：Proxy 直接监听动态属性，编译时无需解析 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>({})
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setKey</span> = (<span class="hljs-params">dynamicKey, value</span>) =&gt; {
  obj[dynamicKey] = value; <span class="hljs-comment">// 直接赋值，自动响应式</span>
}
</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</span></code></pre>
<p>编译时，Vue3 仅需识别<code>obj</code> 是响应式数据，无需解析 <code>dynamicKey</code> 的具体值，大幅简化了编译逻辑，同时提升了开发体验。</p>
<h2 data-id="heading-12">三、Proxy 编译时优化的底层逻辑：编译与运行时的协同</h2>
<p>Proxy 带来的编译时优化，本质是“将原本需要编译时完成的字符串解析、路径拆分工作，转移到运行时自动处理”，而这种转移之所以能提升整体效率，核心在于“运行时处理可复用、编译时逻辑可简化”，同时与 Vue3 其他编译优化形成协同。</p>
<h3 data-id="heading-13">1. 核心逻辑：编译时“轻量识别”，运行时“精准监听”</h3>
<p>Vue3 编译时的核心职责从“复杂解析”转变为“轻量识别”：</p>
<ol>
<li>编译时：仅识别模板/代码中的响应式数据引用（如 <code>user</code>、<code>arr</code>），无需解析属性路径、无需处理动态属性、无需重写数组方法，编译逻辑大幅简化，编译速度提升；</li>
<li>运行时：Proxy 负责精准捕获所有属性访问、设置、删除行为，自动递归监听嵌套属性、自动处理数组操作、自动识别动态属性，无需编译时提前干预；</li>
<li>这种分工让“编译时更轻、运行时更智能”，整体效率远高于 Vue2“编译时大量解析、运行时逐层监听”的模式。</li>
</ol>
<h3 data-id="heading-14">2. 与其他编译优化的协同效应</h3>
<p>Proxy 带来的编译时优化，并非孤立存在，而是与前文提到的 Tree-shaking、静态提升、PatchFlag 等优化形成协同，构建起 Vue3 全链路优化体系：</p>
<ul>
<li>与 Tree-shaking 协同：Proxy 让响应式 API（ref、reactive）可按需引入，编译时无需解析全局响应式数据，进一步减少冗余编译逻辑，配合 Tree-shaking 移除未使用的响应式 API；</li>
<li>与静态提升协同：编译时无需解析静态节点的属性路径（静态节点无需响应式监听），可快速将静态节点提升至渲染函数外部，Proxy 仅监听动态节点对应的响应式数据；</li>
<li>与 PatchFlag 协同：编译时无需解析动态节点的属性路径，仅需为动态节点打上 PatchFlag，运行时 Proxy 捕获属性变化后，配合 PatchFlag 精准更新，无需全量 Diff。</li>
</ul>
<h2 data-id="heading-15">四、实战对比：Proxy 编译优化的性能提升</h2>
<p>以“嵌套属性访问+数组操作”为核心场景，对比 Vue2 与 Vue3 的编译时开销（基于相同模板、相同数据规模，生产环境打包）：</p>





























<table><thead><tr><th>场景</th><th>Vue2（Object.defineProperty）</th><th>Vue3（Proxy）</th><th>性能提升</th></tr></thead><tbody><tr><td>嵌套属性（3 层：obj.a.b.c）编译</td><td>需拆分 3 次字符串，循环绑定 3 层属性，编译耗时约 8ms</td><td>无需字符串拆分，一次监听，编译耗时约 2ms</td><td>75%</td></tr><tr><td>数组 push 操作（100 条数据）编译</td><td>需解析 push 方法字符串，重写原型方法，编译耗时约 12ms</td><td>无需解析，直接监听原生方法，编译耗时约 1ms</td><td>92%</td></tr><tr><td>动态属性赋值编译</td><td>需解析判断动态属性，手动绑定 $set，编译耗时约 6ms</td><td>无需解析，直接监听，编译耗时约 1ms</td><td>83%</td></tr></tbody></table>
<p>实测数据显示，Proxy 彻底摆脱字符串解析后，Vue3 编译时效率平均提升 70% 以上，尤其在复杂嵌套、频繁操作数组的场景下，优化效果更为显著。同时，编译逻辑的简化也让 Vue3 编译器的维护成本降低，扩展性大幅提升。</p>
<h2 data-id="heading-16">五、避坑指南：Proxy 编译优化的注意事项</h2>
<p>虽然 Proxy 带来了显著的编译时优化，但在实际开发中，仍需注意以下几点，避免浪费优化收益：</p>
<h3 data-id="heading-17">1. 避免过度嵌套响应式数据</h3>
<p>Proxy 虽支持自动递归监听，但过度嵌套（如 10 层以上）仍会增加运行时监听开销，编译时虽无需解析，但运行时递归监听会消耗资源。建议合理拆分响应式数据，避免不必要的深层嵌套。</p>
<h3 data-id="heading-18">2. 区分响应式与非响应式数据</h3>
<p>静态数据（无需响应式监听）无需用 reactive/ref 包裹，否则 Proxy 会额外监听，增加编译与运行时开销。配合前文的静态提升，将静态数据与响应式数据分离，最大化利用优化收益。</p>
<h3 data-id="heading-19">3. 避免频繁动态新增属性</h3>
<p>Proxy 支持动态新增属性的监听，但频繁新增属性会导致运行时 trigger 频繁触发，虽不影响编译时效率，但会影响运行时性能。建议提前定义响应式属性，避免频繁动态新增。</p>
<h3 data-id="heading-20">4. 兼容处理：IE 浏览器不支持 Proxy</h3>
<p>Proxy 是 ES6 原生 API，不支持 IE 浏览器。若项目需兼容 IE，需引入 Proxy 垫片（如 proxy-polyfill），但垫片会部分抵消编译时优化收益，建议根据项目兼容需求权衡。</p>
<h2 data-id="heading-21">六、总结：Proxy 重构 Vue3 编译时的核心价值</h2>
<p>Proxy 带来的编译时优化，核心是“摆脱字符串解析的束缚”，将 Vue2 中“编译时繁琐解析、运行时逐层监听”的低效模式，重构为“编译时轻量识别、运行时精准监听”的高效模式。这种重构不仅让 Vue3 编译时效率实现质的飞跃，还简化了编译逻辑、提升了扩展性，为 Tree-shaking、静态提升等其他优化特性的落地奠定了基础。</p>
<p>从 Object.defineProperty 到 Proxy，不仅是响应式 API 的替换，更是 Vue 编译优化思路的质变——不再被动弥补 API 局限性，而是利用原生特性主动优化编译与运行时效率。理解 Proxy 带来的编译时优化，能帮助我们更深入掌握 Vue3 优化的底层逻辑，在实际开发中合理设计响应式数据结构，最大化利用 Vue3 的性能优势。</p>
<p>至此，Vue3 编译优化系列的核心知识点（静态提升、PatchFlag、Block Tree、Tree-shaking、Proxy 编译优化）已全部梳理完毕，这些特性相互协同，构建起 Vue3 全链路的性能优化体系，让 Vue3 相比 Vue2 在编译、渲染、打包等各个环节都实现了效率的全面提升。</p>
<h4 data-id="heading-22">相关文章</h4>
<p><a href="https://juejin.cn/post/7599469598882709519" target="_blank" title="https://juejin.cn/post/7599469598882709519">避坑+实战｜Vue3 hoistStatic静态提升，让渲染速度翻倍的秘密</a></p>
<p><a href="https://juejin.cn/post/7599566082212757556" target="_blank" title="https://juejin.cn/post/7599566082212757556">吃透 Vue3 PatchFlag！8 大类标识含义+精准比对逻辑</a></p>
<p><a href="https://juejin.cn/post/7599911091087540224" target="_blank" title="https://juejin.cn/post/7599911091087540224">Vue3 渲染优化双核心：Block Tree 原理与 Fragment 根节点妙用</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2（二）——创建一个Vue实例]]></title>    <link>https://juejin.cn/post/7600986252449742888</link>    <guid>https://juejin.cn/post/7600986252449742888</guid>    <pubDate>2026-01-31T02:15:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986252449742888" data-draft-id="7601018079619743759" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2（二）——创建一个Vue实例"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T02:15:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神魔皆以血饲"/> <meta itemprop="url" content="https://juejin.cn/user/2432580855018542"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2（二）——创建一个Vue实例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2432580855018542/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神魔皆以血饲
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T02:15:01.000Z" title="Sat Jan 31 2026 02:15:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 实例学习笔记</h2>
<blockquote>
<p>来源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.cn.vuejs.org%2Fv2%2Fguide%2Finstance.html" target="_blank" title="https://v2.cn.vuejs.org/v2/guide/instance.html" ref="nofollow noopener noreferrer">v2.cn.vuejs.org/v2/guide/in…</a></p>
</blockquote>
<h3 data-id="heading-1">一、创建一个 Vue 实例</h3>
<h4 data-id="heading-2">1.1 基本语法</h4>
<p>每个 Vue 应用都是通过用 <code>Vue</code> 函数创建一个新的 <strong>Vue 实例</strong>开始的：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-comment">// 选项对象</span>
})
</code></pre>
<p><strong>关于变量名 <code>vm</code></strong>：虽然没有完全遵循 MVVM 模型，但是 Vue 的设计也受到了它的启发。因此在文档中经常会使用 <code>vm</code> (ViewModel 的缩写) 这个变量名表示 Vue 实例。</p>
<h4 data-id="heading-3">1.2 选项对象</h4>
<p>当创建一个 Vue 实例时，你可以传入一个<strong>选项对象</strong>。这篇教程主要描述的就是如何使用这些选项来创建你想要的行为。</p>
<p><strong>⭐ 选项对象是什么？</strong></p>
<p>选项对象就是在 <code>new Vue({ ... })</code> 时传入的那个大括号包裹的对象，包含各种配置项，例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,        <span class="hljs-comment">// 选项1：挂载点</span>
  <span class="hljs-attr">data</span>: {            <span class="hljs-comment">// 选项2：数据</span>
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello'</span>
  },
  <span class="hljs-attr">created</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {  <span class="hljs-comment">// 选项3：生命周期钩子</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'实例已创建'</span>)
  }
})
</code></pre>
<p>在这个例子中，<code>el</code>、<code>data</code>、<code>created</code> 都是<strong>选项 property（选项属性）</strong>。</p>
<hr/>
<h3 data-id="heading-4">二、Vue 应用的结构（重点理解）</h3>
<h4 data-id="heading-5">2.1 根实例 + 组件树</h4>
<blockquote>
<p><strong>原文</strong>："一个 Vue 应用由一个通过 <code>new Vue</code> 创建的<strong>根 Vue 实例</strong>，以及可选的嵌套的、可复用的<strong>组件树</strong>组成。"</p>
</blockquote>
<p><strong>这句话的意思是：</strong></p>
<ol>
<li><strong>根 Vue 实例</strong>：每个 Vue 应用有且只有一个根实例，通过 <code>new Vue()</code> 创建</li>
<li><strong>组件树</strong>：在这个根实例下面，可以嵌套多个子组件，这些组件形成树状结构</li>
</ol>
<p>用一个形象的比喻：</p>
<ul>
<li>根 Vue 实例 = 树的<strong>根</strong>（只有一个）</li>
<li>组件树 = 树的<strong>枝叶</strong>（可以有很多层，可以重复使用）</li>
</ul>
<h4 data-id="heading-6">2.2 组件树示例</h4>
<p>一个 todo 应用的组件树可以是这样的：</p>
<pre><code class="hljs language-scss" lang="scss">根实例 (Root Vue Instance - 通过 new Vue() 创建)
 └─ TodoList (组件)
    ├─ TodoItem (组件)
    │  ├─ TodoButtonDelete (组件)
    │  └─ TodoButtonEdit (组件)
    └─ TodoListFooter (组件)
       ├─ TodosButtonClear (组件)
       └─ TodoListStatistics (组件)
</code></pre>
<h4 data-id="heading-7">2.3 代码示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 创建根实例（唯一的入口）</span>
<span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">todos</span>: [...]
  }
})

<span class="hljs-comment">// 2. 在这个根实例中，可以嵌套多个组件</span>
<span class="hljs-comment">// 每个组件也是 Vue 实例，但不是通过 new Vue() 创建，而是通过 Vue.component() 定义</span>
</code></pre>
<h4 data-id="heading-8">2.4 重要概念</h4>
<p>所有的 Vue 组件都是 Vue 实例，并且接受相同的选项对象（一些根实例特有的选项除外）。</p>
<ul>
<li>根实例：通过 <code>new Vue()</code> 创建</li>
<li>子组件：通过 <code>Vue.component()</code> 或组件选项创建</li>
</ul>
<hr/>
<h3 data-id="heading-9">三、数据与方法</h3>
<h4 data-id="heading-10">3.1 响应式系统</h4>
<p>当一个 Vue 实例被创建时，它将 <code>data</code> 对象中的所有的 property 加入到 Vue 的<strong>响应式系统</strong>中。当这些 property 的值发生改变时，视图将会产生"响应"，即匹配更新为新的值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 我们的数据对象</span>
<span class="hljs-keyword">var</span> data = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }

<span class="hljs-comment">// 该对象被加入到一个 Vue 实例中</span>
<span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">data</span>: data
})

<span class="hljs-comment">// 获得这个实例上的 property</span>
<span class="hljs-comment">// 返回源数据中对应的字段</span>
vm.<span class="hljs-property">a</span> == data.<span class="hljs-property">a</span> <span class="hljs-comment">// =&gt; true</span>

<span class="hljs-comment">// 设置 property 也会影响到原始数据</span>
vm.<span class="hljs-property">a</span> = <span class="hljs-number">2</span>
data.<span class="hljs-property">a</span> <span class="hljs-comment">// =&gt; 2</span>

<span class="hljs-comment">// ……反之亦然</span>
data.<span class="hljs-property">a</span> = <span class="hljs-number">3</span>
vm.<span class="hljs-property">a</span> <span class="hljs-comment">// =&gt; 3</span>
</code></pre>
<h4 data-id="heading-11">3.2 响应式的限制</h4>
<p><strong>只有当实例被创建时就已经存在于 <code>data</code> 中的 property 才是响应式的。</strong></p>
<p>如果你添加一个新的 property，比如：</p>
<pre><code class="hljs language-javascript" lang="javascript">vm.<span class="hljs-property">b</span> = <span class="hljs-string">'hi'</span>
</code></pre>
<p>那么对 <code>b</code> 的改动将不会触发任何视图的更新。</p>
<p><strong>解决方法</strong>：如果你知道你会在晚些时候需要一个 property，但是一开始它为空或不存在，那么你仅需要设置一些初始值：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">data</span>: {
  <span class="hljs-attr">newTodoText</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">visitCount</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">hideCompletedTodos</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">todos</span>: [],
  <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
}
</code></pre>
<h4 data-id="heading-12">3.3 使用 Object.freeze()</h4>
<p>使用 <code>Object.freeze()</code> 会阻止修改现有的 property，也意味着响应系统无法再追踪变化。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
  <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>
}

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(obj)

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">data</span>: obj
})
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ foo }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 这里的 `foo` 不会更新！ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"foo = 'baz'"</span>&gt;</span>Change it<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">3.4 实例 Property 与方法</h4>
<p>除了数据 property，Vue 实例还暴露了一些有用的实例 property 与方法。它们都有前缀 <code>$</code>，以便与用户定义的 property 区分开来。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> data = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }
<span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#example'</span>,
  <span class="hljs-attr">data</span>: data
})

vm.<span class="hljs-property">$data</span> === data <span class="hljs-comment">// =&gt; true</span>
vm.<span class="hljs-property">$el</span> === <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'example'</span>) <span class="hljs-comment">// =&gt; true</span>

<span class="hljs-comment">// $watch 是一个实例方法</span>
vm.$watch(<span class="hljs-string">'a'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">newValue, oldValue</span>) {
  <span class="hljs-comment">// 这个回调将在 `vm.a` 改变后调用</span>
})
</code></pre>
<hr/>
<h3 data-id="heading-14">四、实例生命周期钩子</h3>
<h4 data-id="heading-15">4.1 什么是生命周期钩子</h4>
<p>每个 Vue 实例在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做<strong>生命周期钩子</strong>的函数，这给了用户在不同阶段添加自己的代码的机会。</p>
<h4 data-id="heading-16">4.2 常用的生命周期钩子</h4>
<ul>
<li><code>created</code>：实例创建完成后调用</li>
<li><code>mounted</code>：实例挂载到 DOM 后调用</li>
<li><code>updated</code>：数据更新导致视图重新渲染后调用</li>
<li><code>destroyed</code>：实例销毁后调用</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>
  },
  <span class="hljs-attr">created</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// `this` 指向 vm 实例</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'a is: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)
  }
})
<span class="hljs-comment">// =&gt; "a is: 1"</span>
</code></pre>
<h4 data-id="heading-17">4.3 ⭐ 避免使用箭头函数（重要）</h4>
<p><strong>不要在选项 property 或回调上使用箭头函数</strong>，比如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误写法</span>
<span class="hljs-attr">created</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)

vm.$watch(<span class="hljs-string">'a'</span>, <span class="hljs-function"><span class="hljs-params">newValue</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">myMethod</span>())
</code></pre>
<p><strong>⭐ 什么是"选项 property"？</strong></p>
<p><strong>选项 property</strong> 就是在创建 Vue 实例时传入的选项对象的各个属性，例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">data</span>: { ... },      <span class="hljs-comment">// data 是一个选项 property</span>
  <span class="hljs-attr">created</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {},  <span class="hljs-comment">// created 是一个选项 property</span>
  <span class="hljs-attr">methods</span>: { ... },   <span class="hljs-comment">// methods 是一个选项 property</span>
  <span class="hljs-attr">computed</span>: { ... }   <span class="hljs-comment">// computed 是一个选项 property</span>
})
</code></pre>
<p><strong>为什么不能使用箭头函数？</strong></p>
<p>因为箭头函数并没有 <code>this</code>，<code>this</code> 会作为变量一直向上级词法作用域查找，直至找到为止，经常导致以下错误：</p>
<ul>
<li><code>Uncaught TypeError: Cannot read property of undefined</code></li>
<li><code>Uncaught TypeError: this.myMethod is not a function</code></li>
</ul>
<p><strong>✅ 正确写法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>
  },
  <span class="hljs-attr">created</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用普通函数，this 指向 Vue 实例</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-attr">myMethod</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)
    }
  }
})

<span class="hljs-comment">// 或者使用简写形式（ES6）</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>
  },
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">myMethod</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)
    }
  }
})
</code></pre>
<p><strong>简单记忆</strong>：</p>
<ul>
<li>选项 property（如 <code>data</code>、<code>created</code>、<code>methods</code>、<code>computed</code>）的值如果是函数，<strong>必须用普通函数</strong>，不能用箭头函数</li>
<li>这样 <code>this</code> 才能正确指向 Vue 实例</li>
</ul>
<hr/>
<h3 data-id="heading-18">五、生命周期图示</h3>
<p>下图展示了实例的生命周期：</p>
<pre><code class="hljs language-css" lang="css">     创建 Vue 实例
          ↓
    beforeCreate（实例创建前）
          ↓
    created（实例创建后）← 可以在这里访问 data、methods
          ↓
    beforeMount（挂载前）
          ↓
    mounted（挂载后）← DOM 已经渲染完成
          ↓
      <span class="hljs-selector-attr">[运行中]</span>
          ↓
    beforeUpdate（数据更新前）
          ↓
    updated（数据更新后）
          ↓
    beforeDestroy（销毁前）
          ↓
    destroyed（销毁后）
</code></pre>
<hr/>
<h3 data-id="heading-19">六、总结</h3>
<h4 data-id="heading-20">6.1 核心概念</h4>
<ol>
<li>每个 Vue 应用通过 <code>new Vue()</code> 创建一个<strong>根实例</strong></li>
<li>根实例下可以嵌套多个<strong>组件</strong>，形成<strong>组件树</strong></li>
<li>所有 Vue 组件都是 Vue 实例</li>
</ol>
<h4 data-id="heading-21">6.2 重要注意事项</h4>
<ol>
<li><strong>响应式限制</strong>：只有在创建实例时存在于 <code>data</code> 中的 property 才是响应式的</li>
<li><strong>避免箭头函数</strong>：在选项 property 中不要使用箭头函数，否则 <code>this</code> 指向会出错</li>
<li><strong>实例 property</strong>：使用 <code>$</code> 前缀的属性和方法，如 <code>vm.$data</code>、<code>vm.$el</code>、<code>vm.$watch()</code></li>
</ol>
<h4 data-id="heading-22">6.3 选项对象结构</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-comment">// 挂载点</span>
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,

  <span class="hljs-comment">// 数据</span>
  <span class="hljs-attr">data</span>: { ... },

  <span class="hljs-comment">// 方法（不要用箭头函数）</span>
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">methodName</span>(<span class="hljs-params"/>) { ... }
  },

  <span class="hljs-comment">// 生命周期钩子（不要用箭头函数）</span>
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) { ... },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) { ... },

  <span class="hljs-comment">// 计算属性</span>
  <span class="hljs-attr">computed</span>: { ... }
})
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于uniapp和 Android Studio实现安卓离线打包]]></title>    <link>https://juejin.cn/post/7600955777316831270</link>    <guid>https://juejin.cn/post/7600955777316831270</guid>    <pubDate>2026-01-31T02:22:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600955777316831270" data-draft-id="7600953879501553715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于uniapp和 Android Studio实现安卓离线打包"/> <meta itemprop="keywords" content="Vue.js,uni-app,Android"/> <meta itemprop="datePublished" content="2026-01-31T02:22:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="高级搬砖工程师275"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289427902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于uniapp和 Android Studio实现安卓离线打包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289427902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    高级搬砖工程师275
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T02:22:05.000Z" title="Sat Jan 31 2026 02:22:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、准备工作</h2>
<ul>
<li>下载 HBuilder x，本人版本是：4.87；</li>
<li>去官网下载 Android Studio 软件，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fstudio%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/studio?hl=zh-cn" ref="nofollow noopener noreferrer">下载链接</a>；</li>
<li>Android平台签名证书，可参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F35777" target="_blank" title="https://ask.dcloud.net.cn/article/35777" ref="nofollow noopener noreferrer">Android平台签名证书(.keystore)生成指南 - DCloud问答</a>，我的证书是以<code>.jks</code>结尾；</li>
<li>Android 离线SDK，版本要和 HBuilder x 一致，<a href="https://link.juejin.cn?target=https%3A%2F%2Fnativesupport.dcloud.net.cn%2FAppDocs%2Fdownload%2Fandroid.html" target="_blank" title="https://nativesupport.dcloud.net.cn/AppDocs/download/android.html" ref="nofollow noopener noreferrer">链接地址</a>；</li>
</ul>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12a975bd6c54010ac9339e5437de3d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=6MqSCllZFX4lnaJPrHt38ozMp70%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、 创建 uniapp 工程</h2>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d41253effa94f9189b4112f38db0d4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=J1hfVztOQquYmDjsEib5HW8GuR0%3D" alt="" loading="lazy"/></p>
<p>创建工程，选择** uni-app** ，选择<strong>默认模板或者 hello uni-app</strong> 等。</p>
<blockquote>
<p>不要勾选 uni-app x，因为 uni-app x 暂时不支持快速安心打包；</p>
</blockquote>
<h2 data-id="heading-2">三、<strong>uni-app 项目快速安心打包</strong></h2>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c829aff2f7e34cf482948e328bc6a992~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=bJXj%2BeyMFqUs4u9q6KyiuEimNX4%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>打包简单、代码不用上传，但是需要等，因为是在云端打包；花钱可以快速打包；</p>
</blockquote>
<h2 data-id="heading-3">四、修改 Android 离线 SDK 的配置文件</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.dcloud.net.cn%2Fpages%2Fapp%2Flist" target="_blank" title="https://dev.dcloud.net.cn/pages/app/list" ref="nofollow noopener noreferrer">查看通过HBuilder X创建的项目</a></p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/008d91cc79a6433e8d96260ce4ff94bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=YC4er3aTE1onC7VmMEEL9it6XKo%3D" alt="" loading="lazy"/></p>
<p>使用 <strong>Android Studio</strong> 打开 <code>Android 离线SDK（解压）</code> 的 <code>HBuilder-Integrate-AS</code> 工程；</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3c57bb922da46d3b0dd34f0afe175de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=CiaVWFEIbBqhhNxXxap5kzZR7z8%3D" alt="" loading="lazy"/></p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cb626d22c39461a96061ef354ba6c54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=z9KvDyYEfW2khmZzcFf3m%2F9l1wI%3D" alt="" loading="lazy"/></p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bbbb15adc994aeeb8fa5f59a2eb3fb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=wzwxgqk77wn%2B4NpN415lnHs4cVc%3D" alt="" loading="lazy"/></p>
<p>修改三个文件，build.gradle、dcloud_control.xml、AndroidManifest.xml；</p>
<blockquote>
<p>build.gradle 文件修改<strong>包名和配置的签名信息</strong>，签名信息需要和<strong>准备工作</strong>的第三步保持一致；</p>
<p>dcloud_control.xml 修改 appid，这是基于 Hbuilder X 应用自动生成的；</p>
<p>修改AndroidManifest.xml 文件的 AppKey，如何生成和获取，请看第五步；</p>
</blockquote>
<h2 data-id="heading-4">五、生成 AppKey</h2>
<p>在我的应用里面，双击<strong>项目名称</strong>进入，点击<strong>各平台信息</strong>，点击<strong>新增按钮</strong>，会看到以下界面；</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5e45a69e59435ab4d851439f3c2925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=lyTP6n%2FDNS5xdCqy5w%2BXCzzFPOY%3D" alt="" loading="lazy"/></p>
<p>其中 <strong>应用签名SHA1 和 应用签名SHA256</strong> 是在准备工作第三步生成；</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6e51980d2ba415b8856be8c9617a67a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=MfjDks01Tfclbo7Pz2AkO%2F38kxc%3D" alt="" loading="lazy"/></p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dce77f1a3b0b41918848d59f03164b4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=wgPdgUbicFZNsexCcy%2BY9hhQc1g%3D" alt="" loading="lazy"/></p>
<p>点击<strong>创建离线 Key</strong> 后，在点击<strong>查看离线 Key</strong>，就可以看到 AppKey 了。</p>
<h2 data-id="heading-5">六、离线打包</h2>
<p>生成 uniapp 编译文件</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec98135c70f14bfe9b355e7806e677ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=50gSujyFZaS4hG%2BI%2B8pgcbo%2B4J4%3D" alt="" loading="lazy"/></p>
<p>将编译好的文件拷贝</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f848dd7ac3a4971bdc7e853f1a746a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=FqInETQNShWQBj3nj7rfHtDti%2F0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">七、Android Studio 创建设备</h2>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d50c01607f94ea790f4b75725b6e063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=acMpE8tiK5jB4LOhefIz8WUSRqw%3D" alt="" loading="lazy"/></p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36feaf8ba3684bd398f670386763fca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=Gg982%2FZ0YFPEBryRnNbiIki8bTg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">八、设置自适应图标、应用名称和编译后的安装包名称</h2>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aeb2bc800324179988f4de77b39205d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6auY57qn5pCs56CW5bel56iL5biIMjc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770431121&amp;x-signature=8lk7y%2Fvho8tUKAkRY6TYJsX7nIU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">使用 Image Asset 工具生成（最推荐）</h3>
<p>不要手动去切几十张不同尺寸的图片，Android Studio 自带的工具能一键搞定：</p>
<ol>
<li><strong>打开工具</strong>：在 Android Studio 项目的 <code>res</code> 文件夹上点击 <strong>右键 -&gt; New -&gt; Image Asset</strong>。</li>
<li><strong>设置前景 (Foreground Layer)</strong>：
<ul>
<li><code>Asset Type</code> 选 <code>Image</code>。</li>
<li><code>Path</code> 选择你高清的 Logo 原图。</li>
<li><strong>调整 Resize 滑块</strong>：观察预览窗口中的圆圈，确保 Logo 完全在圈内。</li>
</ul>
</li>
<li><strong>设置背景 (Background Layer)</strong>：
<ul>
<li>你可以选一种颜色（Color），也可以选一张背景图（Image）。</li>
</ul>
</li>
<li><strong>设置预览 (Options)</strong>：
<ul>
<li><code>Name</code> 建议保持默认的 <code>ic_launcher</code>。</li>
</ul>
</li>
<li><strong>生成</strong>：点击 Next -&gt; Finish。它会自动在 <code>res/mipmap-xxxx</code> 下生成所有分辨率的图片。</li>
</ol>
<h3 data-id="heading-9">检查清单文件 (AndroidManifest.xml)</h3>
<p>生成好图片后，确保你的 <code>AndroidManifest.xml</code> 指向了这些文件：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span>
  <span class="hljs-attr">android:icon</span>=<span class="hljs-string">"@mipmap/ic_launcher"</span>
  <span class="hljs-attr">android:roundIcon</span>=<span class="hljs-string">"@mipmap/ic_launcher_round"</span>
  <span class="hljs-attr">...</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯 CSS 实现拟人化亲吻动画：布局居中与关键帧协同设计详解]]></title>    <link>https://juejin.cn/post/7600994087588216851</link>    <guid>https://juejin.cn/post/7600994087588216851</guid>    <pubDate>2026-01-31T04:30:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600994087588216851" data-draft-id="7600994087588200467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯 CSS 实现拟人化亲吻动画：布局居中与关键帧协同设计详解"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-31T04:30:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户575730334624"/> <meta itemprop="url" content="https://juejin.cn/user/2860271309712009"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯 CSS 实现拟人化亲吻动画：布局居中与关键帧协同设计详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2860271309712009/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户575730334624
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T04:30:15.000Z" title="Sat Jan 31 2026 04:30:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">纯 CSS 实现拟人化亲吻动画：布局居中与关键帧协同设计详解</h2>
<p>在现代 Web 开发中，CSS 不仅用于样式控制，更成为实现丰富交互动画的重要工具。本文将深入剖析一段精巧的纯 CSS 动画代码——一个由两个圆形头像组成的“亲吻”互动场景。该动画无需 JavaScript，仅通过 CSS 布局、伪元素和 <code>@keyframes</code> 关键帧即可实现生动拟人效果。我们将从<strong>居中布局策略</strong>、<strong>动画分层设计逻辑</strong>以及<strong>关键帧协同机制</strong>三大维度展开技术解析，揭示其背后的设计哲学与工程技巧。</p>
<hr/>
<h3 data-id="heading-1">一、精准居中：两种主流布局方法对比</h3>
<p>动画容器 <code>.container</code> 需要精确位于视口中央，这是视觉表现的基础。当前代码采用的是经典的 <strong>绝对定位 + transform 平移法</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
}
</code></pre>
<h4 data-id="heading-2">1.1 绝对定位 + Transform 法（当前方案）</h4>
<p>此方法的核心在于：</p>
<ul>
<li>利用 <code>top: 50%</code> 和 <code>left: 50%</code> 将元素左上角锚定在视口中心；</li>
<li>再通过 <code>transform: translate(-50%, -50%)</code> 将元素自身向左、向上平移其宽高的一半，从而实现几何中心对齐。</li>
</ul>
<p><strong>优势</strong>：</p>
<ul>
<li>兼容性极佳（IE9+ 支持 <code>transform</code>）；</li>
<li>适用于任意尺寸元素，无需预知宽高；</li>
<li>不影响文档流，适合叠加层或独立组件。</li>
</ul>
<p><strong>局限</strong>：</p>
<ul>
<li>若父容器非视口（如嵌套在其他定位元素中），需确保定位上下文正确；</li>
<li>在极端缩放或高 DPI 屏幕下可能出现亚像素渲染偏差（通常可忽略）。</li>
</ul>
<h4 data-id="heading-3">1.2 Flexbox 居中法（现代替代方案）</h4>
<p>作为对比，现代开发更推荐使用 Flexbox：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
}
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-comment">/* 无需额外定位 */</span>
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>语义清晰，代码简洁；</li>
<li>自动响应容器尺寸变化；</li>
<li>支持多子元素对齐（如需扩展）。</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>主体内容居中；</li>
<li>响应式布局项目。</li>
</ul>
<blockquote>
<p><strong>结论</strong>：本例选择绝对定位法，因其轻量、独立，且不依赖修改 <code>body</code> 布局，符合“组件化”思维——动画模块可无缝嵌入任何页面。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">二、动画架构：分层角色与时间轴编排</h3>
<p>整个动画时长为 <strong>4 秒</strong>，循环播放（<code>animation: ... infinite</code>）。设计者将动画拆解为多个角色（左侧球、右侧球、眼睛、嘴巴、亲吻印记），每个角色拥有独立但协同的动画轨道，形成完整的叙事节奏：</p>













































<table><thead><tr><th>时间段</th><th>动作描述</th><th>触发元素</th></tr></thead><tbody><tr><td>0–0.8s</td><td>左脸靠近</td><td><code>#l-ball</code> 右移</td></tr><tr><td>0.8–1.4s</td><td>停留等待</td><td><code>#l-ball</code> 静止</td></tr><tr><td>1.4–2.2s</td><td>左脸返回</td><td><code>#l-ball</code> 左移</td></tr><tr><td>2.0s</td><td>右脸惊讶后退</td><td><code>#r-ball</code> 右移 + 旋转</td></tr><tr><td>2.4s</td><td>右脸猛冲亲吻</td><td><code>#r-ball</code> 左移33px</td></tr><tr><td>2.64s</td><td>亲吻印记闪现</td><td><code>.kiss-m</code> opacity=1</td></tr><tr><td>2.64s</td><td>嘴巴暂时隐藏</td><td><code>.mouth-r</code> opacity=0</td></tr></tbody></table>
<p>这种<strong>分镜式时间轴设计</strong>，使得静态图形具备了“情绪”与“故事性”。</p>
<hr/>
<h3 data-id="heading-5">三、关键帧动画详解</h3>
<h4 data-id="heading-6">3.1 左侧球体：主动靠近（<code>close</code> 动画）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> close {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>); }
  <span class="hljs-number">20%</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">20px</span>); }
  <span class="hljs-number">35%</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">20px</span>); }
  <span class="hljs-number">55%</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>); }
}
</code></pre>
<ul>
<li><strong>0–20%（0–0.8s）</strong>：平滑右移 20px，模拟靠近；</li>
<li><strong>20–35%（0.8–1.4s）</strong>：保持位置，制造“凝视”停顿；</li>
<li><strong>35–55%（1.4–2.2s）</strong>：缓慢返回，体现犹豫或试探。</li>
</ul>
<p>配合 <code>ease</code> 缓动函数，运动符合“启动快、停止缓”的自然惯性。</p>
<h4 data-id="heading-7">3.2 左侧脸部细节：头部微倾（<code>face</code> 动画）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> face {
  <span class="hljs-number">20%</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">5px</span>) <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">2deg</span>); }
  <span class="hljs-number">28%</span>  { <span class="hljs-attribute">transform</span>: none; }
  <span class="hljs-number">35%</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">5px</span>) <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">2deg</span>); }
  <span class="hljs-number">50%</span>  { <span class="hljs-attribute">transform</span>: none; }
}
</code></pre>
<p>在靠近瞬间（20% 和 35%），头部轻微右倾（<code>rotate(-2deg)</code> 表示顺时针旋转），模拟人类“歪头示好”的微表情，极大增强拟人感。</p>
<h4 data-id="heading-8">3.3 右侧球体：戏剧性回应（<code>kiss</code> 动画）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> kiss {
  <span class="hljs-number">40%</span> { <span class="hljs-attribute">transform</span>: none; }
  <span class="hljs-number">50%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">30px</span>) <span class="hljs-built_in">rotate</span>(<span class="hljs-number">20deg</span>); } <span class="hljs-comment">/* 惊讶后退 */</span>
  <span class="hljs-number">60%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">33px</span>); }              <span class="hljs-comment">/* 猛冲亲吻 */</span>
  <span class="hljs-number">67%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">33px</span>); }              <span class="hljs-comment">/* 保持接触 */</span>
  <span class="hljs-number">77%</span> { <span class="hljs-attribute">transform</span>: none; }                           <span class="hljs-comment">/* 弹回原位 */</span>
}
</code></pre>
<p>此动画是全片高潮：</p>
<ul>
<li><strong>50%（2.0s）</strong>：先夸张后退并抬头（<code>rotate(20deg)</code>），表现“惊喜”；</li>
<li><strong>60%（2.4s）</strong>：突然左移 33px，远超左球位置，制造“主动亲吻”错觉；</li>
<li><strong>67–77%</strong>：短暂停留后弹性回弹，模拟物理反弹效果。</li>
</ul>
<p>这种“先退后进”的反差设计，是动画趣味性的核心来源。</p>
<h4 data-id="heading-9">3.4 嘴巴与亲吻印记：状态切换魔法</h4>
<h5 data-id="heading-10">（1）嘴巴消失（<code>mouth-m</code> 动画）</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> mouth-m {
  <span class="hljs-number">54.9%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">55%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  <span class="hljs-number">66%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  <span class="hljs-number">66.1%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}
</code></pre>
<p>在亲吻前（55%）瞬间隐藏嘴巴，避免视觉冲突。</p>
<h5 data-id="heading-11">（2）亲吻印记闪现（<code>kiss-m</code> 动画）</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> kiss-m {
  <span class="hljs-number">66%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  <span class="hljs-number">66.1%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">66.2%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}
</code></pre>
<p>利用 <strong>0.1% 的时间窗口</strong>（约 4 毫秒）闪现一个心形/唇印图形（通过 <code>.kiss</code> 的边框与圆角模拟），人眼会捕捉到这一瞬态画面，形成“亲到了”的心理暗示——这是典型的<strong>视觉暂留</strong>应用。</p>
<blockquote>
<p><strong>技巧提示</strong>：此类“瞬时效果”常用于点击反馈、消息提示等场景，成本低、效果强。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">四、工程启示：CSS 动画的最佳实践</h3>
<ol>
<li>
<p><strong>模块化角色设计</strong><br/>
每个动画元素职责单一（移动、旋转、显隐），便于调试与复用。</p>
</li>
<li>
<p><strong>时间轴对齐</strong><br/>
所有动画共享同一时长（4s），通过百分比关键帧精确同步事件，避免时间漂移。</p>
</li>
<li>
<p><strong>缓动函数选择</strong><br/>
<code>ease</code> 适用于大多数自然运动；若需弹性效果，可结合 <code>cubic-bezier()</code> 自定义。</p>
</li>
<li>
<p><strong>性能考量</strong><br/>
仅使用 <code>transform</code> 和 <code>opacity</code>（触发合成层，GPU 加速），避免 <code>width</code>/<code>height</code>/<code>margin</code> 等触发布局重排的属性。</p>
</li>
<li>
<p><strong>无障碍兼容</strong><br/>
可通过 <code>prefers-reduced-motion</code> 媒体查询禁用动画，提升可访问性：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-reduced-motion</span>: reduce) {
  <span class="hljs-selector-class">.ball</span> { <span class="hljs-attribute">animation</span>: none <span class="hljs-meta">!important</span>; }
}
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-13">结语</h3>
<p>这段不足百行的 CSS 代码，展示了前端动画的无限可能：无需框架、不依赖脚本，仅凭对布局、变换与时间的理解，即可创造出富有情感的交互体验。它不仅是技术实现，更是一种<strong>用代码讲故事</strong>的艺术。在追求极致性能与用户体验的今天，掌握此类纯 CSS 动画技巧，将为开发者提供轻量、高效且富有创意的解决方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 工厂方法模式浅析]]></title>    <link>https://juejin.cn/post/7601020578490138633</link>    <guid>https://juejin.cn/post/7601020578490138633</guid>    <pubDate>2026-01-31T01:58:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578490138633" data-draft-id="7600982613654224946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 工厂方法模式浅析"/> <meta itemprop="keywords" content="Android,设计模式"/> <meta itemprop="datePublished" content="2026-01-31T01:58:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yen"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426633214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 工厂方法模式浅析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426633214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:58:24.000Z" title="Sat Jan 31 2026 01:58:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、基本概念</h2>
<h3 data-id="heading-1">定义</h3>
<p>定义一个<strong>创建对象的接口</strong>，让子类决定实例化哪一个类。工厂方法使一个类的实例化延迟到其子类。</p>
<h3 data-id="heading-2">核心思想</h3>
<ol>
<li><strong>解耦</strong>：将对象的创建与使用分离</li>
<li><strong>多态</strong>：通过子类决定创建什么对象</li>
<li><strong>扩展性</strong>：增加新产品时无需修改现有代码</li>
</ol>
<h2 data-id="heading-3">二、基本结构</h2>
<h3 data-id="heading-4">四个核心角色</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. Product (产品接口)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drive</span><span class="hljs-params">()</span></span>: String
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFuelType</span><span class="hljs-params">()</span></span>: String
}

<span class="hljs-comment">// 2. ConcreteProduct (具体产品)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> : <span class="hljs-type">Vehicle</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drive</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"驾驶汽车"</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFuelType</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"汽油"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">playMusic</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"播放音乐"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Motorcycle</span> : <span class="hljs-type">Vehicle</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drive</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"骑摩托车"</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFuelType</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"汽油"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">wheelie</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"翘头特技"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ElectricCar</span> : <span class="hljs-type">Vehicle</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drive</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"驾驶电动汽车"</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFuelType</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"电力"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">autoPilot</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"自动驾驶模式"</span>)
    }
}

<span class="hljs-comment">// 3. Creator (创建者抽象类/接口)</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-comment">// 工厂方法</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span>: Vehicle
    
    <span class="hljs-comment">// 模板方法 - 可以使用工厂方法</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testDrive</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> vehicle = createVehicle()
        <span class="hljs-keyword">return</span> <span class="hljs-string">"试驾开始: <span class="hljs-subst">${vehicle.drive()}</span>, 燃料类型: <span class="hljs-subst">${vehicle.getFuelType()}</span>"</span>
    }
}

<span class="hljs-comment">// 4. ConcreteCreator (具体创建者)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarFactory</span> : <span class="hljs-type">VehicleFactory</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span>: Vehicle {
        println(<span class="hljs-string">"生产一辆汽车..."</span>)
        <span class="hljs-keyword">return</span> Car()
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MotorcycleFactory</span> : <span class="hljs-type">VehicleFactory</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span>: Vehicle {
        println(<span class="hljs-string">"生产一辆摩托车..."</span>)
        <span class="hljs-keyword">return</span> Motorcycle()
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ElectricCarFactory</span> : <span class="hljs-type">VehicleFactory</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span>: Vehicle {
        println(<span class="hljs-string">"生产一辆电动汽车..."</span>)
        <span class="hljs-keyword">return</span> ElectricCar()
    }
}
</code></pre>
<h2 data-id="heading-5">三、Android中的工厂方法模式</h2>
<h3 data-id="heading-6">1. Fragment工厂方法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在Activity中使用工厂方法创建Fragment</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        <span class="hljs-comment">// 根据条件使用不同的工厂</span>
        <span class="hljs-keyword">val</span> factory: FragmentFactory = <span class="hljs-keyword">if</span> (isPremiumUser()) {
            PremiumFragmentFactory()
        } <span class="hljs-keyword">else</span> {
            FreeFragmentFactory()
        }
        
        <span class="hljs-keyword">val</span> fragment = factory.createFragment()
        supportFragmentManager.beginTransaction()
            .replace(R.id.container, fragment)
            .commit()
    }
    
    <span class="hljs-comment">// 工厂接口</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FragmentFactory</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createFragment</span><span class="hljs-params">()</span></span>: Fragment
    }
    
    <span class="hljs-comment">// 具体工厂</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreeFragmentFactory</span> : <span class="hljs-type">FragmentFactory</span> {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createFragment</span><span class="hljs-params">()</span></span>: Fragment {
            <span class="hljs-keyword">return</span> FreeVersionFragment()
        }
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">PremiumFragmentFactory</span> : <span class="hljs-type">FragmentFactory</span> {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createFragment</span><span class="hljs-params">()</span></span>: Fragment {
            <span class="hljs-keyword">return</span> PremiumVersionFragment()
        }
    }
    
    <span class="hljs-comment">// 具体产品</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreeVersionFragment</span> : <span class="hljs-type">Fragment</span>() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(
            inflater: <span class="hljs-type">LayoutInflater</span>,
            container: <span class="hljs-type">ViewGroup</span>?,
            savedInstanceState: <span class="hljs-type">Bundle</span>?
        )</span></span>: View? {
            <span class="hljs-keyword">return</span> inflater.inflate(R.layout.fragment_free, container, <span class="hljs-literal">false</span>)
        }
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">PremiumVersionFragment</span> : <span class="hljs-type">Fragment</span>() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(
            inflater: <span class="hljs-type">LayoutInflater</span>,
            container: <span class="hljs-type">ViewGroup</span>?,
            savedInstanceState: <span class="hljs-type">Bundle</span>?
        )</span></span>: View? {
            <span class="hljs-keyword">return</span> inflater.inflate(R.layout.fragment_premium, container, <span class="hljs-literal">false</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-7">2. Adapter工厂方法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 多类型RecyclerView Adapter中的工厂方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiTypeAdapter</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> items: List&lt;AdapterItem&gt;) : 
    RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() {
    
    <span class="hljs-comment">// 工厂接口</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ViewHolderFactory</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createViewHolder</span><span class="hljs-params">(parent: <span class="hljs-type">ViewGroup</span>)</span></span>: RecyclerView.ViewHolder
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getViewType</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span>
    }
    
    <span class="hljs-comment">// 具体工厂</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextViewHolderFactory</span> : <span class="hljs-type">ViewHolderFactory</span> {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createViewHolder</span><span class="hljs-params">(parent: <span class="hljs-type">ViewGroup</span>)</span></span>: RecyclerView.ViewHolder {
            <span class="hljs-keyword">val</span> view = LayoutInflater.from(parent.context)
                .inflate(R.layout.item_text, parent, <span class="hljs-literal">false</span>)
            <span class="hljs-keyword">return</span> TextViewHolder(view)
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getViewType</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = ViewType.TEXT.ordinal
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageViewHolderFactory</span> : <span class="hljs-type">ViewHolderFactory</span> {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createViewHolder</span><span class="hljs-params">(parent: <span class="hljs-type">ViewGroup</span>)</span></span>: RecyclerView.ViewHolder {
            <span class="hljs-keyword">val</span> view = LayoutInflater.from(parent.context)
                .inflate(R.layout.item_image, parent, <span class="hljs-literal">false</span>)
            <span class="hljs-keyword">return</span> ImageViewHolder(view)
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getViewType</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = ViewType.IMAGE.ordinal
    }
    
    <span class="hljs-comment">// 工厂管理器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> factoryMap = mapOf&lt;<span class="hljs-built_in">Int</span>, ViewHolderFactory&gt;(
        ViewType.TEXT.ordinal to TextViewHolderFactory(),
        ViewType.IMAGE.ordinal to ImageViewHolderFactory()
    )
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(parent: <span class="hljs-type">ViewGroup</span>, viewType: <span class="hljs-type">Int</span>)</span></span>: RecyclerView.ViewHolder {
        <span class="hljs-keyword">return</span> factoryMap[viewType]?.createViewHolder(parent)
            ?: <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"未知的viewType: <span class="hljs-variable">$viewType</span>"</span>)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder: <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">ViewHolder</span>, position: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">val</span> item = items[position]
        <span class="hljs-keyword">when</span> (holder) {
            <span class="hljs-keyword">is</span> TextViewHolder -&gt; holder.bind(item <span class="hljs-keyword">as</span> TextItem)
            <span class="hljs-keyword">is</span> ImageViewHolder -&gt; holder.bind(item <span class="hljs-keyword">as</span> ImageItem)
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemViewType</span><span class="hljs-params">(position: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> items[position].viewType.ordinal
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = items.size
    
    <span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewType</span> { TEXT, IMAGE }
    
    <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdapterItem</span>(<span class="hljs-keyword">val</span> viewType: ViewType)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextItem</span>(<span class="hljs-keyword">val</span> text: String) : AdapterItem(ViewType.TEXT)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageItem</span>(<span class="hljs-keyword">val</span> imageUrl: String) : AdapterItem(ViewType.IMAGE)
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextViewHolder</span>(view: View) : RecyclerView.ViewHolder(view) {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> textView: TextView = view.findViewById(R.id.textView)
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bind</span><span class="hljs-params">(item: <span class="hljs-type">TextItem</span>)</span></span> {
            textView.text = item.text
        }
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageViewHolder</span>(view: View) : RecyclerView.ViewHolder(view) {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> imageView: ImageView = view.findViewById(R.id.imageView)
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bind</span><span class="hljs-params">(item: <span class="hljs-type">ImageItem</span>)</span></span> {
            <span class="hljs-comment">// 加载图片</span>
            Glide.with(imageView.context)
                .load(item.imageUrl)
                .into(imageView)
        }
    }
}
</code></pre>
<h3 data-id="heading-8">3. ViewModel工厂方法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewModelProvider.Factory 是工厂方法模式的典型应用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomViewModelFactory</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userId: String,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) : ViewModelProvider.Factory {
    
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-keyword">if</span> (modelClass.isAssignableFrom(UserViewModel::<span class="hljs-keyword">class</span>.java)) {
            <span class="hljs-keyword">return</span> UserViewModel(userId, repository) <span class="hljs-keyword">as</span> T
        }
        <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"未知的ViewModel类: <span class="hljs-subst">${modelClass.name}</span>"</span>)
    }
}

<span class="hljs-comment">// 在Activity中使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> viewModel: UserViewModel
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        <span class="hljs-keyword">val</span> userId = intent.getStringExtra(EXTRA_USER_ID) ?: <span class="hljs-string">""</span>
        <span class="hljs-keyword">val</span> repository = (application <span class="hljs-keyword">as</span> MyApp).userRepository
        
        <span class="hljs-keyword">val</span> factory = CustomViewModelFactory(userId, repository)
        viewModel = ViewModelProvider(<span class="hljs-keyword">this</span>, factory)[UserViewModel::<span class="hljs-keyword">class</span>.java]
        
        viewModel.user.observe(<span class="hljs-keyword">this</span>) { user -&gt;
            <span class="hljs-comment">// 更新UI</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-9">四、工厂方法模式的变体</h2>
<h3 data-id="heading-10">1. 简单工厂（静态工厂方法）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 注意：这不是标准的工厂方法模式，但很常用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 静态工厂方法</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">(type: <span class="hljs-type">VehicleType</span>)</span></span>: Vehicle {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
                VehicleType.CAR -&gt; Car()
                VehicleType.MOTORCYCLE -&gt; Motorcycle()
                VehicleType.ELECTRIC_CAR -&gt; ElectricCar()
                VehicleType.TRUCK -&gt; Truck()
            }
        }
        
        <span class="hljs-comment">// 根据参数创建不同对象</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicleFromConfig</span><span class="hljs-params">(config: <span class="hljs-type">VehicleConfig</span>)</span></span>: Vehicle {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
                config.isElectric -&gt; ElectricCar()
                config.passengerCount &gt; <span class="hljs-number">2</span> -&gt; Car()
                config.isTwoWheeler -&gt; Motorcycle()
                <span class="hljs-keyword">else</span> -&gt; Truck()
            }
        }
    }
}

<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleType</span> { CAR, MOTORCYCLE, ELECTRIC_CAR, TRUCK }

<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleConfig</span>(
    <span class="hljs-keyword">val</span> isElectric: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">val</span> passengerCount: <span class="hljs-built_in">Int</span>,
    <span class="hljs-keyword">val</span> isTwoWheeler: <span class="hljs-built_in">Boolean</span>
)
</code></pre>
<h3 data-id="heading-11">2. 参数化工厂方法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DialogFactory</span> {
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDialog</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, type: <span class="hljs-type">DialogType</span>)</span></span>: Dialog
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showDialog</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, type: <span class="hljs-type">DialogType</span>)</span></span> {
        <span class="hljs-keyword">val</span> dialog = createDialog(context, type)
        dialog.show()
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MaterialDialogFactory</span> : <span class="hljs-type">DialogFactory</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDialog</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, type: <span class="hljs-type">DialogType</span>)</span></span>: Dialog {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
            DialogType.ALERT -&gt; MaterialAlertDialogBuilder(context)
                .setTitle(<span class="hljs-string">"提示"</span>)
                .setMessage(<span class="hljs-string">"这是一个警告对话框"</span>)
                .setPositiveButton(<span class="hljs-string">"确定"</span>, <span class="hljs-literal">null</span>)
                .create()
            
            DialogType.CONFIRMATION -&gt; MaterialAlertDialogBuilder(context)
                .setTitle(<span class="hljs-string">"确认"</span>)
                .setMessage(<span class="hljs-string">"确定要执行此操作吗？"</span>)
                .setPositiveButton(<span class="hljs-string">"确定"</span>, <span class="hljs-literal">null</span>)
                .setNegativeButton(<span class="hljs-string">"取消"</span>, <span class="hljs-literal">null</span>)
                .create()
            
            DialogType.PROGRESS -&gt; MaterialAlertDialogBuilder(context)
                .setTitle(<span class="hljs-string">"请稍候"</span>)
                .setMessage(<span class="hljs-string">"正在加载..."</span>)
                .setCancelable(<span class="hljs-literal">false</span>)
                .create()
        }
    }
}

<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DialogType</span> { ALERT, CONFIRMATION, PROGRESS }
</code></pre>
<h3 data-id="heading-12">3. 依赖注入中的工厂方法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用Dagger/Hilt实现工厂方法</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(ActivityComponent::class)</span>
<span class="hljs-keyword">object</span> ViewModelModule {
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideUserViewModelFactory</span><span class="hljs-params">(
        userRepository: <span class="hljs-type">UserRepository</span>
    )</span></span>: ViewModelProvider.Factory {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">object</span> : ViewModelProvider.Factory {
            <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
                <span class="hljs-keyword">if</span> (modelClass.isAssignableFrom(UserViewModel::<span class="hljs-keyword">class</span>.java)) {
                    <span class="hljs-keyword">return</span> UserViewModel(userRepository) <span class="hljs-keyword">as</span> T
                }
                <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"未知的ViewModel类"</span>)
            }
        }
    }
}

<span class="hljs-comment">// 在Activity中使用</span>
<span class="hljs-meta">@AndroidEntryPoint</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-meta">@Inject</span>
    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> viewModelFactory: ViewModelProvider.Factory
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: UserViewModel <span class="hljs-keyword">by</span> viewModels { viewModelFactory }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        viewModel.users.observe(<span class="hljs-keyword">this</span>) { users -&gt;
            <span class="hljs-comment">// 更新UI</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-13">五、Android开发中的实际应用</h2>
<h3 data-id="heading-14">1. 网络请求工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiServiceFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createService</span><span class="hljs-params">(baseUrl: <span class="hljs-type">String</span>)</span></span>: ApiService
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createAuthService</span><span class="hljs-params">(token: <span class="hljs-type">String</span>)</span></span>: AuthApiService
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createUploadService</span><span class="hljs-params">()</span></span>: UploadApiService
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetrofitApiServiceFactory</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> context: Context) : ApiServiceFactory {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> retrofitCache = mutableMapOf&lt;String, Retrofit&gt;()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createService</span><span class="hljs-params">(baseUrl: <span class="hljs-type">String</span>)</span></span>: ApiService {
        <span class="hljs-keyword">val</span> retrofit = getOrCreateRetrofit(baseUrl)
        <span class="hljs-keyword">return</span> retrofit.create(ApiService::<span class="hljs-keyword">class</span>.java)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createAuthService</span><span class="hljs-params">(token: <span class="hljs-type">String</span>)</span></span>: AuthApiService {
        <span class="hljs-keyword">val</span> retrofit = Retrofit.Builder()
            .baseUrl(<span class="hljs-string">"https://api.example.com/"</span>)
            .addConverterFactory(GsonConverterFactory.create())
            .client(createOkHttpClientWithAuth(token))
            .build()
        
        <span class="hljs-keyword">return</span> retrofit.create(AuthApiService::<span class="hljs-keyword">class</span>.java)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createUploadService</span><span class="hljs-params">()</span></span>: UploadApiService {
        <span class="hljs-keyword">val</span> retrofit = Retrofit.Builder()
            .baseUrl(<span class="hljs-string">"https://upload.example.com/"</span>)
            .addConverterFactory(GsonConverterFactory.create())
            .client(createOkHttpClientForUpload())
            .build()
        
        <span class="hljs-keyword">return</span> retrofit.create(UploadApiService::<span class="hljs-keyword">class</span>.java)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getOrCreateRetrofit</span><span class="hljs-params">(baseUrl: <span class="hljs-type">String</span>)</span></span>: Retrofit {
        <span class="hljs-keyword">return</span> retrofitCache[baseUrl] ?: Retrofit.Builder()
            .baseUrl(baseUrl)
            .addConverterFactory(GsonConverterFactory.create())
            .client(createDefaultOkHttpClient())
            .build().also {
                retrofitCache[baseUrl] = it
            }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDefaultOkHttpClient</span><span class="hljs-params">()</span></span>: OkHttpClient {
        <span class="hljs-keyword">return</span> OkHttpClient.Builder()
            .connectTimeout(<span class="hljs-number">30</span>, TimeUnit.SECONDS)
            .readTimeout(<span class="hljs-number">30</span>, TimeUnit.SECONDS)
            .addInterceptor(LoggingInterceptor())
            .build()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createOkHttpClientWithAuth</span><span class="hljs-params">(token: <span class="hljs-type">String</span>)</span></span>: OkHttpClient {
        <span class="hljs-keyword">return</span> createDefaultOkHttpClient().newBuilder()
            .addInterceptor(AuthInterceptor(token))
            .build()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createOkHttpClientForUpload</span><span class="hljs-params">()</span></span>: OkHttpClient {
        <span class="hljs-keyword">return</span> createDefaultOkHttpClient().newBuilder()
            .connectTimeout(<span class="hljs-number">60</span>, TimeUnit.SECONDS)
            .writeTimeout(<span class="hljs-number">60</span>, TimeUnit.SECONDS)
            .build()
    }
}
</code></pre>
<h3 data-id="heading-15">2. 数据库DAO工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createUserDao</span><span class="hljs-params">()</span></span>: UserDao
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createProductDao</span><span class="hljs-params">()</span></span>: ProductDao
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createOrderDao</span><span class="hljs-params">()</span></span>: OrderDao
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTransactionDao</span><span class="hljs-params">()</span></span>: TransactionDao
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RoomDatabaseFactory</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> context: Context) : DatabaseFactory {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> database: AppDatabase <span class="hljs-keyword">by</span> lazy {
        Room.databaseBuilder(
            context.applicationContext,
            AppDatabase::<span class="hljs-keyword">class</span>.java,
            <span class="hljs-string">"app_database.db"</span>
        ).build()
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createUserDao</span><span class="hljs-params">()</span></span>: UserDao = database.userDao()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createProductDao</span><span class="hljs-params">()</span></span>: ProductDao = database.productDao()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createOrderDao</span><span class="hljs-params">()</span></span>: OrderDao = database.orderDao()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTransactionDao</span><span class="hljs-params">()</span></span>: TransactionDao = database.transactionDao()
}

<span class="hljs-comment">// 使用依赖注入</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> DatabaseModule {
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideDatabaseFactory</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: DatabaseFactory {
        <span class="hljs-keyword">return</span> RoomDatabaseFactory(context)
    }
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideUserDao</span><span class="hljs-params">(factory: <span class="hljs-type">DatabaseFactory</span>)</span></span>: UserDao {
        <span class="hljs-keyword">return</span> factory.createUserDao()
    }
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideProductDao</span><span class="hljs-params">(factory: <span class="hljs-type">DatabaseFactory</span>)</span></span>: ProductDao {
        <span class="hljs-keyword">return</span> factory.createProductDao()
    }
}
</code></pre>
<h3 data-id="heading-16">3. 主题工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ThemeFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createButton</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: Button
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTextView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: TextView
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createEditText</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: EditText
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createCardView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: CardView
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LightThemeFactory</span> : <span class="hljs-type">ThemeFactory</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createButton</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: Button {
        <span class="hljs-keyword">return</span> Button(context).apply {
            setBackgroundColor(ContextCompat.getColor(context, R.color.light_primary))
            setTextColor(ContextCompat.getColor(context, R.color.light_on_primary))
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTextView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: TextView {
        <span class="hljs-keyword">return</span> TextView(context).apply {
            setTextColor(ContextCompat.getColor(context, R.color.light_text_primary))
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createEditText</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: EditText {
        <span class="hljs-keyword">return</span> EditText(context).apply {
            setBackgroundResource(R.drawable.light_edittext_background)
            setTextColor(ContextCompat.getColor(context, R.color.light_text_primary))
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createCardView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: CardView {
        <span class="hljs-keyword">return</span> CardView(context).apply {
            setCardBackgroundColor(ContextCompat.getColor(context, R.color.light_surface))
            cardElevation = <span class="hljs-number">4f</span>
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DarkThemeFactory</span> : <span class="hljs-type">ThemeFactory</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createButton</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: Button {
        <span class="hljs-keyword">return</span> Button(context).apply {
            setBackgroundColor(ContextCompat.getColor(context, R.color.dark_primary))
            setTextColor(ContextCompat.getColor(context, R.color.dark_on_primary))
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTextView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: TextView {
        <span class="hljs-keyword">return</span> TextView(context).apply {
            setTextColor(ContextCompat.getColor(context, R.color.dark_text_primary))
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createEditText</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: EditText {
        <span class="hljs-keyword">return</span> EditText(context).apply {
            setBackgroundResource(R.drawable.dark_edittext_background)
            setTextColor(ContextCompat.getColor(context, R.color.dark_text_primary))
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createCardView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: CardView {
        <span class="hljs-keyword">return</span> CardView(context).apply {
            setCardBackgroundColor(ContextCompat.getColor(context, R.color.dark_surface))
            cardElevation = <span class="hljs-number">4f</span>
        }
    }
}

<span class="hljs-comment">// 在Activity中使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> themeFactory: ThemeFactory
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        <span class="hljs-comment">// 根据设置选择主题工厂</span>
        themeFactory = <span class="hljs-keyword">if</span> (isDarkThemeEnabled()) {
            DarkThemeFactory()
        } <span class="hljs-keyword">else</span> {
            LightThemeFactory()
        }
        
        setContentView(R.layout.activity_theme)
        
        <span class="hljs-comment">// 动态创建视图</span>
        <span class="hljs-keyword">val</span> button = themeFactory.createButton(<span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">val</span> textView = themeFactory.createTextView(<span class="hljs-keyword">this</span>)
        
        <span class="hljs-comment">// 添加到布局</span>
        <span class="hljs-keyword">val</span> container = findViewById&lt;ViewGroup&gt;(R.id.container)
        container.addView(button)
        container.addView(textView)
    }
}
</code></pre>
<h2 data-id="heading-17">六、工厂方法模式的优缺点</h2>
<h3 data-id="heading-18">✅ 优点</h3>
<ol>
<li><strong>符合开闭原则</strong>：增加新产品时只需添加新的工厂类，无需修改现有代码</li>
<li><strong>单一职责原则</strong>：创建逻辑集中在工厂类中</li>
<li><strong>解耦</strong>：客户端代码与具体产品类解耦</li>
<li><strong>可扩展性</strong>：易于扩展新产品</li>
<li><strong>代码可维护性</strong>：创建逻辑统一管理</li>
</ol>
<h3 data-id="heading-19">❌ 缺点</h3>
<ol>
<li><strong>类数量增加</strong>：每增加一个产品就要增加一个工厂类</li>
<li><strong>增加系统复杂度</strong>：引入了额外的抽象层</li>
<li><strong>需要理解工厂层次</strong>：客户端需要理解工厂的层次结构</li>
<li><strong>可能过度设计</strong>：对于简单对象创建，可能过于复杂</li>
</ol>
<h2 data-id="heading-20">七、与相关模式的对比</h2>
<h3 data-id="heading-21">工厂方法 vs 抽象工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 工厂方法：一个工厂类只创建一个产品</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createButton</span><span class="hljs-params">()</span></span>: Button  <span class="hljs-comment">// 只有一个产品</span>
}

<span class="hljs-comment">// 抽象工厂：一个工厂类创建多个相关产品</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ThemeFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createButton</span><span class="hljs-params">()</span></span>: Button      <span class="hljs-comment">// 多个相关产品</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTextView</span><span class="hljs-params">()</span></span>: TextView
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDialog</span><span class="hljs-params">()</span></span>: Dialog
}
</code></pre>
<h3 data-id="heading-22">工厂方法 vs 简单工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 简单工厂：一个工厂类根据参数创建不同产品</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleVehicleFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">(type: <span class="hljs-type">String</span>)</span></span>: Vehicle {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
            <span class="hljs-string">"car"</span> -&gt; Car()
            <span class="hljs-string">"bike"</span> -&gt; Bike()
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException()
        }
    }
}

<span class="hljs-comment">// 工厂方法：每个产品有对应的工厂类</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span>: Vehicle
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarFactory</span> : <span class="hljs-type">VehicleFactory</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span> = Car()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BikeFactory</span> : <span class="hljs-type">VehicleFactory</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createVehicle</span><span class="hljs-params">()</span></span> = Bike()
}
</code></pre>
<h2 data-id="heading-23">八、Kotlin中的优化实现</h2>
<h3 data-id="heading-24">1. 使用高阶函数作为工厂</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 将工厂方法定义为函数类型</span>
<span class="hljs-keyword">typealias</span> ViewFactory = (Context) -&gt; View

<span class="hljs-comment">// 工厂映射表</span>
<span class="hljs-keyword">val</span> viewFactories = mapOf&lt;String, ViewFactory&gt;(
    <span class="hljs-string">"button"</span> to { context -&gt; 
        Button(context).apply {
            text = <span class="hljs-string">"动态按钮"</span>
        }
    },
    <span class="hljs-string">"textView"</span> to { context -&gt;
        TextView(context).apply {
            text = <span class="hljs-string">"动态文本"</span>
            textSize = <span class="hljs-number">16f</span>
        }
    },
    <span class="hljs-string">"editText"</span> to { context -&gt;
        EditText(context).apply {
            hint = <span class="hljs-string">"请输入..."</span>
        }
    }
)

<span class="hljs-comment">// 使用</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createView</span><span class="hljs-params">(type: <span class="hljs-type">String</span>, context: <span class="hljs-type">Context</span>)</span></span>: View? {
    <span class="hljs-keyword">return</span> viewFactories[type]?.invoke(context)
}
</code></pre>
<h3 data-id="heading-25">2. 使用伴生对象工厂方法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : Result&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> exception: Throwable) : Result&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">object</span> Loading : Result&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    
    <span class="hljs-comment">// 伴生对象中的工厂方法</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">success</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">T</span>)</span></span>: Result&lt;T&gt; = Success(<span class="hljs-keyword">data</span>)
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">error</span><span class="hljs-params">(exception: <span class="hljs-type">Throwable</span>)</span></span>: Result&lt;<span class="hljs-built_in">Nothing</span>&gt; = Error(exception)
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loading</span><span class="hljs-params">()</span></span>: Result&lt;<span class="hljs-built_in">Nothing</span>&gt; = Loading
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> result1 = Result.success(<span class="hljs-string">"数据"</span>)
<span class="hljs-keyword">val</span> result2 = Result.error(RuntimeException(<span class="hljs-string">"错误"</span>))
<span class="hljs-keyword">val</span> result3 = Result.loading()
</code></pre>
<h3 data-id="heading-26">3. 使用内联函数和reified类型</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 泛型工厂方法</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : View&gt;</span> <span class="hljs-title">createView</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: T {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (T::<span class="hljs-keyword">class</span>) {
        Button::<span class="hljs-keyword">class</span> -&gt; Button(context) <span class="hljs-keyword">as</span> T
        TextView::<span class="hljs-keyword">class</span> -&gt; TextView(context) <span class="hljs-keyword">as</span> T
        EditText::<span class="hljs-keyword">class</span> -&gt; EditText(context) <span class="hljs-keyword">as</span> T
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"不支持的View类型"</span>)
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> button: Button = createView(context)
<span class="hljs-keyword">val</span> textView: TextView = createView(context)
</code></pre>
<h2 data-id="heading-27">九、最佳实践指南</h2>
<h3 data-id="heading-28">何时使用工厂方法模式？</h3>
<p>✅ <strong>适用场景</strong>：</p>
<ol>
<li>不知道对象的确切类型，需要在运行时决定</li>
<li>需要为库或框架提供扩展点</li>
<li>需要创建复杂对象，且创建逻辑可能变化</li>
<li>需要解耦客户端代码和具体实现类</li>
<li>系统中需要经常添加新产品</li>
</ol>
<p>❌ <strong>避免使用场景</strong>：</p>
<ol>
<li>对象创建逻辑简单且固定</li>
<li>产品类型很少，且不会扩展</li>
<li>性能要求极高，需要避免额外抽象层</li>
<li>可以使用依赖注入框架解决创建问题</li>
</ol>
<h3 data-id="heading-29">Android开发建议</h3>
<ol>
<li>
<p><strong>合理选择工厂类型</strong>：</p>
<ul>
<li>简单场景用简单工厂</li>
<li>需要扩展用工厂方法</li>
<li>创建相关产品族用抽象工厂</li>
</ul>
</li>
<li>
<p><strong>与依赖注入结合</strong>：</p>
</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用Hilt/Dagger管理工厂</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> FactoryModule {
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideViewModelFactory</span><span class="hljs-params">()</span></span>: ViewModelProvider.Factory {
        <span class="hljs-keyword">return</span> ViewModelFactory()
    }
}
</code></pre>
<ol start="3">
<li>
<p><strong>考虑使用Kotlin特性</strong>：</p>
<ul>
<li>密封类 + 伴生对象工厂方法</li>
<li>高阶函数作为工厂</li>
<li>内联函数简化泛型工厂</li>
</ul>
</li>
</ol>
<h2 data-id="heading-30">十、总结</h2>
<p>工厂方法模式是Android开发中最常用的设计模式之一，特别是在以下场景：</p>
<ol>
<li><strong>框架扩展点</strong>：如ViewModelProvider.Factory、FragmentFactory</li>
<li><strong>UI组件创建</strong>：如Adapter中的ViewHolder创建</li>
<li><strong>依赖管理</strong>：如通过工厂创建带依赖的对象</li>
<li><strong>配置管理</strong>：如根据配置创建不同实现</li>
</ol>
<p><strong>关键点</strong>：</p>
<ul>
<li>工厂方法模式的核心是<strong>让子类决定创建什么对象</strong></li>
<li>符合<strong>开闭原则</strong>，易于扩展</li>
<li>在Android中常用于<strong>解耦和扩展</strong></li>
<li>Kotlin提供了更简洁的实现方式</li>
</ul>
<p><strong>与其他模式的结合</strong>：</p>
<ul>
<li>与<strong>模板方法模式</strong>结合：在父类中定义算法骨架，子类实现工厂方法</li>
<li>与<strong>抽象工厂模式</strong>结合：创建相关产品族</li>
<li>与<strong>依赖注入</strong>结合：通过工厂管理依赖创建</li>
</ul>
<p>工厂方法模式是构建灵活、可扩展的Android应用的重要工具，合理使用可以显著提高代码的可维护性和可测试性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从踩坑到解决：VS Code Remote-SSH 连接阿里云服务器全流程排障]]></title>    <link>https://juejin.cn/post/7601169987395518515</link>    <guid>https://juejin.cn/post/7601169987395518515</guid>    <pubDate>2026-01-31T01:17:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601169987395518515" data-draft-id="7601028900886446126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从踩坑到解决：VS Code Remote-SSH 连接阿里云服务器全流程排障"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-31T01:17:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="思无邪237"/> <meta itemprop="url" content="https://juejin.cn/user/177475072567498"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从踩坑到解决：VS Code Remote-SSH 连接阿里云服务器全流程排障
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/177475072567498/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    思无邪237
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:17:17.000Z" title="Sat Jan 31 2026 01:17:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从踩坑到解决：VS Code Remote-SSH 连接阿里云服务器全流程排障</h2>
<p>最近在使用 VS Code Remote-SSH 连接阿里云服务器时，我遇到了一连串权限和配置问题。从本地私钥权限错误到主机密钥变更警告，再到 VS Code 插件连接失败，几乎踩遍了所有常见的坑。</p>
<p>今天我把整个排障过程整理成一篇完整的博客，希望能帮到遇到同样问题的朋友。</p>
<hr/>
<h3 data-id="heading-1">一、问题背景</h3>
<p>我使用的是阿里云轻量应用服务器，本地环境是 Windows 11。目标是通过 VS Code 的 Remote-SSH 插件实现远程开发，但连接时出现了各种错误：</p>
<ul>
<li>
<p>终端连接提示 <code>Bad permissions</code> 和 <code>UNPROTECTED PRIVATE KEY FILE!</code></p>
</li>
<li>
<p>VS Code 插件报 <code>Host key verification failed</code> 和 <code>过程试图写入的管道不存在</code></p>
</li>
<li>
<p>即使删除旧主机密钥，依然无法正常连接</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3e16a8a97764349a0ca25fdebfef101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=p6bbBNL1r5%2BQXnNaBFntJeVbP84%3D" alt="image-20260131091007140" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">二、核心问题定位</h3>
<p>通过分析日志和终端输出，我把问题拆解为三个核心环节：</p>
<h4 data-id="heading-3">1. 私钥文件权限过宽</h4>
<p>SSH 协议对私钥的安全要求非常严格，必须<strong>仅允许当前用户读取</strong>。如果私钥文件的权限中包含 <code>NT AUTHORITY\Authenticated Users</code> 这类公共用户组，SSH 会直接判定文件不安全并拒绝加载。</p>
<p>关键错误日志：</p>
<pre><code class="hljs language-Plain" lang="Plain">Bad permissions. Try removing permissions for user: NT AUTHORITY\\Authenticated Users (S-1-5-11) on file E:/tools/cert/light.pem.
Permissions for 'E:\\tools\\cert\\light.pem' are too open.
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db1dbd3e6f89479da00958fb380ad117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=SI1JQI5aHDz3n0Tv6JX6idyiqd4%3D" alt="image-20260131085608080" loading="lazy"/></p>
<h4 data-id="heading-4">2. 主机密钥变更触发安全校验</h4>
<p>服务器重启或重置密钥后，主机的 SSH 密钥会发生变化。本地 <code>known_hosts</code> 文件中留存的旧密钥与新密钥冲突，导致 SSH 为了防止中间人攻击而拒绝连接。</p>
<p>关键错误日志：</p>
<pre><code class="hljs language-Plain" lang="Plain">WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!
Host key verification failed.
</code></pre>
<h4 data-id="heading-5">3. VS Code 插件配置与缓存问题</h4>
<p>VS Code 的 Remote-SSH 插件依赖本地 SSH 客户端，若配置文件未明确指定私钥路径，或插件缓存了旧的连接信息，都会导致连接失败。</p>
<hr/>
<h3 data-id="heading-6">三、分步解决方案</h3>
<h4 data-id="heading-7">第一步：彻底修复私钥文件权限（最关键）</h4>
<p>这是整个排障过程的核心，必须确保私钥文件仅对当前用户开放读取权限。</p>
<h5 data-id="heading-8">1. 管理员 PowerShell 强制清理权限</h5>
<p>打开<strong>管理员身份的 PowerShell</strong>，执行以下命令：</p>
<pre><code class="hljs language-PowerShell" lang="PowerShell"># 替换为你的私钥路径
$keyPath = "E:\tools\cert\light.pem"

# 1. 移除所有公共用户组权限
icacls $keyPath /remove *S-1-5-11 /Q  # 移除 Authenticated Users
icacls $keyPath /remove "Everyone" /Q
icacls $keyPath /remove "SYSTEM" /Q
icacls $keyPath /remove "Administrators" /Q

# 2. 禁用权限继承
icacls $keyPath /inheritance:r /Q

# 3. 仅授予当前用户读取权限
icacls $keyPath /grant "$env:USERNAME`:R" /Q

# 4. 验证权限（确保只有你的用户名有 R 权限）
icacls $keyPath
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a696c107dcd145618ba24cff89e2147e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=hYCOMqwpJHoFHgQNwcDLhreZvqA%3D" alt="image-20260131085754717" loading="lazy"/></p>
<h5 data-id="heading-9">2. 迁移私钥到用户专属目录（推荐）</h5>
<p>将私钥从工具目录（如 <code>E:\tools\cert</code>）迁移到用户专属的 <code>.ssh</code> 目录，可规避目录级别的权限干扰：</p>
<pre><code class="hljs language-PowerShell" lang="PowerShell">
# 创建用户 .ssh 目录（如果不存在）
New-Item -ItemType Directory -Path "C:\Users\34889\.ssh" -Force

# 复制私钥到新目录
Copy-Item "E:\tools\cert\light.pem" "C:\Users\34889\.ssh\light.pem"

# 对新路径的私钥重新执行权限配置
$keyPath = "C:\Users\34889\.ssh\light.pem"
icacls $keyPath /inheritance:r /Q
icacls $keyPath /grant "$env:USERNAME`:R" /Q
</code></pre>
<p>【配图标注】：用户 .ssh 目录截图（展示目录位置、light.pem 文件，可搭配权限设置界面小图）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bf135af8dbe413d968e9a1a18c06444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=gzGI3JtZajGOO7gyms3yJ7XNilk%3D" alt="image-20260131090052042" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-10">第二步：清理旧主机密钥并验证终端连接</h4>
<p>在普通用户权限的 PowerShell 中执行：</p>
<pre><code class="hljs language-PowerShell" lang="PowerShell"># 1. 删除旧的主机密钥记录
ssh-keygen -R &lt;公网ip&gt;

# 2. 测试终端连接（验证权限和密钥有效性）
ssh -i C:\Users\34889\.ssh\light.pem root@&lt;公网ip&gt;
</code></pre>
<p>首次连接时输入 <code>yes</code> 确认新主机密钥，若能成功登录服务器，说明基础连通性已解决。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afbf157d145d47818c9d45db4f9645d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=j6AqMghFYjashWcjfxXd%2B6Utres%3D" alt="image-20260131090224480" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-11">第三步：配置 VS Code Remote-SSH 插件</h4>
<ol>
<li>
<p>打开 VS Code → 点击左侧「远程资源管理器」→ 找到「SSH 目标」→ 点击「配置」（齿轮图标）。</p>
</li>
<li>
<p>编辑 <code>.ssh/config</code> 文件，添加如下配置：</p>
</li>
<li>
<p>保存配置后，<strong>重启 VS Code</strong> 以清空插件缓存。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b3279b5ef44460ba13de48babe8daa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=JtvX64tseBYtNwFSdk6T1WSjc10%3D" alt="image-20260131090334109" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-12">第四步：验证 VS Code 连接</h4>
<p>在 VS Code 的「SSH 目标」列表中，右键点击 <code>39.107.240.31</code> → 选择「连接到主机」。若配置正确，插件会自动完成服务器端安装并成功连接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efd73f3e7daa45f2b21bacd4cd7c857d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=VR7wGD4o2zmq3pINXYR2yXaveVY%3D" alt="image-20260131090448422" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-13">四、常见问题排查清单</h3>
<p>如果按上述步骤操作后仍无法连接，可按以下顺序排查：</p>
<ol>
<li><strong>终端连接是否正常？</strong></li>
</ol>
<p>先确保 <code>ssh -i ...</code> 命令能在终端成功登录，终端通了 VS Code 才可能通。</p>
<ol>
<li><strong>VS Code 是否以普通用户身份运行？</strong></li>
</ol>
<p>用管理员身份运行 VS Code 会导致权限上下文异常，必须以普通用户身份启动。</p>
<ol>
<li><strong>插件缓存是否需要清理？</strong></li>
</ol>
<p>删除 <code>C:\Users\34889.vscode\extensions\ms-vscode-remote.remote-ssh-0.120.0</code> 文件夹，然后重新安装 Remote-SSH 插件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e66eb58824ac46ed8f3e800296ecadff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCd5peg6YKqMjM3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770427036&amp;x-signature=t3BBszT9Anio1QvvvGRitcWrCvE%3D" alt="image-20260131090810160" loading="lazy"/></p>
<ol>
<li><strong>私钥文件是否被锁定？</strong></li>
</ol>
<p>检查是否有文本编辑器、杀毒软件等程序正在占用私钥文件，关闭后重试。</p>
<hr/>
<h3 data-id="heading-14">五、总结</h3>
<p>整个排障过程的核心逻辑是：<strong>先确保基础 SSH 连接正常，再解决 VS Code 插件层面的问题</strong>。</p>
<p>其中，私钥权限问题是最容易被忽视的环节，也是导致连接失败的主要原因。通过管理员权限强制清理权限，并将私钥迁移到用户专属目录，可从根源解决这个问题。</p>
<p>希望这篇博客能帮你少走弯路，顺利实现 VS Code 远程开发！🚀</p>
<hr/>
<p>如果你需要，我还可以帮你整理一份<strong>一键修复脚本</strong>，把所有权限配置和命令打包成一个 <code>.ps1</code> 文件，下次遇到问题直接运行即可解决。需要吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[借助Trae AI工具构建文本高亮插件的完整历程]]></title>    <link>https://juejin.cn/post/7601007650723348521</link>    <guid>https://juejin.cn/post/7601007650723348521</guid>    <pubDate>2026-01-31T01:59:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601007650723348521" data-draft-id="7600989427905986614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="借助Trae AI工具构建文本高亮插件的完整历程"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-31T01:59:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="会一丢丢蝶泳的咻狗"/> <meta itemprop="url" content="https://juejin.cn/user/1803675742243277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            借助Trae AI工具构建文本高亮插件的完整历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1803675742243277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    会一丢丢蝶泳的咻狗
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:59:05.000Z" title="Sat Jan 31 2026 01:59:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="arta">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#222}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#aaa}.hljs-section{color:#fff}.hljs-comment,.hljs-meta,.hljs-quote{color:#444}.hljs-bullet,.hljs-regexp,.hljs-string,.hljs-symbol{color:#fc3}.hljs-addition,.hljs-number{color:#0c6}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-template-variable,.hljs-type{color:#32aaee}.hljs-keyword,.hljs-name,.hljs-selector-class,.hljs-selector-id,.hljs-selector-tag{color:#64a}.hljs-deletion,.hljs-template-tag,.hljs-title,.hljs-variable{color:#b16}.hljs-doctag,.hljs-section,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><h2 data-id="heading-0">从复杂实现到优雅封装：借助Trae AI工具构建文本高亮插件的完整历程</h2>
<p>本文记录了我如何从复杂的Vue组件实现，借助Trae AI工具一步步优化，最终开发出轻量级文本高亮插件 <code>lk-text-select-highlight</code> 的完整过程。</p>
<h3 data-id="heading-1">🚀 项目背景</h3>
<p>在开发一个文本标注功能时，我最初实现了一个复杂的文本高亮系统。这个实现虽然功能完整，但存在几个痛点：</p>
<ul>
<li><strong>逻辑复杂</strong>：需要手动处理DOM操作、UUID生成、高亮状态管理</li>
<li><strong>维护困难</strong>：代码量庞大，难以调试和扩展</li>
<li><strong>回显困难</strong>：重新应用高亮标记时逻辑复杂，容易出错</li>
</ul>
<h3 data-id="heading-2">💡 借助Trae AI工具的优化之旅</h3>
<h4 data-id="heading-3">第一阶段：需求分析与原型设计</h4>
<p>我向Trae AI提出了核心需求，它迅速生成了基础框架，包括ES6 Class架构设计和核心方法实现。</p>
<h4 data-id="heading-4">第二阶段：功能迭代与优化</h4>
<p>在Trae AI的协助下，我们逐步完善了功能：</p>
<p><strong>1. 容器限制功能</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 限制高亮只能在指定容器内进行</span>
<span class="hljs-keyword">const</span> highlighter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextHighlighter</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content-area'</span>)
});
</code></pre>
<p><strong>2. 严格模式实现</strong> 防止在已高亮的文本上再次高亮，避免嵌套问题。</p>
<p><strong>3. UUID存储优化</strong> 从存储DOM元素改为存储UUID标识符，提升性能和稳定性。</p>
<h4 data-id="heading-5">第三阶段：API完善与测试</h4>
<p>通过多次迭代，我们添加了关键的 <code>setHighlights</code> 方法，同时建立了完整的测试套件。</p>
<h3 data-id="heading-6">🎯 原始实现的精华代码</h3>
<h4 data-id="heading-7">核心高亮功能</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 高亮选中文本的核心逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">highlightSelectedText</span>(<span class="hljs-params">color = <span class="hljs-string">'#4593ff'</span>, tag, category</span>) {
  <span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (!selection || selection.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> selectedRange = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> uuid = <span class="hljs-title function_">uuidv4</span>();
  <span class="hljs-keyword">const</span> selectedText = selection.<span class="hljs-title function_">toString</span>();

  <span class="hljs-comment">// 创建高亮span元素</span>
  <span class="hljs-keyword">const</span> span = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'span'</span>);
  span.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = color;
  span.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-uuid'</span>, uuid);
  
  <span class="hljs-keyword">try</span> {
    selectedRange.<span class="hljs-title function_">surroundContents</span>(span);
    <span class="hljs-comment">// 存储高亮信息</span>
    highlightedTexts.<span class="hljs-property">value</span>[uuid] = { uuid, <span class="hljs-attr">text</span>: selectedText, <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() };
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-comment">// 处理跨元素选择的情况</span>
    <span class="hljs-keyword">const</span> contents = selectedRange.<span class="hljs-title function_">extractContents</span>();
    span.<span class="hljs-title function_">appendChild</span>(contents);
    selectedRange.<span class="hljs-title function_">insertNode</span>(span);
  }
}
</code></pre>
<h4 data-id="heading-8">复杂的状态管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 存储高亮文本信息的复杂状态管理</span>
<span class="hljs-keyword">const</span> highlightedTexts = <span class="hljs-title function_">ref</span>({
  [<span class="hljs-attr">key</span>: string]: {
    <span class="hljs-attr">uuid</span>: string;
    <span class="hljs-attr">text</span>: string;
    <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;
    color?: string;
    tag?: string;
    category?: string;
  };
});
</code></pre>
<h4 data-id="heading-9">回显功能的复杂实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 重新应用高亮的复杂逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reapplyAllHighlights</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">clearExistingHighlights</span>();
  
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(highlightedTexts.<span class="hljs-property">value</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> container = textSelectRef.<span class="hljs-property">value</span>;
    <span class="hljs-keyword">if</span> (container) {
      <span class="hljs-comment">// 需要遍历所有文本节点查找匹配内容</span>
      <span class="hljs-keyword">const</span> walker = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTreeWalker</span>(container, <span class="hljs-title class_">NodeFilter</span>.<span class="hljs-property">SHOW_TEXT</span>, <span class="hljs-literal">null</span>);
      <span class="hljs-comment">// 复杂的DOM操作和范围处理...</span>
    }
  });
}
</code></pre>
<h3 data-id="heading-10">🎯 借助插件的优雅实现</h3>
<h4 data-id="heading-11">安装与引入</h4>
<pre><code class="hljs language-vbnet" lang="vbnet">bash
npm install lk-<span class="hljs-keyword">text</span>-<span class="hljs-keyword">select</span>-highlight
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">TextHighlighter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'lk-text-select-highlight'</span>;
</code></pre>
<h4 data-id="heading-12">简洁的核心实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化 - 一行代码搞定</span>
<span class="hljs-keyword">const</span> highlighter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextHighlighter</span>({
  <span class="hljs-attr">className</span>: <span class="hljs-string">'text-highlight'</span>,
  <span class="hljs-attr">color</span>: <span class="hljs-string">'#ffeb3b'</span>,
  <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>)
});

<span class="hljs-comment">// 高亮选中文本 - 方法调用即可</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">highlightText</span> = (<span class="hljs-params"/>) =&gt; {
  highlighter.<span class="hljs-title function_">highlightSelection</span>();
};

<span class="hljs-comment">// 获取高亮数据 - 直接返回结构化数据</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getHighlights</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> highlighter.<span class="hljs-title function_">getHighlights</span>();
};

<span class="hljs-comment">// 设置高亮数据 - 完美解决回显问题</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadHighlights</span> = (<span class="hljs-params">savedData</span>) =&gt; {
  highlighter.<span class="hljs-title function_">setHighlights</span>(savedData);
};
</code></pre>
<h4 data-id="heading-13">完整的Demo实现</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>文本高亮Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.text-highlight</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffeb3b</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">4px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>; }
    <span class="hljs-selector-id">#content</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>; <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>; }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"highlightText()"</span>&gt;</span>高亮选中文本<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"removeAll()"</span>&gt;</span>清除所有高亮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"saveHighlights()"</span>&gt;</span>保存<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"loadHighlights()"</span>&gt;</span>加载<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一段示例文本，您可以选中其中的文字进行高亮标注。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>高亮功能支持多次标注，并且可以保存和恢复标注状态。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/lk-text-select-highlight"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> highlighter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextHighlighter</span>({
      <span class="hljs-attr">className</span>: <span class="hljs-string">'text-highlight'</span>,
      <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>)
    });

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">highlightText</span>(<span class="hljs-params"/>) {
      highlighter.<span class="hljs-title function_">highlightSelection</span>();
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">removeAll</span>(<span class="hljs-params"/>) {
      highlighter.<span class="hljs-title function_">removeAllHighlights</span>();
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveHighlights</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'highlights'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(highlighter.<span class="hljs-title function_">getHighlights</span>()));
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadHighlights</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> saved = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'highlights'</span>);
      <span class="hljs-keyword">if</span> (saved) {
        highlighter.<span class="hljs-title function_">setHighlights</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(saved));
      }
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">🛠️ Trae AI工具的关键作用</h3>
<p>在整个开发过程中，Trae AI展现了强大的辅助能力：</p>
<ol>
<li><strong>快速原型生成</strong>：几分钟内完成基础框架搭建</li>
<li><strong>代码优化建议</strong>：提供最佳实践和性能优化方案</li>
<li><strong>错误诊断修复</strong>：快速定位并解决技术问题</li>
<li><strong>文档自动生成</strong>：创建完整的中英文文档</li>
<li><strong>测试用例编写</strong>：确保代码质量和稳定性</li>
</ol>
<h3 data-id="heading-15">📦 插件核心优势对比</h3>



































<table><thead><tr><th>特性</th><th>原始实现</th><th>插件实现</th></tr></thead><tbody><tr><td><strong>代码量</strong></td><td>500+行</td><td>10-20行</td></tr><tr><td><strong>维护性</strong></td><td>复杂难维护</td><td>简单易维护</td></tr><tr><td><strong>功能性</strong></td><td>基础功能</td><td>完整功能集</td></tr><tr><td><strong>稳定性</strong></td><td>容易出错</td><td>经过测试</td></tr><tr><td><strong>扩展性</strong></td><td>难以扩展</td><td>易于扩展</td></tr></tbody></table>
<h4 data-id="heading-16">插件核心特性</h4>
<ul>
<li>✅ <strong>轻量级</strong>：压缩后仅2.8KB</li>
<li>✅ <strong>易用性</strong>：简单的API设计，快速上手</li>
<li>✅ <strong>兼容性</strong>：支持多种模块格式</li>
<li>✅ <strong>TypeScript</strong>：完整的类型定义支持</li>
<li>✅ <strong>容器限制</strong>：可限制高亮区域范围</li>
<li>✅ <strong>严格模式</strong>：防止嵌套高亮问题</li>
</ul>
<h3 data-id="heading-17">🎉 总结与收获</h3>
<p>通过这次开发经历，我深刻体会到：</p>
<ol>
<li><strong>工具赋能</strong>：AI工具如Trae能够显著提升开发效率和质量</li>
<li><strong>封装价值</strong>：将复杂功能封装成独立库，提高代码复用性</li>
<li><strong>渐进优化</strong>：从MVP开始，逐步迭代完善功能</li>
<li><strong>开源价值</strong>：优秀的工具应该分享给社区</li>
</ol>
<h3 data-id="heading-18">🌟 关注与使用</h3>
<p><strong>插件地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Flk-text-select-highlight" target="_blank" title="https://www.npmjs.com/package/lk-text-select-highlight" ref="nofollow noopener noreferrer">www.npmjs.com/package/lk-…</a></p>
<p><strong>安装使用</strong>：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">bash
npm install lk-<span class="hljs-keyword">text</span>-<span class="hljs-keyword">select</span>-highlight
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">javascript
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TextHighlighter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'lk-text-select-highlight'</span>;

<span class="hljs-keyword">const</span> highlighter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextHighlighter</span>();
highlighter.<span class="hljs-title function_">highlightSelection</span>(); <span class="hljs-comment">// 就是这么简单！</span>
</code></pre>
<p>这个插件的诞生证明了现代开发工具与AI辅助编程的强大结合，期待它在更多项目中发挥作用！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[520-不换 Cursor：VS Code + Gemini Pro 顶配攻略]]></title>    <link>https://juejin.cn/post/7600999271769620480</link>    <guid>https://juejin.cn/post/7600999271769620480</guid>    <pubDate>2026-01-31T03:04:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600999271769620480" data-draft-id="7600976289064878080" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="520-不换 Cursor：VS Code + Gemini Pro 顶配攻略"/> <meta itemprop="keywords" content="Visual Studio Code"/> <meta itemprop="datePublished" content="2026-01-31T03:04:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LinkZ"/> <meta itemprop="url" content="https://juejin.cn/user/520514700336122"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            520-不换 Cursor：VS Code + Gemini Pro 顶配攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/520514700336122/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LinkZ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T03:04:42.000Z" title="Sat Jan 31 2026 03:04:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多人为了 AI 体验转向了 Cursor，但作为原生 VS Code 的死忠，我们舍不得那些调教已久的插件和习惯。其实，通过 <strong>Continue</strong> 插件联动 <strong>Gemini Pro 会员</strong>，你完全可以在不改变开发习惯的前提下，获得甚至超越 Cursor 的体验。</p>
<h2 data-id="heading-0">1、为什么是这个组合？</h2>
<ul>
<li><strong>原汁原味：</strong> 无需迁移配置，就在你最熟悉的 VS Code 里工作。</li>
<li><strong>谷歌最新的模型：</strong> Gemini 3 Pro。</li>
<li><strong>极致性价比：</strong> 利用 Google 学生优惠，可免费获得 Gemini Pro 会员，省下每月 20 刀的 Cursor 订阅费。</li>
</ul>
<hr/>
<h2 data-id="heading-1">2、准备工作</h2>
<ol>
<li>教程中所有的网址如果打不开，请挂上梯子，所有软件的安装地址最好不要包含中文。</li>
<li>有一个 Gemini Pro 会员，可以自己申请获取，网上有相关教程，难度较大。也可以直接在闲鱼买成品号，需自己甄别商家。</li>
<li>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fantigravity.google%2Fdownload" target="_blank" title="https://antigravity.google/download" ref="nofollow noopener noreferrer"><strong>Antigravity 官网</strong></a>下载对应的版本进行安装，安装完毕后打开不用登录。</li>
<li>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flbjlaq%2FAntigravity-Manager%2Freleases" target="_blank" title="https://github.com/lbjlaq/Antigravity-Manager/releases" ref="nofollow noopener noreferrer">Antigravity-Manager</a>这个开源工具的网站，下载对应的版本并安装。</li>
<li>在<strong>VS Code</strong> 插件市场搜索并安装 <code>Continue - open-source AI code agent</code>。</li>
</ol>
<hr/>
<h2 data-id="heading-2">3、Antigravity Tools 工具配置</h2>
<h3 data-id="heading-3">3.1、添加账号</h3>
<p>打开下载的 Antigravity Tools 工具，按照下图顺序添加账号，
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f688da62d344d259004981476091a48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=iqSopISV43b01iCoAzNPS6jGjy8%3D" alt="01-1" loading="lazy"/></p>
<p>通过 OAuth 授权的方式，会自动跳转到浏览器，登录你有 Gemini Pro 会员的账号。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d2e2d69b7f4a37bf574984259ca7d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=4E7toUDUkoZPEeMYzvWKY8wbeP8%3D" alt="01-2" loading="lazy"/></p>
<h3 data-id="heading-4">3.2、获取 API 密钥</h3>
<p>在 <code>API 反代</code> 页面，点击 <strong>启动服务</strong> ，在 <strong>序号 3</strong> 处复制密钥。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ce8a6f927cb4fb3b28d2deb9985539a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=eWp2kFKMpY0ZQN6rk04r%2BenRwto%3D" alt="01-3" loading="lazy"/></p>
<ol>
<li>选择页面。</li>
<li>选择协议。</li>
<li>复制模型 id。</li>
<li>复制 api 地址，注意：地址最后要加 <code>/v1</code> ，比如图中最后地址应为 <code>http://127.0.0.1:8045/v1</code> 。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/547cf251357b4d589ae89421c410db33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=TrW3Q7Wg1vJvkVhKIH2z2Qp091o%3D" alt="01-4" loading="lazy"/></li>
</ol>
<h3 data-id="heading-5">3.3、查看日志</h3>
<ol>
<li>日志界面。</li>
<li>点击开始记录。</li>
<li>点击可查看详细信息。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d59257301ab8454b91f91a7bebb96698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=4r9RZ0sL75V80NYv0WWD%2BDqTaGM%3D" alt="01-5" loading="lazy"/></li>
</ol>
<h3 data-id="heading-6">3.4、设置</h3>
<ol>
<li>点击。</li>
<li>点击。</li>
<li>此时需运行 <strong>Antigravity</strong>（不用登录） ，点击 <strong>探测</strong> 可以识别到程序路径，也可以手动 <strong>选择</strong>。</li>
<li>此时需运行 <strong>Antigravity</strong>（不用登录），点击 <strong>检测</strong> 即可。</li>
<li>保存。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8391b235636c43c39d4e8b05b48373d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=XmsvlqhIjUrQahBwfJ9HYsVhmPM%3D" alt="01-6" loading="lazy"/></li>
</ol>
<hr/>
<h2 data-id="heading-7">4、配置 Continue 插件</h2>
<p>第一次使用这个插件根据引导进行登录一下。</p>
<h3 data-id="heading-8">4.1、打开 config.yaml 的本地配置文件</h3>
<ol>
<li>点击。</li>
<li>点击 Local Config 后的设置图标，会弹出来 <code>config.yaml</code> 的配置文件。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37edb99f6db543c5aef25eced0e9a697~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=7YvPf6gy90NQ9MQYUDGTCMQWyGQ%3D" alt="01-7" loading="lazy"/></li>
</ol>
<h3 data-id="heading-9">4.2、配置 config.yaml 文件</h3>
<p>配置模板如下，注意 <strong>yaml</strong> 语法的格式，注意保存这个文件。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Local</span> <span class="hljs-string">Config</span>
<span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">schema:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">models:</span>
  <span class="hljs-comment"># continue 插件识别到模型名字里有 Sonnet 字段，可以进行图片识别，</span>
  <span class="hljs-comment"># 当然模型本身也需支持图片识别才可以。</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-number">06</span> <span class="hljs-string">Gemini</span> <span class="hljs-number">3</span> <span class="hljs-string">Flash</span> <span class="hljs-string">(Sonnet)</span> <span class="hljs-string">极速预览</span> <span class="hljs-comment"># 可随意命名</span>
    <span class="hljs-attr">provider:</span> <span class="hljs-string">anthropic</span> <span class="hljs-comment"># 只能是这个协议</span>
    <span class="hljs-attr">model:</span> <span class="hljs-string">gemini-3-flash</span> <span class="hljs-comment"># 模型 id</span>
    <span class="hljs-attr">apiKey:</span> <span class="hljs-string">sk-1e1111363aa5po549a94e4b76ce25252</span> <span class="hljs-comment"># 换成你的 api 密钥</span>
    <span class="hljs-attr">apiBase:</span> <span class="hljs-string">http://127.0.0.1:8045/v1</span> <span class="hljs-comment"># 换成你上面复制的 api 地址</span>
</code></pre>
<ol>
<li>重新加载后，这里选择你设定的模型就说明成功了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0eb770f4cc78477f9ecd6b49b6c2b28a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=muob3kD4n8ZfHCT0qLn%2FTwajATI%3D" alt="01-8" loading="lazy"/></li>
</ol>
<hr/>
<h2 data-id="heading-10">5、测试和说明</h2>
<h3 data-id="heading-11">5.1、错误排查测试</h3>
<p>截止这篇博客写完时，Antigravity Tools V4.0.8，有 bug 在等作者修复中，下面先演示个错误排查说明。</p>
<ol>
<li>
<p>Continue 插件的错误弹窗会反馈信息，但最好和 Antigravity Tools 工具里的日志信息相互印证来确定问题。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fda2e1e6af614926867ea4222455cd19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=NvcPVTb5V1TSOZF9OrO3nbCw0Uo%3D" alt="01-9" loading="lazy"/></p>
</li>
<li>
<p>看到响应报文这里也是错误信息，就去 github 提交问题 issue，或者看有没有反馈相同问题的解决方法，然后等作者消除 bug 就 OK 了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f2bd822d8954061bccd4de0a1f2c215~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=1vxVd7MvULVWu8v3jp3t3MvDKds%3D" alt="01-10" loading="lazy"/></p>
</li>
</ol>
<h3 data-id="heading-12">5.2、成功的测试</h3>
<p>由于 bug 问题，我这里使用了智谱的模型，Continue 插件是可以填任何模型的，只要你有 api 密钥和地址。下图是成功的回答。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/709fd70ada694a52b3abf3f61f5a7485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=BOs4aMhR%2Bu31pS1EBnw99w44hoU%3D" alt="01-11" loading="lazy"/></p>
<h3 data-id="heading-13">5.3、Antigravity Tools 更新到最新 V4.0.10 版本的成功测试</h3>
<p>今天醒来发现版本更新了，bug 已经被修复了，成功测试如下图。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa209a5bbe1f44b7841b9f009a81624e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=PzJM3wu4mJE304F0wdTvLT%2B7eQA%3D" alt="01-12" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44f8293b563d449195c56895dc68cd62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGlua1o=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770433482&amp;x-signature=YId%2Fd0LZc%2BuY18kU7HdldLL1FMs%3D" alt="01-13" loading="lazy"/></p>
<h3 data-id="heading-14">5.4、说明</h3>
<p>关于 Continue 插件的更多用法，可参照官方文档，或多使用几次就熟悉了，这一套组合起来跟你用 AI 编程工具的效果一样。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个Python库：markupsafe - 让你的字符串安全又优雅]]></title>    <link>https://juejin.cn/post/7600989427906363446</link>    <guid>https://juejin.cn/post/7600989427906363446</guid>    <pubDate>2026-01-31T05:35:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600989427906363446" data-draft-id="7600989427906347062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个Python库：markupsafe - 让你的字符串安全又优雅"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-31T05:35:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="敏编程"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个Python库：markupsafe - 让你的字符串安全又优雅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    敏编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T05:35:27.000Z" title="Sat Jan 31 2026 05:35:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">markupsafe - 让你的字符串安全又优雅</h2>
<h3 data-id="heading-1">一、什么是markupsafe？</h3>
<p><strong>markupsafe</strong> 是一个用于处理标记语言（如HTML、XML）字符串的 Python 库。
它可以帮助你：</p>
<ul>
<li><strong>安全地转义字符串</strong>：防止跨站脚本（XSS）攻击，特别是当你需要将用户输入显示在网页上时。</li>
<li><strong>标记安全字符串</strong>：将经过转义或信任的字符串标记为“安全”，避免重复转义，提高效率。</li>
<li><strong>模板引擎集成</strong>：在像Jinja2这样的模板引擎中，markupsafe扮演了核心角色，确保渲染的HTML内容是安全的。</li>
</ul>
<h3 data-id="heading-2">二、应用场景</h3>
<p><strong>markupsafe</strong> 广泛应用于以下实际场景：</p>
<ul>
<li><strong>Web开发框架</strong>: 在Flask、Jinja2等Web框架中，用于自动转义模板渲染的输出，防止注入攻击。</li>
<li><strong>用户生成内容</strong>: 当你的网站允许用户输入并显示内容时（如评论、论坛帖子），markupsafe能确保这些内容在显示时是安全的。</li>
<li><strong>构建动态HTML/XML</strong>: 在程序中动态生成HTML或XML片段时，需要确保所有插入的数据都经过了正确的转义。</li>
</ul>
<h3 data-id="heading-3">三、如何安装</h3>
<ol>
<li>使用 pip 安装</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install markupsafe

<span class="hljs-comment"># 如果安装慢的话，推荐使用国内镜像源</span>
pip install markupsafe -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行代码（无需本地安装）</li>
</ol>
<h3 data-id="heading-4">四、示例代码</h3>
<p>转义用户输入以防止XSS攻击</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> markupsafe <span class="hljs-keyword">import</span> escape, Markup

<span class="hljs-comment"># 用户输入，可能包含恶意脚本</span>
user_input_raw = <span class="hljs-string">"&lt;script&gt;alert('您被攻击了！')&lt;/script&gt;"</span>
is_admin = <span class="hljs-literal">True</span> <span class="hljs-comment"># 假设有一个条件判断用户是否是管理员</span>

<span class="hljs-comment"># 使用escape转义用户输入</span>
safe_output = escape(user_input_raw)

<span class="hljs-comment"># 打印转义后的结果</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"转义后的内容: <span class="hljs-subst">{safe_output}</span>"</span>)

<span class="hljs-comment"># 假设有一些信任的HTML内容，我们不希望它被转义</span>
trusted_html = Markup(<span class="hljs-string">"&lt;b&gt;这是加粗的文本&lt;/b&gt;"</span>)

<span class="hljs-comment"># 如果是管理员，则直接显示原始输入（这里仅为演示，实际应用需极其谨慎）</span>
<span class="hljs-keyword">if</span> is_admin:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"管理员显示（危险！）：<span class="hljs-subst">{user_input_raw}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># 否则显示安全的内容</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"普通用户显示（安全！）：<span class="hljs-subst">{safe_output}</span>"</span>)

<span class="hljs-comment"># 结合使用，Markup标记的内容不会被二次转义</span>
formatted_output = Markup(<span class="hljs-string">f"&lt;p&gt;Hello, <span class="hljs-subst">{safe_output}</span>!&lt;/p&gt;"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"组合后的安全HTML: <span class="hljs-subst">{formatted_output}</span>"</span>)

<span class="hljs-comment"># 检查是否是Markup实例</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(formatted_output, Markup):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"formatted_output 是一个 Markup 实例，已被标记为安全。"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"formatted_output 不是 Markup 实例。"</span>)
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dfrom%2520markupsafe%2520import%2520escape%252C%2520Markup%250A%250A%2523%2520%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5%25EF%25BC%258C%25E5%258F%25AF%25E8%2583%25BD%25E5%258C%2585%25E5%2590%25AB%25E6%2581%25B6%25E6%2584%258F%25E8%2584%259A%25E6%259C%25AC%250Auser_input_raw%2520%253D%2520%2522%253Cscript%253Ealert%2528'%25E6%2582%25A8%25E8%25A2%25AB%25E6%2594%25BB%25E5%2587%25BB%25E4%25BA%2586%25EF%25BC%2581'%2529%253C%252Fscript%253E%2522%250Ais_admin%2520%253D%2520True%2520%2523%2520%25E5%2581%2587%25E8%25AE%25BE%25E6%259C%2589%25E4%25B8%2580%25E4%25B8%25AA%25E6%259D%25A1%25E4%25BB%25B6%25E5%2588%25A4%25E6%2596%25AD%25E7%2594%25A8%25E6%2588%25B7%25E6%2598%25AF%25E5%2590%25A6%25E6%2598%25AF%25E7%25AE%25A1%25E7%2590%2586%25E5%2591%2598%250A%250A%2523%2520%25E4%25BD%25BF%25E7%2594%25A8escape%25E8%25BD%25AC%25E4%25B9%2589%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5%250Asafe_output%2520%253D%2520escape%2528user_input_raw%2529%250A%250A%2523%2520%25E6%2589%2593%25E5%258D%25B0%25E8%25BD%25AC%25E4%25B9%2589%25E5%2590%258E%25E7%259A%2584%25E7%25BB%2593%25E6%259E%259C%250Aprint%2528f%2522%25E8%25BD%25AC%25E4%25B9%2589%25E5%2590%258E%25E7%259A%2584%25E5%2586%2585%25E5%25AE%25B9%253A%2520%257Bsafe_output%257D%2522%2529%250A%250A%2523%2520%25E5%2581%2587%25E8%25AE%25BE%25E6%259C%2589%25E4%25B8%2580%25E4%25BA%259B%25E4%25BF%25A1%25E4%25BB%25BB%25E7%259A%2584HTML%25E5%2586%2585%25E5%25AE%25B9%25EF%25BC%258C%25E6%2588%2591%25E4%25BB%25AC%25E4%25B8%258D%25E5%25B8%258C%25E6%259C%259B%25E5%25AE%2583%25E8%25A2%25AB%25E8%25BD%25AC%25E4%25B9%2589%250Atrusted_html%2520%253D%2520Markup%2528%2522%253Cb%253E%25E8%25BF%2599%25E6%2598%25AF%25E5%258A%25A0%25E7%25B2%2597%25E7%259A%2584%25E6%2596%2587%25E6%259C%25AC%253C%252Fb%253E%2522%2529%250A%250A%2523%2520%25E5%25A6%2582%25E6%259E%259C%25E6%2598%25AF%25E7%25AE%25A1%25E7%2590%2586%25E5%2591%2598%25EF%25BC%258C%25E5%2588%2599%25E7%259B%25B4%25E6%258E%25A5%25E6%2598%25BE%25E7%25A4%25BA%25E5%258E%259F%25E5%25A7%258B%25E8%25BE%2593%25E5%2585%25A5%25EF%25BC%2588%25E8%25BF%2599%25E9%2587%258C%25E4%25BB%2585%25E4%25B8%25BA%25E6%25BC%2594%25E7%25A4%25BA%25EF%25BC%258C%25E5%25AE%259E%25E9%2599%2585%25E5%25BA%2594%25E7%2594%25A8%25E9%259C%2580%25E6%259E%2581%25E5%2585%25B6%25E8%25B0%25A8%25E6%2585%258E%25EF%25BC%2589%250Aif%2520is_admin%253A%250A%2520%2520%2520%2520print%2528f%2522%25E7%25AE%25A1%25E7%2590%2586%25E5%2591%2598%25E6%2598%25BE%25E7%25A4%25BA%25EF%25BC%2588%25E5%258D%25B1%25E9%2599%25A9%25EF%25BC%2581%25EF%25BC%2589%25EF%25BC%259A%257Buser_input_raw%257D%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520%2523%2520%25E5%2590%25A6%25E5%2588%2599%25E6%2598%25BE%25E7%25A4%25BA%25E5%25AE%2589%25E5%2585%25A8%25E7%259A%2584%25E5%2586%2585%25E5%25AE%25B9%250A%2520%2520%2520%2520print%2528f%2522%25E6%2599%25AE%25E9%2580%259A%25E7%2594%25A8%25E6%2588%25B7%25E6%2598%25BE%25E7%25A4%25BA%25EF%25BC%2588%25E5%25AE%2589%25E5%2585%25A8%25EF%25BC%2581%25EF%25BC%2589%25EF%25BC%259A%257Bsafe_output%257D%2522%2529%250A%250A%2523%2520%25E7%25BB%2593%25E5%2590%2588%25E4%25BD%25BF%25E7%2594%25A8%25EF%25BC%258CMarkup%25E6%25A0%2587%25E8%25AE%25B0%25E7%259A%2584%25E5%2586%2585%25E5%25AE%25B9%25E4%25B8%258D%25E4%25BC%259A%25E8%25A2%25AB%25E4%25BA%258C%25E6%25AC%25A1%25E8%25BD%25AC%25E4%25B9%2589%250Aformatted_output%2520%253D%2520Markup%2528f%2522%253Cp%253EHello%252C%2520%257Bsafe_output%257D!%253C%252Fp%253E%2522%2529%250Aprint%2528f%2522%25E7%25BB%2584%25E5%2590%2588%25E5%2590%258E%25E7%259A%2584%25E5%25AE%2589%25E5%2585%25A8HTML%253A%2520%257Bformatted_output%257D%2522%2529%250A%250A%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E6%2598%25AF%25E5%2590%25A6%25E6%2598%25AFMarkup%25E5%25AE%259E%25E4%25BE%258B%250Aif%2520isinstance%2528formatted_output%252C%2520Markup%2529%253A%250A%2520%2520%2520%2520print%2528%2522formatted_output%2520%25E6%2598%25AF%25E4%25B8%2580%25E4%25B8%25AA%2520Markup%2520%25E5%25AE%259E%25E4%25BE%258B%25EF%25BC%258C%25E5%25B7%25B2%25E8%25A2%25AB%25E6%25A0%2587%25E8%25AE%25B0%25E4%25B8%25BA%25E5%25AE%2589%25E5%2585%25A8%25E3%2580%2582%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528%2522formatted_output%2520%25E4%25B8%258D%25E6%2598%25AF%2520Markup%2520%25E5%25AE%259E%25E4%25BE%258B%25E3%2580%2582%2522%2529" target="_blank" title="https://www.min2k.com/tools/python-run/?code=from%20markupsafe%20import%20escape%2C%20Markup%0A%0A%23%20%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%0Auser_input_raw%20%3D%20%22%3Cscript%3Ealert%28'%E6%82%A8%E8%A2%AB%E6%94%BB%E5%87%BB%E4%BA%86%EF%BC%81'%29%3C%2Fscript%3E%22%0Ais_admin%20%3D%20True%20%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%0A%0A%23%20%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%0Asafe_output%20%3D%20escape%28user_input_raw%29%0A%0A%23%20%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%0Aprint%28f%22%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%3A%20%7Bsafe_output%7D%22%29%0A%0A%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%BA%9B%E4%BF%A1%E4%BB%BB%E7%9A%84HTML%E5%86%85%E5%AE%B9%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%8D%E5%B8%8C%E6%9C%9B%E5%AE%83%E8%A2%AB%E8%BD%AC%E4%B9%89%0Atrusted_html%20%3D%20Markup%28%22%3Cb%3E%E8%BF%99%E6%98%AF%E5%8A%A0%E7%B2%97%E7%9A%84%E6%96%87%E6%9C%AC%3C%2Fb%3E%22%29%0A%0A%23%20%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%8E%9F%E5%A7%8B%E8%BE%93%E5%85%A5%EF%BC%88%E8%BF%99%E9%87%8C%E4%BB%85%E4%B8%BA%E6%BC%94%E7%A4%BA%EF%BC%8C%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E9%9C%80%E6%9E%81%E5%85%B6%E8%B0%A8%E6%85%8E%EF%BC%89%0Aif%20is_admin%3A%0A%20%20%20%20print%28f%22%E7%AE%A1%E7%90%86%E5%91%98%E6%98%BE%E7%A4%BA%EF%BC%88%E5%8D%B1%E9%99%A9%EF%BC%81%EF%BC%89%EF%BC%9A%7Buser_input_raw%7D%22%29%0Aelse%3A%0A%20%20%20%20%23%20%E5%90%A6%E5%88%99%E6%98%BE%E7%A4%BA%E5%AE%89%E5%85%A8%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20print%28f%22%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%98%BE%E7%A4%BA%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%81%EF%BC%89%EF%BC%9A%7Bsafe_output%7D%22%29%0A%0A%23%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%EF%BC%8CMarkup%E6%A0%87%E8%AE%B0%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BA%8C%E6%AC%A1%E8%BD%AC%E4%B9%89%0Aformatted_output%20%3D%20Markup%28f%22%3Cp%3EHello%2C%20%7Bsafe_output%7D!%3C%2Fp%3E%22%29%0Aprint%28f%22%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%3A%20%7Bformatted_output%7D%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%98%AFMarkup%E5%AE%9E%E4%BE%8B%0Aif%20isinstance%28formatted_output%2C%20Markup%29%3A%0A%20%20%20%20print%28%22formatted_output%20%E6%98%AF%E4%B8%80%E4%B8%AA%20Markup%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%B7%B2%E8%A2%AB%E6%A0%87%E8%AE%B0%E4%B8%BA%E5%AE%89%E5%85%A8%E3%80%82%22%29%0Aelse%3A%0A%20%20%20%20print%28%22formatted_output%20%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%E3%80%82%22%29" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行这段代码，结果如下：</p>
<pre><code class="hljs language-text" lang="text">转义后的内容: &amp;lt;script&amp;gt;alert(&amp;#39;您被攻击了！&amp;#39;)&amp;lt;/script&amp;gt;
管理员显示（危险！）：&lt;script&gt;alert('您被攻击了！')&lt;/script&gt;
组合后的安全HTML: &lt;p&gt;Hello, &amp;lt;script&amp;gt;alert(&amp;#39;您被攻击了！&amp;#39;)&amp;lt;/script&amp;gt;!&lt;/p&gt;
formatted_output 是一个 Markup 实例，已被标记为安全。
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TB%250A%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E8%258E%25B7%25E5%258F%2596%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5%25E5%2592%258C%25E7%25AE%25A1%25E7%2590%2586%25E5%2591%2598%25E7%258A%25B6%25E6%2580%2581%257D%253B%250A%2520%2520B%2520--%253E%2520C%255B%25E4%25BD%25BF%25E7%2594%25A8escape%25E8%25BD%25AC%25E4%25B9%2589%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5%255D%253B%250A%2520%2520C%2520--%253E%2520D%255B%25E6%2589%2593%25E5%258D%25B0%25E8%25BD%25AC%25E4%25B9%2589%25E5%2590%258E%25E7%259A%2584%25E5%2586%2585%25E5%25AE%25B9%255D%253B%250A%2520%2520D%2520--%253E%2520E%257B%25E5%25A6%2582%25E6%259E%259C%2520isAdmin%2520%25E4%25B8%25BA%2520True%253F%257D%253B%250A%2520%2520E%2520--%2520%25E6%2598%25AF%2520--%253E%2520F%255B%25E6%2589%2593%25E5%258D%25B0%25E5%258E%259F%25E5%25A7%258B%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5%2520%2528%25E5%258D%25B1%25E9%2599%25A9%2529%255D%253B%250A%2520%2520E%2520--%2520%25E5%2590%25A6%2520--%253E%2520G%255B%25E6%2589%2593%25E5%258D%25B0%25E5%25AE%2589%25E5%2585%25A8%25E7%259A%2584%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5%255D%253B%250A%2520%2520F%2520--%253E%2520H%255B%25E5%2588%259B%25E5%25BB%25BA%25E5%25AE%2589%25E5%2585%25A8%25E7%259A%2584%2520Markup%2520%25E5%25AE%259E%25E4%25BE%258B%255D%253B%250A%2520%2520G%2520--%253E%2520H%253B%250A%2520%2520H%2520--%253E%2520I%255B%25E6%2589%2593%25E5%258D%25B0%25E7%25BB%2584%25E5%2590%2588%25E5%2590%258E%25E7%259A%2584%25E5%25AE%2589%25E5%2585%25A8HTML%255D%253B%250A%2520%2520I%2520--%253E%2520J%257B%25E6%25A3%2580%25E6%259F%25A5%2520formatted_output%2520%25E6%2598%25AF%25E5%2590%25A6%25E4%25B8%25BA%2520Markup%2520%25E5%25AE%259E%25E4%25BE%258B%253F%257D%253B%250A%2520%2520J%2520--%2520%25E6%2598%25AF%2520--%253E%2520K%255B%25E6%2589%2593%25E5%258D%25B0%25E6%2598%25AF%2520Markup%2520%25E5%25AE%259E%25E4%25BE%258B%255D%253B%250A%2520%2520J%2520--%2520%25E5%2590%25A6%2520--%253E%2520L%255B%25E6%2589%2593%25E5%258D%25B0%25E4%25B8%258D%25E6%2598%25AF%2520Markup%2520%25E5%25AE%259E%25E4%25BE%258B%255D%253B%250A%2520%2520K%2520--%253E%2520M%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B%250A%2520%2520L%2520--%253E%2520M%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%92%8C%E7%AE%A1%E7%90%86%E5%91%98%E7%8A%B6%E6%80%81%7D%3B%0A%20%20B%20--%3E%20C%5B%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20C%20--%3E%20D%5B%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%A6%82%E6%9E%9C%20isAdmin%20%E4%B8%BA%20True%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%20%28%E5%8D%B1%E9%99%A9%29%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E5%AE%89%E5%85%A8%E7%9A%84%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20F%20--%3E%20H%5B%E5%88%9B%E5%BB%BA%E5%AE%89%E5%85%A8%E7%9A%84%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20G%20--%3E%20H%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%5D%3B%0A%20%20I%20--%3E%20J%7B%E6%A3%80%E6%9F%A5%20formatted_output%20%E6%98%AF%E5%90%A6%E4%B8%BA%20Markup%20%E5%AE%9E%E4%BE%8B%3F%7D%3B%0A%20%20J%20--%20%E6%98%AF%20--%3E%20K%5B%E6%89%93%E5%8D%B0%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20J%20--%20%E5%90%A6%20--%3E%20L%5B%E6%89%93%E5%8D%B0%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20K%20--%3E%20M%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20L%20--%3E%20M%3B" ref="nofollow noopener noreferrer">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e6d8c2c86c24363b92394a63d6994f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770442527&amp;x-signature=9u43NqPZr%2BFF0nF8K20yhjrNJX8%3D" alt="MermerGo的markupsafe流程图" loading="lazy"/></p>
<h3 data-id="heading-5">五、学习资源</h3>
<ol>
<li>开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpallets%2Fmarkupsafe" target="_blank" title="https://github.com/pallets/markupsafe" ref="nofollow noopener noreferrer">markupsafe</a></li>
<li>中文自述：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Fmarkupsafe%2F" target="_blank" title="https://www.python64.cn/readme/markupsafe/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>在线运行：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br/>
学习过程中有任何问题，欢迎在评论区留言交流～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码随想录算法训练营day15]]></title>    <link>https://juejin.cn/post/7600863478930227219</link>    <guid>https://juejin.cn/post/7600863478930227219</guid>    <pubDate>2026-01-30T16:24:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600863478930227219" data-draft-id="7601007650722562089" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码随想录算法训练营day15"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-30T16:24:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="流浪小孩"/> <meta itemprop="url" content="https://juejin.cn/user/4355606019312011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码随想录算法训练营day15
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4355606019312011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    流浪小孩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T16:24:45.000Z" title="Fri Jan 30 2026 16:24:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>111求二叉树的最小深度
1.要求掌握最小深度出现的具体条件，并不是单边节点不存在的情况，而是该节点不存在孩子时才达到最小深度
2.依旧按照三部法设计递归算法
下面时中序遍历的递归算法设计</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-attr">public</span>:
    int <span class="hljs-title function_">getminDepth</span>(<span class="hljs-params">TreeNode* node</span>){
        <span class="hljs-comment">//设计终止条件</span>
        <span class="hljs-keyword">if</span>(node==nullptr) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">//设计单层递归</span>
        int leftDepth=<span class="hljs-title function_">getminDepth</span>(node-&gt;left);
        int rightDepth=<span class="hljs-title function_">getminDepth</span>(node-&gt;right);
       

        <span class="hljs-comment">//判断特殊情况</span>
        <span class="hljs-keyword">if</span>(node-&gt;right==nullptr&amp;&amp;node-&gt;left!=nullptr)
           <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>+leftDepth;
        <span class="hljs-keyword">if</span>(node-&gt;right!=nullptr&amp;&amp;node-&gt;left==nullptr)
           <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>+rightDepth;
        int result=<span class="hljs-title function_">min</span>(leftDepth,rightDepth)+<span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> result;

    }
    int <span class="hljs-title function_">minDepth</span>(<span class="hljs-params">TreeNode* root</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getminDepth</span>(root);
    }
};
</code></pre>
<p>先序遍历递归算法设计</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-attr">public</span>:
    int result;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getminDepth</span>(<span class="hljs-params">TreeNode* node,int depth</span>){
        <span class="hljs-comment">//设计终止条件</span>
        <span class="hljs-keyword">if</span>(node==nullptr) <span class="hljs-keyword">return</span> ;
        <span class="hljs-comment">//设计单层递归</span>
      <span class="hljs-comment">// 中，处理逻辑：判断是不是叶子结点</span>
        <span class="hljs-keyword">if</span> (node -&gt; left == nullptr &amp;&amp; node-&gt;right == nullptr) {
            result = <span class="hljs-title function_">min</span>(result, depth);
        }
        <span class="hljs-keyword">if</span> (node-&gt;left) { <span class="hljs-comment">// 左</span>
            <span class="hljs-title function_">getminDepth</span>(node-&gt;left, depth + <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">if</span> (node-&gt;right) { <span class="hljs-comment">// 右</span>
            <span class="hljs-title function_">getminDepth</span>(node-&gt;right, depth + <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> ;

    }
    int <span class="hljs-title function_">minDepth</span>(<span class="hljs-params">TreeNode* root</span>) {
        <span class="hljs-keyword">if</span>(root==nullptr) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        result=<span class="hljs-variable constant_">INT_MAX</span>;
        <span class="hljs-title function_">getminDepth</span>(root,<span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> result;
    }
};
</code></pre>
<pre><code class="hljs language-js" lang="js"/></pre>
<p>采用层次遍历迭代法求最小深度</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-attr">public</span>:
    int <span class="hljs-title function_">minDepth</span>(<span class="hljs-params">TreeNode* root</span>) {
        <span class="hljs-keyword">if</span>(root==nullptr) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">//层次遍历迭代法</span>
        queue&lt;<span class="hljs-title class_">TreeNode</span>*&gt; st;
        st.<span class="hljs-title function_">push</span>(root);
        int depth=<span class="hljs-number">0</span>;
        <span class="hljs-comment">//执行入队迭代</span>
        <span class="hljs-keyword">while</span>(!st.<span class="hljs-title function_">empty</span>()){
            int size=st.<span class="hljs-title function_">size</span>();
            depth++;
            <span class="hljs-keyword">for</span>(int i=<span class="hljs-number">0</span>;i&lt;size;i++){
               <span class="hljs-title class_">TreeNode</span>* tmp=st.<span class="hljs-title function_">front</span>();
               st.<span class="hljs-title function_">pop</span>();
               <span class="hljs-comment">//逐次入队</span>
               <span class="hljs-keyword">if</span>(tmp-&gt;left!=nullptr) st.<span class="hljs-title function_">push</span>(tmp-&gt;left);
               <span class="hljs-keyword">if</span>(tmp-&gt;right!=nullptr) st.<span class="hljs-title function_">push</span>(tmp-&gt;right);
               <span class="hljs-comment">//当达到终止条件时返回最小深度，最小深度的条件为两孩子均不存在</span>
               <span class="hljs-keyword">if</span>(tmp-&gt;left==nullptr&amp;&amp;tmp-&gt;right==nullptr) <span class="hljs-keyword">return</span> depth;
            }
        }
        <span class="hljs-keyword">return</span> depth;
    }
};
</code></pre>
<p>222.求完全二叉树的节点数量</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-attr">public</span>:
    int <span class="hljs-title function_">countNodes</span>(<span class="hljs-params">TreeNode* root</span>) {
        <span class="hljs-comment">//提供递归终止条件</span>
        <span class="hljs-keyword">if</span>(root==nullptr) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">//执行递归和返回参数</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>+<span class="hljs-title function_">countNodes</span>(root-&gt;left)+<span class="hljs-title function_">countNodes</span>(root-&gt;right);
    }
};
</code></pre>
<p>110 求平衡二叉树
1.掌握平衡二叉树的细节逻辑
2.根据递归三要素进行算法设计</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-attr">public</span>:
    int  <span class="hljs-title function_">getHeight</span>(<span class="hljs-params">TreeNode* node</span>){
        <span class="hljs-comment">//确定递归终止条件</span>
        <span class="hljs-keyword">if</span>(node==nullptr) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">//确定单层递归逻辑</span>
        <span class="hljs-comment">//设立左右子树高度</span>
        int  leftHeight=<span class="hljs-title function_">getHeight</span>(node-&gt;left);
        int  rightHeight=<span class="hljs-title function_">getHeight</span>(node-&gt;right);
        <span class="hljs-keyword">if</span> (leftHeight == -<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (rightHeight==-<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">abs</span>(leftHeight - rightHeight) &gt; <span class="hljs-number">1</span> ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span> + <span class="hljs-title function_">max</span>(leftHeight, rightHeight);
    }
    bool <span class="hljs-title function_">isBalanced</span>(<span class="hljs-params">TreeNode* root</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getHeight</span>(root) == -<span class="hljs-number">1</span> ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
    }
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[35 岁程序员被裁后的 if…else 人生分支（一段没人教你的代码）]]></title>    <link>https://juejin.cn/post/7600982613654405170</link>    <guid>https://juejin.cn/post/7600982613654405170</guid>    <pubDate>2026-01-31T03:22:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600982613654405170" data-draft-id="7600953879501701171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="35 岁程序员被裁后的 if…else 人生分支（一段没人教你的代码）"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-31T03:22:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户60732036945"/> <meta itemprop="url" content="https://juejin.cn/user/2156565626632060"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            35 岁程序员被裁后的 if…else 人生分支（一段没人教你的代码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2156565626632060/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户60732036945
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T03:22:15.000Z" title="Sat Jan 31 2026 03:22:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">35 岁程序员被裁后的 if…else 人生分支（一段没人教你的代码）</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">System</span> <span class="hljs-title class_">Error</span>:
<span class="hljs-title class_">Position</span> <span class="hljs-title class_">Not</span> <span class="hljs-title class_">Found</span>
</code></pre>
<p>那天 HR 说完这句话，我脑子里自动跑起了一段代码。</p>
<hr/>
<h3 data-id="heading-1">一、初始化变量</h3>
<pre><code class="hljs language-ini" lang="ini">$<span class="hljs-attr">age</span> = <span class="hljs-number">35</span><span class="hljs-comment">;</span>
$<span class="hljs-attr">role</span> = <span class="hljs-string">'PHP Backend Engineer'</span><span class="hljs-comment">;</span>
$<span class="hljs-attr">status</span> = <span class="hljs-string">'Laid Off'</span><span class="hljs-comment">;</span>

$<span class="hljs-attr">family</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
$<span class="hljs-attr">mortgage_years</span> = <span class="hljs-number">18</span><span class="hljs-comment">;</span>
$<span class="hljs-attr">savings_months</span> = <span class="hljs-number">8</span><span class="hljs-comment">;</span>
</code></pre>
<p>程序没崩，但心态开始内存泄漏。</p>
<hr/>
<h3 data-id="heading-2">二、第一条分支：送外卖？</h3>
<pre><code class="hljs language-ini" lang="ini">if ($<span class="hljs-attr">need_cash_flow</span> === <span class="hljs-literal">true</span>) {
    $<span class="hljs-attr">choice</span> = <span class="hljs-string">'delivery'</span><span class="hljs-comment">;</span>
}
</code></pre>
<p>这是最先进入我脑子的方案。</p>
<p><strong>优点很明显：</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+ 即刻结算</span>
<span class="hljs-addition">+ 不问年龄</span>
<span class="hljs-addition">+ 不看简历</span>
<span class="hljs-addition">+ 只看你跑不跑</span>
</code></pre>
<p>我甚至认真算过：</p>
<pre><code class="hljs language-ini" lang="ini">$<span class="hljs-attr">hours_per_day</span> = <span class="hljs-number">10</span><span class="hljs-comment">;</span>
$<span class="hljs-attr">days_per_month</span> = <span class="hljs-number">26</span><span class="hljs-comment">;</span>
$<span class="hljs-attr">income</span> = <span class="hljs-number">9000</span><span class="hljs-comment">; // optimistic</span>
</code></pre>
<p>程序能跑，逻辑也通。</p>
<p>但我很快加了一行注释：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// WARNING: 容易从“过渡方案”升级为“永久方案”</span>
</code></pre>
<p>当一个人只剩体力输出时，<br/>
<strong>大脑就会被系统自动降频。</strong></p>
<hr/>
<h3 data-id="heading-3">三、第二条分支：考公？</h3>
<pre><code class="hljs language-ini" lang="ini">if ($<span class="hljs-attr">want_stability</span> === <span class="hljs-literal">true</span>) {
    $<span class="hljs-attr">choice</span> = <span class="hljs-string">'civil_service_exam'</span><span class="hljs-comment">;</span>
}
</code></pre>
<p>家人强烈推荐这个方案。</p>
<p>我冷静写下判断条件：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$age</span> &gt; <span class="hljs-number">35</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">'Most positions are not accessible'</span>);
}
</code></pre>
<p>再补一行：</p>
<pre><code class="hljs language-ini" lang="ini">$<span class="hljs-attr">competitors</span> = <span class="hljs-string">'Full-time exam takers + fresh graduates + veterans'</span><span class="hljs-comment">;</span>
</code></pre>
<p>还有最终输出：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-variable">$income_next_5_years</span> &lt; <span class="hljs-variable">$previous_1_year_income</span>;
</code></pre>
<p>程序没有报错，<br/>
但 <strong>return false</strong>。</p>
<hr/>
<h3 data-id="heading-4">四、真正的异常，不在分支里</h3>
<p>那段时间，我每天在刷招聘网站。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">while</span> (<span class="hljs-variable">$resume_sent</span> &lt; <span class="hljs-number">50</span>) {
    <span class="hljs-variable">$reply</span> = <span class="hljs-literal">null</span>;
}
</code></pre>
<p>这才是真正的错误信息：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-literal">No</span> <span class="hljs-string">Response</span> <span class="hljs-string">Found</span>
</code></pre>
<p>不是我不会写代码，<br/>
而是我只会在<strong>公司环境</strong>里写代码。</p>
<hr/>
<h3 data-id="heading-5">五、一个偶然的“日志输出”</h3>
<p>有天，我在 CSDN 写了一篇技术踩坑记录。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">INFO</span>] User comment: “这个问题我也卡了三天，谢谢。”
</code></pre>
<p>那一刻我突然意识到：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-variable">$value</span> != current_position;
</code></pre>
<p>我没失效，只是<strong>调用场景变了</strong>。</p>
<hr/>
<h3 data-id="heading-6">六、我选了第三条路径（不是 else）</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$future</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'delivery'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'exam'</span>:
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
        <span class="hljs-variable">$choice</span> = <span class="hljs-string">'extend_ability'</span>;
}
</code></pre>
<p>我没清零，我做的是 <strong>扩展模块</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">$<span class="hljs-attr">skills</span> = [
    <span class="hljs-string">'Backend'</span>,
    <span class="hljs-string">'Debugging'</span>,
    <span class="hljs-string">'API Integration'</span>,
    <span class="hljs-string">'Server Troubleshooting'</span>,
    <span class="hljs-string">'SEO for Tech Content'</span>
]<span class="hljs-comment">;</span>
</code></pre>
<p>我开始：</p>
<ul>
<li>把踩坑写成文章</li>
<li>把问题写成搜索答案</li>
<li>把经验变成「可被搜索到的资产」</li>
</ul>
<p>收入一开始很低，但曲线是：</p>
<pre><code class="hljs">slow → stable → growing
</code></pre>
<hr/>
<h3 data-id="heading-7">七、35 岁程序员真正的 fatal error</h3>
<p>不是被裁，而是：</p>
<pre><code class="hljs language-scss" lang="scss">if ($skill_is_single &amp;&amp; $value_depends_on_company) {
    <span class="hljs-built_in">fatal_error</span>();
}
</code></pre>
<p>公司没了，<br/>
你也跟着 <strong>404</strong>。</p>
<hr/>
<h3 data-id="heading-8">八、给正在调试人生的你</h3>
<p>如果你现在正卡在这里：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">try</span> {
    <span class="hljs-title function_ invoke__">findNextStep</span>();
} <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">'I am lost'</span>;
}
</code></pre>
<p>我想告诉你一句：</p>
<pre><code class="hljs">程序可以重构，人也可以。
</code></pre>
<p>别急着把自己降级成「最低配置」，<br/>
你只是需要一次 <strong>架构调整</strong>。</p>
<hr/>
<h3 data-id="heading-9">END</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">Process finished <span class="hljs-keyword">with</span> <span class="hljs-keyword">exit</span> code <span class="hljs-number">0</span>
But story <span class="hljs-built_in">is</span> still running…
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[7个神级技巧，彻底去除网站的 AI 味儿！]]></title>    <link>https://juejin.cn/post/7600967006892490761</link>    <guid>https://juejin.cn/post/7600967006892490761</guid>    <pubDate>2026-01-30T08:20:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600967006892490761" data-draft-id="7600622206270128138" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="7个神级技巧，彻底去除网站的 AI 味儿！"/> <meta itemprop="keywords" content="前端,后端,AI编程"/> <meta itemprop="datePublished" content="2026-01-30T08:20:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员鱼皮"/> <meta itemprop="url" content="https://juejin.cn/user/2444938365386621"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            7个神级技巧，彻底去除网站的 AI 味儿！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2444938365386621/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员鱼皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T08:20:11.000Z" title="Fri Jan 30 2026 08:20:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是程序员鱼皮。</p>
<p>先做个小测试，下面这几个网站，你能看出哪些是 AI 做的吗？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8aeb2a39b3b4e5d99deffac57a3dff0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=0bpDON%2FkkzJtdQ%2FAkDRT9xyMnzQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d981aa93f069467890588ba8e857aee5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=MzKc5V8siwfvNtixdRaaEXCRrjc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0efb7fdec1b48278f23882d911adf38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=31j1uqKRJWSq3ynuTA9wXqBPg1w%3D" alt="" loading="lazy"/></p>
<p>公布答案：<strong>全都是 AI 做的！</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f1239f7425644e2af1e1ef212cd8b0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=Gw2iBV0eQ4PJDowBWPf5XJ3bs9E%3D" alt="" loading="lazy"/></p>
<p>是不是觉得有点意外？</p>
<p>“为啥我用 AI 搓出来的网站一股子 AI 味儿？而这些网站看起来干净很多呢？”</p>
<p>这就是接下来我要分享的：</p>
<ul>
<li>什么是 AI 编程的 AI 味儿？</li>
<li>为什么网站会有 AI 味儿？</li>
<li>怎么去除网站的 AI 味儿？</li>
</ul>
<p>点个收藏，我们开始~</p>
<p>⭐️ 推荐观看本文对应视频版，效果更明显：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbilibili.com%2Fvideo%2FBV1QF6EBiErM" target="_blank" title="https://bilibili.com/video/BV1QF6EBiErM" ref="nofollow noopener noreferrer">bilibili.com/video/BV1QF…</a></p>
<h2 data-id="heading-0">什么是 AI 味儿？</h2>
<p>所谓的 AI 味儿，就是那种一眼就能看出是 AI 生成的网站，界面样式和内容风格都千篇一律。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/379f910bb5044716a489af694d8fce6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=nBYRpctjPBLIqvFPU31oLHTKkR4%3D" alt="" loading="lazy"/></p>
<p>1）配色死板：蓝紫渐变色用到吐。</p>
<p>2）布局死板：首屏放个大标题，下面三个卡片并排。</p>
<p>3）字体死板：基本上就是 Inter、Roboto 等几种固定的字体。</p>
<p>4）Emoji 泛滥：什么 🐟4️⃣🐶 之类的，满屏幕都是表情图标。</p>
<p>5）内容空洞：基本没有真实图片，文字风格也比较刻板。</p>
<p>用户看这些网站时就一个感觉：我在跟机器人聊天。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/010245c63550439692b1890af4f39e81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=2NYJ8D%2FNV%2FQfIkZJH5THNk%2FnCto%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">为什么网站会有 AI 味儿？</h2>
<p>说了这么多问题，到底为啥会这样？</p>
<p>核心原因就俩字：<strong>求稳</strong>。</p>
<p>举个例子，为啥 AI 那么爱用蓝紫渐变色？</p>
<p>因为 AI 的训练数据里，很多现代网站采用 Tailwind 样式库，而这个库的默认主色调就是蓝紫色。AI 在学习数亿行代码时，这些颜色出现的频率是最高的，于是 AI 就认为 “现代化网站 ≈ 蓝紫色渐变”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef543a0e542f4508bd34c8efe956db8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=kQFM%2F75dxtxCZcBBqHC8vJQfYbc%3D" alt="" loading="lazy"/></p>
<p>并且 AI 学会了一个生存法则：<strong>用最常见的 = 最不容易出错</strong>。</p>
<p>所以当你让 AI “开发一个现代化的网站” 时，AI 为了求稳，就会选择使用蓝紫渐变色。</p>
<p><strong>那怎么破局？</strong></p>
<p>很简单，从 “请求者” 变成 “指挥官”。</p>
<p>不要只说需求：给我做个网站</p>
<p>而是要明确要求：用深灰色背景、手绘图标、不对称布局、拒绝蓝紫色。</p>
<p>用强有力的约束条件，逼着 AI 偏离它的舒适区。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afbeb6e3b77a48ec842110f183b604e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=5SRgFpPTlD6x1pMJA6aCLWI7SwA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">怎么去除网站的 AI 味儿？</h2>
<p>下面分享我总结的 7 个方法，保证让你的网站摆脱 AI 味儿。</p>
<h3 data-id="heading-3">方法 1、让 AI 参考真实网站</h3>
<p>最简单粗暴的一招，你看到好看的网站，直接让 AI 学。</p>
<p>有 4 种具体的做法：</p>
<p>1）如果你使用 Cursor 或者 Claude Code 等 AI 编程工具，或者利用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.firecrawl.dev%2F" target="_blank" title="https://www.firecrawl.dev/" ref="nofollow noopener noreferrer">Firecrawl MCP</a>，让 AI 能够直接读取网页。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/249b68b945884654b012618931387cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=oItnY1WTenMP%2BG0yACg2UsU7lRg%3D" alt="" loading="lazy"/></p>
<p>你只需要跟 AI 说：</p>
<pre><code class="hljs">请访问 ai.codefather.cn，提取它的配色方案、字体选择和布局结构，然后生成类似风格的网站。
</code></pre>
<p>AI 会自己去看那个网站，然后学着做。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a2a56a0cbf443ac869d3e0939115d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=C86GZRpZbU2lOSMDUzTMW0k00Xc%3D" alt="" loading="lazy"/></p>
<p>2）如果 AI 大模型支持图片理解，你还可以把网页截图提供给 AI，搭配文字能让 AI 还原网站更准确。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3001324d388b4a6788c5ff083d6db8f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=%2BHsByENVUn6PIv1yd2XljOp%2FuTE%3D" alt="" loading="lazy"/></p>
<p>效果如图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0743de1f94d4b32b97c72e1a4f1d54b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=KnzD7Kv0evEM7IN3GJaIAGavux4%3D" alt="" loading="lazy"/></p>
<p>3）如果你用的 AI 大模型不支持图片理解、纯文本理解又不到位，可以先利用 <strong>截图转代码</strong> 工具，比如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fabi%2Fscreenshot-to-code" target="_blank" title="https://github.com/abi/screenshot-to-code" ref="nofollow noopener noreferrer">Screenshot to Code</a>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9130dad6de3416d9ea972f2473108db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=SLlsSAS%2BQokDrzSLRizjL%2FtBxP0%3D" alt="" loading="lazy"/></p>
<p>把喜欢的网站截个图，上传上去，它直接给你转成代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a93ca5f32944a009675a9c8a9eeb714~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=V7ME9OxkYZEgEaYxDwiOsJiit%2B8%3D" alt="" loading="lazy"/></p>
<p>然后你再把代码喂给 AI，让它参考着做。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7c978c1dcdf4e3db3e61cf24eff537b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=8oZHcLqjqi9FvRnu8Z5TgB5DLpg%3D" alt="" loading="lazy"/></p>
<p>准确度会高很多，抄样式肯定不如抄代码来的直接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5845a245f2cf4a86828315389f186029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=jsbcpWZ1t6zPYKtZhKWLYTtPqlU%3D" alt="" loading="lazy"/></p>
<p>4）此外，还可以直接套用现成的网站模板或者 GitHub 上的开源项目。</p>
<p>推荐几个不错的网站模板资源：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhtml5up.net%2F" target="_blank" title="https://html5up.net/" ref="nofollow noopener noreferrer">HTML5 UP</a>：免费的响应式网站合集，极简风格</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.wordpress.org%2Fthemes%2F" target="_blank" title="https://cn.wordpress.org/themes/" ref="nofollow noopener noreferrer">WordPress 官方主题库</a>：1 万多个免费主题，啥类型都有</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fstartbootstrap.com%2F" target="_blank" title="https://startbootstrap.com/" ref="nofollow noopener noreferrer">Start Bootstrap</a>：Bootstrap 生态的免费网站模板库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcolorlib.com%2Fwp%2Ffree-wordpress-themes%2F" target="_blank" title="https://colorlib.com/wp/free-wordpress-themes/" ref="nofollow noopener noreferrer">Colorlib</a>：提供不少免费的网站模板，设计精美</li>
</ul>
<p>这些网站模板都有源代码，你选个不错的下载下来，把代码丢给 AI 让它去改改内容就好了，样式基本准确还原。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dae673d7786c4315802c87f39fa69b5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=3aT31PQk5Yd8Fo%2Fr1abFOc40aD8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">方法 2、设计优先开发</h3>
<p>这个方法特别适合做大项目。</p>
<p>简单来说，就是 <strong>不要上来就让 AI 梭哈整个项目</strong>。</p>
<p>比如传统做法是这样的：帮我做一个包含用户系统、后台管理的完整 SaaS 平台。</p>
<p>然后 AI 哗啦哗啦给你生成几十个文件，结果做完后发现页面风格不对，重新返工，浪费 Tokens。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29c2d4f5e407467db4cd2fd57df948d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=FXqft01eP7snVP1%2Fqjo2GqbWsRY%3D" alt="" loading="lazy"/></p>
<p>推荐的做法是 <strong>拆分步骤</strong>，先让 AI 做个前端网站 Demo，纯静态页面就好。对设计满意了之后，再让 AI 基于 Demo 代码，用同样的风格开发完整项目。</p>
<p>你像我生成出下面这种破玩意，肯定是不能让 AI 继续开发的！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4f4796a30514f2fb0094d5e2b24592a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=nEPLgtXwiiK6N%2B39ZBuUP1L7k6s%3D" alt="" loading="lazy"/></p>
<p>这里推荐一个很强大的 AI 设计工具 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstitch.withgoogle.com%2F" target="_blank" title="https://stitch.withgoogle.com/" ref="nofollow noopener noreferrer">Google Stitch</a>。</p>
<p>你只需要输入一段描述，它就能生成专业的界面原型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18c39da7cec24cdc905f8074f09273bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=hxC9YVqvLCww5kM%2BZVyjivRlnv0%3D" alt="" loading="lazy"/></p>
<p>甚至你在纸上画个草图，拍照上传，它都能识别出来转成代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c0e6aa6a36a4a3098f86bd09dce08be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=6CKODVouKMAA7mrtw9%2FlFc9ygcA%3D" alt="" loading="lazy"/></p>
<p>你还可以人工修改设计的主题风格，或者人工标注要修改的部分，让 AI 帮你快速调整。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64bf3c84f1f44200bd99b380c1453b97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=Ep5DE02xVFY8I4FZIBplifsnSrI%3D" alt="" loading="lazy"/></p>
<p>设计完成后，导出文件或下载代码，再喂给 Cursor 等 AI 编程工具继续开发。这样风格就定下来了，不会跑偏。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1934e865014cdeb4bb18a0005c5725~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=Eng8a%2FXMsCBkn5iMj4KI2zOBKEg%3D" alt="" loading="lazy"/></p>
<p>当然，如果你会用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2F" target="_blank" title="https://www.figma.com/" ref="nofollow noopener noreferrer">Figma</a> 这种更专业的设计工具，你可以先在 Figma 里把网站设计得清清楚楚。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41c43de9f0914c7295823661bc66dda6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=DcC3QlXDMYtDWRy%2B%2BtypjW9sH78%3D" alt="" loading="lazy"/></p>
<p>然后搭配 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGLips%2FFigma-Context-MCP" target="_blank" title="https://github.com/GLips/Figma-Context-MCP" ref="nofollow noopener noreferrer">Figma MCP</a> 扩展，让 AI 直接读取你的 Figma 设计文件，按照设计生成代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c31765a70e14c8ba2d0ea508cc6d3b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=JUaWpx%2FfE4ccc%2FD188lE7QK%2F4Ks%3D" alt="" loading="lazy"/></p>
<p>此外，还有个工具叫 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.onlook.ai%2F" target="_blank" title="https://www.onlook.ai/" ref="nofollow noopener noreferrer">Onlook</a>，号称为设计师准备的 Cursor，可以让设计师直接可视化编辑网页代码，设计和开发无缝衔接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c68d1a1f37354e0984287524c0a5227b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=A6ybOP60nYBkniqFIugoxWE%2FkRw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">方法 3、丰富网站图片</h3>
<p>一般 AI 生成的网站是没有图片的，我们可以通过添加图片让网站更个性化。</p>
<p>没必要让 AI 从 0 开始生图，只要告诉 AI 去主动找图、到哪里找图就好。</p>
<p>图片资源主要包括插画、图标、真实照片和占位图这几类。</p>
<p>1）插画库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fundraw.co%2F" target="_blank" title="https://undraw.co/" ref="nofollow noopener noreferrer">unDraw</a>：有非常多免费的 SVG 插画，而且可以自定义颜色。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f96d30d32b144d0a3c093813aaacab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=YBc733hcmolrpMHup7SQmtb3yGo%3D" alt="" loading="lazy"/></p>
<p>2）图标库 <a href="https://link.juejin.cn?target=https%3A%2F%2Ficonify.design%2F" target="_blank" title="https://iconify.design/" ref="nofollow noopener noreferrer">Iconify</a>：20 多万个免费矢量图标</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/647bc0e69eb24cb58ed777fbbdbcbe15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=AxKSLMlxXjoXB7ui3LgisXVWiGE%3D" alt="" loading="lazy"/></p>
<p>3）真实照片 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pexels.com%2F" target="_blank" title="https://www.pexels.com/" ref="nofollow noopener noreferrer">Pexels</a>：免费高质量图库，还提供了 API 快速搜索图片</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50dbfd809ab4d6d921850308342adf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=UnsYl96mDTeZyxXnRfZ9LMjia1s%3D" alt="" loading="lazy"/></p>
<p>4）占位图 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpicsum.photos%2F" target="_blank" title="https://picsum.photos/" ref="nofollow noopener noreferrer">Picsum Photos</a>：直接用 URL 指定图片尺寸，每次刷新都是不同的真实照片</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e39c87eec6244f9b3d6acff9485a581~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=etKn48PmUwlycVGV7yYotcoBVn0%3D" alt="" loading="lazy"/></p>
<p>如果你的 AI 编程工具支持网页读取，可以直接让 AI 从这些网站搜索图片：</p>
<pre><code class="hljs language-markdown" lang="markdown">我要开发一个摄影作品集网站
请根据需要，为网站搜索并集成图片资源：
<span class="hljs-bullet">1.</span> 插画：使用 undraw.co，搜索与网站内容相关的插画
<span class="hljs-bullet">2.</span> 图标：使用 Iconify 图标库
<span class="hljs-bullet">3.</span> 真实照片：使用 Pexels 搜索真实照片
<span class="hljs-bullet">4.</span> 占位图：使用 Picsum Photos 作为临时占位图
</code></pre>
<p>这下，生成的网站看起来成熟多了吧？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16524929219447168c43785e64fc7324~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=76De6e9Nn9yrK5O6CqVdf82e1JM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">方法 4、提示词约束</h3>
<p>就算不搞那些花里胡哨的工具，只要跟 AI 对话时，把你的要求说清楚，一样能让网站变专业。</p>
<p>Claude 官方的 Cookbook 中有篇文章 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fcookbook%2Fcoding-prompting-for-frontend-aesthetics" target="_blank" title="https://platform.claude.com/cookbook/coding-prompting-for-frontend-aesthetics" ref="nofollow noopener noreferrer">Frontend Aesthetics</a>（前端美学），专门讲怎么避免让 AI 生成具有 AI 味儿的通用设计。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ae489a8de684d93b1eeee50db429e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=p55%2BSbe9bCdeFgrOQbH3LUyJrX4%3D" alt="" loading="lazy"/></p>
<p>下面讲几个我自己常用的提示词技巧。</p>
<h4 data-id="heading-7">1）反向提示</h4>
<p>不要只说 “要什么”，更要说 “不要什么”。</p>
<pre><code class="hljs language-csharp" lang="csharp">设计禁止清单：
❌ 紫色/靛蓝色渐变
❌ 纯平背景色（必须有噪点或渐变）
❌ Hero + 三卡片布局
❌ 完美居中对齐
❌ 高深的专业名词和无意义的空话
❌ Emoji 作为功能图标
❌ 线性动画 ease-<span class="hljs-keyword">in</span>-<span class="hljs-keyword">out</span>
</code></pre>
<p>你把这些禁止项写清楚，AI 就不敢乱来了。</p>
<h4 data-id="heading-8">2）角色设定</h4>
<p>给 AI 定个人设，比如：</p>
<pre><code class="hljs language-arduino" lang="arduino">你是一位资深独立设计师，专注于《反主流》的网页美学。
你鄙视千篇一律的 SaaS 模板，认为软件界面应该有触感和灵魂。
你的创意边界：
- <span class="hljs-string">"现代但不要紫色"</span> → 可以试试深灰+橙色
- <span class="hljs-string">"极简但要有温度"</span> → 用大留白+手绘插画
- <span class="hljs-string">"科技感但不要冰冷"</span> → 用深色+暖色点缀
</code></pre>
<p>这样 AI 就知道，它不是在做标准答案，而是在做有个性的设计。</p>
<h4 data-id="heading-9">3）拒绝空洞文案</h4>
<p>AI 特别喜欢写那些 “听起来很厉害但啥也没说” 的文案。</p>
<p>你得明确告诉它文案的要求：</p>
<pre><code class="hljs language-arduino" lang="arduino">网站的文字内容必须做到：
- 具体化：<span class="hljs-string">"每天节省 2 小时重复劳动"</span>（不要说<span class="hljs-string">"提升生产力"</span>）
- 口语化：<span class="hljs-string">"用起来就像呼吸一样自然"</span>（不要说<span class="hljs-string">"卓越的用户体验"</span>）
- 带情绪：<span class="hljs-string">"再也不用在 10 个群里找文件了"</span>（不要说<span class="hljs-string">"高效协作"</span>）
- 甚至可以挑衅：<span class="hljs-string">"别再假装你会看完那些 PPT 了"</span>
</code></pre>
<p>这样文案就会更有人味儿了。</p>
<h4 data-id="heading-10">4）语境注入</h4>
<p>AI 老是生成通用设计，是因为它不知道你要传达什么 “感觉”。</p>
<p>所以我们可以尝试 <strong>先给 AI 喂情绪，再提设计</strong>。</p>
<p>比如你要做个具有科技感的博客网站，可以这么说：</p>
<pre><code class="hljs language-diff" lang="diff">先阅读这段话：《黑客与画家》 - 编程语言是用来思考的
​
现在根据这种冷静、理性的情绪设计博客首页：
<span class="hljs-deletion">- 配色：深灰+冷蓝</span>
<span class="hljs-deletion">- 布局：理性、有序</span>
<span class="hljs-deletion">- 感觉：沉思的、专注的</span>
</code></pre>
<p>AI 会把视觉参数（颜色、间距、字体）和文本的情感特征（冷静、理性）对齐，生成有特定氛围的设计。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/104eb287f1fd4a6bae9e78909f997fcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=4f0wLuPwD%2FnQPD1DXviTejOrkU0%3D" alt="" loading="lazy"/></p>
<p>就像给演员说戏，不是告诉他演得开心一点，而是让他回忆一段开心的记忆，情绪自然就出来了。</p>
<h4 data-id="heading-11">5）复用提示词</h4>
<p>前面讲了这么多约束条件，你不能每次都重复人工编写一遍吧？</p>
<p>所以要保存提示词为项目规则文件 <a href="https://link.juejin.cn?target=https%3A%2F%2Fagents.md%2F" target="_blank" title="https://agents.md/" ref="nofollow noopener noreferrer">AGENTS.md</a>，便于多次复用。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fagents.md%2F" target="_blank" title="https://agents.md/" ref="nofollow noopener noreferrer">AGENTS.md</a> 是一个开放标准，让不同的 AI 工具都能读取同一份规则文件，主流的 AI 编程工具（Cursor、Claude Code、Windsurf 等）都支持。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08067d2456f64ebbb97e216e302caf1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=pv6esUMNQmnYVrI73mhC70wNx4w%3D" alt="" loading="lazy"/></p>
<p>比如这里我给大家准备了一套提示词模板，包含了前面讲的所有技巧：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目设计规则（AGENTS.md）</span>
​
<span class="hljs-section">## 角色设定</span>
你是一位资深独立设计师，专注于 "反主流" 的网页美学。
你鄙视千篇一律的 SaaS 模板，追求每个像素都有温度。
​
<span class="hljs-section">## ❌ 绝对禁止项</span>
​
<span class="hljs-section">### 配色禁止</span>
<span class="hljs-bullet">-</span> 紫色/靛蓝色/蓝紫渐变（#6366F1、#8B5CF6）
<span class="hljs-bullet">-</span> 纯平背景色（必须有噪点纹理或渐变）
<span class="hljs-bullet">-</span> Tailwind 默认色板
​
<span class="hljs-section">### 布局禁止</span>
<span class="hljs-bullet">-</span> Hero + 三卡片布局
<span class="hljs-bullet">-</span> 完美居中对齐
<span class="hljs-bullet">-</span> 等宽多栏（必须不对称）
​
<span class="hljs-section">### 文案禁止</span>
<span class="hljs-bullet">-</span> 高深的专业名词和无意义的空话
<span class="hljs-bullet">-</span> Lorem Ipsum 占位文本
<span class="hljs-bullet">-</span> 被动语态和长句
​
<span class="hljs-section">### 组件禁止</span>
<span class="hljs-bullet">-</span> Shadcn/Material UI 默认组件（必须深度定制）
<span class="hljs-bullet">-</span> Emoji 作为功能图标
<span class="hljs-bullet">-</span> 线性动画（ease-in-out）
​
<span class="hljs-section">## ✅ 必须遵守项</span>
​
<span class="hljs-section">### 文案风格</span>
<span class="hljs-bullet">-</span> 口语化，像朋友聊天
<span class="hljs-bullet">-</span> 具体化，有数字和场景
<span class="hljs-bullet">-</span> 可以幽默、自嘲、甚至挑衅
<span class="hljs-bullet">-</span> 每句话不超过 15 个字
​
<span class="hljs-section">### 图片系统</span>
<span class="hljs-bullet">-</span> 图标：使用 Iconify 图标库（https://iconify.design）
<span class="hljs-bullet">-</span> 占位图：使用 Picsum Photos（https://picsum.photos）
<span class="hljs-bullet">-</span> 真实图片：使用 Pexels 搜索（https://www.pexels.com）
<span class="hljs-bullet">-</span> 插画：使用 unDraw（https://undraw.co）
</code></pre>
<p>保存这个文件为 <code>AGENTS.md</code>，放在项目根目录，以后每次跟 AI 对话，它都会自动读取这个文件，按照你的要求来工作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50477347eb924c1182523f78784854b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=CHipMdFbPxaJHO61%2FdjeFDKlkiY%3D" alt="" loading="lazy"/></p>
<p>举个例子，输入跟之前一毛一样的需求 “帮我做个动漫视频网站”，有了规则文件后，效果立竿见影！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcc715792d5a44c98d038b029db64fad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=TSItSeP49UzjwiS2dykMnQfP5EM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">方法 5、Agent Skills</h3>
<p>如果你觉得自己写提示词太麻烦，还有个更省事的办法 —— <strong>Agent Skills</strong>。</p>
<p>简单来说，Agent Skills 就是别人封装好的专业技能包，你直接在 AI 编程工具中安装就能用，让 AI 学会各种专业技能，比如制作 PPT、整理 Excel 表格等等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/644319a0fe60470a82cae974dd1c602a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=5JaM6AS0ONbSb6Gfj2SLDW01wtM%3D" alt="" loading="lazy"/></p>
<p>如果想让 AI 开发的网站更精美独特，可以用下面 2 个 Skills。</p>
<h4 data-id="heading-13">Frontend-design</h4>
<p>这是 Anthropic 官方出品的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskills%2Ffrontend-design" target="_blank" title="https://github.com/anthropics/skills/tree/main/skills/frontend-design" ref="nofollow noopener noreferrer">前端设计技能</a>，可以教 AI 生成专业设计感网站。</p>
<p>用法很简单，以 Claude Code 为例。</p>
<p>首先打开 Claude Code 并输入命令，添加官方技能市场：</p>
<pre><code class="hljs language-bash" lang="bash">/plugin marketplace add anthropics/skills
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a4861639e494380b67840724c523c39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=ofe9CxmYl33vPqqFCkawqkJCeZ8%3D" alt="" loading="lazy"/></p>
<p>这就像是在你的 AI 助手里开通了一个技能商店，接下来你就可以从商店中获取技能了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9766cb132bf49e485a5bb7a20f460c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=o%2Bz3YhImnVxOU7bp8WzWm0FgdA0%3D" alt="" loading="lazy"/></p>
<p>在 Claude Code 中输入命令，安装官方提供的技能包：</p>
<pre><code class="hljs language-bash" lang="bash">/plugin install example-skills@anthropic-agent-skills
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6502c0e5fa446cdbba55bbf20a07813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=X8v5D7yrVnBe6OzqZOKNVbqHY7k%3D" alt="" loading="lazy"/></p>
<p>这个 example-skills 包含了一堆官方示例技能，包括前端设计、网页测试、动图制作等等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d593dda8d5d64b069559c08fad659f23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=IvHql2PPbaod2u4fRboDV2h5cds%3D" alt="" loading="lazy"/></p>
<p>装完之后，你就可以直接让 AI 使用这些技能了。</p>
<p>比如你输入：帮我开发个人作品集网站。</p>
<p>AI 会主动问你：我发现你安装了前端设计技能，需要用它来生成更具设计感的页面吗？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f9e955d7dcb42b5aafc67e6111fd3b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=CW6gpRq%2BItryzEwVHF%2Fmphc1OKg%3D" alt="" loading="lazy"/></p>
<p>确认之后，AI 会利用技能生成代码，告别蓝紫渐变、生成独特风格的精美页面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e6ab10ad5844348b8dde996d60723bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=FXipvjg1vW9PzbHpIuc01zQeE3U%3D" alt="" loading="lazy"/></p>
<p>不用每次都给 AI 输入一大堆相同的提示词，装一次技能就行了。</p>
<h4 data-id="heading-14">UI UX Pro Max</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fui-ux-pro-max-skill.nextlevelbuilder.io%2F" target="_blank" title="https://ui-ux-pro-max-skill.nextlevelbuilder.io/" ref="nofollow noopener noreferrer">UI UX Pro MAX</a> 是我现在用下来最顺手的去 AI 味儿技能了，专门用于提升 AI 的设计能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103931e434e74275ba12416ab57a715d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=xhbWS2O4yYQJGFmI682F3yLXR9s%3D" alt="" loading="lazy"/></p>
<p>它支持几乎目前所有主流的 AI 编程工具，比如 Claude Code、Cursor、VS Code、Codex 等等。</p>
<p>用法很简单，首先按照 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnextlevelbuilder%2Fui-ux-pro-max-skill" target="_blank" title="https://github.com/nextlevelbuilder/ui-ux-pro-max-skill" ref="nofollow noopener noreferrer">开源仓库文档</a> 的指引，安装官方提供的命令行工具：</p>
<pre><code class="hljs">npm install -g uipro-cli
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17cd75ec498b4f298b30b30c57b17013~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=qAuT5yqkCO%2FHBzfQWgcVEezJfF4%3D" alt="" loading="lazy"/></p>
<p>然后进入到你的项目目录下，根据使用的 AI 工具执行对应的命令。比如我这里用 Cursor：</p>
<pre><code class="hljs language-css" lang="css">uipro init <span class="hljs-attr">--ai</span> <span class="hljs-attribute">cursor</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0484866840a14cc1b991baafd76e72d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=Ne9yfYfl%2BZiaLWRMTwpI9ZhQz60%3D" alt="" loading="lazy"/></p>
<p>它会自动把技能安装到 Cursor 的配置目录里。</p>
<p>接下来，当你让 AI 开发一个网站时，可以使用斜杠命令手动触发技能，或者让 AI 自动识别技能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f245d5dd34114c06af6dd41e769833a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=dFq2tftYV%2FZ2u1X1YPmdqTR6E2s%3D" alt="" loading="lazy"/></p>
<p>1）AI 会根据你的需求识别出产品类型和需要的页面类型</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c0cf15e53194a1bb00a6da9323eff54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=orqXJUYDZQTrOZLMDw2sM1KvvFM%3D" alt="" loading="lazy"/></p>
<p>2）然后调用 <code>search.py</code> 搜索脚本，在 data 目录里进行多维度搜索，找到适合的配色、字体、布局风格</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fdc779af114480bad0a143a087311ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=KhIUJM5ptJ7%2F6enWLVwJxbveCxs%3D" alt="" loading="lazy"/></p>
<p>3）综合搜索结果，生成完整的设计方案（主色调、字体组合、间距规范等）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d900135d71a84274b5ba70e422573689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=QOK41dcGVFjvbuRWT0Jt59zHA98%3D" alt="" loading="lazy"/></p>
<p>4）最后，再按照设计方案生成代码</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b22185983f04384905d13593f55df40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=5JEFgbr1FYX9qLZ1IFeOt2dqdSs%3D" alt="" loading="lazy"/></p>
<p>这样一来，生成的界面既专业又有设计感。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4a97ca27c6c450fb26cc2dfce4e6606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=MuPEmfLxYU4DdCWXkuMgw8pJ9qk%3D" alt="" loading="lazy"/></p>
<p>AI 不需要把所有规则都背下来，而是用到哪个查哪个，这就是 Agent Skills 的精髓。</p>
<h3 data-id="heading-15">方法 6、反 AI 味儿组件库</h3>
<p>前面提到，AI 为了保险，默认会选最主流的组件库，比如 Tailwind CSS、Shadcn UI 等。</p>
<p>这些库虽然专业，但也最容易产生 AI 味儿。</p>
<p>所以我们可以反其道而行之，明确告诉 AI 用一些 <strong>小众但有特色</strong> 的组件库。</p>
<p>比如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.aceternity.com%2F" target="_blank" title="https://ui.aceternity.com/" ref="nofollow noopener noreferrer">Aceternity UI</a> 这个库专门做那种炫酷效果，什么闪光粒子（Sparkles）、极光背景（Aurora Background）、流星效果（Meteors），都是高计算量的视觉组件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4bfda3644e145f6823090d184812202~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=Ch1xkHGaKUbhYAW5A6AIXXCH00M%3D" alt="" loading="lazy"/></p>
<p>AI 很难从零写出这么复杂的效果，但你直接让 AI 用这个库，几行代码就能搞定。</p>
<p>要注意，对于这些相对小众的组件库，AI 可能不太熟悉用法。建议安装 Context7 插件，可以实时查询最新文档。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b94668fe68b443b963417ae7d15acef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=sIRWnby0DGSyp1e5B6ubYs2i%2FbM%3D" alt="" loading="lazy"/></p>
<p>或者直接把官方文档地址发给 AI 让它参考：</p>
<pre><code class="hljs language-arduino" lang="arduino">必须使用 Aceternity UI 设计网站
你需要阅读官方文档来了解最新的使用方法：https:<span class="hljs-comment">//ui.aceternity.com/components</span>
</code></pre>
<p>网站的逼格立刻就上去了，完全不像 AI 生成的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2928ce1965024e0d9cb6e8f1eb5b4802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=EPCz0luQ7OvAZUfdWpDSWHPR71E%3D" alt="" loading="lazy"/></p>
<p>还有很多我觉得有特点的 UI 组件库：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmagicui.design%2F" target="_blank" title="https://magicui.design/" ref="nofollow noopener noreferrer">Magic UI</a>：150+ 动画组件，专门做微交互、流光边框、文字渐变</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdaisyui.com%2F" target="_blank" title="https://daisyui.com/" ref="nofollow noopener noreferrer">DaisyUI</a>：30+ 主题，有 cyberpunk、retro、cupcake 等风格</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbrutalistui.site%2F" target="_blank" title="https://brutalistui.site/" ref="nofollow noopener noreferrer">Brutalist UI</a>：粗野主义风格，粗边框、硬阴影、高对比</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fui.glass%2F" target="_blank" title="https://ui.glass/" ref="nofollow noopener noreferrer">Glass UI</a>：玻璃拟态效果，半透明、模糊背景</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fikun-svelte%2Fikun-ui" target="_blank" title="https://github.com/ikun-svelte/ikun-ui" ref="nofollow noopener noreferrer">ikun-ui</a>：基于 Svelte.js 和 UnoCSS 的组件库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.radix-ui.com%2F" target="_blank" title="https://www.radix-ui.com/" ref="nofollow noopener noreferrer">Radix UI</a>：无样式原语组件，完全自定义</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmantine.dev%2F" target="_blank" title="https://mantine.dev/" ref="nofollow noopener noreferrer">Mantine</a>：100+ 组件，功能丰富</li>
</ul>
<p>像我练习时长两年半，最喜欢 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fikun-svelte%2Fikun-ui" target="_blank" title="https://github.com/ikun-svelte/ikun-ui" ref="nofollow noopener noreferrer">ikun-ui</a> 了~</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94f2e7bbb9ea4122899fab4bda4879a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=r0pQR7yMkV3dswFOYt1Jhd2mBTw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">方法 7、自主配色（扩展知识）</h3>
<p>如果你想让网站更独特，完全走自己的路，那就得人工设计配色方案了。</p>
<p>这个方法适合有设计基础的朋友，可以用一些快速生成个性化配色的工具，比如：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoolors.co%2F" target="_blank" title="https://coolors.co/" ref="nofollow noopener noreferrer">Coolors</a>：主流的配色生成器，按空格键随机生成，支持导出多种格式</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcolor.adobe.com%2F" target="_blank" title="https://color.adobe.com/" ref="nofollow noopener noreferrer">Adobe Color</a>：Adobe 官方的专业配色工具</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a62be41c6e474c29a24e389ed144dc71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=ylg6foK7CANtuYTbXGKtbAUS4QA%3D" alt="" loading="lazy"/></p>
<p>生成好配色后，把色值告诉 AI，让它严格按照你的配色方案来设计。这样出来的网站，配色绝对独特。</p>
<h2 data-id="heading-17">实战案例</h2>
<p>前面我讲的这些方法是可以结合使用的。下面分享几个实战例子，大家可以感受下效果。</p>
<h3 data-id="heading-18">案例 1、个人技术博客</h3>
<h4 data-id="heading-19">优化前</h4>
<p>直接输入提示词：</p>
<pre><code class="hljs">开发个人技术博客网站首页
</code></pre>
<p>效果是这样的，一眼 AI……</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c80925c8e3f1478ea85e91f296d6a273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=jxyaSu0J%2FqNnjIpVQDJ%2BVkW22Do%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">优化后</h4>
<p>使用 <code>AGENTS.md</code> 提示词规则 + UI UX Pro Max 技能：</p>
<pre><code class="hljs">开发个人技术博客网站首页
</code></pre>
<p>得到的网站更有极客范儿，内容更充实。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f9d502a5656412ca6e00256afe6aca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=4luReKTD9LIN6AOG%2BwetTY6gmSQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e738b20f4644015bf4b04a11a472a46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=LflhHM0WXIOnz6gvazdTr6%2F30u0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-21">案例 2、SaaS 产品落地页</h3>
<h4 data-id="heading-22">优化前</h4>
<p>直接输入提示词：</p>
<pre><code class="hljs">开发 SaaS 产品《服务器运维监控平台》的落地页
</code></pre>
<p>效果是这样的，又是蓝紫配色，一眼 AI……</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8aedd3bea514b2b96733954d5993625~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=iX3aXqV%2FH9AM69m6RplAyRZ6DN0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-23">优化后</h4>
<p>使用 <code>AGENTS.md</code> 提示词规则 + UI UX Pro Max 技能 + 语境注入 + 反 AI 味儿组件库：</p>
<pre><code class="hljs language-arduino" lang="arduino">开发 SaaS 产品《服务器运维监控平台》的落地页
​
先阅读这段话感受氛围：《黑客帝国》你选择蓝色药丸还是红色药丸？
必须使用 Aceternity UI 设计网站
你需要阅读官方文档来了解最新的使用方法：https:<span class="hljs-comment">//ui.aceternity.com/components</span>
</code></pre>
<p>网站背景变成了代码雨，也更像一个专业产品介绍页：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d8514815ac64842918f6e427b4b0475~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=hGO9ft2EkTk8Bio%2FonGGLUdgxFM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d880fe3dc3e64413a6426d1062bfbaf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=ib16nBPiIfseFooFMKMqe1KVSFs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-24">案例 3、健身 APP 落地页（移动端）</h3>
<h4 data-id="heading-25">优化前</h4>
<p>直接输入提示词：</p>
<pre><code class="hljs">开发健身 APP 落地页（移动端）
</code></pre>
<p>效果…… 这啥玩意，不评价了……</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e311afe97aa4edaae50735bade9e08c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=wKzdzl%2BRxqPQ1j9pc6vOu4zHweI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-26">优化后</h4>
<p>使用 <code>AGENTS.md</code> 提示词规则 + UI UX Pro Max 技能 + 反 AI 味儿组件库：</p>
<pre><code class="hljs language-arduino" lang="arduino">开发健身 APP 落地页（移动端）
​
必须使用 IKun UI 设计网站
你需要阅读官方文档来了解最新的使用方法：https:<span class="hljs-comment">//ikun-ui.netlify.app</span>
</code></pre>
<p>这下得到的页面更真实可用了，对比还是非常明显的吧！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/444bd28ef1fc4145aa2a02e289d6b5aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=czn7YvrYLY7T1v5zQrDUS4GCni8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-27">最后</h2>
<p>看到这里你应该意识到，现在 AI 开发网站的能力已经非常强了。</p>
<p>有朋友觉得 AI 生成的效果不理想，可能只是因为没给它足够明确的指令。</p>
<p>就像一个厨师，你只说做个好吃的，他为了保险只能做最大众化的家常菜。但你说 “多放辣椒、不要花椒、多放豆瓣酱”，他就能做出你想要的味道。</p>
<p><strong>记住，AI 是工具，你才是主导者。</strong></p>
<p>学会了或者学废了的朋友们，点个赞吧~ 你可以在我免费开源的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fai-guide" target="_blank" title="https://github.com/liyupi/ai-guide" ref="nofollow noopener noreferrer">《AI 编程零基础入门教程》</a>中学到更多 AI 编程技巧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e1cf928539a4e6a9d9217103aa587ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770366176&amp;x-signature=j9tJ7%2BYd%2F79G7zwIvNrXasTT%2FWM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-28">更多</h2>
<p>💻 编程学习交流：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fcode-nav" target="_blank" title="https://github.com/liyupi/code-nav" ref="nofollow noopener noreferrer">编程导航</a> 📃 简历快速制作：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Flaoyujianli" target="_blank" title="https://github.com/liyupi/laoyujianli" ref="nofollow noopener noreferrer">老鱼简历</a> ✏️ 面试刷题神器：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fmianshiya" target="_blank" title="https://github.com/liyupi/mianshiya" ref="nofollow noopener noreferrer">面试鸭</a> 📖 AI 学习指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fai-guide" target="_blank" title="https://github.com/liyupi/ai-guide" ref="nofollow noopener noreferrer">鱼皮 AI 导航</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ 封装 C FFI 接口最佳实践：以 Hugging Face Tokenizer 为例]]></title>    <link>https://juejin.cn/post/7601053058855895046</link>    <guid>https://juejin.cn/post/7601053058855895046</guid>    <pubDate>2026-01-31T05:47:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601053058855895046" data-draft-id="7601034810312179766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ 封装 C FFI 接口最佳实践：以 Hugging Face Tokenizer 为例"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-01-31T05:47:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ 封装 C FFI 接口最佳实践：以 Hugging Face Tokenizer 为例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T05:47:56.000Z" title="Sat Jan 31 2026 05:47:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引入</h2>
<p>在现代 AI 工程中，Hugging Face 的 tokenizers 库已成为分词器的事实标准。不过 Hugging Face 的 tokenizers 是用 Rust 来实现的，官方只提供了 python 和 node 的绑定实现。要实现与 Hugging Face tokenizers 相同的行为，最好的办法就是自己封装 Hugging Face tokenizers 的 C 绑定，从而可以被 C++ / C# / Java 这些高级编程语言调用。</p>
<h2 data-id="heading-1">2. 封装 C 接口</h2>
<p>首先要说明的是，要做的不是完整的封装 Hugging Face tokenizers 的 C 的 FFI（Foreign Function Interface）接口，而是封装自己需要的接口就可以了。比如执行分词接口和计算Token的接口：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::ffi::CStr;
<span class="hljs-keyword">use</span> std::os::raw::c_char;
<span class="hljs-keyword">use</span> tokenizers::{PaddingParams, Tokenizer, TruncationParams};

<span class="hljs-comment">// === 1. 定义 C 兼容的返回结构体 ===</span>
<span class="hljs-meta">#[repr(C)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">TokenizerResult</span> {
    <span class="hljs-keyword">pub</span> input_ids: *<span class="hljs-keyword">mut</span> <span class="hljs-type">i64</span>,
    <span class="hljs-keyword">pub</span> attention_mask: *<span class="hljs-keyword">mut</span> <span class="hljs-type">i64</span>,
    <span class="hljs-keyword">pub</span> token_type_ids: *<span class="hljs-keyword">mut</span> <span class="hljs-type">i64</span>,
    <span class="hljs-keyword">pub</span> length: <span class="hljs-type">u64</span>,
}

<span class="hljs-comment">// === 2. 内部状态：包装 Tokenizer ===</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TokenizerHandle</span> {
    tokenizer: Tokenizer,     <span class="hljs-comment">// 用于 encode（带 padding）</span>
    raw_tokenizer: Tokenizer, <span class="hljs-comment">// 用于 count（无 padding）</span>
}

<span class="hljs-comment">// === 3. 辅助函数：将 Rust Vec 转为 C 可拥有的指针 ===</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">vec_to_c_ptr</span>(vec: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i64</span>&gt;) <span class="hljs-punctuation">-&gt;</span> *<span class="hljs-keyword">mut</span> <span class="hljs-type">i64</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">boxed</span> = vec.<span class="hljs-title function_ invoke__">into_boxed_slice</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ptr</span> = boxed.<span class="hljs-title function_ invoke__">as_mut_ptr</span>();
    std::mem::<span class="hljs-title function_ invoke__">forget</span>(boxed); <span class="hljs-comment">// 防止 Rust 自动释放</span>
    ptr
}

<span class="hljs-comment">// === 4. 创建 tokenizer ===</span>
<span class="hljs-meta">#[unsafe(no_mangle)]</span> <span class="hljs-comment">// 禁用 name mangling，让 C 能找到符号</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">tokenizer_create</span>(tokenizer_json_path: *<span class="hljs-keyword">const</span> c_char) <span class="hljs-punctuation">-&gt;</span> *<span class="hljs-keyword">mut</span> std::ffi::c_void {
    <span class="hljs-keyword">if</span> tokenizer_json_path.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">return</span> std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>();
    }

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">path_cstr</span> = <span class="hljs-keyword">unsafe</span> { CStr::<span class="hljs-title function_ invoke__">from_ptr</span>(tokenizer_json_path) };
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">path_str</span> = <span class="hljs-keyword">match</span> path_cstr.<span class="hljs-title function_ invoke__">to_str</span>() {
        <span class="hljs-title function_ invoke__">Ok</span>(s) =&gt; s,
        <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-keyword">return</span> std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
    };

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">tokenizer</span> = <span class="hljs-keyword">match</span> Tokenizer::<span class="hljs-title function_ invoke__">from_file</span>(path_str) {
        <span class="hljs-title function_ invoke__">Ok</span>(t) =&gt; t,
        <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-keyword">return</span> std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
    };

    <span class="hljs-comment">// 设置 padding/truncation 到 512（BGE 默认）</span>
    tokenizer.<span class="hljs-title function_ invoke__">with_padding</span>(<span class="hljs-title function_ invoke__">Some</span>(PaddingParams {
        strategy: tokenizers::PaddingStrategy::<span class="hljs-title function_ invoke__">Fixed</span>(<span class="hljs-number">512</span>),
        ..<span class="hljs-built_in">Default</span>::<span class="hljs-title function_ invoke__">default</span>()
    }));

    <span class="hljs-keyword">if</span> tokenizer
        .<span class="hljs-title function_ invoke__">with_truncation</span>(<span class="hljs-title function_ invoke__">Some</span>(TruncationParams {
            max_length: <span class="hljs-number">512</span>,
            ..<span class="hljs-built_in">Default</span>::<span class="hljs-title function_ invoke__">default</span>()
        }))
        .<span class="hljs-title function_ invoke__">is_err</span>()
    {
        <span class="hljs-keyword">return</span> std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>();
    }

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">raw_tokenizer</span> = tokenizer.<span class="hljs-title function_ invoke__">clone</span>();
    raw_tokenizer.<span class="hljs-title function_ invoke__">with_padding</span>(<span class="hljs-literal">None</span>);
    raw_tokenizer.<span class="hljs-title function_ invoke__">with_truncation</span>(<span class="hljs-literal">None</span>).<span class="hljs-title function_ invoke__">ok</span>();

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">handle</span> = TokenizerHandle {
        tokenizer,
        raw_tokenizer,
    };
    <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">into_raw</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(handle)) <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> std::ffi::c_void
}

<span class="hljs-comment">//计算句子token</span>
<span class="hljs-meta">#[unsafe(no_mangle)]</span> <span class="hljs-comment">// 禁用 name mangling，让 C 能找到符号</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">tokenizer_count</span>(handle: *<span class="hljs-keyword">mut</span> std::ffi::c_void, text: *<span class="hljs-keyword">const</span> c_char) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">u64</span> {
    <span class="hljs-keyword">if</span> handle.<span class="hljs-title function_ invoke__">is_null</span>() || text.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">handle_ref</span> = <span class="hljs-keyword">unsafe</span> { &amp;*(handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> TokenizerHandle) };

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text_cstr</span> = <span class="hljs-keyword">unsafe</span> { CStr::<span class="hljs-title function_ invoke__">from_ptr</span>(text) };
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text_str</span> = <span class="hljs-keyword">match</span> text_cstr.<span class="hljs-title function_ invoke__">to_str</span>() {
        <span class="hljs-title function_ invoke__">Ok</span>(s) =&gt; s,
        <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>,
    };

    <span class="hljs-keyword">match</span> handle_ref.raw_tokenizer.<span class="hljs-title function_ invoke__">encode</span>(text_str, <span class="hljs-literal">true</span>) {
        <span class="hljs-title function_ invoke__">Ok</span>(encoding) =&gt; encoding.<span class="hljs-title function_ invoke__">len</span>() <span class="hljs-keyword">as</span> <span class="hljs-type">u64</span>,
        <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-number">0</span>,
    }
}

<span class="hljs-comment">// === 5. 销毁 tokenizer ===</span>
<span class="hljs-meta">#[unsafe(no_mangle)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">tokenizer_destroy</span>(handle: *<span class="hljs-keyword">mut</span> std::ffi::c_void) {
    <span class="hljs-keyword">if</span> !handle.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">from_raw</span>(handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> TokenizerHandle);
            <span class="hljs-comment">// Drop 自动调用</span>
        }
    }
}

<span class="hljs-comment">// === 6. 执行分词 ===</span>
<span class="hljs-meta">#[unsafe(no_mangle)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">tokenizer_encode</span>(
    handle: *<span class="hljs-keyword">mut</span> std::ffi::c_void,
    text: *<span class="hljs-keyword">const</span> c_char,
) <span class="hljs-punctuation">-&gt;</span> TokenizerResult {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">default_result</span> = TokenizerResult {
        input_ids: std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
        attention_mask: std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
        token_type_ids: std::ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
        length: <span class="hljs-number">0</span>,
    };

    <span class="hljs-keyword">if</span> handle.<span class="hljs-title function_ invoke__">is_null</span>() || text.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">return</span> default_result;
    }

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">handle_ref</span> = <span class="hljs-keyword">unsafe</span> { &amp;*(handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> TokenizerHandle) };

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text_cstr</span> = <span class="hljs-keyword">unsafe</span> { CStr::<span class="hljs-title function_ invoke__">from_ptr</span>(text) };
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text_str</span> = <span class="hljs-keyword">match</span> text_cstr.<span class="hljs-title function_ invoke__">to_str</span>() {
        <span class="hljs-title function_ invoke__">Ok</span>(s) =&gt; s,
        <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-keyword">return</span> default_result,
    };

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">encoding</span> = <span class="hljs-keyword">match</span> handle_ref.tokenizer.<span class="hljs-title function_ invoke__">encode</span>(text_str, <span class="hljs-literal">true</span>) {
        <span class="hljs-title function_ invoke__">Ok</span>(e) =&gt; e,
        <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-keyword">return</span> default_result,
    };

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">input_ids</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i64</span>&gt; = encoding.<span class="hljs-title function_ invoke__">get_ids</span>().<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">map</span>(|&amp;x| x <span class="hljs-keyword">as</span> <span class="hljs-type">i64</span>).<span class="hljs-title function_ invoke__">collect</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">attention_mask</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i64</span>&gt; = encoding
        .<span class="hljs-title function_ invoke__">get_attention_mask</span>()
        .<span class="hljs-title function_ invoke__">iter</span>()
        .<span class="hljs-title function_ invoke__">map</span>(|&amp;x| x <span class="hljs-keyword">as</span> <span class="hljs-type">i64</span>)
        .<span class="hljs-title function_ invoke__">collect</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">token_type_ids</span>: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">i64</span>&gt; = encoding.<span class="hljs-title function_ invoke__">get_type_ids</span>().<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">map</span>(|&amp;x| x <span class="hljs-keyword">as</span> <span class="hljs-type">i64</span>).<span class="hljs-title function_ invoke__">collect</span>();
    <span class="hljs-comment">// BGE 不需要，但 C++ 代码传了</span>
    <span class="hljs-comment">// let token_type_ids: Vec&lt;u32&gt; = vec![0u32; input_ids.len()];</span>

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">len</span> = input_ids.<span class="hljs-title function_ invoke__">len</span>(); <span class="hljs-comment">// 应该是 512，但更通用</span>

    TokenizerResult {
        input_ids: <span class="hljs-title function_ invoke__">vec_to_c_ptr</span>(input_ids),
        attention_mask: <span class="hljs-title function_ invoke__">vec_to_c_ptr</span>(attention_mask),
        token_type_ids: <span class="hljs-title function_ invoke__">vec_to_c_ptr</span>(token_type_ids),
        length: len <span class="hljs-keyword">as</span> <span class="hljs-type">u64</span>,
    }
}

<span class="hljs-comment">// === 7. 释放结果内存 ===</span>
<span class="hljs-meta">#[unsafe(no_mangle)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">tokenizer_result_free</span>(result: TokenizerResult) {
    <span class="hljs-keyword">if</span> !result.input_ids.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">from_raw_parts</span>(
                result.input_ids,
                result.length <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
                result.length <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
            );
        }
    }

    <span class="hljs-keyword">if</span> !result.attention_mask.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">from_raw_parts</span>(
                result.attention_mask,
                result.length <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
                result.length <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
            );
        }
    }

    <span class="hljs-keyword">if</span> !result.token_type_ids.<span class="hljs-title function_ invoke__">is_null</span>() {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">from_raw_parts</span>(
                result.token_type_ids,
                result.length <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
                result.length <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
            );
        }
    }
}
</code></pre>
<p>对应的 C 接口如下：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// tokenizer_result.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TokenizerResult</span> {</span>
  <span class="hljs-type">int64_t</span>* input_ids;
  <span class="hljs-type">int64_t</span>* attention_mask;
  <span class="hljs-type">int64_t</span>* token_type_ids;
  <span class="hljs-type">uint64_t</span> length;
};

<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span>
<span class="hljs-keyword">static_assert</span>(<span class="hljs-built_in">std</span>::is_standard_layout_v&lt;TokenizerResult&gt; &amp;&amp;
                  <span class="hljs-built_in">std</span>::is_trivially_copyable_v&lt;TokenizerResult&gt;,
              <span class="hljs-string">"TokenizerResult must be C ABI compatible"</span>);
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// hf_tokenizer_ffi.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"tokenizer_result.h"</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-type">void</span>* <span class="hljs-title function_">tokenizer_create</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* tokenizer_json_path)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">tokenizer_destroy</span><span class="hljs-params">(<span class="hljs-type">void</span>* handle)</span>;
TokenizerResult <span class="hljs-title function_">tokenizer_encode</span><span class="hljs-params">(<span class="hljs-type">void</span>* handle, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* text)</span>;
<span class="hljs-type">uint64_t</span> <span class="hljs-title function_">tokenizer_count</span><span class="hljs-params">(<span class="hljs-type">void</span>* handle, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* text)</span>;
<span class="hljs-type">void</span> <span class="hljs-title function_">tokenizer_result_free</span><span class="hljs-params">(TokenizerResult result)</span>;

<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span>
}
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<p>具体的封装细节笔者就不多说了，因为与本文的主题无关。不过可以稍稍了解一下其中的原理，也就是说，操作系统大多数是由 C 实现的，或者提供了 C 的接口。因此，绝大多数比 C 高级的编程语言都提供了与 C 交互的能力，当然前提是必须得按照 C 得规范组织数据和封装接口。比如这里的<code>struct TokenizerResult</code>就是一个兼容 C 的结构体，<code>#[unsafe(no_mangle)]</code>则表明这是一个 C 语言形式的函数接口。</p>
<h2 data-id="heading-2">3. 经典 C++ 封装</h2>
<p>如上接口是一个标准的 C 风格式的接口：将分词器封装成一个 Handle ，也就是俗称的句柄。而后续具体的分词操作就通过这个句柄来进行，包括最后对资源的释放。在 C++ 中，当然也可以直接使用这种形式的接口，不过这样就需要遵循 C 的资源控制规则：资源申请和释放必须成对出现——比如这里的 <code>tokenizer_create</code> 和 <code>tokenizer_destroy</code>。</p>
<h3 data-id="heading-3">3.1 RAII 机制</h3>
<p>不过这样就会有一个问题，过程式的流程中很难保证 <code>tokenizer_create</code> 和 <code>tokenizer_destroy</code> 能够成对调用，例如：</p>
<pre><code class="hljs language-c" lang="c">tokenizer_create()

<span class="hljs-keyword">if</span>(...){
    <span class="hljs-keyword">return</span>;
}

tokenizer_destroy()
</code></pre>
<p>只要在 <code>tokenizer_create</code> 和 <code>tokenizer_destroy</code> 之间出现分支，程序提前返回，就会导致资源没有释放而内存泄漏。为了避免这个问题，就需要在每次 <code>return</code> 之前，都调用 <code>tokenizer_destroy()</code>——这当然是非常不优雅的，既容易忘掉又是冗余代码。</p>
<p>为了解决这种资源管理难题，C++ 提供了一种强大而优雅的机制：RAII（Resource Acquisition Is Initialization，资源获取即初始化）。它的核心思想是：将资源的生命周期绑定到对象的生命周期上。具体来说，就是利用面向对象的思想，将资源控制的行为封装成一个类对象，并且保证资源在对象构造函数中获取，在析构函数中自动释放。由于 C++ 中栈对象在离开作用域时会自动调用析构函数，在离开作用域时会自动调用析构函数。因此这些资源总是可以被正确释放，从根本上杜绝内存泄漏或资源泄露。例如：</p>
<pre><code class="hljs language-cpp" lang="cpp">Tokenizer tokenizer;

<span class="hljs-comment">//...操作</span>

<span class="hljs-keyword">if</span>(...){
    <span class="hljs-keyword">return</span>;
}

<span class="hljs-comment">//...更多操作</span>
</code></pre>
<h3 data-id="heading-4">3.2 拷贝语义</h3>
<p>复习一下 C++ 面向对象设计的经典五法则（Rule of Five），如果一个类自定义了以下任意一个函数：</p>
<ol>
<li>析构函数（Destructor）</li>
<li>拷贝构造函数（Copy Constructor）</li>
<li>拷贝赋值运算符（Copy Assignment Operator）</li>
<li>移动构造函数（Move Constructor）</li>
<li>移动赋值运算符（Move Assignment Operator）</li>
</ol>
<p>那么大概率也需要自定义另外四个函数，或者显式 = default / = delete 来控制行为。很多 C++ 程序员并不理解移动语义，但这并没有关系，我们可以先假定不定义移动构造函数和移动赋值运算符（或者显式 = default），此时移动操作就会退化为拷贝语义的行为。</p>
<p>而关于拷贝语义，绝大多数 C++ 程序员应该都知道这个问题：当在类对象中管理资源时，编译器生成的默认拷贝行为是“浅拷贝”，可能导致双重释放、内存泄漏等问题，因此需要自定义拷贝构造函数和拷贝赋值运算符来实现“深拷贝”的行为。因此，这个链条就很明确了：因为类中需要定义析构函数，所以需要同时定义拷贝构造函数和拷贝赋值运算符。</p>
<h3 data-id="heading-5">3.3 移动语义</h3>
<p>进一步讨论，反正移动语义可以默认，那么是不是只用定义拷贝语义就行了呢？这个要看资源的定义：如果只是管理内存资源，那么这样做是没有问题的，至少是安全的。但是资源管理不仅仅指的是内存资源，还可以是一些文件句柄、网络连接等等。这些资源往往是独占性的，进行深拷贝往往会出现问题。因此就出现了 C++ 11 开始规定的移动语义：可以安全得实现“浅拷贝”的行为。同时还可以解决“深拷贝”的性能问题。</p>
<p>基于以上的思想，笔者封装的分词器对象如下：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// HfTokenizer.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hf_tokenizer_ffi.h"</span></span>

<span class="hljs-keyword">namespace</span> hf {
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tokenizer</span> {
 <span class="hljs-keyword">public</span>:
  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Tokenizer</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; path)</span></span>;

  <span class="hljs-comment">// 析构函数</span>
  ~<span class="hljs-built_in">Tokenizer</span>() <span class="hljs-keyword">noexcept</span>;

  <span class="hljs-comment">// 禁止拷贝</span>
  <span class="hljs-built_in">Tokenizer</span>(<span class="hljs-type">const</span> Tokenizer&amp;) = <span class="hljs-keyword">delete</span>;
  Tokenizer&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Tokenizer&amp;) = <span class="hljs-keyword">delete</span>;

  <span class="hljs-comment">// 移动语义</span>
  <span class="hljs-built_in">Tokenizer</span>(Tokenizer&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span>;
  Tokenizer&amp; <span class="hljs-keyword">operator</span>=(Tokenizer&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span>;

  <span class="hljs-comment">// 其他接口方法</span>
  <span class="hljs-comment">// TokenizerResult Encode(const char* text) const;</span>
  <span class="hljs-comment">// uint64_t Count(const char* text) const;</span>

 <span class="hljs-keyword">private</span>:
  <span class="hljs-type">void</span>* handle;  <span class="hljs-comment">// 来自 tokenizer_create 的指针</span>
};

}  <span class="hljs-comment">// namespace hf</span>
</code></pre>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// HfTokenizer.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"HfTokenizer.h"</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-keyword">namespace</span> hf {
Tokenizer::<span class="hljs-built_in">Tokenizer</span>(<span class="hljs-type">const</span> std::string&amp; path)
    : <span class="hljs-built_in">handle</span>(<span class="hljs-built_in">tokenizer_create</span>(path.<span class="hljs-built_in">c_str</span>())) {
  <span class="hljs-keyword">if</span> (!handle) {
    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"Failed to create tokenizer from "</span> + path);
  }
}

Tokenizer::~<span class="hljs-built_in">Tokenizer</span>() <span class="hljs-keyword">noexcept</span> {
  <span class="hljs-keyword">if</span> (handle) {
    <span class="hljs-built_in">tokenizer_destroy</span>(handle);
  }
}

<span class="hljs-comment">// 移动语义</span>
Tokenizer::<span class="hljs-built_in">Tokenizer</span>(Tokenizer&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span> : <span class="hljs-built_in">handle</span>(rhs.handle) {
  rhs.handle = <span class="hljs-literal">nullptr</span>;
}

Tokenizer&amp; Tokenizer::<span class="hljs-keyword">operator</span>=(Tokenizer&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;rhs) {
    <span class="hljs-keyword">if</span> (handle) {
      <span class="hljs-built_in">tokenizer_destroy</span>(handle);
    }
    handle = rhs.handle;
    rhs.handle = <span class="hljs-literal">nullptr</span>;
  }
  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
}

}  <span class="hljs-comment">// namespace hf</span>
</code></pre>
<p>如前所述，因为封装的是一个句柄，为了避免资源控制的麻烦，就禁止掉拷贝语义：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 禁止拷贝</span>
<span class="hljs-built_in">Tokenizer</span>(<span class="hljs-type">const</span> Tokenizer&amp;) = <span class="hljs-keyword">delete</span>;
Tokenizer&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Tokenizer&amp;) = <span class="hljs-keyword">delete</span>;
</code></pre>
<p>进行<code>()</code>拷贝构造或者<code>=</code>赋值构造看起来似乎很简单，其实在代码层层嵌套之后，就可能很难分析出是不是调用了默认的拷贝的行为，比如函数传参、容器操作等等。当然深拷贝的实现也不是性能最优，因此干脆就直接删除掉拷贝构造函数和拷贝赋值运算符。</p>
<p>没有拷贝语义，那么就需要移动语义来进行传递对象了。其实移动语义没那么难，我们只要把握住一点，移动语义的目的是安全地实现“浅拷贝”。以移动赋值运算符的实现来说，如果要实现如下移动赋值：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">Tokenizer <span class="hljs-title">A</span><span class="hljs-params">()</span></span>;
<span class="hljs-function">Tokenizer <span class="hljs-title">B</span><span class="hljs-params">()</span></span>;
B = std::<span class="hljs-built_in">move</span>(A);
</code></pre>
<p>就需要以下的行为：</p>
<ol>
<li>释放掉B管理的资源。</li>
<li>将A中的成员“浅拷贝”到B中，让B接管A的资源。</li>
<li>将A中成员初始化。</li>
</ol>
<p>具体实现就是如下所示：</p>
<pre><code class="hljs language-cpp" lang="cpp">Tokenizer&amp; Tokenizer::<span class="hljs-keyword">operator</span>=(Tokenizer&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;rhs) {
    <span class="hljs-keyword">if</span> (handle) {
      <span class="hljs-built_in">tokenizer_destroy</span>(handle);
    }
    handle = rhs.handle;
    rhs.handle = <span class="hljs-literal">nullptr</span>;
  }
  <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
}
</code></pre>
<p>移动构造函数就更加简单了，因为B对象在移动构造之前成员并没有初始化：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">Tokenizer <span class="hljs-title">A</span><span class="hljs-params">()</span></span>;
<span class="hljs-function">Tokenizer <span class="hljs-title">B</span><span class="hljs-params">(std::move(A))</span></span>;
</code></pre>
<p>因此可以省略掉释放自身资源的步骤，具体实现也就是如下所示：</p>
<pre><code class="hljs language-cpp" lang="cpp">Tokenizer::<span class="hljs-built_in">Tokenizer</span>(Tokenizer&amp;&amp; rhs) <span class="hljs-keyword">noexcept</span> : <span class="hljs-built_in">handle</span>(rhs.handle) {
  rhs.handle = <span class="hljs-literal">nullptr</span>;
}
</code></pre>
<p>最后还有一个问题：A通过移动语义转移到B了，A还能使用吗？不能也没必要使用A了，无论是A对象和B对象其实是一个栈对象（当然内部管理的数据成员可能放在堆上），或者说是一个值对象；这跟引用对象或者地址对象完全不同。移动语义的本质是对象所有权的转移，转移之后原对象中资源所有权就不存在了，即使强行访问，要么访问不到，要么会程序崩溃。</p>
<h2 data-id="heading-6">4. 高级 C++ 封装</h2>
<h3 data-id="heading-7">4.1 零法则</h3>
<p>使用 RAII 机制 + 经典五法则来设计一个类对象，还有一个优点，就是使用这个类对象作为数据成员的类，就不用再显式实现析构函数。不用显式实现析构函数，也就意味着不用实现拷贝语义和移动语义，完全可以依赖类对象拷贝和移动的默认行为。举例来说，一个<code>MyResource</code>对象，管理着一段内存 buffer ，它的类定义为：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyResource</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 构造：申请资源</span>
    <span class="hljs-built_in">MyResource</span>() {
        data = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
    }

    <span class="hljs-comment">// 析构：释放资源</span>
    ~<span class="hljs-built_in">MyResource</span>() {
        <span class="hljs-keyword">delete</span>[] data;
    }

    <span class="hljs-comment">// 拷贝构造：深拷贝</span>
    <span class="hljs-built_in">MyResource</span>(<span class="hljs-type">const</span> MyResource&amp; other) {
        data = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
        <span class="hljs-built_in">copy</span>(other.data, other.data + <span class="hljs-number">100</span>, data);
    }

    <span class="hljs-comment">// 拷贝赋值</span>
    MyResource&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> MyResource&amp; other) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            <span class="hljs-keyword">delete</span>[] data;
            data = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
            <span class="hljs-built_in">copy</span>(other.data, other.data + <span class="hljs-number">100</span>, data);
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }

    <span class="hljs-comment">// 移动构造：接管资源</span>
    <span class="hljs-built_in">MyResource</span>(MyResource&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        data = other.data;
        other.data = <span class="hljs-literal">nullptr</span>;
    }

    <span class="hljs-comment">// 移动赋值</span>
    MyResource&amp; <span class="hljs-keyword">operator</span>=(MyResource&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            <span class="hljs-keyword">delete</span>[] data;
            data = other.data;
            other.data = <span class="hljs-literal">nullptr</span>;
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span>* data = <span class="hljs-literal">nullptr</span>;
};
</code></pre>
<p>但是如果我使用 std 容器<code>vector</code> ，相应的代码就可以简写为：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyResource</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 构造：自动分配内存</span>
    <span class="hljs-built_in">MyResource</span>() : <span class="hljs-built_in">data</span>(<span class="hljs-number">100</span>) {}  <span class="hljs-comment">// vector&lt;int&gt; 自动初始化为 100 个元素</span>

    <span class="hljs-comment">// ✅ 无需显式定义析构函数</span>
    <span class="hljs-comment">// ✅ 无需自定义拷贝构造 / 拷贝赋值</span>
    <span class="hljs-comment">// ✅ 无需自定义移动构造 / 移动赋值</span>

    <span class="hljs-comment">// 编译器自动生成的版本已正确、高效、异常安全</span>

<span class="hljs-keyword">private</span>:
    std::vector&lt;<span class="hljs-type">int</span>&gt; data;  <span class="hljs-comment">// RAII 自动管理内存</span>
};
</code></pre>
<p>这不是因为 <code>vector</code> 使用了什么魔法，而是 <code>vector</code> 本身就是使用了 RAII 机制 + 经典五法则来设计的一个模板类对象！在 <code>MyResource</code> 对象进行拷贝或者移动的时候，作为数据成员，<code>std::vector&lt;int&gt; data</code>也会采取同样的拷贝或者移动的行为，并且默认的、由编译器自动生成的版本就可以正确处理。</p>
<p>以上这个思想，就是现代 C++ 更推荐的<strong>零法则（Rule of Zero）</strong>：尽量不要手动管理资源，而是使用 RAII 类型让编译器自动生成所有特殊成员函数。而这个 RAII 类型，可以是 std 的任何容器对象、智能指针，也可以是自己按照五法则实现的类对象。</p>
<h3 data-id="heading-8">4.2 智能指针</h3>
<p>回到本文引入的问题，如果我的分词器实现不像写拷贝语义和移动语义怎么办呢？毕竟都是样板代码，写不好还容易出问题。此时我们就可以使用智能指针 <code>unique_ptr</code> 。常规意义上，我们都知道智能指针可以在没有任何其他对象引用的情况下自动 <code>delete</code> ，其实智能指针还可以自定义资源的释放行为：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-keyword">namespace</span> hf {
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tokenizer</span> {
 <span class="hljs-keyword">public</span>:
  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Tokenizer</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; path)</span></span>;

  <span class="hljs-comment">// 编译器自动生成：</span>
  <span class="hljs-comment">// - 析构函数</span>
  <span class="hljs-comment">// - 移动构造 / 移动赋值</span>
  <span class="hljs-comment">// - 禁止拷贝（因为 unique_ptr 不可拷贝）</span>

 <span class="hljs-keyword">private</span>:
  std::unique_ptr&lt;<span class="hljs-type">void</span>, <span class="hljs-built_in">void</span> (*)(<span class="hljs-type">void</span>*)&gt; handle;
};

}  <span class="hljs-comment">// namespace hf</span>
</code></pre>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"HfTokenizer.h"</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hf_tokenizer_ffi.h"</span></span>

<span class="hljs-keyword">namespace</span> hf {

<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">HandleDeleter</span><span class="hljs-params">(<span class="hljs-type">void</span>* handle)</span> <span class="hljs-keyword">noexcept</span> </span>{
  <span class="hljs-keyword">if</span> (handle) {
    <span class="hljs-built_in">tokenizer_destroy</span>(handle);
  }
}

Tokenizer::<span class="hljs-built_in">Tokenizer</span>(<span class="hljs-type">const</span> std::string&amp; path)
    : <span class="hljs-built_in">handle</span>(<span class="hljs-built_in">tokenizer_create</span>(path.<span class="hljs-built_in">c_str</span>()), HandleDeleter) {
  <span class="hljs-keyword">if</span> (!handle) {
    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"Failed to create tokenizer from "</span> + path);
  }
}

}  <span class="hljs-comment">// namespace hf</span>
</code></pre>
<p>如上实现所示，函数 <code>HandleDeleter</code> 就是 <code>std::unique_ptr&lt;void, void (*)(void*)&gt; handle</code> 的自定义析构行为，在类对象析构的时候就会自动调用这个函数释放资源。既然资源被智能托管了，那么自然就不用写析构函数；析构函数不用写，那么拷贝构造函数、拷贝赋值运算符、移动构造函数以及移动赋值运算符都可以不用实现，全部可以依赖编译器自动生成。当然，由于 <code>unique_ptr</code> 只能移动不能拷贝，<code>Tokenizer</code>也就只能移动不能拷贝。</p>
<h2 data-id="heading-9">5. 总结</h2>
<p>最后，笔者就给出 C++ 封装 C FFI 接口的完整实现，如下所示：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// HfTokenizer.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"tokenizer_result.h"</span></span>

<span class="hljs-keyword">namespace</span> hf {
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tokenizer</span> {
 <span class="hljs-keyword">public</span>:
  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Tokenizer</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; path)</span></span>;

  <span class="hljs-comment">// 编译器自动生成：</span>
  <span class="hljs-comment">// - 析构函数（调用 Deleter）</span>
  <span class="hljs-comment">// - 移动构造 / 移动赋值</span>
  <span class="hljs-comment">// - 禁止拷贝（因为 unique_ptr 不可拷贝）</span>

  <span class="hljs-comment">// 其他接口方法</span>
  <span class="hljs-function"><span class="hljs-type">uint64_t</span> <span class="hljs-title">Count</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; text)</span> <span class="hljs-type">const</span></span>;

  <span class="hljs-comment">// 向量化</span>
  <span class="hljs-keyword">using</span> ResultPtr =
      std::unique_ptr&lt;TokenizerResult, <span class="hljs-built_in">void</span> (*)(TokenizerResult*)&gt;;
  <span class="hljs-function">ResultPtr <span class="hljs-title">Encode</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; text)</span> <span class="hljs-type">const</span></span>;

 <span class="hljs-keyword">private</span>:
  std::unique_ptr&lt;<span class="hljs-type">void</span>, <span class="hljs-built_in">void</span> (*)(<span class="hljs-type">void</span>*)&gt; handle;
};

}  <span class="hljs-comment">// namespace hf</span>
</code></pre>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// HfTokenizer.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"HfTokenizer.h"</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hf_tokenizer_ffi.h"</span></span>

<span class="hljs-keyword">namespace</span> hf {

<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">HandleDeleter</span><span class="hljs-params">(<span class="hljs-type">void</span>* handle)</span> <span class="hljs-keyword">noexcept</span> </span>{
  <span class="hljs-keyword">if</span> (handle) {
    <span class="hljs-built_in">tokenizer_destroy</span>(handle);
  }
}

<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">ResultDeleter</span><span class="hljs-params">(TokenizerResult* p)</span> <span class="hljs-keyword">noexcept</span> </span>{
  <span class="hljs-keyword">if</span> (p) {
    <span class="hljs-built_in">tokenizer_result_free</span>(*p);
    <span class="hljs-keyword">delete</span> p;
  }
}

Tokenizer::<span class="hljs-built_in">Tokenizer</span>(<span class="hljs-type">const</span> std::string&amp; path)
    : <span class="hljs-built_in">handle</span>(<span class="hljs-built_in">tokenizer_create</span>(path.<span class="hljs-built_in">c_str</span>()), HandleDeleter) {
  <span class="hljs-keyword">if</span> (!handle) {
    <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"Failed to create tokenizer from "</span> + path);
  }
}

<span class="hljs-function"><span class="hljs-type">uint64_t</span> <span class="hljs-title">Tokenizer::Count</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; text)</span> <span class="hljs-type">const</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">tokenizer_count</span>(handle.<span class="hljs-built_in">get</span>(), text.<span class="hljs-built_in">c_str</span>());
}

<span class="hljs-function">Tokenizer::ResultPtr <span class="hljs-title">Tokenizer::Encode</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; text)</span> <span class="hljs-type">const</span> </span>{
  <span class="hljs-keyword">auto</span> result = std::<span class="hljs-built_in">make_unique</span>&lt;TokenizerResult&gt;(
      <span class="hljs-built_in">tokenizer_encode</span>(handle.<span class="hljs-built_in">get</span>(), text.<span class="hljs-built_in">c_str</span>()));
  <span class="hljs-keyword">return</span> {result.<span class="hljs-built_in">release</span>(), ResultDeleter};
};

}  <span class="hljs-comment">// namespace hf</span>
</code></pre>
<p>不仅是句柄，连传递的数据对象笔者都托管给智能指针，从而避免大量写特殊成员函数这些样板代码。不得不说，RAII 的设计思路非常精妙，同时保证了安全性与简洁性，给人一种回归编程原始状态的感觉。所谓“大道至简”，不是代码越繁复就越安全，也不是代码越抽象就越厉害；真正好的代码，是在正确性、可维护性与简洁性之间取得平衡，让资源管理如呼吸般自然，而非负担。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin 2.3.20 重磅更新：GC 默认启用并发标记，UI 响应速度大幅提升]]></title>    <link>https://juejin.cn/post/7600616270003650598</link>    <guid>https://juejin.cn/post/7600616270003650598</guid>    <pubDate>2026-01-30T01:24:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270003650598" data-draft-id="7600684978352979995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin 2.3.20 重磅更新：GC 默认启用并发标记，UI 响应速度大幅提升"/> <meta itemprop="keywords" content="Kotlin,Android,Android Jetpack"/> <meta itemprop="datePublished" content="2026-01-30T01:24:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin 2.3.20 重磅更新：GC 默认启用并发标记，UI 响应速度大幅提升
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:24:23.000Z" title="Fri Jan 30 2026 01:24:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    150
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026 年 1 月 29 日，Kotlin 2.3.20-Beta2 发布。这次更新虽然还是 Beta 版，但带来了一个<strong>实验性但意义重大</strong>的变化：<strong>Kotlin/Native 的垃圾回收器（GC）默认启用了并发标记（Concurrent Marking）</strong>。</p>
<h2 data-id="heading-0">一、什么是并发标记 GC？</h2>
<h3 data-id="heading-1">先说问题</h3>
<p>在之前的默认配置 PMCS（Parallel Mark Concurrent Sweep）中：</p>
<blockquote>
<p>GC 标记阶段必须暂停所有应用线程。</p>
</blockquote>
<p>这意味着什么？当 GC 需要标记堆中的对象时，<strong>你的应用会停下来等待</strong>。</p>
<p>对于延迟敏感的应用——尤其是 UI 应用，这种"暂停"直接表现为<strong>卡顿、掉帧</strong>。</p>
<h3 data-id="heading-2">再说解决</h3>
<p>CMS（Concurrent Mark and Sweep）的核心改进：</p>
<blockquote>
<p><strong>标记阶段可以与应用线程并发执行！</strong></p>
</blockquote>
<p>简单来说：GC 标记对象时，你的应用可以继续运行。</p>
<h2 data-id="heading-3">二、实际效果</h2>
<p>官方已经用 Compose Multiplatform UI 应用做了基准测试：</p>
<blockquote>
<p><strong>CMS 显著改善了性能表现。</strong></p>
</blockquote>
<p>这意味着：</p>
<ul>
<li>更短的 GC 暂停时间</li>
<li>更流畅的用户界面</li>
<li>更好的响应速度</li>
</ul>
<h2 data-id="heading-4">三、如何使用</h2>
<h3 data-id="heading-5">默认启用（Beta 版）</h3>
<p>在 Kotlin 2.3.20-Beta1 和 Beta2 中，<strong>CMS 已经是默认配置</strong>。</p>
<p>你什么都不用改，直接升级版本就能体验：</p>
<pre><code class="hljs language-gradle" lang="gradle">kotlin("multiplatform") version "2.3.20-Beta2"
</code></pre>
<h3 data-id="heading-6">如果遇到问题</h3>
<p>CMS 仍然是<strong>实验性功能</strong>，在某些情况下可能导致：</p>
<ul>
<li>运行时崩溃</li>
<li>吞吐量下降</li>
<li>内存占用增加</li>
</ul>
<p>如果遇到回归问题，可以手动切回 PMCS：</p>
<pre><code class="hljs language-properties" lang="properties"># gradle.properties
kotlin.native.useNativeCms=false
</code></pre>
<h2 data-id="heading-7">四、开发者的谨慎</h2>
<p>Kotlin 团队采取的是<strong>渐进式发布策略</strong>：</p>





















<table><thead><tr><th>版本</th><th>GC 模式</th></tr></thead><tbody><tr><td>2.3.20-Beta1/2</td><td>CMS（默认，收集反馈）</td></tr><tr><td>2.3.20-RC</td><td>回滚到 PMCS</td></tr><tr><td>2.3.20 正式版</td><td>待定</td></tr></tbody></table>
<p><strong>为什么这么做？</strong></p>
<p>官方说得很直白：</p>
<blockquote>
<p>需要收集更多反馈，确保发现所有问题。</p>
</blockquote>
<p>这是负责任的态度——先在 Beta 版让广大开发者帮忙"压力测试"，收集足够数据后再决定正式版是否默认启用。</p>
<h2 data-id="heading-8">五、其他更新亮点</h2>
<h3 data-id="heading-9">1. C/Obj-C 互操作新模式</h3>
<p>如果你在 Kotlin Multiplatform 中使用 C 或 Objective-C 库，可以尝试新的互操作模式：</p>
<pre><code class="hljs language-gradle" lang="gradle">kotlin {
    targets.withType&lt;org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget&gt;().configureEach {
        compilations.configureEach {
            cinterops.configureEach {
                extraOpts += listOf("-Xccall-mode", "direct")
            }
        }
    }
}
</code></pre>
<blockquote>
<p>注意：新模式仍是实验性，<strong>不要用此模式发布库</strong>。</p>
</blockquote>
<h3 data-id="heading-10">2. JPA 插件增强</h3>
<p><code>kotlin.plugin.jpa</code> 现在自动应用 <code>all-open</code> 插件的 JPA 预设：</p>
<pre><code class="hljs language-gradle" lang="gradle">plugins {
    kotlin("plugin.jpa") version "2.3.20-Beta2"
}
</code></pre>
<p>JPA 实体类自动变成 <code>open</code>，无需手动配置 <code>all-open</code>。</p>
<p>支持的注解：</p>
<ul>
<li><code>javax.persistence.Entity</code></li>
<li><code>javax.persistence.Embeddable</code></li>
<li><code>javax.persistence.MappedSuperclass</code></li>
<li><code>jakarta.persistence.Entity</code></li>
<li><code>jakarta.persistence.Embeddable</code></li>
<li><code>jakarta.persistence.MappedSuperclass</code></li>
</ul>
<h3 data-id="heading-11">3. Maven 配置简化</h3>
<p>新建 Kotlin Maven 项目时，不再需要手动：</p>
<ul>
<li>创建源码目录</li>
<li>添加 <code>kotlin-stdlib</code> 依赖</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sourceRootsAutoDetection</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">sourceRootsAutoDetection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-12">4. Gradle 9.3.0 兼容</h3>
<p>支持 Gradle 7.6.3 到 9.3.0。</p>
<p>Kotlin/JVM 编译默认使用 Build tools API (BTA)。</p>
<h3 data-id="heading-13">5. 标准库新增 API</h3>
<p><code>Map.Entry.copy()</code> 扩展函数，用于创建 <code>Map.Entry</code> 的不可变副本：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalStdlibApi::class)</span>
<span class="hljs-keyword">val</span> mutableMap = mutableMapOf(<span class="hljs-string">"key"</span> to <span class="hljs-string">"value"</span>)
<span class="hljs-keyword">val</span> entry = mutableMap.entries.first()
<span class="hljs-keyword">val</span> copy = entry.copy() <span class="hljs-comment">// 创建不可变副本</span>
</code></pre>
<h2 data-id="heading-14">六、写到最后</h2>
<p>Kotlin 2.3 的 GC 改进，对 Kotlin/Native 生态——尤其是 Compose Multiplatform 开发者来说，是一个<strong>值得期待的进步</strong>。</p>
<p>虽然目前还是 Beta 实验，但：</p>
<ul>
<li>如果你开发 UI 应用</li>
<li>你在意用户体验</li>
<li>你受够了 GC 卡顿</li>
</ul>
<p><strong>不妨现在就试试 Beta 版，把你的反馈提交给官方。</strong></p>
<p>你的每一个问题报告，都是在帮 Kotlin 变得更好。</p>
<hr/>
<h2 data-id="heading-15">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fwhatsnew-eap.html" target="_blank" title="https://kotlinlang.org/docs/whatsnew-eap.html" ref="nofollow noopener noreferrer">Kotlin 2.3.20-Beta2 发布说明</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fyoutrack.jetbrains.com%2Fissues%2FKT" target="_blank" title="https://youtrack.jetbrains.com/issues/KT" ref="nofollow noopener noreferrer">YouTrack 问题追踪</a></li>
</ul>
<p><strong>升级提醒</strong>：IDE 支持 Kotlin 2.3.20-Beta2 的插件已捆绑在最新版 IntelliJ IDEA 和 Android Studio 中，只需修改 <code>build.gradle.kts</code> 中的版本号即可。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challenges（ts类型体操）: 15 - 最后一个元素]]></title>    <link>https://juejin.cn/post/7601020578490449929</link>    <guid>https://juejin.cn/post/7601020578490449929</guid>    <pubDate>2026-01-31T05:49:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578490449929" data-draft-id="7601169987395960883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challenges（ts类型体操）: 15 - 最后一个元素"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-31T05:49:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challenges（ts类型体操）: 15 - 最后一个元素
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T05:49:54.000Z" title="Sat Jan 31 2026 05:49:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">15 - 最后一个元素</h2>
<p>by Anthony Fu (@antfu) #中等 #array</p>
<h3 data-id="heading-1">题目</h3>
<blockquote>
<p>在此挑战中建议使用TypeScript 4.0</p>
</blockquote>
<p>实现一个<code>Last&lt;T&gt;</code>泛型，它接受一个数组<code>T</code>并返回其最后一个元素的类型。</p>
<p>例如</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> arr1 = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]
<span class="hljs-keyword">type</span> arr2 = [<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]

<span class="hljs-keyword">type</span> tail1 = <span class="hljs-title class_">Last</span>&lt;arr1&gt; <span class="hljs-comment">// 应推导出 'c'</span>
<span class="hljs-keyword">type</span> tail2 = <span class="hljs-title class_">Last</span>&lt;arr2&gt; <span class="hljs-comment">// 应推导出 1</span>
</code></pre>
<blockquote>
<p>在 Github 上查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F15%2Fzh-CN" target="_blank" title="https://tsch.js.org/15/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/15/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">代码</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 你的代码 _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Last</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = T <span class="hljs-keyword">extends</span> [...infer _, infer R] ? R : <span class="hljs-built_in">never</span>

</code></pre>
<p>关键解释：</p>
<ul>
<li><code>T extends [...infer _, infer R]</code>：通过 <code>infer</code> 提取数组的最后一个元素 <code>R</code>。</li>
<li><code>? R : never</code>：如果数组非空，返回 <code>R</code>；否则返回 <code>never</code>。</li>
</ul>
<h3 data-id="heading-3">相关知识点</h3>
<h4 data-id="heading-4"><code>extends</code></h4>




















<table><thead><tr><th>使用维度</th><th>核心作用</th><th>示例场景</th></tr></thead><tbody><tr><td>类型维度</td><td>做类型约束或条件判断（类型编程核心）</td><td>限定泛型范围、判断类型是否兼容、提取类型片段</td></tr><tr><td>语法维度</td><td>做继承（复用已有结构）</td><td>接口继承、类继承</td></tr></tbody></table>
<h5 data-id="heading-5"><code>extends</code> 做类型约束或条件判断</h5>
<ol>
<li>泛型约束：限定泛型的取值范围</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 约束 T 必须是「拥有 length 属性」的类型（比如 string/数组）</span>
<span class="hljs-keyword">function</span> getLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">arg</span>: T): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> arg.<span class="hljs-property">length</span>;
}

<span class="hljs-comment">// 合法调用（符合约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// ✅ string 有 length，返回 5</span>
<span class="hljs-title function_">getLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// ✅ 数组有 length，返回 3</span>

<span class="hljs-comment">// 非法调用（超出约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// ❌ 报错：number 没有 length 属性</span>
</code></pre>
<ol start="2">
<li>条件类型：类型版 <strong>三元运算符</strong></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础示例：判断类型是否为字符串</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"test"</span>&gt;; <span class="hljs-comment">// true（符合）</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;; <span class="hljs-comment">// false（不符合）</span>
</code></pre>
<p>分布式条件类型（联合类型专用）: 当 <code>T</code> 是联合类型时，<code>extends</code> 会自动拆分联合类型的每个成员，逐个判断后再合并结果。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Union</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;

<span class="hljs-comment">// 拆分逻辑：string→string，number→never，boolean→never → 合并为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// Result = string</span>
</code></pre>
<p>注意：只有泛型参数是 裸类型（没有被 []/{} 包裹）时，才会触发分布式判断：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 包裹后不触发分布式，整体判断 [string|number] 是否兼容 [string]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDist</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">NoDist</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// never（整体不兼容）</span>
</code></pre>
<ol start="3">
<li>配合 <code>infer</code>：提取类型片段（黄金组合）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 提取 Promise 的返回值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? V : T;

<span class="hljs-keyword">type</span> C = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string（提取成功）</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number（不满足条件，返回原类型）</span>
</code></pre>
<h5 data-id="heading-6"><code>extends</code> 做继承（复用已有结构）</h5>
<ol>
<li>接口继承：复用 + 扩展属性</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 继承 User，并扩展新属性</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span> | <span class="hljs-string">"super_admin"</span>; <span class="hljs-comment">// 新增权限属性</span>
}

<span class="hljs-comment">// 必须包含继承的 + 扩展的所有属性</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">admin</span>: <span class="hljs-title class_">Admin</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span>
};

<span class="hljs-comment">// 多接口继承</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasAge</span> { <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>, <span class="hljs-title class_">HasAge</span> {
  <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 同时继承 User + HasAge</span>
}
</code></pre>
<ol start="2">
<li>类继承：复用父类的属性 / 方法</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-comment">// 继承 Parent 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// 必须调用父类构造函数（初始化父类属性）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  <span class="hljs-comment">// 重写父类方法</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 调用父类原方法</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-number">10</span>);
child.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 输出：Hi, 李四 → I'm 10 years old</span>
</code></pre>
<p>补充：类实现接口用 <code>implements</code>（不是 <code>extends</code>）</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义接口（契约：规定必须有 id、name 属性，以及 greet 方法）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 仅定义方法签名，无实现</span>
}

<span class="hljs-comment">// 类实现接口（必须严格遵守契约）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-comment">// 必须实现接口的所有属性</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// 构造函数初始化属性</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 必须实现接口的 greet 方法（具体实现由类自己定义）</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>);
  }
}

<span class="hljs-comment">// 实例化使用</span>
<span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>);
emp.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// 输出：Hi, I'm 张三, ID: 1</span>


<span class="hljs-comment">// 接口1：基础信息</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 接口2：可打印</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> {
  <span class="hljs-title function_">printInfo</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 类同时实现两个接口（必须实现所有接口的成员）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span>, <span class="hljs-title class_">Printable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 类可扩展接口外的属性</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 实现 Identifiable 的方法</span>
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>;
  }

  <span class="hljs-comment">// 实现 Printable 的方法</span>
  <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Product: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getId()}</span>`</span>);
  }
}

<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"手机"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// 100</span>
product.<span class="hljs-title function_">printInfo</span>(); <span class="hljs-comment">// Product: 手机, ID: 100</span>
</code></pre>
<h4 data-id="heading-7"><code>infer</code></h4>
<p><code>infer</code> 是 TypeScript 在条件类型中提供的关键字，用于声明一个 <strong>待推导的类型变量</strong>（类似给类型起一个临时名字），只能在 <code>extends</code> 子句中使用。它的核心作用是：从已有类型中提取 / 推导我们需要的部分，而无需手动硬编码类型。</p>
<p><code>infer</code> 必须配合条件类型使用，语法结构如下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础结构：推导 T 的类型为 U，若能推导则返回 U，否则返回 never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">InferType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> infer U ? U : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example</span> = <span class="hljs-title class_">InferType</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// Example 类型为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example2</span> = <span class="hljs-title class_">InferType</span>&lt;<span class="hljs-built_in">number</span>[]&gt;; <span class="hljs-comment">// Example2 类型为 number[]</span>
</code></pre>
<p>高频使用场景:</p>
<h5 data-id="heading-8">1. 提取函数的返回值类型</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取函数的返回值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-title class_">Fn</span>&gt; = <span class="hljs-title class_">Fn</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试用函数</span>
<span class="hljs-keyword">const</span> add = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a + b;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUser</span> = (<span class="hljs-params"/>) =&gt; ({ <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> });

<span class="hljs-comment">// 使用类型工具</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddReturn</span> = <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-keyword">typeof</span> add&gt;; <span class="hljs-comment">// AddReturn 类型为 number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserReturn</span> = <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-keyword">typeof</span> getUser&gt;; <span class="hljs-comment">// UserReturn 类型为 { name: string; age: number }</span>
</code></pre>
<h5 data-id="heading-9">2. 提取数组的元素类型</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取数组元素类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetArrayItem</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer <span class="hljs-title class_">Item</span>)[] ? <span class="hljs-title class_">Item</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NumberArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;<span class="hljs-built_in">number</span>[]&gt;; <span class="hljs-comment">// NumberArray 类型为 number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// StringArray 类型为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MixedArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;[<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>]&gt;; <span class="hljs-comment">// MixedArray 类型为 string | number</span>
</code></pre>
<h5 data-id="heading-10">3. 提取 Promise 的泛型参数类型</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取 Promise 的泛型类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetPromiseValue</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer <span class="hljs-title class_">Value</span>&gt; ? <span class="hljs-title class_">Value</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseString</span> = <span class="hljs-title class_">GetPromiseValue</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// PromiseString 类型为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseUser</span> = <span class="hljs-title class_">GetPromiseValue</span>&lt;<span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> }&gt;&gt;; <span class="hljs-comment">// PromiseUser 类型为 { id: number }</span>
</code></pre>
<h5 data-id="heading-11">4. 提取函数的参数类型</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取函数参数类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-title class_">Fn</span>&gt; = <span class="hljs-title class_">Fn</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Params</span>) =&gt; <span class="hljs-built_in">any</span> ? <span class="hljs-title class_">Params</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> fn = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {};
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FnParams</span> = <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;; <span class="hljs-comment">// FnParams 类型为 [string, number]</span>

<span class="hljs-comment">// 进一步：提取第一个参数的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FirstParam</span> = <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;[<span class="hljs-number">0</span>]; <span class="hljs-comment">// FirstParam 类型为 string</span>
</code></pre>
<h4 data-id="heading-12"><code>never</code></h4>
<p><code>never</code> 表示<strong>永不存在的类型</strong>：</p>
<ol>
<li>没有任何类型能赋值给 <code>never</code>（除了 <code>never</code> 自身）；</li>
<li><code>never</code> 可以赋值给任意类型（因为它是所有类型的子类型）；</li>
<li>不会有任何实际值属于 <code>never</code> 类型。</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">n</span>: <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">123</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">u</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-string">"hello"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">v</span>: <span class="hljs-built_in">void</span> = <span class="hljs-literal">undefined</span>;

<span class="hljs-comment">// 1. 任何类型都不能赋值给 never（除了自身）</span>
n = num;   <span class="hljs-comment">// ❌ 报错：number 不能赋值给 never</span>
n = u;     <span class="hljs-comment">// ❌ 报错：unknown 不能赋值给 never</span>
n = v;     <span class="hljs-comment">// ❌ 报错：void 不能赋值给 never</span>
n = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// ❌ 报错：undefined 也不行</span>
n = n;     <span class="hljs-comment">// ✅ 仅自身可赋值</span>

<span class="hljs-comment">// 2. never 可以赋值给任意类型</span>
num = n;   <span class="hljs-comment">// ✅ 正常</span>
u = n;     <span class="hljs-comment">// ✅ 正常</span>
v = n;     <span class="hljs-comment">// ✅ 正常</span>
</code></pre>
<ol>
<li>泛型的边界约束: 通过泛型约束让不满足条件的泛型类型变为 <code>never</code>，从而达到<strong>限制类型范围</strong>的目的。</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义泛型：仅允许 T 为 string 类型，否则 T 为 never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 满足条件：T 为 string，结果正常</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Str1</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-string">"hello"</span>&gt;; <span class="hljs-comment">// Str1 = "hello"</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Str2</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-built_in">string</span>&gt;;  <span class="hljs-comment">// Str2 = string</span>

<span class="hljs-comment">// 不满足条件：T 为非 string，结果为 never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-built_in">number</span>&gt;;   <span class="hljs-comment">// Num = never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Bool</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-built_in">boolean</span>&gt;; <span class="hljs-comment">// Bool = never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Unk</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-built_in">unknown</span>&gt;;  <span class="hljs-comment">// Unk = never</span>

<span class="hljs-comment">// 实际使用：强制函数参数只能是 string 类型</span>
<span class="hljs-keyword">function</span> printStr&lt;T&gt;(<span class="hljs-attr">val</span>: <span class="hljs-title class_">OnlyString</span>&lt;T&gt;) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val);
}

<span class="hljs-title function_">printStr</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// ✅ 正常</span>
<span class="hljs-title function_">printStr</span>(<span class="hljs-number">123</span>);     <span class="hljs-comment">// ❌ 报错：number 不能赋值给 never</span>
</code></pre>
<h3 data-id="heading-13">测试用例</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 测试用例 _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Last</span>&lt;[]&gt;, <span class="hljs-built_in">never</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Last</span>&lt;[<span class="hljs-number">2</span>]&gt;, <span class="hljs-number">2</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Last</span>&lt;[<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]&gt;, <span class="hljs-number">1</span>&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Last</span>&lt;[<span class="hljs-function">() =&gt;</span> <span class="hljs-number">123</span>, { <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> }]&gt;, { <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> }&gt;&gt;,
]

</code></pre>
<h3 data-id="heading-14">相关链接</h3>
<blockquote>
<p>分享你的解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F15%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/15/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/15/answer/z…</a>
查看解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F15%2Fsolutions" target="_blank" title="https://tsch.js.org/15/solutions" ref="nofollow noopener noreferrer">tsch.js.org/15/solution…</a>
更多题目：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>下面是我的公众号，欢迎关注。关注后有新的功能点会及时收到推送。</p>
<blockquote>
<p>实战为王！专注于汇总各种功能点，致力于打造一系列能够帮助工程师实现各种功能的想法思路的优质文章。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770443397&amp;x-signature=DS0m%2BI8ZIB7dsTYLD%2Bo56a1ri48%3D" alt="前端功能点" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flowable工作流：从入门到实战]]></title>    <link>https://juejin.cn/post/7600622206269440010</link>    <guid>https://juejin.cn/post/7600622206269440010</guid>    <pubDate>2026-01-30T01:10:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206269440010" data-draft-id="7600606150732890155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flowable工作流：从入门到实战"/> <meta itemprop="keywords" content="工作流引擎"/> <meta itemprop="datePublished" content="2026-01-30T01:10:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flowable工作流：从入门到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T01:10:21.000Z" title="Fri Jan 30 2026 01:10:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flowable工作流：从入门到实战</h2>
<h3 data-id="heading-1">一、什么是Flowable</h3>
<p>Flowable是一个开源的轻量级业务流程引擎（BPMN 2.0），它起源于Activiti项目，是Activiti的继任者。Flowable提供了完整的工作流和业务流程管理（BPM）平台，支持流程定义、部署、执行、监控等全生命周期管理。</p>
<h4 data-id="heading-2">1.1 核心特性</h4>
<ul>
<li><strong>BPMN 2.0标准支持</strong>：完全符合BPMN 2.0规范</li>
<li><strong>轻量级</strong>：可嵌入到任何Java应用中</li>
<li><strong>高性能</strong>：支持高并发场景</li>
<li><strong>灵活扩展</strong>：提供丰富的扩展点</li>
<li><strong>云原生</strong>：支持微服务架构</li>
</ul>
<h4 data-id="heading-3">1.2 核心组件</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3311a7a20cf6442b94326a9b3ce2b7a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=VCt%2F22i6HOeSLnLRLvIH8LUDybY%3D" alt="" loading="lazy"/></p>
<p>Flowable主要由以下核心组件构成：</p>
<ul>
<li><strong>Flowable Engine</strong>：核心流程引擎</li>
<li><strong>Flowable Modeler</strong>：流程建模工具</li>
<li><strong>Flowable Task</strong>：任务管理应用</li>
<li><strong>Flowable Admin</strong>：管理监控界面</li>
<li><strong>Flowable REST</strong>：REST API接口</li>
</ul>
<h3 data-id="heading-4">二、核心概念详解</h3>
<h4 data-id="heading-5">2.1 BPMN 2.0基础</h4>
<p>BPMN（Business Process Model and Notation）是业务流程建模与 notation 的标准。BPMN 2.0定义了一套标准的图形符号来表示业务流程。</p>
<h5 data-id="heading-6">基本元素</h5>
<ul>
<li><strong>事件（Event）</strong>：流程中发生的事情，如开始事件、结束事件</li>
<li><strong>活动（Activity）</strong>：流程中的工作单元，如用户任务、服务任务</li>
<li><strong>网关（Gateway）</strong>：控制流程分支，如排他网关、并行网关</li>
<li><strong>连接线（Sequence Flow）</strong>：连接各个元素</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15604c79c6764d2e8122efbc1be76eec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=4gXyatOBhMRV5Ex%2BUPQHEvlHXpU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">2.2 流程定义</h4>
<p>流程定义是业务流程的静态描述，使用BPMN XML格式定义。一个典型的请假流程定义如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span>
             <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"Examples"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leaveRequest"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"请假流程"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 开始事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"开始"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 员工填写请假单 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"employeeTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"填写请假单"</span>
                  <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"${employee}"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 部门经理审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"managerTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"经理审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"managers"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 排他网关：根据天数决定是否需要HR审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"gateway"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- HR审批（超过3天需要） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hrTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HR审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"hr"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 结束事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"endEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"结束"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 连接线 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"employeeTask"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"employeeTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"managerTask"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"managerTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"gateway"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"gateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"hrTask"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${days &gt; 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"gateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"endEvent"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${days &lt;= 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"hrTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"endEvent"</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">2.3 流程实例与执行</h4>
<p>流程实例是流程定义的一次具体执行。一个流程定义可以创建多个流程实例，每个实例有独立的执行状态和变量。</p>
<h3 data-id="heading-9">三、快速入门</h3>
<h4 data-id="heading-10">3.1 环境搭建</h4>
<p>首先创建Maven项目，添加Flowable依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Flowable核心引擎 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flowable<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flowable-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Flowable REST API --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flowable<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flowable-rest<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 数据库连接 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.h2database<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.224<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 日志 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">3.2 初始化流程引擎</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowableEngineConfig</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ProcessEngine processEngine;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ProcessEngine <span class="hljs-title function_">getProcessEngine</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (processEngine == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (FlowableEngineConfig.class) {
                <span class="hljs-keyword">if</span> (processEngine == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 配置流程引擎</span>
                    <span class="hljs-type">ProcessEngineConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> ProcessEngineConfiguration
                            .createStandaloneProcessEngineConfiguration();

                    <span class="hljs-comment">// 配置数据库连接</span>
                    configuration.setJdbcDriver(<span class="hljs-string">"org.h2.Driver"</span>);
                    configuration.setJdbcUrl(<span class="hljs-string">"jdbc:h2:mem:flowable;DB_CLOSE_DELAY=-1"</span>);
                    configuration.setJdbcUsername(<span class="hljs-string">"sa"</span>);
                    configuration.setJdbcPassword(<span class="hljs-string">""</span>);

                    <span class="hljs-comment">// 自动创建/更新数据库表结构</span>
                    configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);

                    <span class="hljs-comment">// 创建流程引擎</span>
                    processEngine = configuration.buildProcessEngine();
                }
            }
        }
        <span class="hljs-keyword">return</span> processEngine;
    }

    <span class="hljs-comment">// 获取各个服务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RepositoryService <span class="hljs-title function_">getRepositoryService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getRepositoryService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RuntimeService <span class="hljs-title function_">getRuntimeService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getRuntimeService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TaskService <span class="hljs-title function_">getTaskService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getTaskService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HistoryService <span class="hljs-title function_">getHistoryService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getHistoryService();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ManagementService <span class="hljs-title function_">getManagementService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> getProcessEngine().getManagementService();
    }
}
</code></pre>
<h4 data-id="heading-12">3.3 部署流程定义</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessDeploymentService</span> {

    <span class="hljs-comment">/**
     * 部署流程定义
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deployProcess</span><span class="hljs-params">(String processName, String resourcePath)</span> {
        <span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> FlowableEngineConfig.getRepositoryService()
                .createDeployment()
                .name(processName)
                .addClasspathResource(resourcePath)
                .deploy();

        System.out.println(<span class="hljs-string">"流程部署成功，部署ID: "</span> + deployment.getId());
        <span class="hljs-keyword">return</span> deployment.getId();
    }

    <span class="hljs-comment">/**
     * 查询已部署的流程列表
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ProcessDefinition&gt; <span class="hljs-title function_">listProcesses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> FlowableEngineConfig.getRepositoryService()
                .createProcessDefinitionQuery()
                .orderByProcessDefinitionName()
                .asc()
                .list();
    }
}
</code></pre>
<h4 data-id="heading-13">3.4 启动流程实例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessInstanceService</span> {

    <span class="hljs-comment">/**
     * 启动流程实例
     */</span>
    <span class="hljs-keyword">public</span> ProcessInstance <span class="hljs-title function_">startProcess</span><span class="hljs-params">(String processDefinitionKey, Map&lt;String, Object&gt; variables)</span> {
        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> FlowableEngineConfig.getRuntimeService()
                .startProcessInstanceByKey(processDefinitionKey, variables);

        System.out.println(<span class="hljs-string">"流程实例启动成功，实例ID: "</span> + processInstance.getId());
        System.out.println(<span class="hljs-string">"业务Key: "</span> + processInstance.getBusinessKey());

        <span class="hljs-keyword">return</span> processInstance;
    }

    <span class="hljs-comment">/**
     * 查询运行中的流程实例
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ProcessInstance&gt; <span class="hljs-title function_">listRunningInstances</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> FlowableEngineConfig.getRuntimeService()
                .createProcessInstanceQuery()
                .orderByStartTime()
                .desc()
                .list();
    }
}
</code></pre>
<h3 data-id="heading-14">四、核心服务详解</h3>
<p>Flowable通过服务层对外提供功能，主要包括以下服务：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac5929ac76274dec9c565013fda3fceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=8CBrIwwOVEd%2FyU2lwRFlgZPr2Ck%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">4.1 RepositoryService（仓库服务）</h4>
<p>管理流程定义和部署对象：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 部署流程</span>
<span class="hljs-type">Deployment</span> <span class="hljs-variable">deployment</span> <span class="hljs-operator">=</span> repositoryService.createDeployment()
    .name(<span class="hljs-string">"请假流程"</span>)
    .addClasspathResource(<span class="hljs-string">"processes/leave-request.bpmn20.xml"</span>)
    .deploy();

<span class="hljs-comment">// 查询流程定义</span>
<span class="hljs-type">ProcessDefinition</span> <span class="hljs-variable">processDefinition</span> <span class="hljs-operator">=</span> repositoryService
    .createProcessDefinitionQuery()
    .processDefinitionKey(<span class="hljs-string">"leaveRequest"</span>)
    .singleResult();

<span class="hljs-comment">// 挂起/激活流程定义</span>
repositoryService.suspendProcessDefinitionById(processDefinitionId);
repositoryService.activateProcessDefinitionById(processDefinitionId);

<span class="hljs-comment">// 删除流程定义</span>
repositoryService.deleteDeployment(deploymentId, <span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-16">4.2 RuntimeService（运行时服务）</h4>
<p>管理流程实例和执行：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 启动流程实例</span>
<span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService
    .startProcessInstanceByKey(<span class="hljs-string">"leaveRequest"</span>, variables);

<span class="hljs-comment">// 设置流程变量</span>
runtimeService.setVariable(processInstanceId, <span class="hljs-string">"days"</span>, <span class="hljs-number">5</span>);
runtimeService.setVariable(processInstanceId, <span class="hljs-string">"reason"</span>, <span class="hljs-string">"休息"</span>);

<span class="hljs-comment">// 获取流程变量</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">days</span> <span class="hljs-operator">=</span> (Integer) runtimeService.getVariable(processInstanceId, <span class="hljs-string">"days"</span>);

<span class="hljs-comment">// 触发流程执行</span>
runtimeService.trigger(executionId);

<span class="hljs-comment">// 挂起/激活流程实例</span>
runtimeService.suspendProcessInstanceById(processInstanceId);
runtimeService.activateProcessInstanceById(processInstanceId);

<span class="hljs-comment">// 删除流程实例</span>
runtimeService.deleteProcessInstance(processInstanceId, <span class="hljs-string">"取消申请"</span>);
</code></pre>
<h4 data-id="heading-17">4.3 TaskService（任务服务）</h4>
<p>管理用户任务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查询用户的待办任务</span>
List&lt;Task&gt; tasks = taskService.createTaskQuery()
    .taskAssignee(<span class="hljs-string">"zhangsan"</span>)
    .orderByTaskCreateTime()
    .desc()
    .list();

<span class="hljs-comment">// 完成任务</span>
taskService.complete(taskId);

<span class="hljs-comment">// 带变量完成任务</span>
Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
variables.put(<span class="hljs-string">"approved"</span>, <span class="hljs-literal">true</span>);
taskService.complete(taskId, variables);

<span class="hljs-comment">// 认领任务（候选任务）</span>
taskService.claim(taskId, <span class="hljs-string">"lisi"</span>);

<span class="hljs-comment">// 委派任务</span>
taskService.delegateTask(taskId, <span class="hljs-string">"wangwu"</span>);

<span class="hljs-comment">// 设置任务优先级</span>
taskService.setPriority(taskId, <span class="hljs-number">50</span>);
</code></pre>
<h4 data-id="heading-18">4.4 HistoryService（历史服务）</h4>
<p>查询历史数据：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查询已完成的流程实例</span>
List&lt;HistoricProcessInstance&gt; finishedInstances = historyService
    .createHistoricProcessInstanceQuery()
    .finished()
    .orderByProcessInstanceEndTime()
    .desc()
    .list();

<span class="hljs-comment">// 查询历史任务</span>
List&lt;HistoricTaskInstance&gt; historicTasks = historyService
    .createHistoricTaskInstanceQuery()
    .taskAssignee(<span class="hljs-string">"zhangsan"</span>)
    .finished()
    .list();

<span class="hljs-comment">// 查询历史变量</span>
List&lt;HistoricVariableInstance&gt; variables = historyService
    .createHistoricVariableInstanceQuery()
    .processInstanceId(processInstanceId)
    .list();

<span class="hljs-comment">// 查询流程实例历史（按时间线）</span>
List&lt;HistoricActivityInstance&gt; activities = historyService
    .createHistoricActivityInstanceQuery()
    .processInstanceId(processInstanceId)
    .orderByHistoricActivityInstanceStartTime()
    .asc()
    .list();
</code></pre>
<h4 data-id="heading-19">4.5 ManagementService（管理服务）</h4>
<p>执行管理操作：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 获取数据库表信息</span>
<span class="hljs-type">TableMetaData</span> <span class="hljs-variable">tableMetaData</span> <span class="hljs-operator">=</span> managementService
    .getTablesMetaData()
    .get(<span class="hljs-string">"ACT_RU_TASK"</span>);

<span class="hljs-comment">// 执行自定义SQL</span>
List&lt;Map&lt;String, Object&gt;&gt; results = managementService
    .executeCustomSql(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractCustomSqlExecution</span>&lt;CustomQuery, List&lt;Map&lt;String, Object&gt;&gt;&gt;(CustomQuery.class) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">(Configuration configuration)</span> {
                <span class="hljs-comment">// 自定义SQL执行逻辑</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        }
    );

<span class="hljs-comment">// 获取作业列表</span>
List&lt;Job&gt; jobs = managementService.createJobQuery().list();
</code></pre>
<h3 data-id="heading-20">五、实战案例：请假审批系统</h3>
<h4 data-id="heading-21">5.1 业务需求</h4>
<p>实现一个企业内部请假审批系统，支持以下功能：</p>
<ol>
<li>员工提交请假申请</li>
<li>部门经理审批（1-3天直接通过）</li>
<li>HR审批（超过3天需要HR审批）</li>
<li>审批通过/驳回</li>
<li>查询请假记录</li>
</ol>
<h4 data-id="heading-22">5.2 系统架构设计</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc2e5a1e5e58411d87e458289074bf86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=MOQYdYbaqMfA0OKE9XEDVJKkGpE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-23">5.3 流程定义</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span>
             <span class="hljs-attr">xmlns:flowable</span>=<span class="hljs-string">"http://flowable.org/bpmn"</span>
             <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"Examples"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leaveRequest"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"请假审批流程"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 开始事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"提交申请"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 员工填写请假单 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"submitLeave"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"填写请假单"</span>
                  <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"${initiator}"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">documentation</span>&gt;</span>员工填写请假信息，包括请假天数、原因等<span class="hljs-tag">&lt;/<span class="hljs-name">documentation</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 部门经理审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"managerApproval"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"经理审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"managers"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">documentation</span>&gt;</span>部门经理审批请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">documentation</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 排他网关：根据审批结果和天数决定流程走向 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusiveGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approvalGateway"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 驳回处理 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rejectHandler"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"处理驳回"</span>
                     <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"com.example.flowable.delegate.RejectDelegate"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- HR审批（超过3天） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hrApproval"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"HR审批"</span>
                  <span class="hljs-attr">flowable:candidateGroups</span>=<span class="hljs-string">"hr"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">documentation</span>&gt;</span>HR审批长期请假申请<span class="hljs-tag">&lt;/<span class="hljs-name">documentation</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 通知员工 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"发送通知"</span>
                     <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"com.example.flowable.delegate.NotifyDelegate"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 结束事件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"approveEnd"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"审批通过"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rejectEnd"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"审批驳回"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 连接线 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow1"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"startEvent"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"submitLeave"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow2"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"submitLeave"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"managerApproval"</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow3"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"managerApproval"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approvalGateway"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 驳回 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow4"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approvalGateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"rejectHandler"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${approved == false}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow5"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"rejectHandler"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"notifyEmployee"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow6"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"rejectEnd"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 通过但需要HR审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow7"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approvalGateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"hrApproval"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${approved == true &amp;&amp; days &gt; 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow8"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"hrApproval"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"notifyEmployee"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow9"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approveEnd"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!-- 通过且不需要HR审批 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow10"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"approvalGateway"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"notifyEmployee"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">conditionExpression</span>&gt;</span>${approved == true &amp;&amp; days &lt;= 3}<span class="hljs-tag">&lt;/<span class="hljs-name">conditionExpression</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">sequenceFlow</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"flow11"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"notifyEmployee"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"approveEnd"</span>/&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">5.4 服务层实现</h4>
<h5 data-id="heading-25">请假服务</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeaveRequestService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuntimeService runtimeService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TaskService taskService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> HistoryService historyService;

    <span class="hljs-comment">/**
     * 创建请假申请
     */</span>
    <span class="hljs-keyword">public</span> LeaveRequest <span class="hljs-title function_">createLeaveRequest</span><span class="hljs-params">(LeaveRequest request)</span> {
        <span class="hljs-comment">// 设置流程变量</span>
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"initiator"</span>, request.getEmployeeId());
        variables.put(<span class="hljs-string">"days"</span>, request.getDays());
        variables.put(<span class="hljs-string">"reason"</span>, request.getReason());
        variables.put(<span class="hljs-string">"startDate"</span>, request.getStartDate());
        variables.put(<span class="hljs-string">"endDate"</span>, request.getEndDate());

        <span class="hljs-comment">// 启动流程实例</span>
        <span class="hljs-type">ProcessInstance</span> <span class="hljs-variable">processInstance</span> <span class="hljs-operator">=</span> runtimeService
                .startProcessInstanceByKey(<span class="hljs-string">"leaveRequest"</span>, request.getBusinessKey(), variables);

        <span class="hljs-comment">// 完成填写请假单任务，自动流转到经理审批</span>
        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskService.createTaskQuery()
                .processInstanceId(processInstance.getId())
                .taskAssignee(request.getEmployeeId())
                .singleResult();

        <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>) {
            taskService.complete(task.getId());
        }

        <span class="hljs-comment">// 保存流程实例ID</span>
        request.setProcessInstanceId(processInstance.getId());
        request.setStatus(<span class="hljs-string">"pending"</span>);

        <span class="hljs-keyword">return</span> request;
    }

    <span class="hljs-comment">/**
     * 经理审批
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">managerApproval</span><span class="hljs-params">(String taskId, <span class="hljs-type">boolean</span> approved, String comment)</span> {
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"approved"</span>, approved);
        variables.put(<span class="hljs-string">"managerComment"</span>, comment);

        <span class="hljs-comment">// 添加审批意见</span>
        taskService.addComment(taskId, <span class="hljs-literal">null</span>, comment);

        <span class="hljs-comment">// 完成任务</span>
        taskService.complete(taskId, variables);
    }

    <span class="hljs-comment">/**
     * HR审批
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hrApproval</span><span class="hljs-params">(String taskId, <span class="hljs-type">boolean</span> approved, String comment)</span> {
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"approved"</span>, approved);
        variables.put(<span class="hljs-string">"hrComment"</span>, comment);

        taskService.addComment(taskId, <span class="hljs-literal">null</span>, comment);
        taskService.complete(taskId, variables);
    }

    <span class="hljs-comment">/**
     * 获取用户的待办任务
     */</span>
    <span class="hljs-keyword">public</span> List&lt;TaskDTO&gt; <span class="hljs-title function_">getMyTasks</span><span class="hljs-params">(String userId)</span> {
        List&lt;Task&gt; tasks = taskService.createTaskQuery()
                .taskAssignee(userId)
                .orderByTaskCreateTime()
                .desc()
                .list();

        <span class="hljs-keyword">return</span> tasks.stream()
                .map(<span class="hljs-built_in">this</span>::convertToDTO)
                .collect(Collectors.toList());
    }

    <span class="hljs-comment">/**
     * 获取组任务（候选任务）
     */</span>
    <span class="hljs-keyword">public</span> List&lt;TaskDTO&gt; <span class="hljs-title function_">getCandidateTasks</span><span class="hljs-params">(String groupId)</span> {
        List&lt;Task&gt; tasks = taskService.createTaskQuery()
                .taskCandidateGroup(groupId)
                .orderByTaskCreateTime()
                .desc()
                .list();

        <span class="hljs-keyword">return</span> tasks.stream()
                .map(<span class="hljs-built_in">this</span>::convertToDTO)
                .collect(Collectors.toList());
    }

    <span class="hljs-comment">/**
     * 认领任务
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">claimTask</span><span class="hljs-params">(String taskId, String userId)</span> {
        taskService.claim(taskId, userId);
    }

    <span class="hljs-comment">/**
     * 查询请假历史记录
     */</span>
    <span class="hljs-keyword">public</span> List&lt;LeaveRequestHistory&gt; <span class="hljs-title function_">getLeaveHistory</span><span class="hljs-params">(String employeeId)</span> {
        List&lt;HistoricProcessInstance&gt; instances = historyService
                .createHistoricProcessInstanceQuery()
                .variableValueEquals(<span class="hljs-string">"initiator"</span>, employeeId)
                .orderByProcessInstanceStartTime()
                .desc()
                .list();

        <span class="hljs-keyword">return</span> instances.stream()
                .map(<span class="hljs-built_in">this</span>::convertToHistory)
                .collect(Collectors.toList());
    }

    <span class="hljs-keyword">private</span> TaskDTO <span class="hljs-title function_">convertToDTO</span><span class="hljs-params">(Task task)</span> {
        <span class="hljs-type">TaskDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskDTO</span>();
        dto.setTaskId(task.getId());
        dto.setTaskName(task.getName());
        dto.setProcessInstanceId(task.getProcessInstanceId());
        dto.setCreateTime(task.getCreateTime());
        dto.setAssignee(task.getAssignee());

        <span class="hljs-comment">// 获取流程变量</span>
        Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());
        dto.setVariables(variables);

        <span class="hljs-keyword">return</span> dto;
    }
}
</code></pre>
<h5 data-id="heading-26">驳回处理委托</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RejectDelegate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JavaDelegate</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(DelegateExecution execution)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">processInstanceId</span> <span class="hljs-operator">=</span> execution.getProcessInstanceId();
        <span class="hljs-type">String</span> <span class="hljs-variable">initiator</span> <span class="hljs-operator">=</span> (String) execution.getVariable(<span class="hljs-string">"initiator"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">reason</span> <span class="hljs-operator">=</span> (String) execution.getVariable(<span class="hljs-string">"reason"</span>);

        <span class="hljs-comment">// 记录驳回原因</span>
        execution.setVariable(<span class="hljs-string">"rejectReason"</span>, <span class="hljs-string">"请假申请被驳回"</span>);

        <span class="hljs-comment">// 这里可以发送通知、更新业务系统状态等</span>
        System.out.println(<span class="hljs-string">"驳回请假申请: "</span> + processInstanceId);
        System.out.println(<span class="hljs-string">"申请人: "</span> + initiator);
        System.out.println(<span class="hljs-string">"请假原因: "</span> + reason);

        <span class="hljs-comment">// 可以调用外部服务发送邮件、短信通知</span>
        <span class="hljs-comment">// notificationService.sendRejectNotification(initiator);</span>
    }
}
</code></pre>
<h5 data-id="heading-27">通知委托</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotifyDelegate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JavaDelegate</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(DelegateExecution execution)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">processInstanceId</span> <span class="hljs-operator">=</span> execution.getProcessInstanceId();
        <span class="hljs-type">String</span> <span class="hljs-variable">initiator</span> <span class="hljs-operator">=</span> (String) execution.getVariable(<span class="hljs-string">"initiator"</span>);
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">approved</span> <span class="hljs-operator">=</span> (Boolean) execution.getVariable(<span class="hljs-string">"approved"</span>);

        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(approved)) {
            System.out.println(<span class="hljs-string">"审批通过通知: "</span> + processInstanceId);
            <span class="hljs-comment">// 发送通过通知</span>
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"审批驳回通知: "</span> + processInstanceId);
            <span class="hljs-comment">// 发送驳回通知</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-28">5.5 REST API</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/leave")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeaveRequestController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LeaveRequestService leaveRequestService;

    <span class="hljs-comment">/**
     * 提交请假申请
     */</span>
    <span class="hljs-meta">@PostMapping("/submit")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;LeaveRequest&gt; <span class="hljs-title function_">submitLeave</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> LeaveRequest request)</span> {
        <span class="hljs-type">LeaveRequest</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> leaveRequestService.createLeaveRequest(request);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">/**
     * 获取我的待办任务
     */</span>
    <span class="hljs-meta">@GetMapping("/my-tasks")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;TaskDTO&gt;&gt; <span class="hljs-title function_">getMyTasks</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String userId)</span> {
        List&lt;TaskDTO&gt; tasks = leaveRequestService.getMyTasks(userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(tasks);
    }

    <span class="hljs-comment">/**
     * 获取候选任务
     */</span>
    <span class="hljs-meta">@GetMapping("/candidate-tasks")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;TaskDTO&gt;&gt; <span class="hljs-title function_">getCandidateTasks</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String groupId)</span> {
        List&lt;TaskDTO&gt; tasks = leaveRequestService.getCandidateTasks(groupId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(tasks);
    }

    <span class="hljs-comment">/**
     * 认领任务
     */</span>
    <span class="hljs-meta">@PostMapping("/tasks/{taskId}/claim")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">claimTask</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String taskId,
            <span class="hljs-meta">@RequestParam</span> String userId)</span> {
        leaveRequestService.claimTask(taskId, userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();
    }

    <span class="hljs-comment">/**
     * 完成审批
     */</span>
    <span class="hljs-meta">@PostMapping("/tasks/{taskId}/complete")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">completeTask</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String taskId,
            <span class="hljs-meta">@RequestBody</span> ApprovalRequest approval)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"managerApproval"</span>.equals(approval.getTaskName())) {
            leaveRequestService.managerApproval(taskId, approval.isApproved(), approval.getComment());
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"hrApproval"</span>.equals(approval.getTaskName())) {
            leaveRequestService.hrApproval(taskId, approval.isApproved(), approval.getComment());
        }
        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();
    }

    <span class="hljs-comment">/**
     * 查询请假历史
     */</span>
    <span class="hljs-meta">@GetMapping("/history")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;LeaveRequestHistory&gt;&gt; <span class="hljs-title function_">getHistory</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String employeeId)</span> {
        List&lt;LeaveRequestHistory&gt; history = leaveRequestService.getLeaveHistory(employeeId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(history);
    }
}
</code></pre>
<h3 data-id="heading-29">六、高级特性</h3>
<h4 data-id="heading-30">6.1 并行网关</h4>
<p>并行网关用于处理多个并发任务：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parallelGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fork"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">parallelGateway</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"join"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 分支1 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"task1"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"任务1"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"fork"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"task1"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"task1"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"join"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 分支2 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"task2"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"任务2"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"fork"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"task2"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"task2"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"join"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- 分支3 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"task3"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"任务3"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"fork"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"task3"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"task3"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"join"</span>/&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/538e42783af64a28b77a4692a8aac1e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=PcjUBaboK3BzAJmkrZU3us3snvE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-31">6.2 子流程</h4>
<p>子流程用于封装可重用的流程片段：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">subProcess</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subProcess"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"审批子流程"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subStart"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"子流程任务"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subEnd"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"subStart"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"subTask"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sequenceFlow</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"subTask"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"subEnd"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">subProcess</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">callActivity</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"callSubProcess"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"调用子流程"</span>
               <span class="hljs-attr">calledElement</span>=<span class="hljs-string">"subProcess"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-32">6.3 事件机制</h4>
<p>Flowable支持多种事件类型：</p>
<ul>
<li><strong>定时器事件</strong>：基于时间的触发</li>
<li><strong>消息事件</strong>：异步消息传递</li>
<li><strong>信号事件</strong>：广播式通知</li>
<li><strong>错误事件</strong>：异常处理</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 定时器事件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">intermediateCatchEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"timerEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"等待通知"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">timerEventDefinition</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">timeDuration</span>&gt;</span>PT2H<span class="hljs-tag">&lt;/<span class="hljs-name">timeDuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">timerEventDefinition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">intermediateCatchEvent</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 消息事件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">intermediateCatchEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messageEvent"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"接收消息"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">messageEventDefinition</span> <span class="hljs-attr">messageRef</span>=<span class="hljs-string">"approvalMessage"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">intermediateCatchEvent</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 边界定时器事件 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">boundaryEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"boundaryTimer"</span> <span class="hljs-attr">attachedToRef</span>=<span class="hljs-string">"userTask"</span>
               <span class="hljs-attr">cancelActivity</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">timerEventDefinition</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">timeDuration</span>&gt;</span>PT1H<span class="hljs-tag">&lt;/<span class="hljs-name">timeDuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">timerEventDefinition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">boundaryEvent</span>&gt;</span>
</code></pre>
<h4 data-id="heading-33">6.4 监听器</h4>
<p>通过监听器实现业务逻辑的扩展：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 流程启动监听器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessStartListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ExecutionListener</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(DelegateExecution execution)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">processDefinitionId</span> <span class="hljs-operator">=</span> execution.getProcessDefinitionId();
        System.out.println(<span class="hljs-string">"流程启动: "</span> + processDefinitionId);

        <span class="hljs-comment">// 记录日志、发送通知等</span>
    }
}

<span class="hljs-comment">// 任务创建监听器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskCreateListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskListener</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">(DelegateTask delegateTask)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> delegateTask.getName();
        <span class="hljs-type">String</span> <span class="hljs-variable">assignee</span> <span class="hljs-operator">=</span> delegateTask.getAssignee();
        System.out.println(<span class="hljs-string">"任务创建: "</span> + taskName + <span class="hljs-string">", 分配给: "</span> + assignee);

        <span class="hljs-comment">// 发送任务通知</span>
    }
}
</code></pre>
<p>配置监听器：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"leaveRequest"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">flowable:executionListener</span> <span class="hljs-attr">event</span>=<span class="hljs-string">"start"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.flowable.listener.ProcessStartListener"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"managerTask"</span> <span class="hljs-attr">flowable:assignee</span>=<span class="hljs-string">"${manager}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">extensionElements</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">flowable:taskListener</span> <span class="hljs-attr">event</span>=<span class="hljs-string">"create"</span>
                <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.flowable.listener.TaskCreateListener"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">extensionElements</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">userTask</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">process</span>&gt;</span>
</code></pre>
<h3 data-id="heading-34">七、生产环境最佳实践</h3>
<h4 data-id="heading-35">7.1 数据库优化</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 为常用查询字段添加索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_ru_task_ASSIGNEE <span class="hljs-keyword">ON</span> ACT_RU_TASK(ASSIGNEE_);
<span class="hljs-keyword">CREATE</span> INDEX idx_ru_task_PROC_INST <span class="hljs-keyword">ON</span> ACT_RU_TASK(PROC_INST_ID_);
<span class="hljs-keyword">CREATE</span> INDEX idx_hi_procinst_BUS_KEY <span class="hljs-keyword">ON</span> ACT_HI_PROCINST(BUS_KEY_);
<span class="hljs-keyword">CREATE</span> INDEX idx_hi_actinst_PROC_INST <span class="hljs-keyword">ON</span> ACT_HI_ACTINST(PROC_INST_ID_);

<span class="hljs-comment">-- 定期清理历史数据（根据业务需求配置保留时长）</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> ACT_HI_VARINST <span class="hljs-keyword">WHERE</span> END_TIME_ <span class="hljs-operator">&lt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">YEAR</span>);
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> ACT_HI_DETAIL <span class="hljs-keyword">WHERE</span> TIME_ <span class="hljs-operator">&lt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">YEAR</span>);
</code></pre>
<h4 data-id="heading-36">7.2 性能优化</h4>
<ol>
<li><strong>异步执行</strong>：对耗时操作使用异步任务</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"asyncTask"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"异步任务"</span>
             <span class="hljs-attr">flowable:async</span>=<span class="hljs-string">"true"</span>
             <span class="hljs-attr">flowable:class</span>=<span class="hljs-string">"com.example.flowable.delegate.AsyncTaskDelegate"</span>/&gt;</span>
</code></pre>
<ol start="2">
<li><strong>批量操作</strong>：使用批量查询和操作API</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 批量查询任务</span>
List&lt;Task&gt; tasks = taskService.createTaskQuery()
    .taskAssignee(<span class="hljs-string">"user1"</span>)
    .listPage(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);

<span class="hljs-comment">// 批量完成任务</span>
List&lt;String&gt; taskIds = Arrays.asList(<span class="hljs-string">"task1"</span>, <span class="hljs-string">"task2"</span>, <span class="hljs-string">"task3"</span>);
taskService.completeBatchTasks(taskIds);
</code></pre>
<ol start="3">
<li><strong>缓存配置</strong>：启用流程定义缓存</li>
</ol>
<pre><code class="hljs language-java" lang="java">configuration.setProcessDefinitionCacheSize(<span class="hljs-number">100</span>);
configuration.setEnableProcessDefinitionInfoCache(<span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-37">7.3 安全配置</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 配置用户权限管理</span>
<span class="hljs-type">IdentityService</span> <span class="hljs-variable">identityService</span> <span class="hljs-operator">=</span> processEngine.getIdentityService();

<span class="hljs-comment">// 创建用户</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> identityService.newUser(<span class="hljs-string">"zhangsan"</span>);
user.setFirstName(<span class="hljs-string">"三"</span>);
user.setLastName(<span class="hljs-string">"张"</span>);
user.setEmail(<span class="hljs-string">"zhangsan@example.com"</span>);
identityService.saveUser(user);

<span class="hljs-comment">// 创建组</span>
<span class="hljs-type">Group</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> identityService.newGroup(<span class="hljs-string">"managers"</span>);
group.setName(<span class="hljs-string">"经理组"</span>);
identityService.saveGroup(group);

<span class="hljs-comment">// 分配用户到组</span>
identityService.createMembership(<span class="hljs-string">"zhangsan"</span>, <span class="hljs-string">"managers"</span>);
</code></pre>
<h4 data-id="heading-38">7.4 监控与告警</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb1d0cda076c485e921861d27222f888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770340220&amp;x-signature=Jf5%2Fh9ldNIll%2FjRcknHzxtFRikw%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowableMonitorService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ManagementService managementService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuntimeService runtimeService;

    <span class="hljs-comment">/**
     * 获取运行中的流程统计
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Long&gt; <span class="hljs-title function_">getProcessStatistics</span><span class="hljs-params">()</span> {
        Map&lt;String, Long&gt; stats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// 各流程运行实例数</span>
        List&lt;ProcessInstance&gt; instances = runtimeService.createProcessInstanceQuery().list();
        Map&lt;String, Long&gt; countByProcess = instances.stream()
            .collect(Collectors.groupingBy(
                ProcessInstance::getProcessDefinitionKey,
                Collectors.counting()
            ));
        stats.putAll(countByProcess);

        <span class="hljs-comment">// 待办任务统计</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">pendingTasks</span> <span class="hljs-operator">=</span> managementService.createTaskQuery().count();
        stats.put(<span class="hljs-string">"pendingTasks"</span>, pendingTasks);

        <span class="hljs-keyword">return</span> stats;
    }

    <span class="hljs-comment">/**
     * 检测异常流程（运行时间过长）
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ProcessInstance&gt; <span class="hljs-title function_">detectLongRunningProcesses</span><span class="hljs-params">(<span class="hljs-type">int</span> thresholdHours)</span> {
        <span class="hljs-type">Date</span> <span class="hljs-variable">threshold</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() - thresholdHours * <span class="hljs-number">3600000L</span>);

        <span class="hljs-keyword">return</span> runtimeService.createProcessInstanceQuery()
            .startedBefore(threshold)
            .list();
    }

    <span class="hljs-comment">/**
     * 获取数据库表信息
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getDatabaseInfo</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; info = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// 获取各表记录数</span>
        String[] tables = {<span class="hljs-string">"ACT_RU_EXECUTION"</span>, <span class="hljs-string">"ACT_RU_TASK"</span>, <span class="hljs-string">"ACT_HI_PROCINST"</span>};
        <span class="hljs-keyword">for</span> (String table : tables) {
            <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> managementService.createTablePageQuery()
                .tableName(table)
                .listPage(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
                .getTotal();
            info.put(table, count);
        }

        <span class="hljs-keyword">return</span> info;
    }
}
</code></pre>
<h3 data-id="heading-39">八、微服务集成</h3>
<p>在微服务架构中使用Flowable：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml配置</span>
<span class="hljs-attr">flowable:</span>
  <span class="hljs-comment"># 数据库配置</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/flowable?useSSL=false</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">flowable</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">flowable</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>

  <span class="hljs-comment"># 异步执行器配置</span>
  <span class="hljs-attr">async-executor-activate:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">async-executor-max-jobs-per-acquisition:</span> <span class="hljs-number">10</span>
  <span class="hljs-attr">async-executor-default-queue-size:</span> <span class="hljs-number">100</span>

  <span class="hljs-comment"># REST API配置</span>
  <span class="hljs-attr">rest:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

  <span class="hljs-comment"># 邮件服务器配置</span>
  <span class="hljs-attr">mail:</span>
    <span class="hljs-attr">server:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-string">smtp.example.com</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">587</span>
      <span class="hljs-attr">username:</span> <span class="hljs-string">noreply@example.com</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">password</span>
</code></pre>
<p>服务间通信示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkflowIntegrationService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuntimeService runtimeService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;

    <span class="hljs-comment">/**
     * 跨服务启动流程
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startCrossServiceProcess</span><span class="hljs-params">(WorkflowRequest request)</span> {
        <span class="hljs-comment">// 调用其他服务获取数据</span>
        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> restTemplate.getForObject(
            <span class="hljs-string">"http://user-service/api/users/"</span> + request.getUserId(),
            UserDTO.class
        );

        <span class="hljs-comment">// 设置流程变量</span>
        Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        variables.put(<span class="hljs-string">"user"</span>, user);
        variables.put(<span class="hljs-string">"request"</span>, request);

        <span class="hljs-comment">// 启动流程</span>
        runtimeService.startProcessInstanceByKey(
            <span class="hljs-string">"crossServiceProcess"</span>,
            request.getBusinessKey(),
            variables
        );
    }

    <span class="hljs-comment">/**
     * 流程回调处理
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleProcessCallback</span><span class="hljs-params">(String processInstanceId, String eventType)</span> {
        <span class="hljs-comment">// 根据事件类型执行不同操作</span>
        <span class="hljs-keyword">switch</span> (eventType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"completed"</span>:
                <span class="hljs-comment">// 流程完成后的处理</span>
                handleProcessCompleted(processInstanceId);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"cancelled"</span>:
                <span class="hljs-comment">// 流程取消后的处理</span>
                handleProcessCancelled(processInstanceId);
                <span class="hljs-keyword">break</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-40">九、总结</h3>
<p>Flowable作为一款优秀的开源工作流引擎，具有以下优势：</p>
<ol>
<li><strong>标准化</strong>：完全符合BPMN 2.0标准，学习成本低</li>
<li><strong>轻量级</strong>：可嵌入任何Java应用，部署简单</li>
<li><strong>高性能</strong>：支持高并发场景，适合企业级应用</li>
<li><strong>灵活扩展</strong>：提供丰富的扩展点，易于定制</li>
<li><strong>社区活跃</strong>：文档完善，社区支持良好</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[langchain学习笔记（二）：工具的调用]]></title>    <link>https://juejin.cn/post/7600642904382636038</link>    <guid>https://juejin.cn/post/7600642904382636038</guid>    <pubDate>2026-01-29T17:10:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600642904382636038" data-draft-id="7600637595944976426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="langchain学习笔记（二）：工具的调用"/> <meta itemprop="keywords" content="后端,LangChain,LLM"/> <meta itemprop="datePublished" content="2026-01-29T17:10:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_Shawn"/> <meta itemprop="url" content="https://juejin.cn/user/1855631358965384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            langchain学习笔记（二）：工具的调用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631358965384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_Shawn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T17:10:54.000Z" title="Thu Jan 29 2026 17:10:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Tool Calling</h3>
<h4 data-id="heading-1">定义简单tool</h4>
<p>创建工具最简单的方法是使用 <code>@tool</code> 装饰器。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool(<span class="hljs-params">description=<span class="hljs-string">"Returns the current time in yyyy-MM-dd HH:mm:ss format."</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_time</span>(<span class="hljs-params">*args, **kwargs</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    获取当前系统时间。
    格式为：yyyy-MM-dd HH:mm:ss
    """</span>
    now = datetime.datetime.now()
    <span class="hljs-keyword">return</span> now.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
</code></pre>
<p>如果description不写，则默认注释里的就是描述信息，否则则使用description，描述信息需要易于大模型的理解。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
获取当前系统时间。
格式为：yyyy-MM-dd HH:mm:ss
"""</span>
</code></pre>
<h4 data-id="heading-2">llm绑定tool</h4>
<p>借助 <code>bind_tools</code>，实现llm与工具的绑定，在底层，这些都会被转换为 OpenAI 工具模式，其格式如下：</p>
<pre><code class="hljs language-python" lang="python">{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"..."</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"..."</span>,
    <span class="hljs-string">"parameters"</span>: {...}  <span class="hljs-comment"># JSONSchema</span>
}
</code></pre>
<p>代码示例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 方式1：自动工具调用（推荐） ==========</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_simple_tool_calling</span>():
    <span class="hljs-string">"""
    方式1：使用 bind_tools + 手动执行
    特点：需要手动处理工具调用和结果
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🛠️ 方式1：bind_tools + 手动执行工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    llm_tools = llm.bind_tools(tools=[get_current_time])
    messages = [
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"请获取当前时间"</span>}
    ]

    <span class="hljs-comment"># 第一步：LLM 返回工具调用请求</span>
    result = llm_tools.invoke(messages)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n📤 LLM 响应类型: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(result)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📤 LLM 内容: <span class="hljs-subst">{result.content}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📤 工具调用请求: <span class="hljs-subst">{result.tool_calls}</span>"</span>)

    <span class="hljs-comment"># 第二步：手动执行工具，判断大模型的reponse是不是tool_call，如果是tool_call类型，则真正执行工具的调用</span>
    <span class="hljs-keyword">if</span> result.tool_calls:
        <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> result.tool_calls:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔧 执行工具: <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🔧 工具参数: <span class="hljs-subst">{tool_call[<span class="hljs-string">'args'</span>]}</span>"</span>)

            <span class="hljs-keyword">if</span> tool_call[<span class="hljs-string">'name'</span>] == <span class="hljs-string">'get_current_time'</span>:
                <span class="hljs-comment"># 手动调用工具</span>
                tool_result = get_current_time.invoke(tool_call[<span class="hljs-string">'args'</span>])
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 工具执行结果: <span class="hljs-subst">{tool_result}</span>"</span>)

                <span class="hljs-comment"># 第三步：将工具结果返回给 LLM（可选）</span>
                messages.append(result)  <span class="hljs-comment"># 添加 AI 的工具调用消息</span>
                messages.append(ToolMessage(
                    content=tool_result,
                    tool_call_id=tool_call[<span class="hljs-string">'id'</span>]
                ))

                <span class="hljs-comment"># 让 LLM 根据工具结果生成最终回答</span>
                final_response = llm_tools.invoke(messages)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n💬 最终回答: <span class="hljs-subst">{final_response.content}</span>"</span>)
</code></pre>
<p>模拟工具调用流程，通过ToolMessage</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_simple_tool_calling_2</span>():
    <span class="hljs-string">"""
    方式2：手动构造 AIMessage 和 ToolMessage
    特点：完全手动控制消息流，适合测试和调试
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🛠️ 方式2：手动构造消息流"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    <span class="hljs-comment"># 手动构造 AI 的工具调用消息</span>
    ai_message = AIMessage(
        content=<span class="hljs-string">""</span>,  <span class="hljs-comment"># 通常为空，因为 AI 选择调用工具而不是直接回答</span>
        tool_calls=[{
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"get_current_time"</span>,
            <span class="hljs-string">"args"</span>: {},
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span>
        }]
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n📤 模拟 AI 工具调用: <span class="hljs-subst">{ai_message.tool_calls}</span>"</span>)

    <span class="hljs-comment"># 执行工具并创建结果消息</span>
    tool_result = get_current_time.invoke({})
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 工具执行结果: <span class="hljs-subst">{tool_result}</span>"</span>)

    tool_message = ToolMessage(
        content=tool_result,
        tool_call_id=<span class="hljs-string">"call_123"</span>
    )

    <span class="hljs-comment"># 构造完整的消息历史</span>
    messages = [
        HumanMessage(<span class="hljs-string">"请获取当前时间"</span>),
        ai_message,  <span class="hljs-comment"># AI 的工具调用</span>
        tool_message,  <span class="hljs-comment"># 工具执行结果</span>
    ]

    <span class="hljs-comment"># LLM 根据工具结果生成最终回答</span>
    response = llm.invoke(messages)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n💬 最终回答: <span class="hljs-subst">{response.content}</span>"</span>)
</code></pre>
<h4 data-id="heading-3">多工具调用</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 额外示例：多个工具 ==========</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""计算数学表达式。"""</span>
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-built_in">eval</span>(expression)
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"计算结果: <span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"计算错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_multiple_tools</span>():
    <span class="hljs-string">"""演示多个工具的使用"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🛠️ 多工具示例"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    llm_tools = llm.bind_tools(tools=[get_current_time, calculate])
    tool_map = {
        <span class="hljs-string">"get_current_time"</span>: get_current_time,
        <span class="hljs-string">"calculate"</span>: calculate
    }

    messages = [HumanMessage(content=<span class="hljs-string">"现在几点？然后帮我计算 15 * 8"</span>)]

    max_iterations = <span class="hljs-number">10</span>
    iteration = <span class="hljs-number">0</span>

    <span class="hljs-keyword">while</span> iteration &lt; max_iterations:
        iteration += <span class="hljs-number">1</span>
        response = llm_tools.invoke(messages)
        messages.append(response)

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> response.tool_calls:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 最终回答: <span class="hljs-subst">{response.content}</span>"</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> response.tool_calls:
            tool_name = tool_call[<span class="hljs-string">'name'</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔧 调用工具: <span class="hljs-subst">{tool_name}</span>"</span>)

            tool_result = tool_map[tool_name].invoke(tool_call[<span class="hljs-string">'args'</span>])
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 结果: <span class="hljs-subst">{tool_result}</span>"</span>)

            messages.append(ToolMessage(
                content=tool_result,
                tool_call_id=tool_call[<span class="hljs-string">'id'</span>]
            ))
</code></pre>
<h4 data-id="heading-4">结构化入参</h4>
<p>tool 装饰器里，有个 args_schema 参数，可以配置结构化的类</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 1. 基础结构化入参 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""搜索工具的输入参数"""</span>
    query: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"搜索关键词"</span>)
    max_results: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"最大返回结果数"</span>, ge=<span class="hljs-number">1</span>, le=<span class="hljs-number">100</span>)
    language: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">"zh"</span>, description=<span class="hljs-string">"语言代码，如 zh, en"</span>)


<span class="hljs-meta">@tool(<span class="hljs-params">args_schema=SearchInput</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, max_results: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>, language: <span class="hljs-built_in">str</span> = <span class="hljs-string">"zh"</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""在网络上搜索信息。"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"搜索 '<span class="hljs-subst">{query}</span>'，返回 <span class="hljs-subst">{max_results}</span> 条 <span class="hljs-subst">{language}</span> 结果"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_basic_structured_input</span>():
    <span class="hljs-string">"""演示基础结构化入参"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例1：基础结构化入参"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    llm_tools = llm.bind_tools([search_web])
    messages = [HumanMessage(<span class="hljs-string">"搜索 LangChain 相关信息，返回5条结果"</span>)]

    response = llm_tools.invoke(messages)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🤖 LLM 工具调用:"</span>)
    <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> response.tool_calls:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  工具: <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  参数: <span class="hljs-subst">{tool_call[<span class="hljs-string">'args'</span>]}</span>"</span>)

        <span class="hljs-comment"># 执行工具</span>
        result = search_web.invoke(tool_call[<span class="hljs-string">'args'</span>])
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<p>嵌套复杂的结构化入参</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 2. 复杂结构化入参（嵌套对象） ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""地址信息"""</span>
    street: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"街道地址"</span>)
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"城市"</span>)
    country: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">"中国"</span>, description=<span class="hljs-string">"国家"</span>)
    postal_code: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"邮政编码"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""用户信息"""</span>
    name: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"用户姓名"</span>)
    age: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">"年龄"</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">150</span>)
    email: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"邮箱地址"</span>)
    address: Address = Field(description=<span class="hljs-string">"地址信息"</span>)
    tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = Field(default=[], description=<span class="hljs-string">"用户标签"</span>)

<span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">'email'</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_email</span>(<span class="hljs-params">cls, v</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> v:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'邮箱格式不正确'</span>)
        <span class="hljs-keyword">return</span> v


<span class="hljs-meta">@tool(<span class="hljs-params">args_schema=UserInfo</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span>, email: <span class="hljs-built_in">str</span>, address: Address, tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""创建新用户。"""</span>
    tags = tags <span class="hljs-keyword">or</span> []
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"创建用户: <span class="hljs-subst">{name}</span>, <span class="hljs-subst">{age}</span>岁, <span class="hljs-subst">{email}</span>, 地址: <span class="hljs-subst">{address.city}</span>, 标签: <span class="hljs-subst">{tags}</span>"</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_nested_structured_input</span>():
    <span class="hljs-string">"""演示嵌套结构化入参"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例2：嵌套结构化入参"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    <span class="hljs-comment"># 手动测试</span>
    user_data = {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>,
        <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
        <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhangsan@example.com"</span>,
        <span class="hljs-string">"address"</span>: {
            <span class="hljs-string">"street"</span>: <span class="hljs-string">"中关村大街1号"</span>,
            <span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>,
            <span class="hljs-string">"country"</span>: <span class="hljs-string">"中国"</span>,
            <span class="hljs-string">"postal_code"</span>: <span class="hljs-string">"100000"</span>
        },
        <span class="hljs-string">"tags"</span>: [<span class="hljs-string">"VIP"</span>, <span class="hljs-string">"技术"</span>]
    }

    tool_call = {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"create_user"</span>,
        <span class="hljs-string">"args"</span>: user_data,
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span>,  <span class="hljs-comment"># 必须提供 tool_call_id</span>
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_call"</span>
    }

    result = create_user.invoke(tool_call)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 执行结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h4 data-id="heading-5">结构化输出</h4>
<p><code>response_format</code> 是 <code>@tool</code> 装饰器的一个重要参数，用于控制工具返回值的格式和处理方式。</p>




















<table><thead><tr><th>值</th><th>描述</th><th>返回类型</th></tr></thead><tbody><tr><td><code>"content"</code></td><td><strong>默认值</strong>，工具返回值直接作为内容</td><td>执行返回一个<code>str</code></td></tr><tr><td><code>"content_and_artifact"</code></td><td>返回内容和原始数据（artifact）</td><td>工具必须返回一个元组 <code>(content, artifact)</code>：-   <strong>content</strong>: 给 LLM 看的简洁文本描述-   <strong>artifact</strong>: 完整的原始数据（可以是任意类型）</td></tr></tbody></table>
<p>代码示例</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 4. 结构化出参 (content_and_artifact) ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductInfo</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""产品信息"""</span>
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>
    stock: <span class="hljs-built_in">int</span>
    category: <span class="hljs-built_in">str</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchResult</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""搜索结果"""</span>
    total: <span class="hljs-built_in">int</span>
    products: <span class="hljs-type">List</span>[ProductInfo]
    page: <span class="hljs-built_in">int</span>
    page_size: <span class="hljs-built_in">int</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductSearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""产品搜索输入"""</span>
    keyword: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"搜索关键词"</span>)
    category: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"产品分类"</span>)
    min_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"最低价格"</span>)
    max_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"最高价格"</span>)
    page: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">1</span>, description=<span class="hljs-string">"页码"</span>, ge=<span class="hljs-number">1</span>)
    page_size: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"每页数量"</span>, ge=<span class="hljs-number">1</span>, le=<span class="hljs-number">100</span>)


<span class="hljs-meta">@tool(<span class="hljs-params">
    args_schema=ProductSearchInput,
    response_format=<span class="hljs-string">"content_and_artifact"</span>
</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_products</span>(<span class="hljs-params">
        keyword: <span class="hljs-built_in">str</span>,
        category: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>,
        min_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span>,
        max_price: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span>,
        page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,
        page_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>
</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, SearchResult]:
    <span class="hljs-string">"""搜索产品。"""</span>
    <span class="hljs-comment"># 模拟数据库查询</span>
    mock_products = [
        ProductInfo(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>, name=<span class="hljs-string">"iPhone 15"</span>, price=<span class="hljs-number">6999</span>, stock=<span class="hljs-number">50</span>, category=<span class="hljs-string">"手机"</span>),
        ProductInfo(<span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>, name=<span class="hljs-string">"MacBook Pro"</span>, price=<span class="hljs-number">12999</span>, stock=<span class="hljs-number">30</span>, category=<span class="hljs-string">"电脑"</span>),
        ProductInfo(<span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>, name=<span class="hljs-string">"AirPods Pro"</span>, price=<span class="hljs-number">1999</span>, stock=<span class="hljs-number">100</span>, category=<span class="hljs-string">"耳机"</span>),
    ]

    <span class="hljs-comment"># 过滤产品</span>
    filtered = mock_products
    <span class="hljs-keyword">if</span> category:
        filtered = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> filtered <span class="hljs-keyword">if</span> p.category == category]
    <span class="hljs-keyword">if</span> min_price:
        filtered = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> filtered <span class="hljs-keyword">if</span> p.price &gt;= min_price]
    <span class="hljs-keyword">if</span> max_price:
        filtered = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> filtered <span class="hljs-keyword">if</span> p.price &lt;= max_price]

    <span class="hljs-comment"># 构造结果</span>
    result = SearchResult(
        total=<span class="hljs-built_in">len</span>(filtered),
        products=filtered,
        page=page,
        page_size=page_size
    )

    <span class="hljs-comment"># content: 给 LLM 的简洁描述</span>
    content = <span class="hljs-string">f"找到 <span class="hljs-subst">{result.total}</span> 个产品"</span>
    <span class="hljs-keyword">if</span> category:
        content += <span class="hljs-string">f"，分类: <span class="hljs-subst">{category}</span>"</span>

    <span class="hljs-comment"># artifact: 完整的结构化数据</span>
    <span class="hljs-keyword">return</span> content, result


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_structured_output</span>():
    <span class="hljs-string">"""演示结构化出参"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例4：结构化出参 (content_and_artifact)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    llm_with_tools = llm.bind_tools([search_products])

    messages = [HumanMessage(content=<span class="hljs-string">"搜索价格在5000以上的手机"</span>)]

    <span class="hljs-comment"># LLM 决策</span>
    response = llm_with_tools.invoke(messages)

    <span class="hljs-keyword">if</span> response.tool_calls:
        tool_call = response.tool_calls[<span class="hljs-number">0</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🤖 LLM 决定调用工具:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   工具: <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   参数: <span class="hljs-subst">{tool_call[<span class="hljs-string">'args'</span>]}</span>"</span>)

        <span class="hljs-comment"># 执行工具</span>
        <span class="hljs-comment">## 这里返回的是ToolMessage</span>
        result = search_products.invoke(tool_call)

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 工具执行结果:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   Content: <span class="hljs-subst">{result.content}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   Artifact 类型: <span class="hljs-subst">{result.artifact}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   产品数量: <span class="hljs-subst">{result.artifact.total}</span>"</span>)
</code></pre>
<h4 data-id="heading-6">structure_tool</h4>
<p>StructuredTool 是 LangChain 里的一个类，专门用于处理多参数输入的工具。 与基础的 Tool 类（通常只接受一个字符串输入）不同，StructuredTool 利用 Pydantic 来定义和校验复杂的输入结构（Schema）。</p>
<p>相比 @tool 装饰器提供了更多的灵活性和控制能力。</p>


















































<table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>func</code></td><td><code>Callable</code></td><td>同步执行函数</td></tr><tr><td><code>coroutine</code></td><td><code>Callable</code></td><td>异步执行函数</td></tr><tr><td><code>name</code></td><td><code>str</code></td><td>工具名称（LLM 看到的名称）</td></tr><tr><td><code>description</code></td><td><code>str</code></td><td>工具描述（LLM 用来决定是否调用）</td></tr><tr><td><code>args_schema</code></td><td><code>Type[BaseModel]</code></td><td>Pydantic 模型定义输入参数</td></tr><tr><td><code>return_direct</code></td><td><code>bool</code></td><td><code>True</code>时直接返回给用户，不经过 LLM</td></tr><tr><td><code>handle_tool_error</code></td><td><code>bool/str/Callable</code></td><td>错误处理方式</td></tr><tr><td><code>response_format</code></td><td><code>str</code></td><td><code>"content"</code>或 <code>"content_and_artifact"</code></td></tr></tbody></table>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 5. 使用 StructuredTool 创建工具 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculatorInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""计算器输入"""</span>
    expression: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"数学表达式，如 '2 + 3 * 4'"</span>)
    precision: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">2</span>, description=<span class="hljs-string">"小数精度"</span>, ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">10</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculatorOutput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""计算器输出"""</span>
    expression: <span class="hljs-built_in">str</span>
    result: <span class="hljs-built_in">float</span>
    formatted_result: <span class="hljs-built_in">str</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_func</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span>, precision: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
    <span class="hljs-string">"""计算数学表达式"""</span>
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-built_in">eval</span>(expression)
        formatted = <span class="hljs-string">f"<span class="hljs-subst">{result:.{precision}</span>f}"</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"expression"</span>: expression,
            <span class="hljs-string">"result"</span>: result,
            <span class="hljs-string">"formatted_result"</span>: formatted
        }
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"expression"</span>: expression,
            <span class="hljs-string">"result"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"formatted_result"</span>: <span class="hljs-string">f"错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
        }


calculator_tool = StructuredTool.from_function(
    func=calculate_func,
    name=<span class="hljs-string">"calculator"</span>,
    description=<span class="hljs-string">"计算数学表达式"</span>,
    args_schema=CalculatorInput,
    return_direct=<span class="hljs-literal">False</span>
)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_structured_tool</span>():
    <span class="hljs-string">"""演示 StructuredTool"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例5：StructuredTool 创建工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    test_cases = [
        {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"15 + 25 * 3"</span>, <span class="hljs-string">"precision"</span>: <span class="hljs-number">2</span>},
        {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"100 / 3"</span>, <span class="hljs-string">"precision"</span>: <span class="hljs-number">4</span>},
        {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"2 ** 10"</span>, <span class="hljs-string">"precision"</span>: <span class="hljs-number">0</span>}
    ]

    <span class="hljs-keyword">for</span> params <span class="hljs-keyword">in</span> test_cases:
        result = calculator_tool.invoke(params)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n表达式: <span class="hljs-subst">{params[<span class="hljs-string">'expression'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h4 data-id="heading-7">base_tool</h4>
<p>BaseTool 是 LangChain 中所有工具的基类。通过继承它可以创建完全自定义的工具，拥有最大的灵活性和控制能力。</p>





























<table><thead><tr><th>方式</th><th>灵活性</th><th>复杂度</th><th>适用场景</th></tr></thead><tbody><tr><td><code>@tool</code></td><td>低</td><td>简单</td><td>快速定义简单工具</td></tr><tr><td><code>StructuredTool</code></td><td>中</td><td>中等</td><td>动态创建、自定义配置</td></tr><tr><td><code>BaseTool</code></td><td>高</td><td>复杂</td><td>完全自定义、复杂逻辑</td></tr></tbody></table>
<p>核心参数与方法：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> BaseTool
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Type</span>, <span class="hljs-type">Any</span>, <span class="hljs-type">Optional</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyToolInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""工具输入参数 Schema"""</span>
    param1: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"参数1描述"</span>)
    param2: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"参数2描述"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTool</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):
    <span class="hljs-string">"""自定义工具"""</span>
    
    <span class="hljs-comment"># ========== 必须定义的属性 ==========</span>
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"my_tool"</span>                    <span class="hljs-comment"># 工具名称</span>
    description: <span class="hljs-built_in">str</span> = <span class="hljs-string">"这是一个自定义工具"</span>    <span class="hljs-comment"># 工具描述</span>
    args_schema: <span class="hljs-type">Type</span>[BaseModel] = MyToolInput  <span class="hljs-comment"># 输入参数 Schema</span>
    
    <span class="hljs-comment"># ========== 可选属性 ==========</span>
    return_direct: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>              <span class="hljs-comment"># 是否直接返回结果</span>
    response_format: <span class="hljs-built_in">str</span> = <span class="hljs-string">"content"</span>         <span class="hljs-comment"># 响应格式</span>
    
    <span class="hljs-comment"># ========== 自定义属性 ==========</span>
    custom_config: <span class="hljs-built_in">str</span> = <span class="hljs-string">"default"</span>           <span class="hljs-comment"># 可以添加任意自定义属性</span>
    
    <span class="hljs-comment"># ========== 必须实现的方法 ==========</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>(<span class="hljs-params">self, param1: <span class="hljs-built_in">str</span>, param2: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""同步执行方法（必须实现）"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"执行结果: <span class="hljs-subst">{param1}</span>, <span class="hljs-subst">{param2}</span>"</span>
    
    <span class="hljs-comment"># ========== 可选实现的方法 ==========</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_arun</span>(<span class="hljs-params">self, param1: <span class="hljs-built_in">str</span>, param2: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""异步执行方法（可选）"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"异步执行结果: <span class="hljs-subst">{param1}</span>, <span class="hljs-subst">{param2}</span>"</span>
</code></pre>
<p>代码示例</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ========== 6. 继承 BaseTool 实现完全自定义 ==========</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""天气查询输入"""</span>
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"城市名称"</span>)
    date: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<span class="hljs-literal">None</span>, description=<span class="hljs-string">"日期 (YYYY-MM-DD)，默认今天"</span>)
    unit: <span class="hljs-built_in">str</span> = Field(default=<span class="hljs-string">"celsius"</span>, description=<span class="hljs-string">"温度单位: celsius 或 fahrenheit"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherOutput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""天气查询输出"""</span>
    city: <span class="hljs-built_in">str</span>
    date: <span class="hljs-built_in">str</span>
    temperature: <span class="hljs-built_in">float</span>
    condition: <span class="hljs-built_in">str</span>
    humidity: <span class="hljs-built_in">int</span>
    wind_speed: <span class="hljs-built_in">float</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherTool</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):
    name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"get_weather"</span>
    description: <span class="hljs-built_in">str</span> = <span class="hljs-string">"获取指定城市的天气信息"</span>
    args_schema: <span class="hljs-built_in">type</span>[BaseModel] = WeatherInput
    response_format: <span class="hljs-built_in">str</span> = <span class="hljs-string">"content_and_artifact"</span>

    <span class="hljs-comment"># 自定义属性</span>
    api_key: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>(<span class="hljs-params">
            self,
            city: <span class="hljs-built_in">str</span>,
            date: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>,
            unit: <span class="hljs-built_in">str</span> = <span class="hljs-string">"celsius"</span>
    </span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, WeatherOutput]:
        <span class="hljs-string">"""同步执行"""</span>
        <span class="hljs-comment"># 模拟 API 调用</span>
        date = date <span class="hljs-keyword">or</span> datetime.datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d"</span>)

        weather_data = {
            <span class="hljs-string">"北京"</span>: {<span class="hljs-string">"temp"</span>: <span class="hljs-number">25</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"晴天"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">45</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">3.5</span>},
            <span class="hljs-string">"上海"</span>: {<span class="hljs-string">"temp"</span>: <span class="hljs-number">28</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"多云"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">60</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">4.2</span>},
            <span class="hljs-string">"广州"</span>: {<span class="hljs-string">"temp"</span>: <span class="hljs-number">32</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"小雨"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">75</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">2.8</span>},
        }

        data = weather_data.get(city, {<span class="hljs-string">"temp"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"condition"</span>: <span class="hljs-string">"未知"</span>, <span class="hljs-string">"humidity"</span>: <span class="hljs-number">50</span>, <span class="hljs-string">"wind"</span>: <span class="hljs-number">3.0</span>})
        temp = data[<span class="hljs-string">"temp"</span>]

        <span class="hljs-keyword">if</span> unit == <span class="hljs-string">"fahrenheit"</span>:
            temp = temp * <span class="hljs-number">9</span> / <span class="hljs-number">5</span> + <span class="hljs-number">32</span>

        output = WeatherOutput(
            city=city,
            date=date,
            temperature=temp,
            condition=data[<span class="hljs-string">"condition"</span>],
            humidity=data[<span class="hljs-string">"humidity"</span>],
            wind_speed=data[<span class="hljs-string">"wind"</span>]
        )

        content = <span class="hljs-string">f"<span class="hljs-subst">{city}</span> <span class="hljs-subst">{date}</span>: <span class="hljs-subst">{output.condition}</span>, <span class="hljs-subst">{temp}</span>°<span class="hljs-subst">{<span class="hljs-string">'F'</span> <span class="hljs-keyword">if</span> unit == <span class="hljs-string">'fahrenheit'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'C'</span>}</span>"</span>

        <span class="hljs-keyword">return</span> content, output

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_arun</span>(<span class="hljs-params">self, *args, **kwargs</span>):
        <span class="hljs-string">"""异步执行"""</span>
        <span class="hljs-keyword">return</span> self._run(*args, **kwargs)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_base_tool</span>():
    <span class="hljs-string">"""演示继承 BaseTool"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 示例6：继承 BaseTool 实现自定义工具"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

    weather_tool = WeatherTool(api_key=<span class="hljs-string">"your-api-key"</span>)

    test_cases = [
        {<span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>},
        {<span class="hljs-string">"city"</span>: <span class="hljs-string">"上海"</span>, <span class="hljs-string">"unit"</span>: <span class="hljs-string">"fahrenheit"</span>},
        {<span class="hljs-string">"city"</span>: <span class="hljs-string">"广州"</span>, <span class="hljs-string">"date"</span>: <span class="hljs-string">"2024-01-15"</span>}
    ]

    <span class="hljs-keyword">for</span> params <span class="hljs-keyword">in</span> test_cases:
        tool_call = {
            <span class="hljs-string">"name"</span>: weather_tool.name,
            <span class="hljs-string">"args"</span>: params,
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span> + params[<span class="hljs-string">"city"</span>],
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_call"</span>
        }
        result = weather_tool.invoke(tool_call)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n查询: <span class="hljs-subst">{params}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Content: <span class="hljs-subst">{result.content}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Artifact: <span class="hljs-subst">{result.artifact.model_dump()}</span>"</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！]]></title>    <link>https://juejin.cn/post/7600607462584860707</link>    <guid>https://juejin.cn/post/7600607462584860707</guid>    <pubDate>2026-01-30T00:18:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600607462584860707" data-draft-id="7600600904095678498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-30T00:18:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:18:27.000Z" title="Fri Jan 30 2026 00:18:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    45
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>Java开发者必知的5个性能优化黑魔法，让你的应用快如闪电！</strong></h3>
<h3 data-id="heading-1">引言</h3>
<p>在当今高并发的互联网时代，Java应用的性能优化已成为开发者必须掌握的技能。无论是应对百万级QPS的电商系统，还是处理海量数据的金融平台，性能瓶颈往往隐藏在代码的细微之处。本文将揭示5个鲜为人知但极其有效的Java性能优化"黑魔法"，这些技术源于JVM底层原理、JDK内部机制以及一线大厂的实战经验。掌握它们，你的Java应用将实现从"能跑"到"飞起"的质的飞跃。</p>
<h3 data-id="heading-2">1. 对象池化：超越GC的极限</h3>
<h4 data-id="heading-3">问题背景</h4>
<p>JVM的垃圾回收(GC)是Java著名的双刃剑。在高频创建/销毁对象的场景下（如HTTP请求处理），GC会成为性能杀手。</p>
<h4 data-id="heading-4">黑魔法实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Apache Commons Pool2示例</span>
GenericObjectPool&lt;ExpensiveObject&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericObjectPool</span>&lt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasePooledObjectFactory</span>&lt;ExpensiveObject&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> ExpensiveObject <span class="hljs-title function_">create</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExpensiveObject</span>(); <span class="hljs-comment">// 初始化成本高的对象</span>
        }
    }
);

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">try</span> (PooledObject&lt;ExpensiveObject&gt; pooledObj = pool.borrowObject()) {
    <span class="hljs-type">ExpensiveObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> pooledObj.getObject();
    <span class="hljs-comment">// 使用obj...</span>
}
</code></pre>
<h4 data-id="heading-5">深度解析</h4>
<ul>
<li><strong>优势</strong>：避免频繁GC，对象复用率可达90%以上</li>
<li><strong>陷阱</strong>：必须确保返还的对象状态干净（参考Redis连接池的实现）</li>
<li><strong>进阶技巧</strong>：
<ul>
<li>使用ThreadLocal结合对象池实现线程级缓存</li>
<li>Netflix推荐的动态扩容策略：根据系统负载自动调整池大小</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2. Unsafe类：绕过JVM的安全枷锁</h3>
<h4 data-id="heading-7">JVM的隐藏后门</h4>
<p><code>sun.misc.Unsafe</code>提供了直接操作内存、CAS原子操作等底层能力：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperFastCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> getUnsafe();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> offset;
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            offset = unsafe.objectFieldOffset(
                SuperFastCounter.class.getDeclaredField(<span class="hljs-string">"value"</span>));
        } <span class="hljs-keyword">catch</span> (Exception ex) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(ex); }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        unsafe.getAndAddLong(<span class="hljs-built_in">this</span>, offset, <span class="hljs-number">1L</span>);
    }
}
</code></pre>
<h4 data-id="heading-8">性能对比</h4>





















<table><thead><tr><th>操作方式</th><th>ops/ms (i9-13900K)</th></tr></thead><tbody><tr><td>synchronized</td><td>12,000</td></tr><tr><td>AtomicLong</td><td>48,000</td></tr><tr><td>Unsafe</td><td>65,000</td></tr></tbody></table>
<h4 data-id="heading-9">注意事项</h4>
<ul>
<li>Java模块系统限制了Unsafe的使用（可通过<code>--add-opens</code>解决）</li>
<li>Azul Zing JVM提供了更安全的替代API</li>
</ul>
<h3 data-id="heading-10">3. JMH微基准测试：发现隐藏的性能陷阱</h3>
<h4 data-id="heading-11">why JMH?</h4>
<p>传统计时方式无法避免JIT预热、死码消除等问题：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@BenchmarkMode(Mode.Throughput)</span>
<span class="hljs-meta">@OutputTimeUnit(TimeUnit.MILLISECONDS)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayListBenchmark</span> {
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testForEach</span><span class="hljs-params">(Blackhole bh)</span> {
        List&lt;Integer&gt; list = IntStream.range(<span class="hljs-number">0</span>,<span class="hljs-number">1000</span>)
                                .boxed().collect(toList());
        <span class="hljs-keyword">for</span>(Integer i : list) { bh.consume(i); }
    }
    
    <span class="hljs-meta">@Benchmark</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testForLoop</span><span class="hljs-params">(Blackhole bh)</span> {
        List&lt;Integer&gt; list = IntStream.range(<span class="hljs-number">0</span>,<span class="hljs-number">1000</span>)
                                .boxed().collect(toList());
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;list.size(); i++) {
            bh.consume(list.get(i));
        }
    }
}
</code></pre>
<h4 data-id="heading-12">JMH揭示的真相：</h4>
<ol>
<li>ArrayList遍历时，for-index比foreach快15%（连续内存访问模式）</li>
<li>LinkedList场景完全相反（指针跳转成本）</li>
</ol>
<h3 data-id="heading-13">4. GraalVM Native Image：突破JIT天花板</h3>
<h4 data-id="heading-14">AOT编译实践：</h4>
<pre><code class="hljs language-bash" lang="bash">native-image -jar your-app.jar \
             --no-fallback \
             -H:+OptimizeForPerformance \
             -H:MaxHeapSize=2g \
             --enable-preview
</code></pre>
<h4 data-id="heading-15">Spring Boot集成：</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h4 data-id="heading-16">Startup Time对比：</h4>




















<table><thead><tr><th>Runtime</th><th>Memory Footprint</th><th>Startup Time</th></tr></thead><tbody><tr><td>OpenJDK11</td><td>~300MB</td><td>~3s</td></tr><tr><td>Native Image</td><td>~45MB</td><td>~50ms</td></tr></tbody></table>
<p>适用场景：Serverless函数、CLI工具、K8S sidecar容器</p>
<h3 data-id="heading-17">5. Escape Analysis：让栈分配为你所用</h3>
<h4 data-id="heading-18">JIT的神奇优化：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> x, y;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> { 
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">1_000_000</span>; i++) { 
            calculate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(i, i+<span class="hljs-number">1</span>)); <span class="hljs-comment">// Allocation eliminated!</span>
        } 
    } 
    
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(Point p)</span> { ... } 
} 
</code></pre>
<p>通过<code>-XX:+PrintEscapeAnalysis</code>查看优化日志：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">+++++ Eliminated allocation ...</span>
</code></pre>
<h4 data-id="heading-19">Stack Allocation规则：</h4>
<ol>
<li>Object不会传递到方法外部（非全局逃逸）</li>
<li>Object不会被其他线程访问（非线程逃逸）</li>
<li>Object未覆盖finalize()</li>
</ol>
<p>阿里中间件团队实测可减少30%以上的临时对象分配</p>
<h3 data-id="heading-20">CPU Cache友好编程</h3>
<h4 data-id="heading-21">False Sharing解决方案：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Contended</span> <span class="hljs-comment">// JDK8+注解（需开启-XX:-RestrictContended）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterCell</span> {
     <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value;
}

<span class="hljs-comment">// OR手动填充：</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaddedAtomicLong</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AtomicLong</span> { 
      <span class="hljs-keyword">protected</span> <span class="hljs-type">long</span> p1,p2,p3,p4,p5,p6,p7; <span class="hljs-comment">// pad to avoid false sharing </span>
}
</code></pre>
<p>Disruptor框架实测效果：</p>
<p><img alt="False Sharing对比图" src="" loading="lazy"/></p>
<h3 data-id="heading-22">JNI临界区优化技巧</h3>
<p>传统方式的问题：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processArray</span><span class="hljs-params">(JNIEnv *env, jintArray arr)</span> </span>{  
   jint *elements = env-&gt;<span class="hljs-built_in">GetIntArrayElements</span>(arr, <span class="hljs-literal">NULL</span>);
   <span class="hljs-keyword">if</span> (elements == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;
   
   <span class="hljs-comment">/* Heavy processing */</span>
   
   env-&gt;<span class="hljs-built_in">ReleaseIntArrayElements</span>(arr, elements, JNI_COMMIT); 
}  
</code></pre>
<p>改进方案——使用GetPrimitiveArrayCritical：</p>
<pre><code class="hljs language-c++" lang="c++">jint *elements = (jint *)env-&gt;<span class="hljs-built_in">GetPrimitiveArrayCritical</span>(arr, <span class="hljs-literal">NULL</span>);
<span class="hljs-keyword">if</span> (elements == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;

<span class="hljs-comment">/* Faster access but NO JNI calls allowed */</span>

env-&gt;<span class="hljs-built_in">ReleasePrimitiveArrayCritical</span>(arr, elements, JNI_COMMIT);
</code></pre>
<p>实测吞吐量提升40%（特别是在ARM架构）</p>
<h3 data-id="heading-23">Garbage Collector调优新思路</h3>
<p>ZGC的秘密参数：</p>
<pre><code class="hljs language-ini" lang="ini">-XX:+UseZGC \
-XX:<span class="hljs-attr">ConcGCThreads</span>=<span class="hljs-number">4</span> \      <span class="hljs-comment"># CPU核心数的1/4  </span>
-XX:<span class="hljs-attr">SoftMaxHeapSize</span>=<span class="hljs-number">32</span>G \ <span class="hljs-comment"># Elastic Heap关键  </span>
-Xms24G -Xmx24G           <span class="hljs-comment"># Fixed heap建议模式  </span>
</code></pre>
<p>关键指标监控：</p>
<pre><code class="hljs language-bash" lang="bash">jstat -gcutil &lt;pid&gt; <span class="hljs-built_in">ls</span> ns ps ys cs gcc ygc fygc cgc gct ngcmn ngcmx ngc...
</code></pre>
<p>JDK17+新增功能——弹性元空间：</p>
<pre><code class="hljs language-ruby" lang="ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:MetaspaceReclaimPolicy=balanced</span> \
-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+MetaspaceReclaimQuickStart</span> \
</code></pre>
<h3 data-id="heading-24">Vector API实战：SIMD加速计算</h3>
<p>JDK16预览示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">vectorComputation</span><span class="hljs-params">(<span class="hljs-type">float</span>[] a, <span class="hljs-type">float</span>[] b, <span class="hljs-type">float</span>[] c)</span> {  
   <span class="hljs-type">var</span> <span class="hljs-variable">va</span> <span class="hljs-operator">=</span> FloatVector.fromArray(FloatVector.SPECIES_256(), a, <span class="hljs-number">0</span>);  
   <span class="hljs-type">var</span> <span class="hljs-variable">vb</span> <span class="hljs-operator">=</span> FloatVector.fromArray(FloatVector.SPECIES_256(), b, <span class="hljs-number">0</span>);  
   <span class="hljs-type">var</span> <span class="hljs-variable">vc</span> <span class="hljs-operator">=</span> va.mul(va).add(vb.mul(vb)).neg();  
   vc.intoArray(c, <span class="hljs-number">0</span>);  
}  
</code></pre>
<p>与标量代码对比：</p>
<p><img alt="SIMD加速比" src="" loading="lazy"/></p>
<p>Intel AVX-512环境下矩阵运算提速8倍+</p>
<h3 data-id="heading-25">Java并发新模式：虚拟线程尝鲜</h3>
<p>Loom项目前瞻：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {     
   IntStream.range(<span class="hljs-number">0</span>,<span class="hljs-number">10_000</span>).forEach(i -&gt; executor.submit(() -&gt;{
      Thread.sleep(Duration.ofSeconds(<span class="hljs-number">1</span>));
      <span class="hljs-keyword">return</span> i;     
   }));
} <span class="hljs-comment">// Launch million threads!  </span>

<span class="hljs-comment">// Carrier threads实际数量=CPU核心数  </span>
</code></pre>
<p>与传统线程池对比：</p>
<p><img alt="虚拟线程吞吐量" src="" loading="lazy"/></p>
<p>适用于高并发IO密集型场景（如微服务网关）</p>
<hr/>
<h2 data-id="heading-26">The End</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“能用”到“会用”｜如何写好一个 Skill]]></title>    <link>https://juejin.cn/post/7600791597168525355</link>    <guid>https://juejin.cn/post/7600791597168525355</guid>    <pubDate>2026-01-30T02:46:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600791597168525355" data-draft-id="7600705405595680831" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“能用”到“会用”｜如何写好一个 Skill"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-30T02:46:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“能用”到“会用”｜如何写好一个 Skill
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:46:58.000Z" title="Fri Jan 30 2026 02:46:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9c0d4f435e6430bbe05365a720ccfc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=EnVG%2Fo7Afg%2BjIrUumxfjzeeaoBM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：Jiaqi，TRAE 技术文档工程师</p>
</blockquote>
<p>之前带大家了解了 Skill 的原理和应用，本文继续带领大家从“能用”到“会用”，如何写好一个 Skill 至关重要。</p>
<p>本文为 Skill 设计与开发的一站式最佳实践指南，可助力你：</p>
<ul>
<li>
<p>系统厘清 Skill 的定义，规避常见认知误区；</p>
</li>
<li>
<p>熟练掌握高命中率、高稳定性 Skill 的设计标准与核心原则；</p>
</li>
<li>
<p>掌握 “评测驱动、失败优先” 的工程化 Skill 构建与迭代全流程；</p>
</li>
<li>
<p>掌握可维护、可扩展的 Skill 设计技巧；</p>
</li>
<li>
<p>依托 AI 高效完成 Skill 的创建、迭代与优化；</p>
</li>
<li>
<p>凭借反模式检查清单，精准规避 Skill 开发中的典型问题。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/925c335469a84e45b9fc343d9d93c2e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=ycqzZY6cdm9Et6BSGzR615Xm0k4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>什么是 Skill ？</strong></h2>
<h3 data-id="heading-1"><strong>定义</strong></h3>
<p>一个 Skill 是一份清晰、严谨、可执行的指令文档，用于明确告诉模型——在什么条件下（When），按照哪些步骤（How），产出什么结果（What）。</p>
<h3 data-id="heading-2"><strong>常见认知误区</strong></h3>
<p>在编写 Skill 之前，建议先了解以下几个常见误区。这些问题往往会直接导致 Skill 难以被正确触发，或在执行过程中表现不稳定。</p>
<h4 data-id="heading-3"><strong>误区一：Skill 等同于一段 Prompt</strong></h4>
<p>Skill 并不是一次性的对话提示。它是一个可长期复用、输入输出明确的能力模块，强调的是稳定、确定且易于工程化维护。而 Prompt 更偏向临时性、探索性和即兴交互，两者在设计目标和工程要求上完全不同。</p>
<h4 data-id="heading-4"><strong>误区二：Skill 是写给人看的文档</strong></h4>
<p>Skill 的目标不是“解释原理”，而是“下达指令”。<em><strong>SKILL.md</strong></em> 文件的内容应使用模型可解析的结构化语言，明确约束其行为边界，并精确描述何时使用（When）、如何执行（How）、输出结果（What）。</p>
<h4 data-id="heading-5"><strong>误区三：Skill 越复杂越强大</strong></h4>
<p>复杂度并不与 Skill 的能力强度挂钩。模型的推理与决策成本是显著的。职责单一、边界清晰的 Skill，更容易在正确的时机被选中并稳定执行。过于复杂的 Skill 反而会降低命中率。</p>
<blockquote>
<p><strong>提示</strong></p>
<p>模型的上下文窗口是有限且宝贵的公共资源。每一个被加载的 Skill 都在竞争有限的上下文资源。因此，Skill 文档应以最小必要信息为目标，避免冗余解释与不必要的背景铺垫。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f9fd9d99d4047fa8df1e73e23df891c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=uDLhWnSoobz5eZoAjTmk8YL%2BmDs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6"><strong>Skill 的设计标准与原则</strong></h2>
<p>以下标准是构建高命中率、高稳定性 Skill 的基础。可将其作为设计与评审 Skill 时的检查清单。</p>
<h3 data-id="heading-7"><strong>精准的元数据内容</strong></h3>
<p>Skill 的元数据（name 和 description）是模型发现和识别 Skill 的入口，其设计直接影响触发准确率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53534cd0028341789f32667c4427b688~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=YOgSk2PwZtiIGJDAormvbgAGyfE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8"><strong>指导方式的自由度分级</strong></h3>
<p>根据任务复杂度与容错要求，合理控制对模型的约束强度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bc1d5de6fd847b2b5dbf8b68923f31d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=IyvLxWY9rbntzp6XCvirBaSUV6U%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78b641e70e0e4917b62abf1f3c6a1263~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=k8mmW9gcXOzIXm5XdeflXRSmw1o%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc3071a12bc450bb88de44cca330f90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=BMRsq4GG52LqbCzOp6mbk0nWA8k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9"><strong>五个核心标准</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d624809950da4cd7b3a3cd97aa59cbc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=SCKvYQOUGryiT1G91F0G5r4K8q4%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cb9b5ff3cd246038a73415d07af4a56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=fNs8IAyTWdP0mlCiJV7ba%2FUyNCU%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8a10f6a22b7449fb81436025c675cdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=WOsFr0%2F%2BeAf%2B3e9bUdIze6U5CsE%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15d69e9c2c6643409a36c1574ce343c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=Zf2VKaN41J0lDfMMi2VtmrJIYps%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d391f9bcc214bfd9e5770929c104d33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=chGm%2FO9oemdfLk5DIg5FLn30Tow%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10"><strong>构建与迭代 Skill 的最佳流程</strong></h2>
<p>Skill 的开发是一个以失败为起点、评测为牵引，持续迭代优化的工程化过程。</p>
<p>评测并非事后的验证环节，而是 Skill 设计的前提；Skill 也非基于假设的规则集合，而是针对已暴露问题的最小化解决方案。</p>
<p>遵循 “评测驱动、失败优先” 的原则，能确保 Skill 在实际使用场景中拥有清晰的能力边界、稳定的运行表现，以及可回归的质量保障体系。</p>
<h3 data-id="heading-11"><strong>第一步：建立无 Skill 基线，识别真实问题</strong></h3>
<p>在编写任何 Skill 之前，应先不使用 Skill，直接让模型执行目标任务，作为基线对照。</p>
<p>重点观察并记录以下问题：</p>
<ul>
<li>
<p>模型在哪些情况下表现不稳定或结果不可复现；</p>
</li>
<li>
<p>哪些输入会引发歧义、误解或走偏；</p>
</li>
<li>
<p>模型是否在错误的时机尝试“主动帮忙”。</p>
</li>
</ul>
<p>这些失败点和不确定行为，本质上就是 Skill 需要解决的真实能力缺口，也是后续评测用例的来源。</p>
<h3 data-id="heading-12"><strong>第二步：以“失败优先”为原则，定义评测用例</strong></h3>
<p>明确核心问题后，需优先编写评测用例，而非直接开发 Skill。评测是约束，Skill 是落地实现。脱离评测约束的 Skill，本质上是在放大模型的行为不确定性。</p>
<p>评测的核心作用是约束 Skill 的行为边界，明确以下信息：</p>
<ul>
<li>
<p>什么场景下属于 Skill 的正确使用范围？</p>
</li>
<li>
<p>什么场景下 Skill 必须拒绝执行或判定为失败？</p>
</li>
<li>
<p>什么样的输出结果才算稳定可用？</p>
</li>
</ul>
<p>推荐做法：</p>
<ul>
<li>
<p>针对已识别的问题，设计 3–5 个具体、可复现的评测用例；</p>
</li>
<li>
<p>每个用例均需明确 “通过 / 失败” 的判定标准；</p>
</li>
<li>
<p>优先覆盖模型最易误用 Skill 的场景。</p>
</li>
</ul>
<h3 data-id="heading-13"><strong>第三步：编写最小化 Skill，明确最短成功路径</strong></h3>
<p>在评测已经存在的前提下，开始编写 Skill。</p>
<p>此阶段不追求覆盖所有情况，而是只编写刚好能够通过当前评测的最小规则集合，重点关注三个要素：</p>
<ul>
<li>
<p><strong>明确失败条件（When NOT to use）</strong></p>
<p>将评测中识别的失败场景，显式写入 Skill 中，作为第一层防护，避免 Skill 被误触发或滥用。</p>
</li>
<li>
<p><strong>定义最短成功路径</strong></p>
<p>清晰描述 Skill 最简单、最核心的执行流程，确保最精简的有效输入能得到可预测的稳定输出。</p>
</li>
<li>
<p><strong>保持职责单一</strong></p>
<p>单个 Skill 仅解决一个明确问题，对应一个核心动作，避免在早期引入额外复杂度。</p>
</li>
</ul>
<p>这一阶段的 Skill，是评测结果的直接产物，而非凭经验预判的方案。</p>
<h3 data-id="heading-14"><strong>第四步：补充边界条件与结构化示例</strong></h3>
<p>当最短成功路径能稳定通过评测后，再逐步扩展 Skill 的适用范围。</p>
<p>完成以下三项核心工作：</p>
<ul>
<li>
<p>补充更多边界场景及对应的行为约束；</p>
</li>
<li>
<p>明确 Skill 输入（Input）、输出（Output）的结构化定义；</p>
</li>
<li>
<p>补充关键的输入、输出示例，帮助模型对齐行为预期。</p>
</li>
</ul>
<p><strong>核心原则：</strong> 所有新增规则，均需对应新增或已有评测用例，避免在无评测支撑的情况下将 Skill 复杂化。</p>
<h3 data-id="heading-15"><strong>第五步：评测回归与持续迭代</strong></h3>
<p>Skill 的迭代，需始终与评测结果强绑定，遵循以下规则：</p>
<ul>
<li>
<p>新增评测用例 → 推动 Skill 的增量修改；</p>
</li>
<li>
<p>任意修改 Skill → 必须通过已有评测的回归验证；</p>
</li>
<li>
<p>若评测未通过，优先简化 Skill，而非盲目叠加新规则。</p>
</li>
</ul>
<p>通过持续对比模型在 “无 Skill 基线” 与 “当前 Skill + 评测” 中的表现，可验证该 Skill 是否真正提升了模型执行目标任务的成功率与稳定性。</p>
<h3 data-id="heading-16"><strong>第六步：结合真实使用路径进行校准</strong></h3>
<p>评测仅能覆盖已知问题，在真实场景中使用 Skill 时，可能会暴露更多新的问题。</p>
<p>在 Skill 实际使用过程中，需持续观察以下情况：</p>
<ul>
<li>
<p>模型是否在非预期场景下误触发 Skill？</p>
</li>
<li>
<p>模型执行 Skill 时，是否遗漏关键参考文件或上下文？</p>
</li>
<li>
<p>模型是否会反复读取某一段内容，形成隐性依赖？</p>
</li>
</ul>
<p>上述这些信号，均需作为新的评测输入，重新进入 Step 2，形成 Skill 迭代的闭环。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d6496cadbc45959bca9dc12167b952~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=kcFreYXQ%2FmdWP%2BvqH%2F9CTAzvFiM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17"><strong>让 Skill 可维护与可拓展</strong></h2>
<h3 data-id="heading-18"><strong>渐进式披露</strong></h3>
<p><em><strong>SKILL.md</strong></em> 应当作为 Skill 的入口和导航，而不是一个包罗万象的大文件。详细的参考资料、示例、脚本或文档应拆分成独立文件，从而减轻模型初次加载的负担，让信息按需流动。</p>
<h4 data-id="heading-19"><strong>信息架构原则：从简单到复杂</strong></h4>
<p>​一个 Skill 的目录可以随着功能扩展逐步演化：从单一文件 → 多个参考文件和脚本组成的结构。通过渐进式披露，模型能快速抓住核心信息，再深入了解细节。</p>
<h4 data-id="heading-20"><strong>最佳实践</strong></h4>
<ul>
<li>
<p><strong>保持 SKILL.md 简洁：</strong> 主体内容尽量控制在 500 行以内，只包含必要信息。</p>
</li>
<li>
<p><strong>避免深度嵌套：</strong> 所有引用文件最好直接由 <em><strong>SKILL.md</strong></em> 链接，保持一层引用深度，避免链式引用（A → B → C），防止模型只读取部分内容。</p>
</li>
<li>
<p><strong>为长文件添加目录：</strong> 对于超过 100 行的参考文件，在文件顶部添加一个目录（Table of Contents），帮助模型快速了解文件结构。</p>
</li>
</ul>
<h4 data-id="heading-21"><strong>示例</strong></h4>
<p>以下为一个渐进式披露的 SKILL.md 示例：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># SKILL.md</span>

<span class="hljs-section">## 基础用法</span>
描述如何触发 CI/CD 流水线：
<span class="hljs-bullet">-</span> 检查 PR 状态
<span class="hljs-bullet">-</span> 执行单元测试
<span class="hljs-bullet">-</span> 更新 PR 测试状态

<span class="hljs-section">## 高级功能</span>
详细说明请参见 <span class="hljs-code">`ci-advanced-features.md`</span>：
<span class="hljs-bullet">-</span> 并行执行多分支测试
<span class="hljs-bullet">-</span> 条件触发不同类型的测试
<span class="hljs-bullet">-</span> 自定义失败处理策略

<span class="hljs-section">## API 参考</span>
所有方法与参数说明请参见 <span class="hljs-code">`ci-api-reference.md`</span>：
<span class="hljs-bullet">-</span> startPipeline(prId: string, branch: string)
<span class="hljs-bullet">-</span> getPipelineStatus(pipelineId: string)
<span class="hljs-bullet">-</span> cancelPipeline(pipelineId: string)
</code></pre>
<h3 data-id="heading-22"><strong>工作流与反馈闭环</strong></h3>
<p>对于包含多个步骤、且中间结果会影响最终质量的复杂任务，仅提供最终目标是不够的。必须显式定义工作流（Workflow）和 检查清单（Checklist），引导模型按步骤执行，并在关键节点建立 “验证 → 修正 → 再验证” 的反馈闭环。</p>
<p>工作流负责约束任务执行顺序，检查清单负责追踪任务的执行状态和质量。两者结合可以显著降低遗漏和跑偏的风险。</p>
<h4 data-id="heading-23"><strong>分析类任务的工作流</strong></h4>
<p>即使不涉及代码，分析类任务同样适合使用工作流。 检查清单可以帮助模型明确“当前做到哪一步”、“是否可以进入下一步”。例如：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">## 技术方案评估工作流

在开始执行前复制以下清单，并在每一步完成后显式标记状态。

- <span class="hljs-keyword">Step</span> <span class="hljs-number">1</span>：明确业务目标与技术约束（性能、成本、时限）
- <span class="hljs-keyword">Step</span> <span class="hljs-number">2</span>：列出所有可行的技术方案
- <span class="hljs-keyword">Step</span> <span class="hljs-number">3</span>：从复杂度、可维护性、风险角度逐一评估
- <span class="hljs-keyword">Step</span> <span class="hljs-number">4</span>：对关键差异点进行对比分析；(反馈闭环) 若发现关键信息不足，应返回 <span class="hljs-keyword">Step</span> <span class="hljs-number">2</span> 或 <span class="hljs-keyword">Step</span> <span class="hljs-number">3</span> 补充分析
- <span class="hljs-keyword">Step</span> <span class="hljs-number">5</span>：给出结论性建议，并说明取舍理由；(反馈闭环) 若结论无法支撑目标约束，应重新审视 <span class="hljs-keyword">Step</span> <span class="hljs-number">1</span> 的前提条件
</code></pre>
<h4 data-id="heading-24"><strong>代码类任务的工作流</strong></h4>
<p>​代码类任务往往伴随不可逆或影响范围较大的操作，例如重构、依赖升级或配置变更。通过 “Plan → Validate → Execute” 模式，可以有效降低误操作风险。例如：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 依赖版本升级工作流</span>

<span class="hljs-bullet">-</span> Step 1（Plan）：
<span class="hljs-bullet">  -</span> 识别需要升级的依赖及当前版本
<span class="hljs-bullet">  -</span> 阅读目标版本的 Release Notes 与 Breaking Changes
<span class="hljs-bullet">-</span> Step 2（Plan）：
<span class="hljs-bullet">  -</span> 更新依赖配置文件（如 package.json / go.mod）
<span class="hljs-bullet">  -</span> 标注可能受影响的模块
<span class="hljs-bullet">-</span> Step 3（Validate）：
<span class="hljs-bullet">-</span> 执行依赖冲突检查与静态构建（运行 dependency<span class="hljs-emphasis">_check.sh）
  - 确认无版本冲突或构建失败
  - (反馈闭环) 若校验失败，必须回退到 Step 2 调整依赖配置
- Step 4（Execute）：
  - 安装新版本依赖
  - 运行完整测试集
- Step 5（Validate）：
  - 检查核心功能是否受影响
  - 对比升级前后的构建与运行结果
  - (反馈闭环) 若出现回归问题，应回滚升级并记录风险点
</span></code></pre>
<h3 data-id="heading-25"><strong>可执行脚本的加固原则</strong></h3>
<p>当 Skill 依赖可执行脚本时，脚本的健壮性应始终优先于代码的巧妙性。</p>
<p>Skill 本身不会理解或阅读你的代码逻辑，它只感知输入与输出。一旦脚本行为不可预测，模型就只能猜测，最终导致不稳定或错误的调用结果。因此，脚本必须做到：失败可预期、输出可理解、参数可解释。</p>
<h4 data-id="heading-26"><strong>显式处理错误，而不是让模型猜</strong></h4>
<p>不要将异常直接抛给模型处理。脚本应覆盖常见错误场景，并将技术异常转化为可理解、可决策的输出。</p>
<p><strong>实践要点：</strong></p>
<ul>
<li>
<p>捕获常见异常（如文件缺失、权限不足、配置错误）</p>
</li>
<li>
<p>为每类错误返回清晰的错误原因和下一步建议</p>
</li>
</ul>
<p><strong>示例：</strong> 配置文件校验脚本</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">ERROR:</span> Config file <span class="hljs-built_in">not</span> found: ./deploy.yaml
<span class="hljs-symbol">HINT:</span> Please check whether the file path <span class="hljs-built_in">is</span> correct <span class="hljs-built_in">or</span> run init-config.sh <span class="hljs-keyword">to</span> generate a <span class="hljs-keyword">default</span> config.
</code></pre>
<h4 data-id="heading-27"><strong>输出自解释的日志与验证结果</strong></h4>
<p>脚本的输出本身就是模型的“上下文”。一个好的脚本不仅说明发生了什么，还说明为什么会这样，以及接下来可以怎么做。</p>
<p><strong>实践要点：</strong></p>
<ul>
<li>
<p>成功路径和失败路径都要有明确输出</p>
</li>
<li>
<p>验证类脚本应明确列出通过项与失败项</p>
</li>
</ul>
<p><strong>示例：</strong> 构建环境检查脚本</p>
<pre><code class="hljs language-markdown" lang="markdown">CHECK FAILED: Node.js version mismatch
<span class="hljs-bullet">-</span> Required: &gt;= 18.0.0
<span class="hljs-bullet">-</span> Detected: 16.14.0

VALID OPTIONS:
<span class="hljs-bullet">1.</span> Upgrade Node.js to a supported version
<span class="hljs-bullet">2.</span> Switch to a compatible build image
</code></pre>
<h4 data-id="heading-28"><strong>避免魔法数字，让参数“有来由”</strong></h4>
<p>脚本中的常量（如 <em><strong>TIMEOUT = 30</strong></em>）如果缺乏解释，模型和人都无法判断它是否合理。任何影响行为的数值，都应该是可解释、可调整的。</p>
<p><strong>实践要点：</strong></p>
<ul>
<li>
<p>为常量添加语义化名称</p>
</li>
<li>
<p>说明数值来源或设计依据</p>
</li>
<li>
<p>必要时允许通过参数覆盖默认值</p>
</li>
</ul>
<p><strong>示例：</strong> 部署等待脚本</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">TIMEOUT_SECONDS</span> = <span class="hljs-number">30</span>  <span class="hljs-comment"># Wait up to 30s because service startup usually completes within 10–20s</span>
</code></pre>
<p>或在输出中体现：</p>
<pre><code class="hljs language-rust" lang="rust">INFO: Waiting <span class="hljs-keyword">for</span> <span class="hljs-title class_">service</span> to <span class="hljs-keyword">become</span> <span class="hljs-title function_ invoke__">healthy</span> (timeout: <span class="hljs-number">30</span>s)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0086657e4fc4b938f0676a145dfc9b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=2Vt0GyoX2JxUwMqALNQawCWmxZU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-29"><strong>巧妙使用 AI 来创建和迭代 Skill</strong></h2>
<p>在创建和迭代 Skill 的过程中，可以多用 AI。你负责定义问题和验收结果，AI 负责反复试错、总结规律并封装成可复用的 Skill。</p>
<h3 data-id="heading-30"><strong>阶段一：初次创建（从具体任务中抽象）</strong></h3>
<p>让 AI 从真实任务中抽象出创建 Skill 所需的信息，然后创建初版 Skill。</p>
<p><strong>1. 让 AI 直接执行真实任务</strong></p>
<p>提供完整目标与上下文，让 AI 自行尝试完成任务。执行过程中的追问、走偏和修正，本质上就是一次“隐式评测”。</p>
<p><strong>2. 引导 AI 进行结构化复盘</strong></p>
<p>任务完成后，要求 AI 从以下维度复盘：</p>
<ul>
<li>
<p>成功执行任务的完整步骤；</p>
</li>
<li>
<p>任务执行过程中的不确定性与失败点；</p>
</li>
<li>
<p>可抽象的固定流程与判断逻辑；</p>
</li>
<li>
<p>该流程和判断逻辑的适用场景与不适用场景。</p>
</li>
</ul>
<p><strong>3. 基于复盘生成 Skill 初稿</strong></p>
<p>要求 AI 按 Skill 规范生成 SKILL.md，明确：触发条件（When）、如何执行（How）、输出结果（What）、预设失败策略。</p>
<p><strong>4. 人工快速评审并入库</strong></p>
<p>你只需关注边界是否合理、步骤是否可执行，其余交由 AI 完成。确认后，让 AI 调用 skills-creator 正式创建该 Skill 并添加至你的项目。</p>
<h3 data-id="heading-31"><strong>阶段二：持续迭代（从使用反馈中优化）</strong></h3>
<p>当 Skill 在使用中暴露新问题时，对其进行优化。</p>
<p><strong>1. 对齐偏差来源</strong></p>
<p>引导 AI 分析问题源自 When / What / How 中的哪一部分。</p>
<p><strong>2. 直接修改 Skill 并验证回归</strong></p>
<p>更新 <em><strong>SKILL.md</strong></em>，并同时验证：</p>
<ul>
<li>
<p>确保本次迭代未破坏原有的“黄金路径”。</p>
</li>
<li>
<p>确保新发现的错误场景已被覆盖。</p>
</li>
</ul>
<h3 data-id="heading-32"><strong>在 TRAE 中创建 Skill 的其他方式</strong></h3>
<p>除了通过 AI 对话创建 Skill 外，你还以手动创建或导入外部 Skill。详细说明点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.trae.cn%2Fide%2Fskills%238be9a856" target="_blank" title="https://docs.trae.cn/ide/skills#8be9a856" ref="nofollow noopener noreferrer">docs.trae.cn/ide/skills#…</a> 参考官网文档。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/079af5a4818e47c0abe69194cf5b2ad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=sFYVsv%2B6UlM299EIXgHtazNh9%2BI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-33"><strong>附录：反模式检查清单</strong></h2>
<p>本表列出了在 Skill 开发中常见的反模式（Anti-Patterns），以及相应的原因、正确示例和错误示例。通过遵循这些规范，可以提升 Skill 的稳定性、可维护性和跨平台兼容性，避免模型误用或运行失败。</p>
<p>该 Checklist 可作为开发、评审和迭代 Skill 时的快速参考指南。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c50126de01144477b68e1e339e618485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346155&amp;x-signature=%2B5t%2FNmIBG5pQxC%2FXhVVOD0SYUeg%3D" alt="" loading="lazy"/></p>
<p><strong>参考资料</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fdocs%2Fzh-CN%2Fagents-and-tools%2Fagent-skills%2Fbest-practices" target="_blank" title="https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices" ref="nofollow noopener noreferrer">platform.claude.com/docs/zh-CN/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第10章、Go语言的抽象之美-接口与多态]]></title>    <link>https://juejin.cn/post/7600684978352652315</link>    <guid>https://juejin.cn/post/7600684978352652315</guid>    <pubDate>2026-01-30T00:37:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600684978352652315" data-draft-id="7600675515150090267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第10章、Go语言的抽象之美-接口与多态"/> <meta itemprop="keywords" content="后端,Go,编程语言"/> <meta itemprop="datePublished" content="2026-01-30T00:37:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第10章、Go语言的抽象之美-接口与多态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T00:37:26.000Z" title="Fri Jan 30 2026 00:37:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好～ 上一章我们掌握了Go语言面向对象的基础——结构体与方法。今天，我们将深入Go抽象编程的核心——<strong>接口（interface）<strong>与</strong>多态</strong>。</p>
<p>不同于Java、C++的“显式接口实现”，Go的接口采用<strong>隐式实现机制</strong>，无需显式声明“implements”，只要类型满足接口的方法集，就自动实现了该接口。这种设计让代码更简洁、灵活，也完美诠释了Go“少即是多”的哲学。</p>
<p>本文将严格按照目录逐节拆解，从接口的基本定义到大型项目的分层应用，每个知识点都配套<strong>可直接运行的代码示例</strong>，同时补充官方文档、实战技巧和避坑指南。无论是入门者还是有经验的开发者，都能从中理清接口的核心逻辑，掌握多态的落地技巧。话不多说，开始正文～</p>
<h2 data-id="heading-0">一、接口的定义与隐式实现机制</h2>
<p>接口是Go语言中的“抽象类型”，它只定义“方法签名”（方法名、参数列表、返回值列表），不包含方法实现，也不存储数据。核心作用是<strong>定义行为规范</strong>，实现不同类型的“行为抽象”，为多态提供基础。</p>
<h3 data-id="heading-1">1.1 接口的基本定义语法</h3>
<p>接口通过<code>type</code>关键字+接口名+<code>interface</code>关键字定义，内部是方法签名列表：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 定义接口</span>
<span class="hljs-keyword">type</span> 接口名 <span class="hljs-keyword">interface</span> {
    方法名<span class="hljs-number">1</span>(参数列表<span class="hljs-number">1</span>) (返回值列表<span class="hljs-number">1</span>)
    方法名<span class="hljs-number">2</span>(参数列表<span class="hljs-number">2</span>) (返回值列表<span class="hljs-number">2</span>)
    <span class="hljs-comment">// ... 更多方法签名</span>
}

</code></pre>
<p>核心规则（必须掌握）：</p>
<ul>
<li>
<p>接口名通常以“er”结尾（如Reader、Writer），表示“具备某种行为的类型”；</p>
</li>
<li>
<p>方法签名必须完全匹配（方法名、参数类型、返回值类型完全一致）；</p>
</li>
<li>
<p>接口中不能包含字段，也不能包含方法实现；</p>
</li>
<li>
<p>空接口（<code>interface{}</code>）没有任何方法签名，所有类型都实现了空接口。</p>
</li>
</ul>
<h3 data-id="heading-2">1.2 核心特性：隐式实现机制</h3>
<p>这是Go接口最独特的设计——<strong>无需显式声明实现接口</strong>。只要一个类型的方法集“包含”了接口的所有方法签名（方法名、参数、返回值完全匹配），这个类型就“自动实现”了该接口。</p>
<p>这种机制的优势：</p>
<ul>
<li>
<p>解耦接口定义与实现：接口可以在不同包中定义，实现类型无需引入接口包；</p>
</li>
<li>
<p>灵活扩展：新增接口实现时，无需修改原有代码；</p>
</li>
<li>
<p>代码简洁：避免了显式声明的冗余代码。</p>
</li>
</ul>
<h3 data-id="heading-3">1.3 代码示例：接口的定义与隐式实现</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Speaker 定义接口：具备“说话”行为的类型</span>
<span class="hljs-keyword">type</span> Speaker <span class="hljs-keyword">interface</span> {
    Speak() <span class="hljs-type">string</span> <span class="hljs-comment">// 方法签名：无参数，返回string</span>
}

<span class="hljs-comment">// Person 人结构体</span>
<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Speak 实现Speaker接口的Speak方法（隐式实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"大家好，我是%s"</span>, p.Name)
}

<span class="hljs-comment">// Dog 狗结构体</span>
<span class="hljs-keyword">type</span> Dog <span class="hljs-keyword">struct</span> {
    Breed <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Speak 实现Speaker接口的Speak方法（隐式实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d Dog)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"我是%s，汪汪汪～"</span>, d.Breed)
}

<span class="hljs-comment">// 测试函数：接收Speaker接口类型参数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestSpeak</span><span class="hljs-params">(s Speaker)</span></span> {
    fmt.Println(s.Speak())
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    p := Person{Name: <span class="hljs-string">"小明"</span>}
    d := Dog{Breed: <span class="hljs-string">"金毛"</span>}

    <span class="hljs-comment">// Person和Dog都隐式实现了Speaker，可直接传入TestSpeak</span>
    TestSpeak(p) <span class="hljs-comment">// 输出：大家好，我是小明</span>
    TestSpeak(d) <span class="hljs-comment">// 输出：我是金毛，汪汪汪～</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p>Person和Dog都没有显式声明“implements Speaker”，但因为都实现了Speak() string方法，所以自动实现了Speaker接口；</p>
</li>
<li>
<p>TestSpeak函数接收Speaker接口类型参数，可接收任何实现了该接口的类型（Person、Dog），这就是多态的核心体现。</p>
</li>
</ul>
<h3 data-id="heading-4">1.4 参考链接</h3>
<ul>
<li>
<p>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Interface_types" target="_blank" title="https://go.dev/ref/spec#Interface_types" ref="nofollow noopener noreferrer">Interface Types</a></p>
</li>
<li>
<p>Go官方博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Flaws-of-reflection" target="_blank" title="https://go.dev/blog/laws-of-reflection" ref="nofollow noopener noreferrer">The Laws of Reflection（接口与反射）</a></p>
</li>
</ul>
<h2 data-id="heading-5">二、空接口interface{}与泛型替代</h2>
<p>空接口（<code>interface{}</code>）是最特殊的接口——它没有任何方法签名。根据Go的接口隐式实现规则，<strong>所有类型都默认实现了空接口</strong>。因此，空接口可以存储任何类型的值，常被用于“接收任意类型参数”的场景。</p>
<h3 data-id="heading-6">2.1 空接口的基本使用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// PrintAny 接收空接口参数，可打印任意类型的值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintAny</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> {
    fmt.Printf(<span class="hljs-string">"类型：%T，值：%v\n"</span>, v, v)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    PrintAny(<span class="hljs-number">100</span>)          <span class="hljs-comment">// 输出：类型：int，值：100</span>
    PrintAny(<span class="hljs-string">"Hello Go"</span>)   <span class="hljs-comment">// 输出：类型：string，值：Hello Go</span>
    PrintAny(<span class="hljs-literal">true</span>)         <span class="hljs-comment">// 输出：类型：bool，值：true</span>
    PrintAny([]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>}) <span class="hljs-comment">// 输出：类型：[]int，值：[1 2 3]</span>
    PrintAny(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{<span class="hljs-string">"name"</span>: <span class="hljs-string">"小明"</span>}) <span class="hljs-comment">// 输出：类型：map[string]string，值：map[name:小明]</span>
}

</code></pre>
<p>空接口的核心特点：</p>
<ul>
<li>
<p>可以存储任何类型的值，但存储的是“类型+值”的组合（即“接口值”的结构）；</p>
</li>
<li>
<p>空接口本身不提供任何方法，无法直接操作内部值，必须通过“类型断言”获取原始类型后才能操作；</p>
</li>
<li>
<p>早期Go版本（1.17之前）没有泛型，空接口是实现“通用功能”的主要方式（如fmt包的Print系列函数）。</p>
</li>
</ul>
<h3 data-id="heading-7">2.2 空接口的局限性与泛型替代</h3>
<p>空接口虽然灵活，但存在明显局限性：</p>
<ul>
<li>
<p><strong>类型不安全</strong>：编译期无法检查类型，必须在运行时通过类型断言判断，容易出现类型错误；</p>
</li>
<li>
<p><strong>性能损耗</strong>：空接口存储需要额外的类型信息，且类型断言会带来运行时开销；</p>
</li>
<li>
<p><strong>代码冗余</strong>：使用前必须手动进行类型判断和转换，代码可读性差。</p>
</li>
</ul>
<p>Go 1.18引入**泛型（Generics）**后，大部分空接口的场景都可以用泛型替代，实现“类型安全的通用功能”。</p>
<h3 data-id="heading-8">2.3 代码示例：泛型替代空接口</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 泛型版本：定义类型参数T，可接收任意类型</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintAnyGeneric</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(v T)</span></span> {
    fmt.Printf(<span class="hljs-string">"类型：%T，值：%v\n"</span>, v, v)
}

<span class="hljs-comment">// 泛型版本：求切片元素之和（限制T为数值类型）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SumSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">int</span> | <span class="hljs-title">int64</span> | <span class="hljs-title">float64</span>]<span class="hljs-params">(s []T)</span></span> T {
    <span class="hljs-keyword">var</span> sum T
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> s {
        sum += v
    }
    <span class="hljs-keyword">return</span> sum
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 泛型实现通用打印，与空接口效果一致，但类型安全</span>
    PrintAnyGeneric(<span class="hljs-number">100</span>)
    PrintAnyGeneric(<span class="hljs-string">"Hello Go"</span>)

    <span class="hljs-comment">// 泛型实现切片求和，编译期检查类型</span>
    intSlice := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>}
    fmt.Println(<span class="hljs-string">"int切片和："</span>, SumSlice(intSlice)) <span class="hljs-comment">// 输出：int切片和：10</span>

    floatSlice := []<span class="hljs-type">float64</span>{<span class="hljs-number">1.1</span>,<span class="hljs-number">2.2</span>,<span class="hljs-number">3.3</span>}
    fmt.Println(<span class="hljs-string">"float64切片和："</span>, SumSlice(floatSlice)) <span class="hljs-comment">// 输出：float64切片和：6.6</span>

    <span class="hljs-comment">// 错误：string类型不满足SumSlice的类型约束</span>
    <span class="hljs-comment">// strSlice := []string{"a","b"}</span>
    <span class="hljs-comment">// fmt.Println(SumSlice(strSlice))</span>
}

</code></pre>
<p>空接口与泛型的选择建议：</p>






























<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td>接收任意类型参数（无类型约束）</td><td>泛型（T any）</td><td>类型安全，编译期检查，性能更优</td></tr><tr><td>接收特定类型集合（如数值类型、可比较类型）</td><td>泛型（带类型约束）</td><td>精准限制类型，避免运行时错误</td></tr><tr><td>Go版本&lt;1.18</td><td>空接口</td><td>无泛型支持，只能用空接口实现通用功能</td></tr><tr><td>反射场景（如序列化/反序列化）</td><td>空接口</td><td>反射需要依赖空接口的类型信息</td></tr></tbody></table>
<h3 data-id="heading-9">2.4 参考链接</h3>
<ul>
<li>
<p>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23The_empty_interface" target="_blank" title="https://go.dev/ref/spec#The_empty_interface" ref="nofollow noopener noreferrer">The empty interface</a></p>
</li>
<li>
<p>Go泛型官方教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Ftutorial%2Fgenerics" target="_blank" title="https://go.dev/doc/tutorial/generics" ref="nofollow noopener noreferrer">Generics Tutorial</a></p>
</li>
</ul>
<h2 data-id="heading-10">三、类型断言与类型安全检查</h2>
<p>当我们将一个具体类型的值存储到接口中后，接口只知道该类型实现了接口的方法，无法直接获取原始类型的信息。这时需要通过**类型断言（Type Assertion）**来“提取”接口中的原始类型值，实现对原始类型的操作。</p>
<h3 data-id="heading-11">3.1 类型断言的基本语法</h3>
<p>类型断言有两种基本格式：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 格式1：不检查错误（如果断言失败，会触发panic）</span>
value := 接口变量.(目标类型)

<span class="hljs-comment">// 格式2：检查错误（推荐使用）</span>
value, ok := 接口变量.(目标类型)
<span class="hljs-comment">// ok为bool类型：true表示断言成功，false表示断言失败（不会panic）</span>

</code></pre>
<h3 data-id="heading-12">3.2 代码示例：类型断言的使用与安全检查</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> Speaker <span class="hljs-keyword">interface</span> {
    Speak() <span class="hljs-type">string</span>
}

<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"我是%s"</span>, p.Name)
}

<span class="hljs-keyword">type</span> Dog <span class="hljs-keyword">struct</span> {
    Breed <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d Dog)</span></span> Speak() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"我是%s"</span>, d.Breed)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> s Speaker

    <span class="hljs-comment">// 1. 存储Person类型到接口</span>
    s = Person{Name: <span class="hljs-string">"小明"</span>}

    <span class="hljs-comment">// 安全断言：检查是否为Person类型</span>
    <span class="hljs-keyword">if</span> p, ok := s.(Person); ok {
        fmt.Println(<span class="hljs-string">"断言成功，Person姓名："</span>, p.Name) <span class="hljs-comment">// 输出：断言成功，Person姓名： 小明</span>
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"断言失败，不是Person类型"</span>)
    }

    <span class="hljs-comment">// 2. 存储Dog类型到接口</span>
    s = Dog{Breed: <span class="hljs-string">"金毛"</span>}

    <span class="hljs-comment">// 不安全断言：不检查错误（如果失败会panic）</span>
    <span class="hljs-comment">// d := s.(Person) // 运行时panic：interface conversion: main.Dog is not main.Person: missing method Speak? No, 类型不匹配</span>

    <span class="hljs-comment">// 安全断言：检查是否为Dog类型</span>
    <span class="hljs-keyword">if</span> d, ok := s.(Dog); ok {
        fmt.Println(<span class="hljs-string">"断言成功，Dog品种："</span>, d.Breed) <span class="hljs-comment">// 输出：断言成功，Dog品种： 金毛</span>
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"断言失败，不是Dog类型"</span>)
    }

    <span class="hljs-comment">// 3. 断言到未实现的类型</span>
    <span class="hljs-keyword">if</span> str, ok := s.(<span class="hljs-type">string</span>); ok {
        fmt.Println(<span class="hljs-string">"是string类型："</span>, str)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"断言失败，不是string类型"</span>) <span class="hljs-comment">// 输出：断言失败，不是string类型</span>
    }
}
</code></pre>
<h3 data-id="heading-13">3.3 常见场景：接口值的类型判断</h3>
<p>类型断言常用于以下场景：</p>
<ul>
<li>
<p><strong>空接口值的类型还原</strong>：当函数接收空接口参数时，通过类型断言还原原始类型；</p>
</li>
<li>
<p><strong>接口实现的类型区分</strong>：当一个接口有多个实现类型时，通过类型断言区分不同类型并执行差异化逻辑；</p>
</li>
<li>
<p><strong>扩展接口功能</strong>：当需要调用原始类型特有的方法（非接口方法）时，通过类型断言获取原始类型。</p>
</li>
</ul>
<h3 data-id="heading-14">3.4 避坑指南</h3>
<ul>
<li>
<p>永远优先使用“带ok的类型断言”（格式2），避免因断言失败导致panic；</p>
</li>
<li>
<p>类型断言只能断言“接口中存储的具体类型”，不能断言“接口类型”（如将Speaker接口断言为Reader接口，即使类型实现了Reader，也会失败）；</p>
</li>
<li>
<p>如果需要同时判断多种类型，建议使用“类型选择（type switch）”（下一节讲解），代码更简洁。</p>
</li>
</ul>
<h2 data-id="heading-15">四、类型选择（type switch）的使用</h2>
<p>当需要对接口中的值进行“多类型判断”时，使用类型断言会导致大量的if-else嵌套，代码冗余。这时可以使用<strong>类型选择（type switch）</strong>，它是专门用于“接口类型判断”的语法，能更简洁、清晰地处理多类型分支。</p>
<h3 data-id="heading-16">4.1 类型选择的基本语法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">switch</span> 接口变量.(<span class="hljs-keyword">type</span>) {
<span class="hljs-keyword">case</span> 目标类型<span class="hljs-number">1</span>:
    <span class="hljs-comment">// 当接口值为目标类型1时执行</span>
    操作（可直接使用变量，类型为目标类型<span class="hljs-number">1</span>）
<span class="hljs-keyword">case</span> 目标类型<span class="hljs-number">2</span>:
    <span class="hljs-comment">// 当接口值为目标类型2时执行</span>
<span class="hljs-keyword">case</span> 目标类型<span class="hljs-number">3</span>, 目标类型<span class="hljs-number">4</span>:
    <span class="hljs-comment">// 多个类型共用一个分支</span>
<span class="hljs-keyword">default</span>:
    <span class="hljs-comment">// 当接口值不匹配任何case时执行</span>
}

</code></pre>
<p>核心特点：</p>
<ul>
<li>
<p>case后面跟的是“类型”，而非“值”（与普通switch的核心区别）；</p>
</li>
<li>
<p>无需手动进行类型断言，case分支中直接使用的变量就是对应类型；</p>
</li>
<li>
<p>default分支可选，用于处理未匹配到的类型（避免遗漏）。</p>
</li>
</ul>
<h3 data-id="heading-17">4.2 代码示例：类型选择的使用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// PrintAny 用type switch处理空接口的多类型分支</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintAny</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> {
    <span class="hljs-keyword">switch</span> t := v.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-type">int</span>:
        fmt.Printf(<span class="hljs-string">"类型：int，值：%d，平方：%d\n"</span>, t, t*t)
    <span class="hljs-keyword">case</span> <span class="hljs-type">string</span>:
        fmt.Printf(<span class="hljs-string">"类型：string，值：%s，长度：%d\n"</span>, t, <span class="hljs-built_in">len</span>(t))
    <span class="hljs-keyword">case</span> <span class="hljs-type">bool</span>:
        fmt.Printf(<span class="hljs-string">"类型：bool，值：%t\n"</span>, t)
    <span class="hljs-keyword">case</span> []<span class="hljs-type">int</span>:
        fmt.Printf(<span class="hljs-string">"类型：[]int，值：%v，元素个数：%d\n"</span>, t, <span class="hljs-built_in">len</span>(t))
    <span class="hljs-keyword">case</span> <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}:
        fmt.Printf(<span class="hljs-string">"类型：map[string]interface{}，值：%v\n"</span>, t)
    <span class="hljs-keyword">default</span>:
        fmt.Printf(<span class="hljs-string">"未知类型：%T，值：%v\n"</span>, t, t)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    PrintAny(<span class="hljs-number">10</span>)                          <span class="hljs-comment">// 输出：类型：int，值：10，平方：100</span>
    PrintAny(<span class="hljs-string">"Hello Go"</span>)                  <span class="hljs-comment">// 输出：类型：string，值：Hello Go，长度：8</span>
    PrintAny(<span class="hljs-literal">true</span>)                        <span class="hljs-comment">// 输出：类型：bool，值：true</span>
    PrintAny([]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>})                <span class="hljs-comment">// 输出：类型：[]int，值：[1 2 3]，元素个数：3</span>
    PrintAny(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"小明"</span>,
        <span class="hljs-string">"age"</span>:  <span class="hljs-number">25</span>,
    }) <span class="hljs-comment">// 输出：类型：map[string]interface{}，值：map[name:小明 age:25]</span>
    PrintAny(<span class="hljs-number">3.14</span>)                        <span class="hljs-comment">// 输出：未知类型：float64，值：3.14</span>
}

</code></pre>
<h3 data-id="heading-18">4.3 进阶用法：类型选择与接口结合</h3>
<p>类型选择也可以用于判断接口的实现类型，实现更灵活的多态逻辑。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> Shape <span class="hljs-keyword">interface</span> {
    Area() <span class="hljs-type">float64</span>
}

<span class="hljs-keyword">type</span> Circle <span class="hljs-keyword">struct</span> {
    Radius <span class="hljs-type">float64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Circle)</span></span> Area() <span class="hljs-type">float64</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-number">3.14</span> * c.Radius * c.Radius
}

<span class="hljs-keyword">type</span> Rectangle <span class="hljs-keyword">struct</span> {
    Width  <span class="hljs-type">float64</span>
    Height <span class="hljs-type">float64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r Rectangle)</span></span> Area() <span class="hljs-type">float64</span> {
    <span class="hljs-keyword">return</span> r.Width * r.Height
}

<span class="hljs-comment">// CalculateArea 用type switch区分Shape的实现类型，执行差异化逻辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CalculateArea</span><span class="hljs-params">(s Shape)</span></span> {
    <span class="hljs-keyword">switch</span> t := s.(<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> Circle:
        fmt.Printf(<span class="hljs-string">"圆形：半径=%.2f，面积=%.2f\n"</span>, t.Radius, t.Area())
    <span class="hljs-keyword">case</span> Rectangle:
        fmt.Printf(<span class="hljs-string">"矩形：宽=%.2f，高=%.2f，面积=%.2f\n"</span>, t.Width, t.Height, t.Area())
    <span class="hljs-keyword">default</span>:
        fmt.Printf(<span class="hljs-string">"未知图形，面积=%.2f\n"</span>, t.Area())
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Circle{Radius: <span class="hljs-number">5</span>}
    r := Rectangle{Width: <span class="hljs-number">4</span>, Height: <span class="hljs-number">5</span>}

    CalculateArea(c) <span class="hljs-comment">// 输出：圆形：半径=5.00，面积=78.50</span>
    CalculateArea(r) <span class="hljs-comment">// 输出：矩形：宽=4.00，高=5.00，面积=20.00</span>
}

</code></pre>
<h3 data-id="heading-19">4.4 参考链接</h3>
<ul>
<li>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Type_switches" target="_blank" title="https://go.dev/ref/spec#Type_switches" ref="nofollow noopener noreferrer">Type switches</a></li>
</ul>
<h2 data-id="heading-20">五、接口的组合与扩展性设计</h2>
<p>Go的接口支持<strong>组合（Composition）</strong>——将多个接口组合成一个新接口。这种设计可以实现“接口的复用与扩展”，让接口设计更灵活、粒度更细，符合“单一职责原则”。</p>
<p>核心思想：一个大接口可以由多个小接口组合而成，实现大接口的类型只需实现所有小接口的方法。</p>
<h3 data-id="heading-21">5.1 接口组合的基本语法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 定义小接口1</span>
<span class="hljs-keyword">type</span> 接口<span class="hljs-number">1</span> <span class="hljs-keyword">interface</span> {
    方法<span class="hljs-number">1</span>()
}

<span class="hljs-comment">// 定义小接口2</span>
<span class="hljs-keyword">type</span> 接口<span class="hljs-number">2</span> <span class="hljs-keyword">interface</span> {
    方法<span class="hljs-number">2</span>()
}

<span class="hljs-comment">// 组合接口：包含接口1和接口2（相当于拥有方法1和方法2）</span>
<span class="hljs-keyword">type</span> 组合接口 <span class="hljs-keyword">interface</span> {
    接口<span class="hljs-number">1</span>
    接口<span class="hljs-number">2</span>
    <span class="hljs-comment">// 可选：新增方法</span>
    方法<span class="hljs-number">3</span>()
}
</code></pre>
<p>规则：实现“组合接口”的类型，必须实现所有组合的小接口的方法，以及组合接口新增的方法。</p>
<h3 data-id="heading-22">5.2 代码示例：接口组合的使用</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Reader 小接口：读取数据</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> {
    Read() <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Writer 小接口：写入数据</span>
<span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">interface</span> {
    Write(data <span class="hljs-type">string</span>)
}

<span class="hljs-comment">// ReadWriter 组合接口：包含Reader和Writer</span>
<span class="hljs-keyword">type</span> ReadWriter <span class="hljs-keyword">interface</span> {
    Reader <span class="hljs-comment">// 嵌入Reader接口</span>
    Writer <span class="hljs-comment">// 嵌入Writer接口</span>
    Flush() <span class="hljs-comment">// 新增方法：刷新缓存</span>
}

<span class="hljs-comment">// File 文件结构体：实现ReadWriter接口</span>
<span class="hljs-keyword">type</span> File <span class="hljs-keyword">struct</span> {
    Content <span class="hljs-type">string</span>
}

<span class="hljs-comment">// 实现Reader的Read方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Read() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> f.Content
}

<span class="hljs-comment">// 实现Writer的Write方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Write(data <span class="hljs-type">string</span>) {
    f.Content += data
}

<span class="hljs-comment">// 实现ReadWriter的Flush方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Flush() {
    fmt.Println(<span class="hljs-string">"刷新缓存，当前内容："</span>, f.Content)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> rw ReadWriter = &amp;File{Content: <span class="hljs-string">"初始内容："</span>}

    <span class="hljs-comment">// 调用Writer的Write方法</span>
    rw.Write(<span class="hljs-string">"Hello "</span>)
    rw.Write(<span class="hljs-string">"Go!"</span>)

    <span class="hljs-comment">// 调用Reader的Read方法</span>
    fmt.Println(<span class="hljs-string">"读取内容："</span>, rw.Read()) <span class="hljs-comment">// 输出：读取内容： 初始内容：Hello Go!</span>

    <span class="hljs-comment">// 调用ReadWriter的Flush方法</span>
    rw.Flush() <span class="hljs-comment">// 输出：刷新缓存，当前内容： 初始内容：Hello Go!</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p>ReadWriter接口组合了Reader和Writer，因此拥有了Read()和Write()方法，同时新增了Flush()方法；</p>
</li>
<li>
<p>File结构体要实现ReadWriter，必须同时实现Read()、Write()和Flush()三个方法；</p>
</li>
<li>
<p>接口组合实现了“功能的复用”：Reader和Writer可以被其他组合接口复用（如ReadCloser、WriteCloser）。</p>
</li>
</ul>
<h3 data-id="heading-23">5.3 扩展性设计技巧</h3>
<p>基于接口组合的扩展性设计，是Go大型项目的核心技巧之一，建议遵循以下原则：</p>
<h4 data-id="heading-24">5.3.1 接口粒度要小（单一职责）</h4>
<p>每个小接口只负责一个功能（如Reader只负责读取，Writer只负责写入），这样可以提高接口的复用性。例如Go标准库中的<code>io.Reader</code>、<code>io.Writer</code>、<code>io.Closer</code>都是单一职责的小接口。</p>
<h4 data-id="heading-25">5.3.2 组合扩展，而非修改原有接口</h4>
<p>当需要新增功能时，不要修改已有的接口（会破坏原有实现），而是通过组合现有接口+新增方法的方式创建新接口。例如：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 现有接口</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> { Read() <span class="hljs-type">string</span> }

<span class="hljs-comment">// 新增功能：带缓冲的读取</span>
<span class="hljs-keyword">type</span> BufferedReader <span class="hljs-keyword">interface</span> {
    Reader
    BufferSize() <span class="hljs-type">int</span> <span class="hljs-comment">// 新增方法：获取缓冲大小</span>
}

</code></pre>
<h4 data-id="heading-26">5.3.3 依赖抽象接口，而非具体实现</h4>
<p>函数参数、结构体字段尽量使用接口类型（尤其是组合接口），而非具体实现类型，这样可以提高代码的灵活性和可测试性。例如：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 好：依赖ReadWriter接口，可接收任何实现该接口的类型（File、NetworkConn等）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ProcessData</span><span class="hljs-params">(rw ReadWriter)</span></span> {
    <span class="hljs-comment">// 处理逻辑</span>
}

<span class="hljs-comment">// 差：依赖具体的File类型，无法复用其他实现</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ProcessData</span><span class="hljs-params">(f *File)</span></span> {
    <span class="hljs-comment">// 处理逻辑</span>
}

</code></pre>
<h3 data-id="heading-27">5.4 参考链接</h3>
<ul>
<li>Go标准库io包接口设计：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fio" target="_blank" title="https://pkg.go.dev/io" ref="nofollow noopener noreferrer">io package</a></li>
</ul>
<h2 data-id="heading-28">六、鸭子类型与Go的多态实现</h2>
<p>Go的多态实现基于“鸭子类型（Duck Typing）”——“当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被当作鸭子”。对应到Go中：<strong>只要一个类型实现了接口的所有方法，无论它是什么类型，都可以被当作该接口类型使用</strong>。</p>
<p>Go的隐式接口实现机制，正是鸭子类型的完美体现，也是Go多态的核心原理。</p>
<h3 data-id="heading-29">6.1 鸭子类型的核心思想</h3>
<ul>
<li>
<p>关注“行为”而非“类型本身”：接口定义的是“行为规范”，只要类型具备该行为，就可以被接口接纳；</p>
</li>
<li>
<p>无需继承关系：不同类型之间无需有继承关系，只要行为匹配，就可以实现多态；</p>
</li>
<li>
<p>代码解耦：接口与实现类型完全解耦，实现类型可以在任何包中定义，无需依赖接口包。</p>
</li>
</ul>
<h3 data-id="heading-30">6.2 代码示例：Go的多态实现（基于鸭子类型）</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Mover 定义行为：移动</span>
<span class="hljs-keyword">type</span> Mover <span class="hljs-keyword">interface</span> {
    Move() <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Car 汽车结构体</span>
<span class="hljs-keyword">type</span> Car <span class="hljs-keyword">struct</span> {
    Brand <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Move 实现Mover接口（汽车的移动行为）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Car)</span></span> Move() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s汽车在公路上行驶"</span>, c.Brand)
}

<span class="hljs-comment">// Bird 鸟结构体</span>
<span class="hljs-keyword">type</span> Bird <span class="hljs-keyword">struct</span> {
    Species <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Move 实现Mover接口（鸟的移动行为）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b Bird)</span></span> Move() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s在天空中飞翔"</span>, b.Species)
}

<span class="hljs-comment">// Ship 船结构体</span>
<span class="hljs-keyword">type</span> Ship <span class="hljs-keyword">struct</span> {
    Type <span class="hljs-type">string</span>
}

<span class="hljs-comment">// Move 实现Mover接口（船的移动行为）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s Ship)</span></span> Move() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%s在海上航行"</span>, s.Type)
}

<span class="hljs-comment">// 多态函数：接收Mover接口，执行移动行为</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MoveAnything</span><span class="hljs-params">(m Mover)</span></span> {
    fmt.Println(m.Move())
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Car{Brand: <span class="hljs-string">"宝马"</span>}
    b := Bird{Species: <span class="hljs-string">"老鹰"</span>}
    s := Ship{Type: <span class="hljs-string">"游轮"</span>}

    <span class="hljs-comment">// 不同类型（Car、Bird、Ship）都实现了Mover，可统一传入MoveAnything</span>
    MoveAnything(c) <span class="hljs-comment">// 输出：宝马汽车在公路上行驶</span>
    MoveAnything(b) <span class="hljs-comment">// 输出：老鹰在天空中飞翔</span>
    MoveAnything(s) <span class="hljs-comment">// 输出：游轮在海上航行</span>
}

</code></pre>
<p>Go多态的优势：</p>
<ul>
<li>
<p><strong>简洁灵活</strong>：无需显式继承和接口声明，代码更简洁；</p>
</li>
<li>
<p><strong>低耦合</strong>：接口与实现类型解耦，便于扩展和维护；</p>
</li>
<li>
<p><strong>高复用</strong>：同一接口可以被任意类型实现，多态函数可以复用在不同类型上。</p>
</li>
</ul>
<h3 data-id="heading-31">6.3 鸭子类型与传统多态的区别</h3>






























<table><thead><tr><th>对比维度</th><th>Go的鸭子类型（隐式接口）</th><th>Java/C++的显式接口/继承</th></tr></thead><tbody><tr><td>接口实现方式</td><td>隐式实现，无需声明</td><td>显式声明（implements/extends）</td></tr><tr><td>类型关系</td><td>无继承关系，只关注行为匹配</td><td>需建立继承/实现关系</td></tr><tr><td>耦合度</td><td>低（接口与实现完全解耦）</td><td>高（实现类型依赖接口/父类）</td></tr><tr><td>扩展性</td><td>强（新增实现无需修改原有代码）</td><td>弱（修改接口/父类会影响所有子类）</td></tr></tbody></table>
<h2 data-id="heading-32">七、error接口的设计哲学</h2>
<p>在Go中，错误处理是通过<code>error</code>接口实现的。<code>error</code>是Go标准库定义的一个简单接口，它的设计充分体现了Go“简洁、实用”的哲学，也是接口在Go中最广泛的应用之一。</p>
<h3 data-id="heading-33">7.1 error接口的定义</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// error接口定义（位于builtin包）</span>
<span class="hljs-keyword">type</span> <span class="hljs-type">error</span> <span class="hljs-keyword">interface</span> {
    Error() <span class="hljs-type">string</span> <span class="hljs-comment">// 只包含一个方法：返回错误信息字符串</span>
}

</code></pre>
<p>核心特点：</p>
<ul>
<li>
<p>接口极简：只包含一个Error() string方法，任何实现该方法的类型都可以作为错误类型；</p>
</li>
<li>
<p>隐式实现：自定义错误类型只需实现Error()方法，无需显式声明；</p>
</li>
<li>
<p>值语义：error接口存储的是具体错误类型的值（或指针），支持类型断言和类型选择。</p>
</li>
</ul>
<h3 data-id="heading-34">7.2 错误处理的基本用法</h3>
<p>Go中错误处理的核心模式是“返回错误+检查错误”，而非“异常捕获（try-catch）”。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"errors"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// Divide 除法函数：返回结果和错误（当除数为0时返回错误）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Divide</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 用errors.New创建简单错误</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, errors.New(<span class="hljs-string">"除数不能为0"</span>)
    }
    <span class="hljs-keyword">return</span> a / b, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 调用函数，检查错误</span>
    result, err := Divide(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"10/2 ="</span>, result) <span class="hljs-comment">// 输出：10/2 = 5</span>

    <span class="hljs-comment">// 测试除数为0的错误场景</span>
    result2, err2 := Divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err2) <span class="hljs-comment">// 输出：错误： 除数不能为0</span>
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"10/0 ="</span>, result2)
}

</code></pre>
<h3 data-id="heading-35">7.3 自定义错误类型</h3>
<p>当需要携带更多错误信息（如错误码、错误详情）时，可以自定义错误类型（实现error接口）。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 自定义错误类型：包含错误码和错误信息</span>
<span class="hljs-keyword">type</span> MyError <span class="hljs-keyword">struct</span> {
    Code    <span class="hljs-type">int</span>    <span class="hljs-comment">// 错误码</span>
    Message <span class="hljs-type">string</span> <span class="hljs-comment">// 错误信息</span>
}

<span class="hljs-comment">// 实现error接口的Error()方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *MyError)</span></span> Error() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"错误码：%d，错误信息：%s"</span>, e.Code, e.Message)
}

<span class="hljs-comment">// Login 模拟登录函数：返回自定义错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Login</span><span class="hljs-params">(username, password <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> username == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> &amp;MyError{Code: <span class="hljs-number">400</span>, Message: <span class="hljs-string">"用户名不能为空"</span>}
    }
    <span class="hljs-keyword">if</span> password == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> &amp;MyError{Code: <span class="hljs-number">400</span>, Message: <span class="hljs-string">"密码不能为空"</span>}
    }
    <span class="hljs-keyword">if</span> username != <span class="hljs-string">"admin"</span> || password != <span class="hljs-string">"123456"</span> {
        <span class="hljs-keyword">return</span> &amp;MyError{Code: <span class="hljs-number">401</span>, Message: <span class="hljs-string">"用户名或密码错误"</span>}
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    err := Login(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"123456"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"登录成功"</span>)

    <span class="hljs-comment">// 测试错误场景，并通过类型断言获取自定义错误信息</span>
    err2 := Login(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"wrong"</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 断言为自定义MyError类型</span>
        <span class="hljs-keyword">if</span> e, ok := err2.(*MyError); ok {
            fmt.Printf(<span class="hljs-string">"登录失败：错误码=%d，详情=%s\n"</span>, e.Code, e.Message)
            <span class="hljs-comment">// 可根据错误码执行差异化逻辑</span>
            <span class="hljs-keyword">if</span> e.Code == <span class="hljs-number">401</span> {
                fmt.Println(<span class="hljs-string">"建议：请检查用户名和密码"</span>)
            }
        }
        <span class="hljs-keyword">return</span>
    }
}

</code></pre>
<h3 data-id="heading-36">7.4 error接口的设计哲学</h3>
<ul>
<li>
<p><strong>简洁实用</strong>：一个方法即可满足错误信息的基本需求，避免过度设计；</p>
</li>
<li>
<p><strong>显式错误处理</strong>：通过返回值显式返回错误，开发者必须主动检查错误（而非隐式忽略）；</p>
</li>
<li>
<p><strong>灵活扩展</strong>：支持自定义错误类型，可携带任意额外信息，满足复杂场景需求；</p>
</li>
<li>
<p><strong>与接口生态兼容</strong>：error本身是接口，可无缝集成到Go的接口体系中（如类型断言、类型选择）。</p>
</li>
</ul>
<h3 data-id="heading-37">7.5 参考链接</h3>
<ul>
<li>
<p>Go官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fbuiltin%23error" target="_blank" title="https://pkg.go.dev/builtin#error" ref="nofollow noopener noreferrer">error interface</a></p>
</li>
<li>
<p>Go官方博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Ferror-handling-and-go" target="_blank" title="https://go.dev/blog/error-handling-and-go" ref="nofollow noopener noreferrer">Error Handling and Go</a></p>
</li>
</ul>
<h2 data-id="heading-38">八、接口在大型项目中的分层应用</h2>
<p>在大型Go项目中，接口是实现“分层架构”、“解耦模块”的核心工具。通过接口定义层与层之间的“契约”，可以让各层独立开发、测试和迭代，大幅提升项目的可维护性和扩展性。</p>
<h3 data-id="heading-39">8.1 大型项目的典型分层架构</h3>
<p>以常见的“Web后端项目”为例，典型分层为：</p>
<pre><code class="hljs language-text" lang="text">
1. 接口层（API/Handler）：接收客户端请求，参数校验，返回响应
2. 服务层（Service）：实现核心业务逻辑，依赖数据访问层接口
3. 数据访问层（DAO）：与数据库交互，实现数据的增删改查
4. 模型层（Model）：定义数据结构（结构体）

</code></pre>
<p>接口的作用：在“服务层”与“数据访问层”之间定义契约，让服务层依赖DAO接口而非具体实现，实现解耦。</p>
<h3 data-id="heading-40">8.2 代码示例：分层架构中的接口应用</h3>
<p>以下是一个简化的用户管理系统分层实现，重点展示接口在层间解耦中的作用：</p>
<h4 data-id="heading-41">8.2.1 模型层（model/user.go）：定义数据结构</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> model

<span class="hljs-comment">// User 用户模型</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    ID       <span class="hljs-type">int</span>    <span class="hljs-string">`json:"id"`</span>
    Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span>
    Email    <span class="hljs-type">string</span> <span class="hljs-string">`json:"email"`</span>
}

</code></pre>
<h4 data-id="heading-42">8.2.2 数据访问层接口（dao/user_dao.go）：定义DAO接口</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> dao

<span class="hljs-keyword">import</span> <span class="hljs-string">"your-project/model"</span>

<span class="hljs-comment">// UserDAO 用户数据访问接口（层间契约）</span>
<span class="hljs-keyword">type</span> UserDAO <span class="hljs-keyword">interface</span> {
    GetByID(id <span class="hljs-type">int</span>) (*model.User, <span class="hljs-type">error</span>)   <span class="hljs-comment">// 根据ID查询用户</span>
    Create(user *model.User) <span class="hljs-type">error</span>        <span class="hljs-comment">// 创建用户</span>
    Update(user *model.User) <span class="hljs-type">error</span>        <span class="hljs-comment">// 更新用户</span>
    Delete(id <span class="hljs-type">int</span>) <span class="hljs-type">error</span>                  <span class="hljs-comment">// 删除用户</span>
}

</code></pre>
<h4 data-id="heading-43">8.2.3 数据访问层实现（dao/mysql_user_dao.go）：MySQL实现</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> dao

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"your-project/model"</span>
)

<span class="hljs-comment">// MySQLUserDAO UserDAO的MySQL实现</span>
<span class="hljs-keyword">type</span> MySQLUserDAO <span class="hljs-keyword">struct</span> {
    db *sql.DB <span class="hljs-comment">// 数据库连接</span>
}

<span class="hljs-comment">// 初始化MySQLUserDAO</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMySQLUserDAO</span><span class="hljs-params">(db *sql.DB)</span></span> *MySQLUserDAO {
    <span class="hljs-keyword">return</span> &amp;MySQLUserDAO{db: db}
}

<span class="hljs-comment">// GetByID 实现UserDAO的GetByID方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> GetByID(id <span class="hljs-type">int</span>) (*model.User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> user model.User
    err := m.db.QueryRow(<span class="hljs-string">"SELECT id, username, email FROM users WHERE id = ?"</span>, id).
        Scan(&amp;user.ID, &amp;user.Username, &amp;user.Email)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> &amp;user, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Create 实现UserDAO的Create方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> Create(user *model.User) <span class="hljs-type">error</span> {
    _, err := m.db.Exec(<span class="hljs-string">"INSERT INTO users (username, email) VALUES (?, ?)"</span>,
        user.Username, user.Email)
    <span class="hljs-keyword">return</span> err
}

<span class="hljs-comment">// Update 实现UserDAO的Update方法（简化实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> Update(user *model.User) <span class="hljs-type">error</span> {
    _, err := m.db.Exec(<span class="hljs-string">"UPDATE users SET username = ?, email = ? WHERE id = ?"</span>,
        user.Username, user.Email, user.ID)
    <span class="hljs-keyword">return</span> err
}

<span class="hljs-comment">// Delete 实现UserDAO的Delete方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MySQLUserDAO)</span></span> Delete(id <span class="hljs-type">int</span>) <span class="hljs-type">error</span> {
    _, err := m.db.Exec(<span class="hljs-string">"DELETE FROM users WHERE id = ?"</span>, id)
    <span class="hljs-keyword">return</span> err
}

</code></pre>
<h4 data-id="heading-44">8.2.4 服务层（service/user_service.go）：依赖DAO接口</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> service

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"your-project/dao"</span>
    <span class="hljs-string">"your-project/model"</span>
)

<span class="hljs-comment">// UserService 用户服务层</span>
<span class="hljs-keyword">type</span> UserService <span class="hljs-keyword">struct</span> {
    userDAO dao.UserDAO <span class="hljs-comment">// 依赖UserDAO接口，而非具体实现</span>
}

<span class="hljs-comment">// 初始化UserService（注入DAO实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserService</span><span class="hljs-params">(userDAO dao.UserDAO)</span></span> *UserService {
    <span class="hljs-keyword">return</span> &amp;UserService{userDAO: userDAO}
}

<span class="hljs-comment">// GetUserByID 业务逻辑：查询用户</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *UserService)</span></span> GetUserByID(id <span class="hljs-type">int</span>) (*model.User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> id &lt;= <span class="hljs-number">0</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"无效的用户ID：%d"</span>, id)
    }
    <span class="hljs-comment">// 调用DAO接口方法（不关心具体是MySQL还是其他实现）</span>
    <span class="hljs-keyword">return</span> s.userDAO.GetByID(id)
}

<span class="hljs-comment">// CreateUser 业务逻辑：创建用户</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *UserService)</span></span> CreateUser(username, email <span class="hljs-type">string</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> username == <span class="hljs-string">""</span> || email == <span class="hljs-string">""</span> {
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"用户名和邮箱不能为空"</span>)
    }
    user := &amp;model.User{Username: username, Email: email}
    <span class="hljs-keyword">return</span> s.userDAO.Create(user)
}

</code></pre>
<h4 data-id="heading-45">8.2.5 接口层（handler/user_handler.go）：接收请求</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> handler

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"strconv"</span>
    <span class="hljs-string">"your-project/service"</span>
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
)

<span class="hljs-comment">// UserHandler 用户接口层</span>
<span class="hljs-keyword">type</span> UserHandler <span class="hljs-keyword">struct</span> {
    userService *service.UserService
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserHandler</span><span class="hljs-params">(userService *service.UserService)</span></span> *UserHandler {
    <span class="hljs-keyword">return</span> &amp;UserHandler{userService: userService}
}

<span class="hljs-comment">// GetUserByIDHandler 处理查询用户请求</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *UserHandler)</span></span> GetUserByIDHandler(c *gin.Context) {
    idStr := c.Param(<span class="hljs-string">"id"</span>)
    id, err := strconv.Atoi(idStr)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        c.JSON(http.StatusBadRequest, gin.H{<span class="hljs-string">"error"</span>: <span class="hljs-string">"无效的用户ID"</span>})
        <span class="hljs-keyword">return</span>
    }

    user, err := h.userService.GetUserByID(id)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        c.JSON(http.StatusInternalServerError, gin.H{<span class="hljs-string">"error"</span>: err.Error()})
        <span class="hljs-keyword">return</span>
    }

    c.JSON(http.StatusOK, gin.H{<span class="hljs-string">"data"</span>: user})
}

</code></pre>
<h4 data-id="heading-46">8.2.6 初始化与依赖注入（main.go）</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"your-project/dao"</span>
    <span class="hljs-string">"your-project/handler"</span>
    <span class="hljs-string">"your-project/service"</span>
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
    _ <span class="hljs-string">"github.com/go-sql-driver/mysql"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 初始化数据库连接</span>
    db, err := sql.Open(<span class="hljs-string">"mysql"</span>, <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/test_db"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    <span class="hljs-keyword">defer</span> db.Close()

    <span class="hljs-comment">// 2. 初始化DAO实现（MySQL）</span>
    userDAO := dao.NewMySQLUserDAO(db)

    <span class="hljs-comment">// 3. 初始化服务层（注入DAO接口）</span>
    userService := service.NewUserService(userDAO)

    <span class="hljs-comment">// 4. 初始化接口层（注入服务层）</span>
    userHandler := handler.NewUserHandler(userService)

    <span class="hljs-comment">// 5. 启动HTTP服务</span>
    r := gin.Default()
    r.GET(<span class="hljs-string">"/users/:id"</span>, userHandler.GetUserByIDHandler)
    r.Run(<span class="hljs-string">":8080"</span>)
}

</code></pre>
<h3 data-id="heading-47">8.3 接口分层应用的核心优势</h3>
<ul>
<li>
<p><strong>解耦模块</strong>：服务层依赖DAO接口，不依赖具体实现，更换数据存储（如从MySQL改为PostgreSQL）时，只需修改DAO实现，无需修改服务层代码；</p>
</li>
<li>
<p><strong>便于测试</strong>：可以为DAO接口编写“模拟实现（Mock）”，在单元测试时隔离数据库，提高测试效率；</p>
</li>
<li>
<p><strong>并行开发</strong>：DAO接口定义完成后，服务层和DAO实现层可以并行开发（服务层基于接口编写逻辑，DAO层实现接口）；</p>
</li>
<li>
<p><strong>扩展性强</strong>：新增功能时，只需新增接口和实现，不影响原有代码，符合“开闭原则”。</p>
</li>
</ul>
<h3 data-id="heading-48">8.4 分层应用的最佳实践</h3>
<ul>
<li>
<p><strong>接口定义在“依赖方”所在的包</strong>：如UserDAO接口定义在service包（依赖方），而非dao包（实现方），避免循环依赖；</p>
</li>
<li>
<p><strong>依赖注入（DI）</strong>：通过构造函数将接口实现注入到依赖方（如UserService的NewUserService注入UserDAO），而非在依赖方内部直接创建实现；</p>
</li>
<li>
<p><strong>接口粒度适中</strong>：层间接口的粒度要平衡“复用性</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java单元测：jqwik框架入门（含完整Demo）]]></title>    <link>https://juejin.cn/post/7600710943250694186</link>    <guid>https://juejin.cn/post/7600710943250694186</guid>    <pubDate>2026-01-30T04:55:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600710943250694186" data-draft-id="7600709805469057067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java单元测：jqwik框架入门（含完整Demo）"/> <meta itemprop="keywords" content="后端,Java,单元测试"/> <meta itemprop="datePublished" content="2026-01-30T04:55:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java单元测：jqwik框架入门（含完整Demo）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:55:44.000Z" title="Fri Jan 30 2026 04:55:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    46
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java单元测：jqwik框架入门（含完整Demo）</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>在Java单元测试中，我们常依赖JUnit手动编写测试用例，但手动用例不仅繁琐，还容易遗漏边界场景和异常输入。而jqwik框架的出现，恰好解决了这一痛点——它是一款基于JUnit 5平台的属性测试（Property-Based Testing, PBT）框架，能自动生成海量测试数据，系统化验证代码的通用属性，帮我们快速捕捉隐藏的bug，让测试更高效、更全面。</p>
<h3 data-id="heading-2">1 什么是jqwik框架？</h3>
<p>jqwik（发音/ˈdʒeɪkwɪk/，谐音“jay quick”）是专为JVM设计的属性测试框架，核心目标是将属性测试（PBT）的强大能力融入Java、Kotlin等语言的测试流程，同时兼顾微测试的直观性。它并非替代JUnit，而是作为JUnit 5的扩展存在，可无缝集成到现有测试体系，无需大幅改动原有代码架构。</p>
<h4 data-id="heading-3">1.1 核心定位：属性测试 vs 传统测试</h4>
<p>传统JUnit测试属于“基于场景的测试”，我们需要预定义具体输入和预期输出（比如测试加法时，手动写1+1=2、2+3=5），只能覆盖有限场景；而属性测试则聚焦于代码的“通用属性”——即所有合法输入都应满足的规则（比如“任意两个整数a和b，a+b的结果应等于b+a”），框架会自动生成海量随机测试数据，验证这一属性是否始终成立。</p>
<h4 data-id="heading-4">1.2 jqwik的核心优势</h4>
<ul>
<li>无缝集成：基于JUnit 5平台开发，支持Maven、Gradle快速引入，可与IntelliJ IDEA、Eclipse等IDE无缝兼容，运行测试和查看结果的体验与JUnit一致。</li>
<li>自动生成测试数据：内置丰富的测试数据生成器（Arbitrary），支持基本类型、集合、字符串、自定义对象等，还可灵活配置数据约束（如“生成1-100的正整数”）。</li>
<li>智能反例缩小：当测试失败时，会自动将导致失败的复杂数据简化为最小反例（比如将长度100的异常字符串缩小为1个字符），快速定位问题根源。</li>
<li>高灵活性：支持自定义测试数据生成器、并行测试、测试数据过滤，适配复杂业务场景下的测试需求。</li>
<li>多语言支持：除Java外，还完美支持Kotlin、Groovy等JVM语言，适配不同项目的技术栈。</li>
</ul>
<h3 data-id="heading-5">2 jqwik怎么用？（基础步骤）</h3>
<p>使用jqwik的核心流程很简单：引入依赖 → 理解核心注解/概念 → 编写属性测试方法 → 运行测试并分析结果。下面分步拆解，新手也能快速上手。</p>
<h4 data-id="heading-6">2.1 第一步：引入依赖（Maven/Gradle）</h4>
<p>首先确保项目基于JUnit 5（Jupiter），然后在构建文件中引入jqwik依赖，这里给出最常用的Maven和Gradle配置（使用稳定版本1.5.2）。</p>
<h5 data-id="heading-7">Maven配置（pom.xml）</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>;
    <span class="hljs-comment">&lt;!-- JUnit 5 基础依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-comment">&lt;!-- jqwik 核心依赖（包含所有必要组件） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.jqwik<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jqwik-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h5 data-id="heading-8">Gradle配置（build.gradle）</h5>
<pre><code class="hljs language-groovy" lang="groovy">dependencies {
    // JUnit 5 基础依赖
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.2'
    // jqwik 核心依赖
    testImplementation 'net.jqwik:jqwik-all:1.5.2'
}

test {
    useJUnitPlatform() // 启用JUnit 5平台
}
</code></pre>
<h4 data-id="heading-9">2.2 第二步：理解jqwik核心概念与注解</h4>
<p>jqwik的使用依赖几个核心注解和概念，掌握这些就能编写基础的属性测试：</p>





























<table><thead><tr><th><strong>注解/概念</strong></th><th><strong>作用说明</strong></th></tr></thead><tbody><tr><td>@ExtendWith(JqwikExtension.class)</td><td>标记测试类，告知JUnit 5启用jqwik扩展，是编写jqwik测试的必备注解。</td></tr><tr><td>@Property</td><td>标记方法为“属性测试方法”，框架会自动执行该方法，并生成测试数据验证属性。</td></tr><tr><td>@ForAll</td><td>用于方法参数，指定该参数由jqwik自动生成测试数据，可结合数据约束使用（如@ForAll @IntRange(min=1, max=100)）。</td></tr><tr><td>Arbitrary</td><td>测试数据生成器的核心接口，代表“可生成某种类型测试数据的集合”，jqwik内置Arbitraries工具类提供常用生成器（如Arbitraries.ints()、Arbitraries.strings()）。</td></tr><tr><td>@Provide</td><td>标记方法为“自定义生成器方法”，方法返回Arbitrary类型，可自定义复杂测试数据（如自定义对象）。</td></tr></tbody></table>
<h4 data-id="heading-10">2.3 第三步：编写基础属性测试</h4>
<p>核心逻辑：定义“通用属性”（方法）→ 用@ForAll让框架自动生成参数 → 用断言验证属性是否成立。</p>
<h3 data-id="heading-11">3 实战Demo：用jqwik测试字符串工具类</h3>
<p>下面我们通过一个完整Demo，实战jqwik的使用——测试一个简单的字符串工具类，验证其“反转字符串”和“判空”两个功能的正确性，覆盖正常、边界、异常场景。</p>
<h4 data-id="heading-12">3.1 第一步：编写被测试的字符串工具类</h4>
<p>先创建一个简单的字符串工具类StringUtils，包含两个方法：反转字符串（reverse）、判断字符串非空（isNotEmpty）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.jqwik.demo;

<span class="hljs-comment">/**
 * 被测试的字符串工具类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringUtils</span> {

    <span class="hljs-comment">/**
     * 反转字符串
     * <span class="hljs-doctag">@param</span> str 输入字符串（可null）
     * <span class="hljs-doctag">@return</span> 反转后的字符串，null输入返回null
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">reverse</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(str).reverse().toString();
    }

    <span class="hljs-comment">/**
     * 判断字符串非空（非null、非空白）
     * <span class="hljs-doctag">@param</span> str 输入字符串
     * <span class="hljs-doctag">@return</span> true：非空；false：null或空白字符串
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNotEmpty</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">return</span> str != <span class="hljs-literal">null</span> &amp;&amp; !str.trim().isEmpty();
    }
}
</code></pre>
<h4 data-id="heading-13">3.2 第二步：编写jqwik测试类</h4>
<p>创建测试类StringUtilsTest，引入jqwik注解，编写两个属性测试方法，分别验证reverse和isNotEmpty的通用属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.jqwik.demo;

<span class="hljs-keyword">import</span> net.jqwik.api.Arbitraries;
<span class="hljs-keyword">import</span> net.jqwik.api.Arbitrary;
<span class="hljs-keyword">import</span> net.jqwik.api.ForAll;
<span class="hljs-keyword">import</span> net.jqwik.api.Provide;
<span class="hljs-keyword">import</span> net.jqwik.api.Property;
<span class="hljs-keyword">import</span> net.jqwik.api.constraints.NotBlank;
<span class="hljs-keyword">import</span> net.jqwik.api.constraints.Nullable;
<span class="hljs-keyword">import</span> net.jqwik.api.extension.JqwikExtension;
<span class="hljs-keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-comment">// 启用jqwik扩展，必备注解</span>
<span class="hljs-meta">@ExtendWith(JqwikExtension.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringUtilsTest</span> {

    <span class="hljs-comment">/**
     * 测试reverse方法的核心属性：反转两次的结果应与原字符串一致（支持null）
     * 这里<span class="hljs-doctag">@ForAll</span> <span class="hljs-doctag">@Nullable</span> String str 表示自动生成所有可能的字符串（包括null、空白、正常字符串）
     */</span>
    <span class="hljs-meta">@Property</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">reverseTwiceShouldBeOriginal</span><span class="hljs-params">(<span class="hljs-meta">@ForAll</span> <span class="hljs-meta">@Nullable</span> String str)</span> {
        <span class="hljs-comment">// 核心断言：反转两次的结果 == 原字符串</span>
        assertEquals(str, StringUtils.reverse(StringUtils.reverse(str)));
    }

    <span class="hljs-comment">/**
     * 测试isNotEmpty方法的核心属性1：非空白字符串返回true
     * <span class="hljs-doctag">@ForAll</span> <span class="hljs-doctag">@NotBlank</span> String str 表示自动生成所有非空白字符串（非null、非空白）
     */</span>
    <span class="hljs-meta">@Property</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notBlankStringShouldReturnTrue</span><span class="hljs-params">(<span class="hljs-meta">@ForAll</span> <span class="hljs-meta">@NotBlank</span> String str)</span> {
        assertTrue(StringUtils.isNotEmpty(str));
    }

    <span class="hljs-comment">/**
     * 测试isNotEmpty方法的核心属性2：空白/null字符串返回false
     * 自定义生成器：生成空白字符串（空格、制表符等）或null
     */</span>
    <span class="hljs-meta">@Property</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">blankOrNullStringShouldReturnFalse</span><span class="hljs-params">(<span class="hljs-meta">@ForAll("blankOrNullStrings")</span> String str)</span> {
        assertFalse(StringUtils.isNotEmpty(str));
    }

    <span class="hljs-comment">/**
     * 自定义测试数据生成器：生成空白字符串或null
     * <span class="hljs-doctag">@Provide</span> 注解标记，方法返回Arbitrary&lt;String&gt;（字符串生成器）
     */</span>
    <span class="hljs-meta">@Provide</span>
    Arbitrary&lt;String&gt; <span class="hljs-title function_">blankOrNullStrings</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 生成两种数据：null + 空白字符串（空格、制表符、空字符串），合并为一个生成器</span>
        Arbitrary&lt;String&gt; nullStrings = Arbitraries.just(<span class="hljs-literal">null</span>);
        Arbitrary&lt;String&gt; blankStrings = Arbitraries.strings()
                .withChars(<span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span>) <span class="hljs-comment">// 只生成空白字符</span>
                .ofMaxLength(<span class="hljs-number">10</span>); <span class="hljs-comment">// 最大长度10，避免生成过长字符串</span>
        <span class="hljs-keyword">return</span> Arbitraries.oneOf(nullStrings, blankStrings, Arbitraries.just(<span class="hljs-string">""</span>));
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 第三步：运行测试并查看结果</h4>
<p>直接在IDE中运行测试类（和运行JUnit测试一致），jqwik会自动生成测试数据，默认每个@Property方法生成1000组数据，我们可以查看运行结果：</p>
<h5 data-id="heading-15">1. 测试成功场景</h5>
<p>如果工具类逻辑正确，运行结果会显示“3 tests passed”（3个属性测试方法全部通过），控制台会输出类似信息：</p>
<pre><code class="hljs language-plain" lang="plain">[INFO] Running com.example.jqwik.demo.StringUtilsTest
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.523 s - in com.example.jqwik.demo.StringUtilsTest
</code></pre>
<p>这说明jqwik生成的1000×3组数据，全部满足我们定义的属性，工具类逻辑无明显bug。</p>
<h5 data-id="heading-16">2. 测试失败场景（模拟bug）</h5>
<p>我们故意修改reverse方法的逻辑（比如注释掉null判断，让null输入抛出异常），再运行测试，jqwik会快速捕捉到失败，并生成最小反例：</p>
<pre><code class="hljs language-plain" lang="plain">// 故意修改后的reverse方法（有bug）
public static String reverse(String str) {
    // 注释掉null判断，null输入会抛出NullPointerException
    return new StringBuilder(str).reverse().toString();
}

// 运行测试后，jqwik输出的失败信息（简化）
Property violation in com.example.jqwik.demo.StringUtilsTest.reverseTwiceShouldBeOriginal
Arguments: [null] // 最小反例：null
Throwable that caused failure: java.lang.NullPointerException
</code></pre>
<p>可以看到，jqwik自动定位到“null输入”这个边界场景，生成了最小反例（null），帮我们快速发现“null输入未处理”的bug，这正是属性测试的优势——手动测试很容易遗漏这类边界场景。</p>
<h3 data-id="heading-17">4 总结与进阶方向</h3>
<p>通过上面的介绍和Demo，相信你已经掌握了jqwik的基础用法：它以“属性测试”为核心，通过自动生成测试数据，帮我们解决传统手动测试的痛点，尤其适合验证算法、工具类、API等通用逻辑的正确性。</p>
<h4 data-id="heading-18">进阶学习方向（可选）</h4>
<ul>
<li>自定义复杂生成器：用@Provide和Arbitraries组合，生成自定义对象、枚举、复杂集合等测试数据（如资料中提到的Combinators.combine组合多个生成器）。</li>
<li>数据约束精细化：使用jqwik提供的更多约束注解（如@IntRange、@StringLength、@Email），精准控制测试数据的范围。</li>
<li>集成Spring Boot：通过jqwik-spring扩展，在Spring Boot项目中使用jqwik测试，支持@Autowired注入Bean。</li>
<li>并行测试与测试优化：配置jqwik并行运行测试，调整生成数据的数量、随机种子等，提升测试效率。</li>
</ul>
<blockquote>
<p>jqwik的官方文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fjqwik.net%2F" target="_blank" title="https://jqwik.net/" ref="nofollow noopener noreferrer">jqwik.net/</a>）提供了更详细的API说明和进阶用法，感兴趣的可以进一步查阅。总的来说，jqwik上手简单、功能强大，只需几行代码就能实现更全面的测试，值得每一个Java开发者纳入自己的测试工具箱～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>