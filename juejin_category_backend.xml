<?xml version="1.0" encoding="UTF-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>掘金 后端</title><link>https://juejin.cn/backend</link><atom:link href="http://10.0.0.5:1200/juejin/category/backend" rel="self" type="application/rss+xml"></atom:link><description>掘金 后端 - Powered by RSSHub</description><generator>RSSHub</generator><webMaster>contact@rsshub.app (RSSHub)</webMaster><language>en</language><lastBuildDate>Wed, 14 Jan 2026 07:16:58 GMT</lastBuildDate><ttl>5</ttl><item><title>31 岁半码农的自白：写了 9 年代码，最棒的“作品”是我的儿子</title><description>现在每天下午六点，我准时关了 IDEA，开车穿过 4 公里的晚高峰，20 分钟就到小区。 一、去年那个手忙脚乱的夏天，我差点错过儿子的成长 去年 5 月 23 号，老婆生了，是个儿子，我在产房陪产，当</description><link>https://juejin.cn/post/7594739292201566243</link><guid isPermaLink="false">https://juejin.cn/post/7594739292201566243</guid><pubDate>Wed, 14 Jan 2026 06:10:43 GMT</pubDate><author>天天摸鱼的java工程师</author><category>后端</category><category>Trae</category></item><item><title>C 语言实战：超市水果结算系统（深度解析与优化）</title><description>C 语言实战：超市水果结算系统（深度解析与优化） 你编写的这份超市结算系统功能完备、逻辑清晰，完美实现了水果累计购买、清单打印、结账找零等核心需求，是一份优秀的 C 语言实用项目代码。</description><link>https://juejin.cn/post/7594919272687124506</link><guid isPermaLink="false">https://juejin.cn/post/7594919272687124506</guid><pubDate>Wed, 14 Jan 2026 06:03:56 GMT</pubDate><author>小杨同学66</author><category>后端</category><category>算法</category><category>设计</category></item><item><title>2026全网详细JAVA八股文，欢迎收藏</title><description>一、什么是 JWT？ 1&amp;nbsp;JWT 的基本概念 JWT（JSON Web&amp;nbsp;Token）是一种开放标准（RFC 7519），用于在各方之间安全地传输信息。它由三部分组成，用点号（.）分隔： 一个典型的 J</description><link>https://juejin.cn/post/7594745643892457507</link><guid isPermaLink="false">https://juejin.cn/post/7594745643892457507</guid><pubDate>Wed, 14 Jan 2026 05:39:01 GMT</pubDate><author>Java水解</author><category>后端</category><category>Java</category></item><item><title>性能突破：星图平台架构优化</title><description>随着货拉拉业务的快速扩展与场景复杂度的提升，星图平台作为客服系统的核心枢纽，不仅承载高并发场景下的关键功能，还肩负着保障服务稳定与用户体验的重任。</description><link>https://juejin.cn/post/7594731175405518888</link><guid isPermaLink="false">https://juejin.cn/post/7594731175405518888</guid><pubDate>Wed, 14 Jan 2026 05:38:39 GMT</pubDate><author>货拉拉技术</author><category>后端</category></item><item><title>猿辅导二面：线上出现的OOM是如何排查的？</title><description>文章内容收录到个人网站，方便阅读：http://hardyfish.top/ 看是哪种OOM? 看报错信息/监控/容器事件，区分类型，不同解法完全不一样。 快速止血（把服务活下来） 取证与快速体检（上</description><link>https://juejin.cn/post/7594742976712949794</link><guid isPermaLink="false">https://juejin.cn/post/7594742976712949794</guid><pubDate>Wed, 14 Jan 2026 05:33:38 GMT</pubDate><author>程序员飞鱼</author><category>后端</category><category>面试</category><category>Java</category></item><item><title>Java注解校验实战</title><description>一、注解校验概述 1.1 为什么需要注解校验？ 在实际开发中，我们经常需要对输入数据进行校验： 注解校验的优势： ✅ 声明式：通过注解声明校验规则，代码更简洁 ✅ 可复用：校验逻辑可以复用，避免重复代</description><link>https://juejin.cn/post/7594843125320712218</link><guid isPermaLink="false">https://juejin.cn/post/7594843125320712218</guid><pubDate>Wed, 14 Jan 2026 05:06:26 GMT</pubDate><author>雨中飘荡的记忆</author><category>后端</category><category>Java</category></item><item><title>git 删除历史记录或历史大文件后 提交历史记录到新的仓库</title><description>我这里的情况是原有仓库已经关闭了，就只有手里的项目代码，现在需要将包括带有大文件的历史提交记录 clone到新的仓库中，而且新仓库已有代码和提交记录的情况下。</description><link>https://juejin.cn/post/7594854295746740260</link><guid isPermaLink="false">https://juejin.cn/post/7594854295746740260</guid><pubDate>Wed, 14 Jan 2026 04:27:56 GMT</pubDate><author>用户383551424028</author><category>后端</category><category>Git</category></item><item><title>Spring Boot多数据源配置实战指南：从选型到落地优化</title><description>Spring Boot多数据源配置实战指南：从选型到落地优化 在后端开发中，随着业务复杂度提升，单一数据源往往无法满足需求——比如电商系统需要区分订单库与用户库、数据归档场景需要同时操作业务库与历史库</description><link>https://juejin.cn/post/7594854295746707492</link><guid isPermaLink="false">https://juejin.cn/post/7594854295746707492</guid><pubDate>Wed, 14 Jan 2026 03:51:14 GMT</pubDate><author>回家路上绕了弯</author><category>后端</category><category>分布式</category></item><item><title>ebpf检测Linux系统要来了</title><description>哈喽，我是子牙老师，深耕计算机底层，手写过操作系统、Linux 内核等核心技术。此前推出《手写生产级 eBPF 内存监测工具》，结合学员需求，决定将工具升级为通用 Linux 系统检测工具！</description><link>https://juejin.cn/post/7594859060857225226</link><guid isPermaLink="false">https://juejin.cn/post/7594859060857225226</guid><pubDate>Wed, 14 Jan 2026 03:46:00 GMT</pubDate><author>硬核子牙</author><category>后端</category><category>Linux</category></item><item><title>Node.js 编程实战：博客系统 —— 数据库设计</title><description>一、数据库设计的重要性 数据库设计是博客系统的根基。它决定了： • 数据存储结构是否合理 • 功能扩展是否顺畅 • 查询性能是否高效 • 数据一致性是否有保障 如果在项目初期忽略数据库设计，后续改表和</description><link>https://juejin.cn/post/7594822511436333082</link><guid isPermaLink="false">https://juejin.cn/post/7594822511436333082</guid><pubDate>Wed, 14 Jan 2026 03:26:48 GMT</pubDate><author>程序员爱钓鱼</author><category>后端</category><category>前端</category><category>Node.js</category></item><item><title>Nginx分布式框架</title><description>Nginx 是一个高性能的HTTP和反向代理web服务器。 提供的服务： 动静分离（web 服务） 负载均衡 （反向代理） web 缓存 内存少，并发能力强。</description><link>https://juejin.cn/post/7594874733382336563</link><guid isPermaLink="false">https://juejin.cn/post/7594874733382336563</guid><pubDate>Wed, 14 Jan 2026 03:18:18 GMT</pubDate><author>优秀的颜</author><category>后端</category></item><item><title>Java Stream：Collectors.collectingAndThen() 用法详解</title><description>Collectors.collectingAndThen() 是一个收集器适配器，允许在收集完成后对结果进行转换。本文介绍其基本概念、基本用法、使用建议，仅供学习参考。</description><link>https://juejin.cn/post/7594859060856979466</link><guid isPermaLink="false">https://juejin.cn/post/7594859060856979466</guid><pubDate>Wed, 14 Jan 2026 03:16:52 GMT</pubDate><author>白衣鸽子</author><category>后端</category></item><item><title>Maven详细配置（完整笔记）</title><description>Maven：Java 领域开源自动化构建工具，基于项目对象模型（POM），统一依赖管理、构建流程，提升项目开发效率与协作一致性。</description><link>https://juejin.cn/post/7594831933515857966</link><guid isPermaLink="false">https://juejin.cn/post/7594831933515857966</guid><pubDate>Wed, 14 Jan 2026 03:13:42 GMT</pubDate><author>优秀的颜</author><category>后端</category></item><item><title>Ubuntu 24.04 PostgreSQL + PostGIS 完整安装与配置指南</title><description>Ubuntu 24.04 PostgreSQL + PostGIS 完整安装与配置指南 PostGIS 是 PostgreSQL 的空间数据库扩展，为地理空间数据提供了强大的存储、查询和分析功能。本教</description><link>https://juejin.cn/post/7594765626457030706</link><guid isPermaLink="false">https://juejin.cn/post/7594765626457030706</guid><pubDate>Wed, 14 Jan 2026 03:09:03 GMT</pubDate><author>勿忘初心720</author><category>后端</category></item><item><title>深入理解 LLVM：从编译器原理到 JIT 实战</title><description>本文从编译器基础概念开始，逐步深入到 LLVM 的实现细节和实际应用，帮助开发者全面理解 LLVM 的工作原理和使用方法。</description><link>https://juejin.cn/post/7594722586731642886</link><guid isPermaLink="false">https://juejin.cn/post/7594722586731642886</guid><pubDate>Wed, 14 Jan 2026 02:45:45 GMT</pubDate><author>杨杨杨大侠</author><category>后端</category><category>Java</category><category>JVM</category><category>编译器</category></item><item><title>SPI机制：服务扩展的核心技术</title><description>## 为什么需要SPI机制 ### SPI和API的区别是什么 SPI是一种跟API相对应的反向</description><link>https://juejin.cn/post/7594415509607333934</link><guid isPermaLink="false">https://juejin.cn/post/7594415509607333934</guid><pubDate>Tue, 13 Jan 2026 06:08:48 GMT</pubDate><author>SevenCoding</author><category>后端</category><category>Java</category></item><item><title>Java 异步调用失败导致系统崩溃？这份重试机制救了我</title><description>上线当天，异步任务因为网络不稳定而频繁失败，系统一直不断的报错。我加了重试和延迟机制，让任务自动重新执行，最终才能稳定完成，系统顺利度过流量高峰，再也不用为异步失败而手忙脚乱。</description><link>https://juejin.cn/post/7594322573453033515</link><guid isPermaLink="false">https://juejin.cn/post/7594322573453033515</guid><pubDate>Tue, 13 Jan 2026 01:17:59 GMT</pubDate><author>程序员大华</author><category>后端</category><category>Java</category></item><item><title>基于Netty的WebSocket服务端</title><description>前面用了两节内容介绍了基于Netty的TCP的Socket的相关内容。这一节开始我们介绍基于Netty的WebSocket的相关内容，我们同样可以按照服务端和客户端的方式分别介绍。</description><link>https://juejin.cn/post/7594337566722146314</link><guid isPermaLink="false">https://juejin.cn/post/7594337566722146314</guid><pubDate>Tue, 13 Jan 2026 01:10:05 GMT</pubDate><author>SimonKing</author><category>后端</category><category>Java</category><category>程序员</category></item><item><title>2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性</title><description>&lt;h2 data-id=&quot;heading-0&quot;&gt;2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性&lt;/h2&gt;
&lt;h3 data-id=&quot;heading-1&quot;&gt;为什么 PHP 8.4 在 2026 年仍然相关&lt;/h3&gt;
&lt;p&gt;如果你的团队计划&quot;今年上 PHP 8.5&quot;，很可能会先聊到 PHP 8.4——不管你愿不愿意。&lt;/p&gt;
&lt;p&gt;无聊但重要的原因是：支持窗口。&lt;/p&gt;
&lt;p&gt;根据官方 PHP 支持时间表，PHP 8.4（2024 年 11 月 21 日发布）仍处于活跃支持期，直到 2026 年 12 月 31 日，安全修复持续到 2028 年 12 月 31 日。&lt;/p&gt;
&lt;p&gt;这让 8.4 在 2026 年初成为一个合理的基线，特别是对于从 8.2/8.3 升级、想避免&quot;跳太远、坏太多&quot;的团队。&lt;/p&gt;
&lt;p&gt;但有意思的原因是技术层面的：PHP 8.4 悄悄重塑了日常 OOP 风格。它引入的特性减少了样板代码，让&quot;干净的 DTO&quot;和&quot;安全的领域对象&quot;更像是语言原生支持的东西：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Property hooks（头条功能）&lt;/li&gt;
&lt;li&gt;非对称属性可见性（读起来是 public，写起来是 private）&lt;/li&gt;
&lt;li&gt;一些生活质量改进（数组、弃用工具、DOM 等）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果你在 8.4 上内化了这些，升级到 8.5 往往感觉像&quot;添加一些好东西&quot;，而不是&quot;把整个 PHP 写法现代化&quot;。&lt;/p&gt;
&lt;p&gt;所以这篇文章可以当作基线知识：如果你还没上 8.4，这是你为 8.5 做准备应该知道的——但不会变成完整的升级清单。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://link.juejin.cn/?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Fphp-3-biggest-strengths-2026&quot; target=&quot;_blank&quot; title=&quot;https://catchadmin.com/post/2026-01/php-3-biggest-strengths-2026&quot; ref=&quot;nofollow noopener noreferrer&quot;&gt;原文 2026 年 PHP 8.4 依然重要：跳到 8.5 之前你该掌握的特性&lt;/a&gt;&lt;/p&gt;
&lt;h3 data-id=&quot;heading-2&quot;&gt;Property hooks：是什么、为什么重要、什么时候值得用&lt;/h3&gt;
&lt;p&gt;Property hooks 是 PHP 8.4 引入的。&lt;/p&gt;
&lt;p&gt;它让你可以直接在属性上附加 get 和/或 set 逻辑。可以理解为&quot;访问器方法&quot;，但不需要写：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;getFoo(): string&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;setFoo(string $foo): void&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;加上私有的 backing 字段&lt;/li&gt;
&lt;li&gt;加上在构造函数和工厂里重复的额外不变量&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 data-id=&quot;heading-3&quot;&gt;心智模型&lt;/h4&gt;
&lt;p&gt;带 hook 的属性仍然是属性。你还是用正常方式读写它：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$user&lt;/span&gt;-&amp;gt;email = &lt;span class=&quot;hljs-string&quot;&gt;&quot;  ADMIN@EXAMPLE.COM  &quot;&lt;/span&gt;;
&lt;span class=&quot;hljs-keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$user&lt;/span&gt;-&amp;gt;email;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但在底层，引擎把读写路由到 hook。&lt;/p&gt;
&lt;p&gt;完整形式的 hook 长这样：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Example&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$modified&lt;/span&gt; = &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$foo&lt;/span&gt; = &lt;span class=&quot;hljs-string&quot;&gt;&#39;default value&#39;&lt;/span&gt; {
        get {
            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;modified) {
                &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;foo . &lt;span class=&quot;hljs-string&quot;&gt;&#39; (modified)&#39;&lt;/span&gt;;
            }
            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;foo;
        }
        &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;set&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;) {
            &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;foo = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;);
            &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;modified = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这是手册里的示例，展示了核心思想：保留属性语法，同时获得集中化的行为。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-4&quot;&gt;Backed property vs virtual property（容易漏掉的部分）&lt;/h4&gt;
&lt;p&gt;Property hooks 可以创建两&quot;种&quot;属性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Backed property&lt;/strong&gt;：在对象中有存储的内存（普通属性），hook 操作 backing value。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Virtual property&lt;/strong&gt;：没有 backing 存储——是派生/计算的，像伪装成 &lt;code&gt;$area&lt;/code&gt; 的 &lt;code&gt;getArea()&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;手册解释说，如果两个 hook 都没有用精确语法引用 &lt;code&gt;$this-&amp;gt;propertyName&lt;/code&gt;，属性就是 virtual 的，virtual 属性不占内存空间。&lt;/p&gt;
&lt;p&gt;一个干净的 virtual property 示例：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Rectangle&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$h&lt;/span&gt;,
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$w&lt;/span&gt;,
    &lt;/span&gt;) &lt;/span&gt;{}
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$area&lt;/span&gt; {
        get =&amp;gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;h * &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;w;
    }
}
&lt;span class=&quot;hljs-variable&quot;&gt;$r&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Rectangle&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;);
&lt;span class=&quot;hljs-keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$r&lt;/span&gt;-&amp;gt;area;     &lt;span class=&quot;hljs-comment&quot;&gt;// 20&lt;/span&gt;
&lt;span class=&quot;hljs-variable&quot;&gt;$r&lt;/span&gt;-&amp;gt;area = &lt;span class=&quot;hljs-number&quot;&gt;30&lt;/span&gt;;     &lt;span class=&quot;hljs-comment&quot;&gt;// Error: no set operation defined&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这基本上是一个计算型 getter——但读起来像属性。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-5&quot;&gt;最有用的实际模式&lt;/h4&gt;
&lt;p&gt;专注于真正能减少 bug 和样板代码的模式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;模式 A：在 setter 中规范化输入（trim、大小写转换等）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;经典场景：邮箱、用户名、slug。你想接受杂乱输入但存储规范化的值。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;UserProfile&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt; {
        set =&amp;gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;));
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在简写形式中，表达式结果成为存储的 backing value。&lt;/p&gt;
&lt;p&gt;这已经很有用了，但生产代码通常还需要验证。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;模式 B：在边界处验证不变量（尽早抛出）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;例如，强制&quot;用户名至少 3 个字符&quot;并规范化空格。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;UserProfile&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$username&lt;/span&gt; {
        set {
            &lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;);
            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt; === &lt;span class=&quot;hljs-string&quot;&gt;&#39;&#39;&lt;/span&gt;) {
                &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;InvalidArgumentException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;Username cannot be empty.&#39;&lt;/span&gt;);
            }
            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt;) &amp;lt; &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;) {
                &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;InvalidArgumentException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;Username is too short.&#39;&lt;/span&gt;);
            }
            &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;username = &lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt;;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这让不变量紧挨着属性，而不是散落在控制器、请求验证器和构造函数各处。&lt;/p&gt;
&lt;p&gt;PHP 迁移指南甚至展示了类似的&quot;验证然后赋值&quot;模式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;模式 C：派生/virtual 的&quot;展示&quot;属性&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;常见的 DTO 需求：暴露 fullName 但不存储它。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Person&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$first&lt;/span&gt;,
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$last&lt;/span&gt;,
    &lt;/span&gt;) &lt;/span&gt;{}
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$fullName&lt;/span&gt; {
        get =&amp;gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;&lt;span class=&quot;hljs-subst&quot;&gt;{$this-&amp;gt;first}&lt;/span&gt; &lt;span class=&quot;hljs-subst&quot;&gt;{$this-&amp;gt;last}&lt;/span&gt;&quot;&lt;/span&gt;;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Virtual property 最适合的场景：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;确定性的，&lt;/li&gt;
&lt;li&gt;计算成本低，&lt;/li&gt;
&lt;li&gt;你永远不想&quot;set&quot;它们。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于历史上滥用魔术 &lt;code&gt;__get()&lt;/code&gt; 的团队，这是一个干净的基线。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;模式 D：&quot;计算一次，之后缓存&quot;（谨慎使用）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;有时计算值很昂贵（解析、构建对象）。你可以在对象内部缓存它。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;RequestContext&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; ?&lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$cachedClaims&lt;/span&gt; = &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$jwt&lt;/span&gt;,
    &lt;/span&gt;) &lt;/span&gt;{}
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$claims&lt;/span&gt; {
        get {
            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;cachedClaims !== &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;cachedClaims;
            }
            &lt;span class=&quot;hljs-comment&quot;&gt;// 假设 parseJwt() 做签名检查、base64 解码等&lt;/span&gt;
            &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;cachedClaims = &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;parseJwt&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$this&lt;/span&gt;-&amp;gt;jwt);
            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;cachedClaims;
        }
    }
    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;parseJwt&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$jwt&lt;/span&gt;&lt;/span&gt;): &lt;span class=&quot;hljs-title&quot;&gt;array&lt;/span&gt;
    &lt;/span&gt;{
        &lt;span class=&quot;hljs-comment&quot;&gt;// ...&lt;/span&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; [];
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这很方便，但也是 hook 可能变得&quot;太魔法&quot;的地方。如果你把重活藏在 &lt;code&gt;$obj-&amp;gt;claims&lt;/code&gt; 后面，可能会让调用者意外。只在人体工学真正超过成本时使用这个模式。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-6&quot;&gt;Hooks + 构造函数提升：一个微妙的坑&lt;/h4&gt;
&lt;p&gt;PHP 允许在提升的属性上使用 hook，但有一个重要规则：传给构造函数的值必须匹配属性声明的类型——不管你的 set hook 可能接受什么。&lt;/p&gt;
&lt;p&gt;也就是说你可以写：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;属性类型：&lt;code&gt;DateTimeInterface&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;set hook 接受：&lt;code&gt;string|DateTimeInterface&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;…但如果你用提升，构造函数参数类型仍然是 &lt;code&gt;DateTimeInterface&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果你真的想&quot;构造函数里也允许 string&quot;，你可能需要工厂或非提升的构造函数参数。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-7&quot;&gt;重要限制：property hooks 不能和 readonly 一起用&lt;/h4&gt;
&lt;p&gt;这对喜欢不可变对象的团队很重要。&lt;/p&gt;
&lt;p&gt;手册明确说明：property hooks 与 readonly 属性不兼容。&lt;/p&gt;
&lt;p&gt;所以如果你的风格是&quot;到处都是不可变值对象&quot;，hooks 不能替代那个。Hooks 更适合的场景是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DTO 和 request/response 对象&lt;/li&gt;
&lt;li&gt;配置对象&lt;/li&gt;
&lt;li&gt;内部可变但需要护栏的领域对象&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;（下一节会讲用非对称可见性实现&quot;半不可变 DTO&quot;。）&lt;/p&gt;
&lt;h4 data-id=&quot;heading-8&quot;&gt;另一个限制：引用和间接修改可能坑你&lt;/h4&gt;
&lt;p&gt;Hooks 拦截读写，这可能与引用冲突——特别是数组元素写入：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$obj&lt;/span&gt;-&amp;gt;arr[&lt;span class=&quot;hljs-string&quot;&gt;&#39;k&#39;&lt;/span&gt;] = &lt;span class=&quot;hljs-string&quot;&gt;&#39;v&#39;&lt;/span&gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;文档警告说，获取引用或间接修改可能绕过 set hook，并概述了约束（如 &lt;code&gt;&amp;amp;get&lt;/code&gt; 行为）和允许的情况。&lt;/p&gt;
&lt;p&gt;实用指南：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果调用者经常修改元素，避免在数组属性上用 hook。&lt;/li&gt;
&lt;li&gt;优先用&quot;替换整个数组&quot;模式（&lt;code&gt;$obj-&amp;gt;tags = [...$obj-&amp;gt;tags, $newTag];&lt;/code&gt;），这表现得像普通 set。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 data-id=&quot;heading-9&quot;&gt;什么时候不应该用 property hooks&lt;/h4&gt;
&lt;p&gt;Hooks 很棒……直到它们不是。在以下情况避免：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&quot;hook body&quot;开始做真正的编排（IO、网络调用、日志）。&lt;/li&gt;
&lt;li&gt;调试变得不清晰（&quot;为什么读这个属性会访问数据库？&quot;）。&lt;/li&gt;
&lt;li&gt;你的团队需要关键行为有显式的调用点。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一个有用的规则：property hooks 最适合实现&lt;strong&gt;局部不变量和局部转换&lt;/strong&gt;——真正属于属性本身的逻辑。&lt;/p&gt;
&lt;h3 data-id=&quot;heading-10&quot;&gt;其他影响日常工作的 PHP 8.4 特性（挑你真正会用的）&lt;/h3&gt;
&lt;p&gt;PHP 8.4 不只有 hooks。专注于以下类型的特性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;减少样板代码，&lt;/li&gt;
&lt;li&gt;减少 bug，&lt;/li&gt;
&lt;li&gt;或让代码更容易理解。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 data-id=&quot;heading-11&quot;&gt;特性：非对称属性可见性（public 读、受限写）&lt;/h4&gt;
&lt;p&gt;非对称可见性让你可以为读和写设置不同的可见性。&lt;/p&gt;
&lt;p&gt;示例：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Money&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;set&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$currency&lt;/span&gt;,
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;set&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$cents&lt;/span&gt;,
    &lt;/span&gt;) &lt;/span&gt;{}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;调用者可以读：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$m&lt;/span&gt;-&amp;gt;cents;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但不能写：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$m&lt;/span&gt;-&amp;gt;cents = &lt;span class=&quot;hljs-number&quot;&gt;500&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;// Error outside the class&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;迁移指南阐明了规则：第一个可见性是 get-visibility，第二个控制 set-visibility，get visibility 不能比 set visibility 更窄。&lt;/p&gt;
&lt;p&gt;这对 DTO 很重要：它给你一种&quot;大部分不可变&quot;的风格，而不必采用完整的值对象方法。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-12&quot;&gt;组合非对称可见性 + property hooks&lt;/h4&gt;
&lt;p&gt;这个组合经常替代经典的&quot;私有属性 + getter + setter&quot;。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;UserInput&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(set) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt; {
        set =&amp;gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;));
    }
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(set) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt; {
        set {
            &lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;);
            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt; === &lt;span class=&quot;hljs-string&quot;&gt;&#39;&#39;&lt;/span&gt;) {
                &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;InvalidArgumentException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;Name is required.&#39;&lt;/span&gt;);
            }
            &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;name = &lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt;;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;读是 public（对模板、序列化器、调试友好）&lt;/li&gt;
&lt;li&gt;写是受控的（对不变量友好）&lt;/li&gt;
&lt;li&gt;样板代码保持低&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 data-id=&quot;heading-13&quot;&gt;特性：新数组辅助函数（array_find、array_find_key、array_any、array_all）&lt;/h4&gt;
&lt;p&gt;PHP 8.4 新增了数组搜索/检查函数。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;array_find 和 array_find_key&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$users&lt;/span&gt; = [
    [&lt;span class=&quot;hljs-string&quot;&gt;&#39;id&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&#39;active&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;],
    [&lt;span class=&quot;hljs-string&quot;&gt;&#39;id&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&#39;active&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;],
    [&lt;span class=&quot;hljs-string&quot;&gt;&#39;id&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&#39;active&#39;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;],
];

&lt;span class=&quot;hljs-variable&quot;&gt;$first&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;array_find&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$users&lt;/span&gt;, fn (&lt;span class=&quot;hljs-variable&quot;&gt;$u&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;hljs-variable&quot;&gt;$u&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&#39;active&#39;&lt;/span&gt;] === &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;);
&lt;span class=&quot;hljs-comment&quot;&gt;// [&#39;id&#39; =&amp;gt; 2, &#39;active&#39; =&amp;gt; true]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果没找到，返回 &lt;code&gt;null&lt;/code&gt;——但如果&lt;strong&gt;值本身&lt;/strong&gt;就是 &lt;code&gt;null&lt;/code&gt;，你怎么区分&quot;找到 null&quot;和&quot;没找到&quot;？&lt;/p&gt;
&lt;p&gt;你可以用 &lt;code&gt;array_find_key()&lt;/code&gt; 来避免歧义（因为 key 不能是 null）。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$key&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;array_find_key&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$users&lt;/span&gt;, fn (&lt;span class=&quot;hljs-variable&quot;&gt;$u&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;hljs-variable&quot;&gt;$u&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&#39;active&#39;&lt;/span&gt;] === &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;);
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$key&lt;/span&gt; === &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;hljs-comment&quot;&gt;// 真的没找到&lt;/span&gt;
}
&lt;span class=&quot;hljs-variable&quot;&gt;$firstActive&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$users&lt;/span&gt;[&lt;span class=&quot;hljs-variable&quot;&gt;$key&lt;/span&gt;];
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;array_any 和 array_all 看起来简单——直到它们消除了噪音&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;例如：强制所有上传的文件都在大小限制内。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$ok&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;array_all&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$files&lt;/span&gt;, fn (&lt;span class=&quot;hljs-variable&quot;&gt;$f&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;hljs-variable&quot;&gt;$f&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&#39;size&#39;&lt;/span&gt;] &amp;lt;= &lt;span class=&quot;hljs-number&quot;&gt;5_000_000&lt;/span&gt;);
&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-variable&quot;&gt;$ok&lt;/span&gt;) {
    &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;One or more files are too large.&#39;&lt;/span&gt;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这替代了每个人都写得略有不同的 foreach + 标志变量。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-14&quot;&gt;特性：#[Deprecated] attribute 用于用户态弃用&lt;/h4&gt;
&lt;p&gt;PHP 一直有内部弃用机制，但 PHP 8.4 通过 &lt;code&gt;#[Deprecated]&lt;/code&gt; attribute 暴露了一个干净的用户态版本。&lt;/p&gt;
&lt;p&gt;手册说：使用已弃用的功能会触发 &lt;code&gt;E_USER_DEPRECATED&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;示例：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#[\Deprecated&lt;/span&gt;(&lt;span class=&quot;hljs-attr&quot;&gt;message&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;Use slugify() instead&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-attr&quot;&gt;since&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;2026-01&quot;&lt;/span&gt;)&lt;span class=&quot;hljs-meta&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;make_slug&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$s&lt;/span&gt;&lt;/span&gt;): &lt;span class=&quot;hljs-title&quot;&gt;string&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$s&lt;/span&gt;));
}

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;slugify&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$s&lt;/span&gt;&lt;/span&gt;): &lt;span class=&quot;hljs-title&quot;&gt;string&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-comment&quot;&gt;// 真正的实现&lt;/span&gt;
    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$s&lt;/span&gt;));
}

&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;make_slug&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这对团队来说被低估了：它给你一个标准化的方式来：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;标记旧的辅助函数，&lt;/li&gt;
&lt;li&gt;指导内部迁移，&lt;/li&gt;
&lt;li&gt;在 CI 日志中暴露弃用使用情况。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 data-id=&quot;heading-15&quot;&gt;特性：支持 HTML5 的新 DOM API（在 Dom 命名空间中）&lt;/h4&gt;
&lt;p&gt;如果你在 PHP 中解析过 HTML（爬取、清理、迁移脚本），PHP 8.4 是一次有意义的升级。&lt;/p&gt;
&lt;p&gt;8.4 发布公告介绍了带有标准兼容 HTML5 解析的新 DOM API、Dom 命名空间中的新类，以及方便的查询辅助函数。&lt;/p&gt;
&lt;p&gt;公告中的示例展示了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Dom\HTMLDocument::createFromString(...)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;querySelector(...)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;classList-&amp;gt;contains(...)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一个实际用例：安全地检测&quot;canonical&quot;链接标签。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$doc&lt;/span&gt; = &lt;span class=&quot;hljs-title class_&quot;&gt;Dom\HTMLDocument&lt;/span&gt;::&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;createFromString&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$html&lt;/span&gt;, LIBXML_NOERROR);
&lt;span class=&quot;hljs-variable&quot;&gt;$canonical&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$doc&lt;/span&gt;-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;querySelector&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;link[rel=&quot;canonical&quot;]&#39;&lt;/span&gt;);
&lt;span class=&quot;hljs-variable&quot;&gt;$url&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$canonical&lt;/span&gt;?-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;getAttribute&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;href&#39;&lt;/span&gt;);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;对于简单任务，这比经典的 DOMDocument + DOMXPath 组合好用得多，它减少了没人想维护的&quot;XPath 意大利面&quot;脚本。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-16&quot;&gt;特性：PDO 驱动特定子类（更精确的 API）&lt;/h4&gt;
&lt;p&gt;PHP 8.4 引入了驱动特定的 PDO 子类，如 &lt;code&gt;Pdo\MySql&lt;/code&gt;、&lt;code&gt;Pdo\Pgsql&lt;/code&gt;、&lt;code&gt;Pdo\Sqlite&lt;/code&gt; 等，并在发布公告中展示了新的连接风格。&lt;/p&gt;
&lt;p&gt;在 PHP 8.4 示例中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PDO::connect(...)&lt;/code&gt; 返回 &lt;code&gt;Pdo\Sqlite&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;驱动特定方法只存在于相关的地方&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这改善了正确性和 IDE 支持，特别是在测试和生产混用不同驱动的代码库中。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-17&quot;&gt;附加：Lazy objects（主要用于框架和基础设施代码）&lt;/h4&gt;
&lt;p&gt;PHP 8.4 还引入了 lazy objects 概念：初始化被延迟到访问时才进行的对象。迁移指南明确指出框架可以利用它们来延迟获取依赖或数据。&lt;/p&gt;
&lt;p&gt;它甚至展示了使用 &lt;code&gt;ReflectionClass::newLazyGhost(...)&lt;/code&gt; 的核心机制。&lt;/p&gt;
&lt;p&gt;这不是你在日常应用代码中会天天用的东西，但如果你做：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DI 容器，&lt;/li&gt;
&lt;li&gt;ORM，&lt;/li&gt;
&lt;li&gt;代理层，&lt;/li&gt;
&lt;li&gt;或对性能敏感的 bootstrap，&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;…值得知道它的存在，因为你会在生态系统内部看到它。&lt;/p&gt;
&lt;h3 data-id=&quot;heading-18&quot;&gt;PHP 8.4 如何改变 OOP 风格（尤其是 DTO）&lt;/h3&gt;
&lt;p&gt;如果你写 PHP 很多年，你可能经历过至少三种 DTO 风格：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&quot;到处都是 public 属性&quot;&lt;/li&gt;
&lt;li&gt;&quot;所有东西都是私有属性 + getter/setter&quot;&lt;/li&gt;
&lt;li&gt;&quot;readonly 提升属性&quot;（好用，但死板）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;PHP 8.4 增加了第四种，非常实用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;public 读，&lt;/li&gt;
&lt;li&gt;受控写，&lt;/li&gt;
&lt;li&gt;不变量靠近数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 data-id=&quot;heading-19&quot;&gt;8.4 之前：常见的 DTO 样板代码&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateUserCommand&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt;;
    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;;
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;&lt;/span&gt;)
    &lt;/span&gt;{
        &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;email = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt;));
        &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;name = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;);
        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;name === &lt;span class=&quot;hljs-string&quot;&gt;&#39;&#39;&lt;/span&gt;) {
            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;InvalidArgumentException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;Name is required.&#39;&lt;/span&gt;);
        }
    }
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;email&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;): &lt;span class=&quot;hljs-title&quot;&gt;string&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;email; }
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;name&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;): &lt;span class=&quot;hljs-title&quot;&gt;string&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;name; }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;没什么问题。只是重复，特别是在几十个消息对象上。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-20&quot;&gt;8.4 之后：&quot;public 读 + private 写 + hooks&quot;&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CreateUserCommand&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(set) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt; {
        set =&amp;gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strtolower&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;));
    }
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(set) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt; {
        set {
            &lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$value&lt;/span&gt;);
            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt; === &lt;span class=&quot;hljs-string&quot;&gt;&#39;&#39;&lt;/span&gt;) {
                &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;InvalidArgumentException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&#39;Name is required.&#39;&lt;/span&gt;);
            }
            &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;name = &lt;span class=&quot;hljs-variable&quot;&gt;$v&lt;/span&gt;;
        }
    }
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;&lt;/span&gt;)
    &lt;/span&gt;{
        &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;email = &lt;span class=&quot;hljs-variable&quot;&gt;$email&lt;/span&gt;;
        &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;name = &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;你得到：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;强类型&lt;/li&gt;
&lt;li&gt;集中化的规范化/验证&lt;/li&gt;
&lt;li&gt;Public 可读性（在模板、日志、序列化器中方便）&lt;/li&gt;
&lt;li&gt;没有访问器样板&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;而且你仍然可以用测试保持严格。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-21&quot;&gt;一个现实的&quot;DTO + 派生属性&quot;模式&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&quot;hljs language-php&quot; lang=&quot;php&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Address&lt;/span&gt;
&lt;/span&gt;{
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;set&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$line1&lt;/span&gt;,
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;set&lt;/span&gt;) ?&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$line2&lt;/span&gt;,
        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;set&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$city&lt;/span&gt;,
    &lt;/span&gt;) &lt;/span&gt;{}
    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$singleLine&lt;/span&gt; {
        get =&amp;gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trim&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$this&lt;/span&gt;-&amp;gt;line1 . &lt;span class=&quot;hljs-string&quot;&gt;&#39; &#39;&lt;/span&gt; . (&lt;span class=&quot;hljs-variable&quot;&gt;$this&lt;/span&gt;-&amp;gt;line2 ?? &lt;span class=&quot;hljs-string&quot;&gt;&#39;&#39;&lt;/span&gt;) . &lt;span class=&quot;hljs-string&quot;&gt;&#39;, &#39;&lt;/span&gt; . &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;city);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;你可以保持存储字段干净，并提供一个友好的派生字段而不引入额外方法。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-22&quot;&gt;readonly 仍然胜出的场景&lt;/h4&gt;
&lt;p&gt;因为 hooks 不能和 readonly 一起用，不可变值对象仍然依赖：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;readonly 提升属性&lt;/li&gt;
&lt;li&gt;工厂&lt;/li&gt;
&lt;li&gt;显式的 &lt;code&gt;withX()&lt;/code&gt; 方法（在 PHP 8.5 里更好用了，但那是另一篇文章的事）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以很多团队的实际分工是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;值对象&lt;/strong&gt;：readonly + 显式行为&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DTO / 命令 / 请求&lt;/strong&gt;：非对称可见性 + hooks&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 data-id=&quot;heading-23&quot;&gt;经常影响测试/CI 的简短兼容性说明&lt;/h3&gt;
&lt;p&gt;这一节故意简短，但是能省时间的那种简短。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-24&quot;&gt;错误报告级别：E_STRICT 没了&lt;/h4&gt;
&lt;p&gt;PHP 8.4 移除了 E_STRICT 错误级别，E_STRICT 常量已弃用。&lt;/p&gt;
&lt;p&gt;如果你有遗留代码或配置引用了 E_STRICT，可能会看到 CI 行为变化。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-25&quot;&gt;JIT 配置默认值变了（OPcache）&lt;/h4&gt;
&lt;p&gt;PHP 8.4 中 JIT 配置的默认值变了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从 &lt;code&gt;opcache.jit=tracing&lt;/code&gt; 和 &lt;code&gt;opcache.jit_buffer_size=0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;到 &lt;code&gt;opcache.jit=disable&lt;/code&gt; 和 &lt;code&gt;opcache.jit_buffer_size=64M&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这不会改变&quot;JIT 默认关闭&quot;，但可能影响之前只切换其中一个值的环境。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-26&quot;&gt;一些扩展变得更严格（类型化常量、ValueError、行为变更）&lt;/h4&gt;
&lt;p&gt;8.4 不兼容列表中的一些例子：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;几个扩展类常量现在有类型（Date、Intl、PDO、Reflection、SPL、Sqlite、XMLReader）。&lt;/li&gt;
&lt;li&gt;一些函数现在抛 ValueError 而不是静默接受无效输入（如 &lt;code&gt;round()&lt;/code&gt; 无效模式、&lt;code&gt;str_getcsv()&lt;/code&gt; 无效分隔符长度）。&lt;/li&gt;
&lt;li&gt;SimpleXML 迭代行为变了以避免意外的 rewind（之前可能导致无限循环）。&lt;/li&gt;
&lt;li&gt;根据驱动，一些 PDO 属性现在表现为布尔而非整数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些是那种除非你尽早在 8.4 下运行测试套件，否则会表现为&quot;随机测试失败&quot;的变更。&lt;/p&gt;
&lt;h3 data-id=&quot;heading-27&quot;&gt;小型迁移：采用 PHP 8.4 的小步骤，无需大重构&lt;/h3&gt;
&lt;p&gt;如果你还没上 8.4——或者上了但没用这些特性——这是一个通常有效的安全顺序。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-28&quot;&gt;步骤 1：先把 8.4 加到 CI，即使生产还没准备好&lt;/h4&gt;
&lt;p&gt;确保你能在 8.4 上运行测试套件而不出意外。把警告和弃用当作信号。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-29&quot;&gt;步骤 2：只在新代码中采用 array_find / array_any / array_all&lt;/h4&gt;
&lt;p&gt;不要重构整个代码库。只是不要再写新的&quot;foreach-with-break&quot;循环，除非它们真的更清晰。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-30&quot;&gt;步骤 3：对新的 DTO 和请求对象使用非对称可见性&lt;/h4&gt;
&lt;p&gt;这是低风险的：你主要是改变属性声明并消除一类意外修改。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-31&quot;&gt;步骤 4：在明显替代样板代码的地方添加 property hooks&lt;/h4&gt;
&lt;p&gt;从以下开始：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;trim 和大小写规范化，&lt;/li&gt;
&lt;li&gt;简单验证，&lt;/li&gt;
&lt;li&gt;派生属性。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一开始避免在 hooks 里放重逻辑。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-32&quot;&gt;步骤 5：用 #[Deprecated] 进行内部 API 清理&lt;/h4&gt;
&lt;p&gt;用清晰的消息标记旧方法和辅助函数。在 CI 日志中跟踪使用情况。让弃用可操作。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-33&quot;&gt;步骤 6：只在脚本或隔离模块中采用新 DOM API&lt;/h4&gt;
&lt;p&gt;如果你的应用做 HTML 解析，新 API 可能是很大的改进——但一开始保持采用范围受限。&lt;/p&gt;
&lt;h4 data-id=&quot;heading-34&quot;&gt;步骤 7：把 lazy objects 留给框架/基础设施层&lt;/h4&gt;
&lt;p&gt;知道这个特性存在。不要强行塞进应用代码，除非你有非常具体的性能或架构原因。&lt;/p&gt;
&lt;h3 data-id=&quot;heading-35&quot;&gt;通往 PHP 8.5 的桥梁（为什么 8.4 让下一步更容易）&lt;/h3&gt;
&lt;p&gt;一旦你的团队熟悉了 PHP 8.4 的&quot;现代基线&quot;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DTO 因为非对称可见性 + hooks 变得更干净&lt;/li&gt;
&lt;li&gt;弃用策略因为 &lt;code&gt;#[Deprecated]&lt;/code&gt; 变得更系统化&lt;/li&gt;
&lt;li&gt;数组重型代码可以用原生辅助函数表达得更清晰&lt;/li&gt;
&lt;li&gt;HTML 解析和工具脚本变得不那么痛苦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个基线减少了迁移到 PHP 8.5 的摩擦，因为你已经现代化了代码库中对象和日常工具的写法。PHP 8.5 就不再是&quot;追赶&quot;，而是选择性地采用改进。&lt;/p&gt;
&lt;h3 data-id=&quot;heading-36&quot;&gt;结论&lt;/h3&gt;
&lt;p&gt;PHP 8.4 不是一个&quot;跳过它，直接上 8.5&quot;的版本。在 2026 年，它仍然是一个明智的基线，因为它受支持、广泛相关，而且它改变了日常 PHP 的人体工学——尤其是在 OOP 密集的代码库中。&lt;/p&gt;
&lt;p&gt;如果你从这篇回顾中只带走一件事，那就是 property hooks——但要带着意图使用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用它们做不变量、规范化和干净的派生值，&lt;/li&gt;
&lt;li&gt;把它们和非对称可见性配对做实用的 DTO，&lt;/li&gt;
&lt;li&gt;让 hooks 保持无聊（往好的方向）。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个组合让你今天就有更干净的 8.4 代码库——以及准备好时通往 8.5 的更平滑路径。&lt;/p&gt;</description><link>https://juejin.cn/post/7594302398686674998</link><guid isPermaLink="false">https://juejin.cn/post/7594302398686674998</guid><pubDate>Mon, 12 Jan 2026 23:15:51 GMT</pubDate><author>BingoGo</author><category>后端</category><category>PHP</category></item><item><title>在Swarm中部署Nacos并配置外部MySQL</title><description>在Swarm中部署Nacos并配置外部MySQL 1. 项目结构调整 2. Nacos数据库初始化脚本 config/mysql-init/nacos-schema.sql config/mysql-</description><link>https://juejin.cn/post/7594309641867591718</link><guid isPermaLink="false">https://juejin.cn/post/7594309641867591718</guid><pubDate>Mon, 12 Jan 2026 22:21:36 GMT</pubDate><author>都叫我大帅哥</author><category>后端</category></item></channel></rss>